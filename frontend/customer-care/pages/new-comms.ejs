<style>
        .chat-scroll::-webkit-scrollbar { width: 5px; }
        .chat-scroll::-webkit-scrollbar-thumb { background: #cbd5e1; border-radius: 10px; }
        
        .bubble-in { 
            border-radius: 0 15px 15px 15px; 
            background: white; 
            box-shadow: 0 1px 2px rgba(0,0,0,0.1); 
        }
        .bubble-out { 
            border-radius: 15px 0 15px 15px; 
            background: #dcf8c6; 
            box-shadow: 0 1px 2px rgba(0,0,0,0.1); 
        }
        .chat-bg { 
            background-color: #e5ddd5; 
            background-image: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="100" height="100" opacity="0.05"><text x="10" y="50" font-size="80" fill="%23999">ðŸ’¬</text></svg>');
        }
        .message-group:hover .admin-delete { opacity: 1; }
    </style>
</head>
<div class="bg-gray-100 h-screen overflow-hidden flex flex-col">

    <!-- Header -->
    <header class="bg-teal-700 text-white p-4 flex justify-between items-center shadow-md z-30">
        <h1 class="text-lg md:text-xl font-bold tracking-tight">
            <i class="fas fa-comments mr-2"></i>TEAM COMMUNICATION
        </h1>
        <div class="flex items-center gap-3">
            <div class="bg-teal-600 px-3 py-1 rounded-full text-xs font-semibold">
                <i class="fas fa-user-shield mr-1"></i>
                <span id="currentUserName">Admin User</span>
            </div>
            <label class="flex items-center gap-2 bg-teal-600 px-3 py-2 rounded cursor-pointer hover:bg-teal-800 transition">
                <input type="checkbox" id="adminToggle" checked onchange="toggleAdminMode()" class="w-3 h-3">
                <span class="text-xs font-semibold">Admin Mode</span>
            </label>
        </div>
    </header>

    <div class="flex flex-1 overflow-hidden">
        <!-- Sidebar -->
        <aside class="w-full md:w-72 border-r bg-white flex flex-col z-20 md:relative absolute inset-0 md:translate-x-0" id="sidebar">
            <!-- Channels & DMs Section -->
            <div class="flex-1 overflow-y-auto chat-scroll">
                <!-- Channels -->
                <div class="p-4 border-b bg-teal-50">
                    <h3 class="text-xs font-bold text-teal-700 uppercase flex items-center gap-2 mb-3">
                        <i class="fas fa-hashtag"></i> Team Channels
                    </h3>
                    <ul id="channelList" class="space-y-1"></ul>
                </div>

                <!-- Direct Messages -->
                <div class="p-4 border-b">
                    <h3 class="text-xs font-bold text-gray-600 uppercase flex items-center gap-2 mb-3">
                        <i class="fas fa-user"></i> Direct Messages
                    </h3>
                    <ul id="dmList" class="space-y-1"></ul>
                </div>

                <!-- Announcements -->
                <div class="p-4 bg-amber-50">
                    <div class="flex justify-between items-center mb-3">
                        <h3 class="text-xs font-bold text-amber-800 uppercase flex items-center gap-2">
                            <i class="fas fa-bullhorn"></i> Announcements
                        </h3>
                        <button id="addAnnounceBtn" onclick="toggleAnnouncementModal()" 
                            class="bg-amber-500 text-white p-1.5 rounded hover:bg-amber-600 transition text-xs">
                            <i class="fas fa-plus"></i>
                        </button>
                    </div>
                    <div id="announcementsList" class="space-y-2 max-h-64 overflow-y-auto chat-scroll">
                        <p class="text-xs text-gray-400 italic">No announcements</p>
                    </div>
                </div>
            </div>
        </aside>

        <!-- Main Chat Area -->
        <main class="flex-1 flex flex-col bg-white hidden md:flex" id="mainDisplay">
            <!-- Chat Header -->
            <div class="p-4 border-b flex justify-between items-center bg-white shadow-sm">
                <div class="flex items-center gap-3">
                    <button onclick="closeChatMobile()" class="md:hidden p-2 text-gray-600">
                        <i class="fas fa-arrow-left"></i>
                    </button>
                    <div>
                        <h2 id="chatTitle" class="text-lg font-bold text-teal-800 flex items-center gap-2">
                            <i class="fas fa-hashtag"></i> General
                        </h2>
                        <p id="chatDesc" class="text-xs text-teal-600">Team wide announcements and chatter</p>
                    </div>
                </div>
            </div>

            <!-- Messages -->
            <div class="flex-1 flex flex-col chat-bg">
                <div id="chatMessages" class="flex-1 overflow-y-auto p-4 chat-scroll flex flex-col gap-3">
                    <div class="text-center text-gray-400 py-10">
                        <i class="fas fa-comment-slash text-5xl mb-3"></i>
                        <p class="text-sm">No messages yet. Start the conversation!</p>
                    </div>
                </div>

                <!-- Message Input -->
                <div class="p-3 bg-white border-t flex gap-2">
                    <button class="text-gray-400 hover:text-gray-600 p-2">
                        <i class="fas fa-paperclip text-lg"></i>
                    </button>
                    <textarea 
                        id="messageInput" 
                        rows="1" 
                        placeholder="Type a message..." 
                        class="flex-1 p-2 bg-gray-100 border-none rounded-full px-4 text-sm outline-none resize-none"
                        oninput="autoResize(this)"
                        onkeypress="if(event.key==='Enter' && !event.shiftKey) { event.preventDefault(); sendMessage(); }"></textarea>
                    <button onclick="sendMessage()" class="bg-teal-600 hover:bg-teal-700 text-white px-4 rounded-full transition">
                        <i class="fas fa-paper-plane"></i>
                    </button>
                </div>
            </div>
        </main>
    </div>

    <!-- Announcement Modal -->
    <div id="announcementModal" class="hidden fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center p-4">
        <div class="bg-white rounded-2xl shadow-2xl w-full max-w-lg">
            <div class="p-6 border-b bg-amber-50">
                <h2 class="text-xl font-bold text-amber-800 flex items-center gap-2">
                    <i class="fas fa-bullhorn"></i> New Announcement
                </h2>
            </div>
            <form onsubmit="saveAnnouncement(event)" class="p-6 space-y-4">
                <div>
                    <label class="block text-sm font-semibold text-gray-700 mb-1">Title</label>
                    <input type="text" id="annTitle" required placeholder="Announcement title..." 
                        class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-amber-500 outline-none">
                </div>
                <div>
                    <label class="block text-sm font-semibold text-gray-700 mb-1">Message</label>
                    <textarea id="annBody" required rows="4" placeholder="Announcement details..." 
                        class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-amber-500 outline-none resize-none"></textarea>
                </div>
                <div class="flex gap-3 pt-2">
                    <button type="submit" class="flex-1 bg-amber-600 text-white py-2.5 rounded-lg font-bold hover:bg-amber-700 transition">
                        Post Announcement
                    </button>
                    <button type="button" onclick="toggleAnnouncementModal()" class="px-6 py-2.5 text-gray-600 font-semibold hover:text-gray-900">
                        Cancel
                    </button>
                </div>
            </form>
        </div>
    </div>
</div>
    <script>
        // Data
        let isAdmin = true;
        let activeChannel = 'general';
        let currentUser = { id: 1, name: 'Admin User' };

        const channels = [
            { id: 'general', name: 'General', desc: 'Team wide announcements and chatter' },
            { id: 'dev', name: 'Development', desc: 'Code, bugs, and coffee' },
            { id: 'marketing', name: 'Marketing', desc: 'Campaigns and social media' }
        ];

        const staff = [
            { id: 101, name: 'Sarah Jenkins', status: 'online' },
            { id: 102, name: 'Mike Ross', status: 'busy' },
            { id: 103, name: 'Rachel Zane', status: 'offline' }
        ];

        let messages = [
            { id: 1, channel: 'general', userId: 101, name: 'Sarah Jenkins', text: 'Has anyone seen the new designs?', time: '10:30 AM' },
            { id: 2, channel: 'general', userId: 1, name: 'Admin User', text: 'Yes, I uploaded them to the drive.', time: '10:32 AM' },
            { id: 3, channel: 'general', userId: 102, name: 'Mike Ross', text: 'Great work team!', time: '10:35 AM' },
            { id: 4, channel: 'dev', userId: 101, name: 'Sarah Jenkins', text: 'Bug on line 42 needs fixing', time: '11:00 AM' },
            { id: 5, channel: 'dm-101', userId: 1, name: 'Admin User', text: 'Hey Sarah, can we chat about the project?', time: '11:15 AM' },
            { id: 6, channel: 'dm-101', userId: 101, name: 'Sarah Jenkins', text: 'Sure! What do you need?', time: '11:16 AM' }
        ];

        let announcements = [
            { id: 1, title: 'Server Maintenance', body: 'Servers will be down this Sunday at 2 AM for upgrades.', date: 'Jan 23' },
            { id: 2, title: 'Welcome New Staff', body: 'Please welcome John to the design team!', date: 'Jan 21' }
        ];

        // Initialize
        window.onload = () => {
            renderSidebar();
            renderMessages();
            renderAnnouncements();
            checkAdminVisibility();
        };

        // Render Functions
        function renderSidebar() {
            // Channels
            const cList = document.getElementById('channelList');
            cList.innerHTML = channels.map(c => `
                <li onclick="switchChannel('${c.id}'); openChatMobile();" 
                    class="cursor-pointer px-3 py-2 rounded-lg transition ${activeChannel === c.id ? 'bg-teal-600 text-white' : 'text-gray-700 hover:bg-teal-100'}">
                    <div class="flex items-center gap-2">
                        <i class="fas fa-hashtag text-xs"></i>
                        <span class="font-medium text-sm">${c.name}</span>
                    </div>
                </li>
            `).join('');

            // Direct Messages
            const dList = document.getElementById('dmList');
            dList.innerHTML = staff.map(s => `
                <li onclick="switchChannel('dm-${s.id}'); openChatMobile();" 
                    class="cursor-pointer px-3 py-2 rounded-lg transition ${activeChannel === 'dm-'+s.id ? 'bg-gray-200 text-gray-900' : 'text-gray-700 hover:bg-gray-100'}">
                    <div class="flex items-center gap-3">
                        <div class="relative">
                            <div class="w-8 h-8 rounded-full ${s.status === 'online' ? 'bg-teal-600' : s.status === 'busy' ? 'bg-red-500' : 'bg-gray-400'} text-white flex items-center justify-center text-xs font-bold">
                                ${s.name.charAt(0).toUpperCase()}
                            </div>
                            ${s.status === 'online' ? '<div class="absolute bottom-0 right-0 w-2.5 h-2.5 bg-green-500 rounded-full border-2 border-white"></div>' : ''}
                        </div>
                        <span class="font-medium text-sm">${s.name}</span>
                    </div>
                </li>
            `).join('');
        }

        function renderMessages() {
            const feed = document.getElementById('chatMessages');
            const filtered = messages.filter(m => m.channel === activeChannel);

            // Update Header
            const currentC = channels.find(c => c.id === activeChannel);
            if(currentC) {
                document.getElementById('chatTitle').innerHTML = `<i class="fas fa-hashtag"></i> ${currentC.name}`;
                document.getElementById('chatDesc').innerText = currentC.desc;
            } else if (activeChannel.startsWith('dm-')) {
                const uid = parseInt(activeChannel.split('-')[1]);
                const u = staff.find(s => s.id === uid);
                document.getElementById('chatTitle').innerHTML = `<i class="fas fa-user"></i> ${u.name}`;
                document.getElementById('chatDesc').innerText = "Direct Message";
            }

            // Render Messages
            if (filtered.length === 0) {
                feed.innerHTML = `
                    <div class="text-center text-gray-400 py-10">
                        <i class="fas fa-comment-slash text-5xl mb-3"></i>
                        <p class="text-sm">No messages yet. Start the conversation!</p>
                    </div>`;
                return;
            }

            feed.innerHTML = filtered.map(m => {
                const isMe = m.userId === currentUser.id;
                return `
                <div class="message-group ${isMe ? 'self-end' : 'self-start'} max-w-[75%] relative">
                    ${!isMe ? `<span class="text-[10px] text-gray-600 ml-2 block mb-1">${escapeHtml(m.name)}</span>` : ''}
                    
                    <div class="${isMe ? 'bubble-out' : 'bubble-in'} p-3 text-sm text-gray-800 relative">
                        ${escapeHtml(m.text)}
                        <span class="block text-[9px] text-gray-400 text-right mt-1">${m.time}</span>
                        
                        ${isAdmin ? `
                            <button onclick="deleteMessage(${m.id})" 
                                class="admin-delete absolute -top-2 ${isMe ? '-left-8' : '-right-8'} opacity-0 transition-opacity bg-white text-red-500 p-1.5 rounded-full shadow-md border hover:bg-red-50">
                                <i class="fas fa-trash text-xs"></i>
                            </button>
                        ` : ''}
                    </div>
                </div>
                `;
            }).join('');

            feed.scrollTop = feed.scrollHeight;
        }

        function renderAnnouncements() {
            const container = document.getElementById('announcementsList');
            if (!announcements.length) {
                container.innerHTML = `<p class="text-xs text-gray-400 italic">No announcements</p>`;
                return;
            }

            container.innerHTML = announcements.map(a => `
                <div class="p-3 bg-white border-l-4 border-amber-500 rounded shadow-sm group relative">
                    <div class="flex justify-between items-start mb-1">
                        <span class="bg-amber-100 text-amber-800 text-[9px] font-bold px-2 py-0.5 rounded uppercase">Notice</span>
                        <span class="text-[9px] text-gray-400">${a.date}</span>
                    </div>
                    <h4 class="font-bold text-gray-800 text-xs mb-1">${escapeHtml(a.title)}</h4>
                    <p class="text-gray-600 text-[11px] leading-relaxed">${escapeHtml(a.body.substring(0, 80))}${a.body.length > 80 ? '...' : ''}</p>
                    
                    ${isAdmin ? `
                        <button onclick="deleteAnnouncement(${a.id})" 
                            class="absolute top-2 right-2 text-gray-300 hover:text-red-500 opacity-0 group-hover:opacity-100 transition">
                            <i class="fas fa-times text-xs"></i>
                        </button>
                    ` : ''}
                </div>
            `).join('');
        }

        // Actions
        function switchChannel(id) {
            activeChannel = id;
            renderSidebar();
            renderMessages();
        }

        function sendMessage() {
            const input = document.getElementById('messageInput');
            const text = input.value.trim();
            if(!text) return;

            const newMsg = {
                id: Date.now(),
                channel: activeChannel,
                userId: currentUser.id,
                name: currentUser.name,
                text: text,
                time: new Date().toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'})
            };

            messages.push(newMsg);
            input.value = '';
            input.style.height = 'auto';
            renderMessages();
        }

        function deleteMessage(id) {
            if(!confirm("Delete this message?")) return;
            messages = messages.filter(m => m.id !== id);
            renderMessages();
        }

        function toggleAnnouncementModal() {
            if(!isAdmin) {
                alert("Only admins can post announcements.");
                return;
            }
            const modal = document.getElementById('announcementModal');
            modal.classList.toggle('hidden');
            if (!modal.classList.contains('hidden')) {
                document.getElementById('annTitle').value = '';
                document.getElementById('annBody').value = '';
            }
        }

        function saveAnnouncement(e) {
            e.preventDefault();
            const title = document.getElementById('annTitle').value.trim();
            const body = document.getElementById('annBody').value.trim();

            if (!title || !body) return;

            announcements.unshift({
                id: Date.now(),
                title: title,
                body: body,
                date: 'Just now'
            });

            document.getElementById('annTitle').value = '';
            document.getElementById('annBody').value = '';
            toggleAnnouncementModal();
            renderAnnouncements();
        }

        function deleteAnnouncement(id) {
            if(!confirm("Remove this announcement?")) return;
            announcements = announcements.filter(a => a.id !== id);
            renderAnnouncements();
        }

        function toggleAdminMode() {
            isAdmin = document.getElementById('adminToggle').checked;
            checkAdminVisibility();
            renderMessages();
            renderAnnouncements();
        }

        function checkAdminVisibility() {
            const btn = document.getElementById('addAnnounceBtn');
            if(isAdmin) btn.classList.remove('hidden');
            else btn.classList.add('hidden');
        }

        function openChatMobile() {
            document.getElementById('mainDisplay').classList.remove('hidden');
            document.getElementById('mainDisplay').classList.add('flex');
            document.getElementById('sidebar').classList.add('hidden');
        }

        function closeChatMobile() {
            document.getElementById('mainDisplay').classList.add('hidden');
            document.getElementById('mainDisplay').classList.remove('flex');
            document.getElementById('sidebar').classList.remove('hidden');
        }

        function autoResize(textarea) {
            textarea.style.height = 'auto';
            textarea.style.height = Math.min(textarea.scrollHeight, 120) + 'px';
        }

        function escapeHtml(text) {
            const div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML;
        }
    </script>