<!DOCTYPE html>
<html lang="en" class="bg-gray-100">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta
      http-equiv="Cache-Control"
      content="no-cache, no-store, must-revalidate"
    />
    <meta http-equiv="Pragma" content="no-cache" />
    <meta http-equiv="Expires" content="0" />
    <title>Dr.Net CTIO (SysAdmin) Technology Labs - Dashboard</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/dayjs@1/dayjs.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/dayjs@1/plugin/relativeTime.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://unpkg.com/jspdf@latest/dist/jspdf.umd.min.js"></script>
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css"
    />
    <link rel="stylesheet" href="css/styles.css" />
    <link rel="stylesheet" href="css/fix-overlapping.css" />
    <link rel="stylesheet" href="css/ctio-gradients.css" />

    <style>
      /* Professional CTIO Design System */
      .ctio-professional {
        background: #1e293b;
      }

      /* Sidebar Styles */
      .sidebar {
        position: fixed;
        top: 0;
        left: 0;
        height: 100vh;
        width: 280px;
        transform: translateX(-100%);
        transition: transform 0.3s ease-in-out;
        z-index: 60;
        backdrop-filter: blur(20px);
      }

      .sidebar.show {
        transform: translateX(0);
      }

      .main-content {
        margin-left: 0;
        transition: margin-left 0.3s ease-in-out;
      }

      /* Desktop styles */
      @media (min-width: 1024px) {
        .sidebar {
          transform: translateX(0);
          position: fixed;
        }

        .main-content {
          margin-left: 280px;
        }

        .mobile-toggle {
          display: none !important;
        }
      }

      /* Mobile responsive */
      @media (max-width: 1023px) {
        .main-content {
          margin-left: 0 !important;
        }

        .sidebar {
          z-index: 60;
        }
      }

      /* Hover effects */
      .nav-item:hover {
        transform: translateX(8px);
        background: rgba(255, 255, 255, 0.15);
      }

      /* Submenu styles */
      .nav-submenu {
        position: relative;
      }

      .submenu-item {
        transition: all 0.2s ease;
      }

      .submenu-item:hover {
        transform: translateX(4px);
        background: rgba(255, 255, 255, 0.1);
      }

      #financeSubmenu {
        animation: slideDown 0.3s ease-out;
      }

      @keyframes slideDown {
        from {
          opacity: 0;
          max-height: 0;
          transform: translateY(-10px);
        }
        to {
          opacity: 1;
          max-height: 500px;
          transform: translateY(0);
        }
      }

      /* Modal animations */
      #supportTicketModal {
        transition: all 0.3s ease;
      }
      
      #supportTicketModalContent {
        transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
      }
      
      #supportTicketModal.show #supportTicketModalContent {
        transform: scale(1);
        opacity: 1;
      }
      
      /* Form field focus animations */
      #supportTicketForm input:focus,
      #supportTicketForm select:focus,
      #supportTicketForm textarea:focus {
        transform: scale(1.02);
        box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
      }
      
      /* Button hover effects */
      #supportTicketForm button[type="submit"]:hover {
        transform: translateY(-1px);
        box-shadow: 0 10px 25px rgba(59, 130, 246, 0.3);
      }
      
      #supportTicketForm button[type="button"]:hover {
        transform: translateY(-1px);
        box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
      }
    </style>
  </head>
  <body onload="showDashboard()" class="bg-gray-50 min-h-screen">
    <!-- Mobile backdrop -->
    <div
      id="sidebarBackdrop"
      class="fixed inset-0 bg-black bg-opacity-60 z-40 lg:hidden hidden transition-opacity duration-300"
    ></div>

    <!-- Sidebar -->
    <aside
      id="sidebar"
      class="sidebar ctio-professional shadow-2xl flex flex-col text-white"
    >
      <div class="p-6 border-b border-white/20">
        <div class="flex items-center justify-between">
          <div class="flex items-center space-x-3">
            <div
              class="w-12 h-12 bg-white/20 rounded-xl flex items-center justify-center backdrop-blur-lg"
            >
              <i class="fas fa-network-wired text-xl text-white"></i>
            </div>
            <div>
              <h2 class="text-xl font-bold">DR.NET</h2>
              <p class="text-white/80 text-sm">Julius Ojwang - CTIO</p>
            </div>
          </div>
          <button
            id="closeSidebar"
            class="mobile-toggle text-white/80 hover:text-white p-2 rounded-lg hover:bg-white/10 transition-all duration-200"
          >
            <i class="fas fa-times text-lg"></i>
          </button>
        </div>
      </div>
      <nav class="flex-1 p-4 space-y-2 overflow-y-auto">
        <a
          href="#"
          onclick="showDashboard(); return false;"
          class="nav-item group flex items-center px-4 py-3 rounded-xl bg-white/20 text-white transition-all duration-300"
        >
          <div
            class="w-10 h-10 bg-white/20 rounded-lg flex items-center justify-center mr-4 transition-all duration-300"
          >
            <i class="fas fa-chart-pie text-lg"></i>
          </div>
          <span class="font-medium">Dashboard</span>
        </a>
        <a
          href="register-user.html"
          class="nav-item group flex items-center px-4 py-3 rounded-xl transition-all duration-300 hover:bg-white/15 text-white/90 hover:text-white"
        >
          <div
            class="w-10 h-10 bg-white/10 rounded-lg flex items-center justify-center mr-4 group-hover:bg-white/20 transition-all duration-300"
          >
            <i class="fas fa-user-plus text-lg"></i>
          </div>
          <span class="font-medium">Register User</span>
        </a>
        <a
          href="manage-users.html"
          class="nav-item group flex items-center px-4 py-3 rounded-xl transition-all duration-300 hover:bg-white/15 text-white/90 hover:text-white"
        >
          <div
            class="w-10 h-10 bg-white/10 rounded-lg flex items-center justify-center mr-4 group-hover:bg-white/20 transition-all duration-300"
          >
            <i class="fas fa-users text-lg"></i>
          </div>
          <span class="font-medium">Manage Users</span>
        </a>
        <a
          href="deleted-users.html"
          class="nav-item group flex items-center px-4 py-3 rounded-xl transition-all duration-300 hover:bg-white/15 text-white/90 hover:text-white"
        >
          <div
            class="w-10 h-10 bg-white/10 rounded-lg flex items-center justify-center mr-4 group-hover:bg-white/20 transition-all duration-300"
          >
            <i class="fas fa-trash text-lg"></i>
          </div>
          <span class="font-medium">Deleted Users</span>
        </a>
        <a
          href="#"
          onclick="showSection('serviceAssignments'); return false;"
          class="nav-item group flex items-center px-4 py-3 rounded-xl transition-all duration-300 hover:bg-white/15 text-white/90 hover:text-white"
        >
          <div
            class="w-10 h-10 bg-white/10 rounded-lg flex items-center justify-center mr-4 group-hover:bg-white/20 transition-all duration-300"
          >
            <i class="fas fa-tools text-lg"></i>
          </div>
          <span class="font-medium">Service Assignments</span>
        </a>
        <a
          href="#"
          onclick="showSection('attendance'); return false;"
          class="nav-item group flex items-center px-4 py-3 rounded-xl transition-all duration-300 hover:bg-white/15 text-white/90 hover:text-white"
        >
          <div
            class="w-10 h-10 bg-white/10 rounded-lg flex items-center justify-center mr-4 group-hover:bg-white/20 transition-all duration-300"
          >
            <i class="fas fa-user-check text-lg"></i>
          </div>
          <span class="font-medium">Staff Attendance</span>
        </a>
        <a
          href="#support-tickets"
          onclick="showSection('serviceRequests'); return false;"
          class="nav-item group flex items-center px-4 py-3 rounded-xl transition-all duration-300 hover:bg-white/15 text-white/90 hover:text-white"
        >
          <div
            class="w-10 h-10 bg-white/10 rounded-lg flex items-center justify-center mr-4 group-hover:bg-white/20 transition-all duration-300"
          >
            <i class="fas fa-ticket-alt text-lg"></i>
          </div>
          <span class="font-medium">Support Tickets</span>
        </a>
        <a
          href="invoice-generator.html"
          class="nav-item group flex items-center px-4 py-3 rounded-xl transition-all duration-300 hover:bg-white/15 text-white/90 hover:text-white"
        >
          <div
            class="w-10 h-10 bg-white/10 rounded-lg flex items-center justify-center mr-4 group-hover:bg-white/20 transition-all duration-300"
          >
            <i class="fas fa-file-invoice-dollar text-lg"></i>
          </div>
          <span class="font-medium">Finance and Reports</span>
        </a>
        <a
          href="#"
          onclick="showSection('users'); return false;"
          class="nav-item group flex items-center px-4 py-3 rounded-xl transition-all duration-300 hover:bg-white/15 text-white/90 hover:text-white"
        >
          <div
            class="w-10 h-10 bg-white/10 rounded-lg flex items-center justify-center mr-4 group-hover:bg-white/20 transition-all duration-300"
          >
            <i class="fas fa-users text-lg"></i>
          </div>
          <span class="font-medium">Users</span>
        </a>
        <a
          href="#"
          onclick="showSection('finance'); return false;"
          class="nav-item group flex items-center px-4 py-3 rounded-xl transition-all duration-300 hover:bg-white/15 text-white/90 hover:text-white"
        >
          <div
            class="w-10 h-10 bg-white/10 rounded-lg flex items-center justify-center mr-4 group-hover:bg-white/20 transition-all duration-300"
          >
            <i class="fas fa-dollar-sign text-lg"></i>
          </div>
          <span class="font-medium">Finance</span>
        </a>
        <a
          href="#"
          onclick="showSection('salesManagement'); return false;"
          class="nav-item group flex items-center px-4 py-3 rounded-xl transition-all duration-300 hover:bg-white/15 text-white/90 hover:text-white"
        >
          <div
            class="w-10 h-10 bg-white/10 rounded-lg flex items-center justify-center mr-4 group-hover:bg-white/20 transition-all duration-300"
          >
            <i class="fas fa-shopping-cart text-lg"></i>
          </div>
          <span class="font-medium">Sales Management</span>
        </a>
        <a
          href="#"
          onclick="showSection('equipment'); return false;"
          class="nav-item group flex items-center px-4 py-3 rounded-xl transition-all duration-300 hover:bg-white/15 text-white/90 hover:text-white"
        >
          <div
            class="w-10 h-10 bg-white/10 rounded-lg flex items-center justify-center mr-4 group-hover:bg-white/20 transition-all duration-300"
          >
            <i class="fas fa-tools text-lg"></i>
          </div>
          <span class="font-medium">Equipment & Tools</span>
        </a>
        <a
          href="#"
          onclick="showSection('reports'); return false;"
          class="nav-item group flex items-center px-4 py-3 rounded-xl transition-all duration-300 hover:bg-white/15 text-white/90 hover:text-white"
        >
          <div
            class="w-10 h-10 bg-white/10 rounded-lg flex items-center justify-center mr-4 group-hover:bg-white/20 transition-all duration-300"
          >
            <i class="fas fa-chart-bar text-lg"></i>
          </div>
          <span class="font-medium">Reports & Logs</span>
        </a>
        <a
          href="team-communication.html"
          class="nav-item group flex items-center px-4 py-3 rounded-xl transition-all duration-300 hover:bg-white/15 text-white/90 hover:text-white"
        >
          <div
            class="w-10 h-10 bg-white/10 rounded-lg flex items-center justify-center mr-4 group-hover:bg-white/20 transition-all duration-300"
          >
            <i class="fas fa-comments text-lg"></i>
          </div>
          <span class="font-medium">Team Communication</span>
        </a>
        <a
          href="settings.html"
          class="nav-item group flex items-center px-4 py-3 rounded-xl transition-all duration-300 hover:bg-white/15 text-white/90 hover:text-white"
        >
          <div
            class="w-10 h-10 bg-white/10 rounded-lg flex items-center justify-center mr-4 group-hover:bg-white/20 transition-all duration-300"
          >
            <i class="fas fa-cog text-lg"></i>
          </div>
          <span class="font-medium">Settings</span>
        </a>
      </nav>
      <div class="p-4 border-t border-white/20">
        <div class="flex items-center space-x-3 mb-4">
          <div
            class="w-10 h-10 bg-indigo-500 rounded-full flex items-center justify-center"
          >
            <span class="text-white font-bold text-lg">JO</span>
          </div>
          <div>
            <p class="text-sm font-medium">Julius Ojwang</p>
            <p class="text-white/70 text-xs">Chief Technology Officer</p>
          </div>
        </div>
        <button
          id="logoutButton"
          onclick="logout()"
          class="hidden w-full bg-red-600/80 hover:bg-red-600 text-white px-4 py-2 rounded-lg transition-all duration-200 flex items-center justify-center space-x-2"
        >
          <i class="fas fa-sign-out-alt"></i>
          <span>Log Out</span>
        </button>
      </div>
    </aside>

    <!-- Mobile Menu Toggle -->
    <button
      id="toggleSidebar"
      class="mobile-toggle fixed top-6 left-6 z-50 bg-white/20 backdrop-blur-lg text-white p-3 rounded-xl shadow-lg hover:bg-white/30 transition-all duration-300"
    >
      <i class="fas fa-bars text-lg"></i>
    </button>

    <!-- Main Content -->
    <main
      class="main-content p-2 md:p-4 overflow-y-auto transition-all duration-300 ease-in-out"
    >
      <div
        id="notificationBox"
        class="hidden mb-6 bg-yellow-100 text-yellow-800 p-4 rounded-lg shadow-md"
      >
        <i class="fas fa-exclamation-triangle mr-2"></i>Some users are expiring soon.
        <a href="#" onclick="showDetailedView('expired')" class="underline"
          >View Now</a
        >
      </div>

      <!-- Dashboard Section -->
      <section id="dashboard" class="container mx-auto px-1 py-2 space-y-8 hidden">
        <!-- Profile Section -->
        <div class="bg-gradient-to-br from-slate-800 via-blue-900 to-indigo-900 rounded-xl shadow-2xl border border-blue-600 mb-8">
          <div class="p-8">
            <div class="flex items-center space-x-6">
              <div class="relative">
                <div class="w-24 h-24 bg-blue-600 rounded-full flex items-center justify-center shadow-lg">
                  <img
                    id="adminProfileImage"
                    src=""
                    alt="Profile Image"
                    class="w-24 h-24 object-cover rounded-full"
                  />
                </div>
              </div>
              <div class="flex-1">
                <h2 id="adminName" class="text-3xl font-bold text-white mb-1">
                  DR.NET TECHNOLOGY LABS
                </h2>
                <p id="adminRole" class="text-blue-200 text-lg font-medium mb-3">
                  Chief Technology & Innovation Officer
                </p>
                <div class="flex items-center space-x-4">
                  <div class="flex items-center space-x-2">
                    <span class="w-3 h-3 bg-green-500 rounded-full animate-pulse"></span>
                    <span class="text-green-400 text-sm font-medium">Online</span>
                  </div>
                  <div class="flex items-center space-x-2 text-sm text-blue-300">
                    <span class="w-3 h-3 bg-blue-500 rounded-full"></span>
                    <span>Dashboard Active</span>
                  </div>
                </div>
              </div>
              <!-- Notification Bell -->
              <div class="mr-4">
                <button
                  onclick="viewAllCTIONotifications()"
                  class="relative p-3 bg-blue-100 rounded-full hover:bg-blue-200 transition-all duration-300 shadow-md hover:shadow-lg"
                >
                  <svg
                    class="w-6 h-6 text-blue-600"
                    fill="currentColor"
                    viewBox="0 0 20 20"
                  >
                    <path
                      d="M10 2a6 6 0 00-6 6v3.586l-.707.707A1 1 0 004 14h12a1 1 0 00.707-1.707L16 11.586V8a6 6 0 00-6-6zM10 18a3 3 0 01-3-3h6a3 3 0 01-3 3z"
                    ></path>
                  </svg>
                  <span
                    id="notificationBadge"
                    class="absolute -top-2 -right-2 bg-red-500 text-white text-xs rounded-full h-6 w-6 flex items-center justify-center font-bold"
                    style="display: none"
                    >0</span
                  >
                </button>
              </div>
            </div>
          </div>
        </div>
        <div class="animate-[fade-in-up_0.8s_ease-out] text-start">
          <h1 class="text-3xl font-bold text-gray-900 mb-2">Network Management Dashboard</h1>
          <p class="text-lg text-gray-600">Real-time insights and analytics</p>
        </div>

        <!-- Animated Stats Grid (3x2 Layout) -->
        <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
          <!-- Top Row -->
          <!-- Active Users -->
          <div
            onclick="showDetailedView('active')"
            class="relative overflow-hidden bg-gradient-to-br from-emerald-500 via-green-600 to-teal-700 rounded-2xl p-6 cursor-pointer transform transition-all duration-500 hover:scale-105 hover:shadow-2xl group"
          >
            <div class="absolute inset-0 bg-gradient-to-r from-white/10 to-transparent opacity-0 group-hover:opacity-100 transition-opacity duration-500"></div>
            <div class="absolute top-0 right-0 w-20 h-20 bg-white/10 rounded-full blur-2xl group-hover:scale-150 transition-transform duration-700"></div>
            <div class="relative z-10">
              <div class="flex items-center justify-between mb-4">
                <div class="w-12 h-12 bg-white/20 rounded-xl flex items-center justify-center group-hover:rotate-12 transition-transform duration-500">
                  <i class="fas fa-users text-white text-xl"></i>
                </div>
                <div class="text-3xl group-hover:bounce">üü¢</div>
              </div>
              <p class="text-emerald-100 text-sm font-medium mb-2 group-hover:text-white transition-colors">Active Users</p>
              <p class="text-white text-3xl font-bold mb-1 group-hover:scale-110 transition-transform origin-left" id="activeUsers">0</p>
              <p class="text-emerald-200 text-xs">Currently subscribed</p>
            </div>
            <div class="absolute bottom-0 left-0 w-full h-1 bg-gradient-to-r from-emerald-300 to-teal-300 group-hover:h-2 transition-all duration-300"></div>
          </div>

          <!-- Expired Users -->
          <div
            onclick="showDetailedView('expired')"
            class="relative overflow-hidden bg-gradient-to-br from-red-500 via-rose-600 to-pink-700 rounded-2xl p-6 cursor-pointer transform transition-all duration-500 hover:scale-105 hover:shadow-2xl group"
          >
            <div class="absolute inset-0 bg-gradient-to-r from-white/10 to-transparent opacity-0 group-hover:opacity-100 transition-opacity duration-500"></div>
            <div class="absolute top-0 right-0 w-20 h-20 bg-white/10 rounded-full blur-2xl group-hover:scale-150 transition-transform duration-700"></div>
            <div class="relative z-10">
              <div class="flex items-center justify-between mb-4">
                <div class="w-12 h-12 bg-white/20 rounded-xl flex items-center justify-center group-hover:rotate-12 transition-transform duration-500">
                  <i class="fas fa-exclamation-triangle text-white text-xl"></i>
                </div>
                <div class="text-3xl group-hover:bounce">‚ö†Ô∏è</div>
              </div>
              <p class="text-red-100 text-sm font-medium mb-2 group-hover:text-white transition-colors">Expired Users</p>
              <p class="text-white text-3xl font-bold mb-1 group-hover:scale-110 transition-transform origin-left" id="expiredUsers">0</p>
              <p class="text-red-200 text-xs">Need renewal</p>
            </div>
            <div class="absolute bottom-0 left-0 w-full h-1 bg-gradient-to-r from-red-300 to-pink-300 group-hover:h-2 transition-all duration-300"></div>
          </div>

          <!-- Monthly Income -->
          <div
            onclick="showDetailedView('income')"
            class="relative overflow-hidden bg-gradient-to-br from-blue-500 via-indigo-600 to-purple-700 rounded-2xl p-6 cursor-pointer transform transition-all duration-500 hover:scale-105 hover:shadow-2xl group"
          >
            <div class="absolute inset-0 bg-gradient-to-r from-white/10 to-transparent opacity-0 group-hover:opacity-100 transition-opacity duration-500"></div>
            <div class="absolute top-0 right-0 w-20 h-20 bg-white/10 rounded-full blur-2xl group-hover:scale-150 transition-transform duration-700"></div>
            <div class="relative z-10">
              <div class="flex items-center justify-between mb-4">
                <div class="w-12 h-12 bg-white/20 rounded-xl flex items-center justify-center group-hover:rotate-12 transition-transform duration-500">
                  <i class="fas fa-chart-line text-white text-xl"></i>
                </div>
                <div class="text-3xl group-hover:bounce">üí∞</div>
              </div>
              <p class="text-blue-100 text-sm font-medium mb-2 group-hover:text-white transition-colors">Monthly Income</p>
              <p class="text-white text-3xl font-bold mb-1 group-hover:scale-110 transition-transform origin-left" id="monthlyIncome">Ksh 0</p>
              <p class="text-blue-200 text-xs" id="currentMonthName">This month</p>
            </div>
            <div class="absolute bottom-0 left-0 w-full h-1 bg-gradient-to-r from-blue-300 to-purple-300 group-hover:h-2 transition-all duration-300"></div>
          </div>

          <!-- Bottom Row -->
          <!-- Accessory Revenue -->
          <div
            onclick="showDetailedView('accessories')"
            class="relative overflow-hidden bg-gradient-to-br from-yellow-500 via-orange-600 to-red-600 rounded-2xl p-6 cursor-pointer transform transition-all duration-500 hover:scale-105 hover:shadow-2xl group"
          >
            <div class="absolute inset-0 bg-gradient-to-r from-white/10 to-transparent opacity-0 group-hover:opacity-100 transition-opacity duration-500"></div>
            <div class="absolute top-0 right-0 w-20 h-20 bg-white/10 rounded-full blur-2xl group-hover:scale-150 transition-transform duration-700"></div>
            <div class="relative z-10">
              <div class="flex items-center justify-between mb-4">
                <div class="w-12 h-12 bg-white/20 rounded-xl flex items-center justify-center group-hover:rotate-12 transition-transform duration-500">
                  <i class="fas fa-microchip text-white text-xl"></i>
                </div>
                <div class="text-3xl group-hover:bounce">üîß</div>
              </div>
              <p class="text-yellow-100 text-sm font-medium mb-2 group-hover:text-white transition-colors">Accessory Revenue</p>
              <p class="text-white text-3xl font-bold mb-1 group-hover:scale-110 transition-transform origin-left" id="accessoryRevenue">Ksh 0</p>
              <p class="text-yellow-200 text-xs">Hardware & accessories</p>
            </div>
            <div class="absolute bottom-0 left-0 w-full h-1 bg-gradient-to-r from-yellow-300 to-orange-300 group-hover:h-2 transition-all duration-300"></div>
          </div>

          <!-- Bookings -->
          <div
            onclick="showDetailedView('bookings')"
            class="relative overflow-hidden bg-gradient-to-br from-purple-500 via-violet-600 to-indigo-700 rounded-2xl p-6 cursor-pointer transform transition-all duration-500 hover:scale-105 hover:shadow-2xl group"
          >
            <div class="absolute inset-0 bg-gradient-to-r from-white/10 to-transparent opacity-0 group-hover:opacity-100 transition-opacity duration-500"></div>
            <div class="absolute top-0 right-0 w-20 h-20 bg-white/10 rounded-full blur-2xl group-hover:scale-150 transition-transform duration-700"></div>
            <div class="relative z-10">
              <div class="flex items-center justify-between mb-4">
                <div class="w-12 h-12 bg-white/20 rounded-xl flex items-center justify-center group-hover:rotate-12 transition-transform duration-500">
                  <i class="fas fa-calendar-check text-white text-xl"></i>
                </div>
                <div class="text-3xl group-hover:bounce">üìÖ</div>
              </div>
              <p class="text-purple-100 text-sm font-medium mb-2 group-hover:text-white transition-colors">Bookings</p>
              <p class="text-white text-3xl font-bold mb-1 group-hover:scale-110 transition-transform origin-left" id="totalBookings">0</p>
              <p class="text-purple-200 text-xs">Website inquiries</p>
            </div>
            <div class="absolute bottom-0 left-0 w-full h-1 bg-gradient-to-r from-purple-300 to-indigo-300 group-hover:h-2 transition-all duration-300"></div>
          </div>

          <!-- My Staff -->
          <div
            onclick="showDetailedView('staff')"
            class="relative overflow-hidden bg-gradient-to-br from-gray-600 via-slate-700 to-zinc-800 rounded-2xl p-6 cursor-pointer transform transition-all duration-500 hover:scale-105 hover:shadow-2xl group"
          >
            <div class="absolute inset-0 bg-gradient-to-r from-white/10 to-transparent opacity-0 group-hover:opacity-100 transition-opacity duration-500"></div>
            <div class="absolute top-0 right-0 w-20 h-20 bg-white/10 rounded-full blur-2xl group-hover:scale-150 transition-transform duration-700"></div>
            <div class="relative z-10">
              <div class="flex items-center justify-between mb-4">
                <div class="w-12 h-12 bg-white/20 rounded-xl flex items-center justify-center group-hover:rotate-12 transition-transform duration-500">
                  <i class="fas fa-user-tie text-white text-xl"></i>
                </div>
                <div class="text-3xl group-hover:bounce">üë•</div>
              </div>
              <p class="text-gray-100 text-sm font-medium mb-2 group-hover:text-white transition-colors">My Staff</p>
              <p class="text-white text-3xl font-bold mb-1 group-hover:scale-110 transition-transform origin-left" id="totalStaff">0</p>
              <p class="text-gray-200 text-xs">Team members</p>
            </div>
            <div class="absolute bottom-0 left-0 w-full h-1 bg-gradient-to-r from-gray-300 to-slate-300 group-hover:h-2 transition-all duration-300"></div>
          </div>
        </div>

        <!-- All Notifications Section -->
        <div class="bg-gradient-to-br from-slate-800 via-blue-900 to-indigo-900 rounded-2xl shadow-2xl border border-blue-600 mb-8">
          <div class="px-6 py-4 border-b border-blue-600">
            <div class="flex items-center justify-between">
              <div>
                <h3 class="text-lg font-semibold text-white">All Notifications</h3>
                <p class="text-sm text-blue-200">View and manage all system notifications</p>
              </div>
              <button
                onclick="clearAllNotifications()"
                class="inline-flex items-center px-4 py-2 bg-gradient-to-r from-red-500 to-red-600 text-white rounded-lg hover:from-red-600 hover:to-red-700 transition-all duration-300 font-medium transform hover:scale-105 shadow-lg"
              >
                <i class="fas fa-trash mr-2"></i> Clear All
              </button>
            </div>
          </div>

          <div class="p-6 bg-gradient-to-br from-slate-800 to-blue-900">
            <div id="allNotificationsList" class="space-y-3 max-h-64 overflow-y-auto">
              <!-- All notifications will be populated here -->
            </div>
          </div>
        </div>

        <!-- Income Chart -->
        <div
          class="relative overflow-hidden bg-gradient-to-br from-white via-gray-50 to-blue-50 backdrop-blur-xl rounded-2xl shadow-xl p-8 hover:shadow-2xl transition-all duration-500 border border-white/20"
        >
          <div
            class="absolute top-0 right-0 w-40 h-40 bg-gradient-to-bl from-blue-200/30 to-transparent rounded-full blur-3xl"
          ></div>
          <div
            class="absolute bottom-0 left-0 w-32 h-32 bg-gradient-to-tr from-purple-200/30 to-transparent rounded-full blur-2xl"
          ></div>
          <div class="relative z-10">
            <div class="flex items-center justify-between mb-6">
              <h3
                class="text-xl font-bold bg-gradient-to-r from-purple-600 to-blue-600 bg-clip-text text-transparent"
              >
                Income Trend (Monthly)
              </h3>
              <span
                class="px-4 py-2 bg-gradient-to-r from-green-100 to-emerald-100 text-green-700 rounded-full text-sm font-medium shadow-sm"
                ><i class="fas fa-chart-line mr-2"></i>Growing</span
              >
            </div>
            <canvas id="incomeChart" height="120"></canvas>
          </div>
        </div>

        <!-- Deleted Users Section -->
        <div id="deletedUsers" class="hidden">
          <div class="bg-white/90 backdrop-blur-sm p-8 rounded-2xl shadow-xl">
            <div class="flex justify-between items-center mb-6">
              <h2 class="text-2xl font-bold text-gray-800">
                <i class="fas fa-trash mr-2"></i>Deleted Users
              </h2>
              <button
                onclick="refreshDeletedClients()"
                class="bg-red-500 hover:bg-red-600 text-white px-4 py-2 rounded-lg transition-all duration-200"
              >
                <i class="fas fa-sync-alt mr-2"></i>Refresh
              </button>
            </div>

            <div class="overflow-x-auto">
              <table
                class="w-full border-collapse bg-gradient-to-br from-slate-800 to-blue-900 rounded-lg overflow-hidden shadow-2xl"
              >
                <thead class="bg-gradient-to-r from-red-600 to-rose-700">
                  <tr>
                    <th
                      class="border-b border-red-500 px-6 py-4 text-left font-semibold text-white"
                    >
                      Name
                    </th>
                    <th
                      class="border-b border-red-500 px-6 py-4 text-left font-semibold text-white"
                    >
                      Email
                    </th>
                    <th
                      class="border-b border-red-500 px-6 py-4 text-left font-semibold text-white"
                    >
                      Phone
                    </th>
                    <th
                      class="border-b border-red-500 px-6 py-4 text-left font-semibold text-white"
                    >
                      Deleted Date
                    </th>
                    <th
                      class="border-b border-red-500 px-6 py-4 text-left font-semibold text-white"
                    >
                      Actions
                    </th>
                  </tr>
                </thead>
                <tbody id="deletedClientsTableBody">
                  <!-- Deleted client rows will be populated here -->
                </tbody>
              </table>
            </div>
          </div>
        </div>

        <!-- Service Assignments Section -->
        <div id="serviceAssignments" class="hidden">
          <div class="bg-gradient-to-br from-slate-800 via-green-900 to-emerald-900 rounded-2xl shadow-2xl border border-green-700 overflow-hidden">
            <div class="px-6 py-4 border-b border-green-600 bg-gradient-to-r from-green-600 to-emerald-600">
              <div class="flex flex-col sm:flex-row sm:items-center sm:justify-between space-y-3 sm:space-y-0">
                <div>
                  <h2 class="text-lg font-semibold text-white">Service Assignments</h2>
                  <p class="text-sm text-green-100">Manage and track all service assignments</p>
                </div>
                <div class="flex space-x-3">
                  <button
                    onclick="createServiceAssignment()"
                    class="inline-flex items-center px-4 py-2 bg-white text-green-600 rounded-lg hover:bg-green-50 transition-colors font-medium shadow-md transform hover:scale-105"
                  >
                    <i class="fas fa-tasks mr-2"></i> Create Assignment
                  </button>
                  <button
                    onclick="refreshCtioServiceAssignments()"
                    class="inline-flex items-center px-4 py-2 bg-green-500 text-white rounded-lg hover:bg-green-400 transition-colors font-medium shadow-md transform hover:scale-105"
                  >
                    <i class="fas fa-sync-alt mr-2"></i> Refresh
                  </button>
                </div>
              </div>
            </div>

            <!-- Service Assignments List -->
            <div class="p-6 bg-gradient-to-br from-slate-800 to-green-900">
              <div id="ctioServiceAssignmentsList" class="space-y-4">
                <!-- Service assignments will be populated here -->
              </div>
              
              <!-- Empty State -->
              <div id="ctioServiceAssignmentsEmptyState" class="text-center py-12">
                <div class="bg-green-600 w-16 h-16 rounded-full flex items-center justify-center mx-auto mb-4 shadow-lg">
                  <i class="fas fa-tools text-2xl text-white"></i>
                </div>
                <h3 class="text-lg font-medium text-white mb-2">No Service Assignments</h3>
                <p class="text-green-200 mb-6">Get started by creating your first service assignment</p>
                <button
                  onclick="createServiceAssignment()"
                  class="inline-flex items-center px-6 py-3 bg-gradient-to-r from-green-500 to-emerald-600 text-white rounded-lg hover:from-green-600 hover:to-emerald-700 transition-all duration-300 font-medium shadow-lg transform hover:scale-105"
                >
                  <i class="fas fa-tasks mr-2"></i> Create First Assignment
                </button>
              </div>
            </div>
          </div>
        </div>

        <!-- Staff Attendance Section -->
        <div id="attendance" class="hidden">
          <div class="bg-gradient-to-br from-slate-800 via-blue-900 to-indigo-900 rounded-2xl shadow-2xl border border-blue-700 overflow-hidden">
            <div class="px-6 py-4 border-b border-blue-600 bg-gradient-to-r from-blue-600 to-indigo-600">
              <div class="flex flex-col sm:flex-row sm:items-center sm:justify-between space-y-3 sm:space-y-0">
                <div>
                  <h2 class="text-lg font-semibold text-white">Staff Attendance</h2>
                  <p class="text-sm text-blue-100">View and manage staff attendance records</p>
                </div>
                <div class="flex space-x-3">
                  <button
                    onclick="markAttendance()"
                    class="inline-flex items-center px-4 py-2 bg-white text-blue-600 rounded-lg hover:bg-blue-50 transition-colors font-medium shadow-md transform hover:scale-105"
                  >
                    <i class="fas fa-plus mr-2"></i> Mark Attendance
                  </button>
                  <button
                    onclick="refreshCtioAttendance()"
                    class="inline-flex items-center px-4 py-2 bg-blue-500 text-white rounded-lg hover:bg-blue-400 transition-colors font-medium shadow-md transform hover:scale-105"
                  >
                    <i class="fas fa-sync-alt mr-2"></i> Refresh
                  </button>
                  <button
                    onclick="deleteAllCtioAttendance()"
                    class="inline-flex items-center px-4 py-2 bg-red-500 text-white rounded-lg hover:bg-red-400 transition-colors font-medium shadow-md transform hover:scale-105"
                  >
                    <i class="fas fa-trash mr-2"></i> Delete All
                  </button>
                  <button
                    onclick="testCtioAttendance()"
                    class="inline-flex items-center px-4 py-2 bg-purple-500 text-white rounded-lg hover:bg-purple-400 transition-colors font-medium shadow-md transform hover:scale-105"
                  >
                    <i class="fas fa-bug mr-2"></i> Test
                  </button>
                </div>
              </div>
            </div>

            <!-- Attendance Filters -->
            <div class="px-6 py-4 bg-gray-50 border-b border-gray-200">
              <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                <div>
                  <input
                    type="text"
                    id="ctioAttendanceSearch"
                    placeholder="Search staff..."
                    class="w-full p-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 text-sm"
                    onkeyup="filterCtioAttendance()"
                  />
                </div>
                <div>
                  <select id="ctioAttendanceStatusFilter" class="w-full p-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 text-sm" onchange="filterCtioAttendance()">
                    <option value="">All Status</option>
                    <option value="Present">Present</option>
                    <option value="Absent">Absent</option>
                    <option value="Off Duty">Off Duty</option>
                    <option value="On Leave">On Leave</option>
                  </select>
                </div>
                <div>
                  <input
                    type="date"
                    id="ctioAttendanceDateFilter"
                    class="w-full p-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 text-sm"
                    onchange="filterCtioAttendance()"
                  />
                </div>
              </div>
            </div>

            <!-- Attendance Table -->
            <div class="overflow-x-auto">
              <table class="w-full">
                <thead class="bg-gray-50">
                  <tr>
                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Employee ID</th>
                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Name</th>
                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Department</th>
                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Role</th>
                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Phone</th>
                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Email</th>
                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Time In</th>
                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Time Out</th>
                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Status</th>
                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Attendance</th>
                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Marked By</th>
                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Last Updated</th>
                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Actions</th>
                  </tr>
                </thead>
                <tbody id="ctioAttendanceTableBody" class="bg-white divide-y divide-gray-200">
                  <!-- Attendance records will be loaded here -->
                </tbody>
              </table>
              <div id="ctioNoAttendanceRecords" class="text-center py-8 hidden">
                <i class="fas fa-user-clock text-4xl text-gray-400 mb-4"></i>
                <p class="text-lg font-medium">No attendance records</p>
                <p class="text-sm">No attendance records found for the selected date</p>
              </div>
            </div>
          </div>
        </div>

        <!-- Support Tickets Section -->
        <section id="serviceRequests" class="hidden container mx-auto px-1 py-2">
          <div class="bg-gradient-to-br from-slate-800 via-blue-900 to-indigo-900 rounded-2xl shadow-2xl border border-blue-700 overflow-hidden">
            <div class="px-6 py-4 border-b border-blue-600 bg-gradient-to-r from-blue-600 to-indigo-600">
              <div class="flex flex-col sm:flex-row sm:items-center sm:justify-between space-y-3 sm:space-y-0">
                <div>
                  <h2 class="text-lg font-semibold text-white">Support Tickets</h2>
                  <p class="text-sm text-blue-100">Manage and track all support tickets</p>
                </div>
                <div class="flex space-x-3">
                  <button
                    onclick="createSupportTicket()"
                    class="inline-flex items-center px-4 py-2 bg-white text-blue-600 rounded-lg hover:bg-blue-50 transition-colors font-medium shadow-md transform hover:scale-105"
                  >
                    <i class="fas fa-plus mr-2"></i> Create Ticket
                  </button>
                  <button
                    onclick="refreshServiceRequests()"
                    class="inline-flex items-center px-4 py-2 bg-blue-500 text-white rounded-lg hover:bg-blue-400 transition-colors font-medium shadow-md transform hover:scale-105"
                  >
                    <i class="fas fa-sync-alt mr-2"></i> Refresh
                  </button>
                </div>
              </div>
            </div>

            <!-- Support Tickets List -->
            <div class="p-6 bg-gradient-to-br from-slate-800 to-blue-900">
              <div id="ctioSupportTicketsList" class="space-y-4">
                <!-- Support tickets will be populated here -->
              </div>
              
              <!-- Empty State -->
              <div id="ctioEmptyState" class="text-center py-12 hidden">
                <div class="bg-blue-600 w-16 h-16 rounded-full flex items-center justify-center mx-auto mb-4 shadow-lg">
                  <i class="fas fa-clipboard-list text-2xl text-white"></i>
                </div>
                <h3 class="text-lg font-medium text-white mb-2">No Support Tickets</h3>
                <p class="text-blue-200 mb-6">Get started by creating your first support ticket</p>
                <button
                  onclick="createSupportTicket()"
                  class="inline-flex items-center px-6 py-3 bg-gradient-to-r from-blue-500 to-indigo-600 text-white rounded-lg hover:from-blue-600 hover:to-indigo-700 transition-all duration-300 font-medium shadow-lg transform hover:scale-105"
                >
                  <i class="fas fa-plus mr-2"></i> Create First Ticket
                </button>
              </div>
            </div>
          </div>
        </section>

        <!-- Detailed View Container (Enhanced Modal) -->
        <div
          id="detailedViewContainer"
          class="fixed inset-0 bg-gradient-to-br from-black/60 via-purple-900/30 to-blue-900/30 backdrop-blur-lg flex items-center justify-center z-[60] p-4 hidden"
          onclick="event.target === this && hideDetailedView()"
        >
          <div
            class="bg-white rounded-2xl shadow-2xl max-w-3xl w-full max-h-[85vh] overflow-hidden transform transition-all duration-500 hover:scale-[1.01] relative mx-auto"
          >
            <!-- Animated background orbs -->
            <div class="absolute top-0 right-0 w-32 h-32 bg-gradient-to-bl from-purple-300/20 to-transparent rounded-full blur-3xl animate-pulse"></div>
            <div class="absolute bottom-0 left-0 w-24 h-24 bg-gradient-to-tr from-blue-300/20 to-transparent rounded-full blur-2xl animate-pulse" style="animation-delay: 1s;"></div>
            
            <!-- Enhanced Header with Dynamic Gradient -->
            <div
              id="modalHeader"
              class="bg-gradient-to-br from-indigo-600 via-purple-600 to-pink-600 text-white p-4 relative overflow-hidden"
            >
              <div class="absolute inset-0 bg-gradient-to-r from-white/10 to-transparent opacity-50"></div>
              <div class="relative z-10 flex items-center justify-between">
                <div class="flex items-center space-x-4">
                  <div id="modalIconContainer" class="w-12 h-12 bg-white/20 backdrop-blur-sm rounded-xl flex items-center justify-center transform hover:rotate-12 transition-transform duration-300">
                    <span id="modalIcon" class="text-xl"></span>
                  </div>
                  <div>
                    <h3 id="detailedViewTitle" class="text-xl font-bold mb-1"></h3>
                    <p id="modalSubtitle" class="text-purple-100 text-xs opacity-90"></p>
                  </div>
                </div>
                <button
                  onclick="hideDetailedView()"
                  class="p-2 hover:bg-white/20 rounded-full transition-all duration-300 transform hover:scale-110 group"
                >
                  <svg
                    class="w-5 h-5 group-hover:rotate-90 transition-transform duration-300"
                    fill="none"
                    stroke="currentColor"
                    viewBox="0 0 24 24"
                    xmlns="http://www.w3.org/2000/svg"
                  >
                    <path
                      stroke-linecap="round"
                      stroke-linejoin="round"
                      stroke-width="2"
                      d="M6 18L18 6M6 6l12 12"
                    ></path>
                  </svg>
                </button>
              </div>
            </div>
            
            <!-- Enhanced Stats Grid Section -->
            <div class="p-4 bg-gradient-to-br from-gray-50 via-white to-blue-50/30 relative">
              <div class="absolute inset-0 bg-gradient-to-r from-transparent via-white/50 to-transparent opacity-30"></div>
              <div class="relative z-10">
                <h4 class="text-base font-semibold text-gray-800 mb-3 flex items-center">
                  <span class="w-2 h-2 bg-gradient-to-r from-purple-500 to-blue-500 rounded-full mr-2 animate-pulse"></span>
                  Quick Statistics
                </h4>
                <div
                  id="modalStatsGrid"
                  class="grid grid-cols-2 md:grid-cols-4 gap-3"
                ></div>
              </div>
            </div>
            
            <!-- Enhanced Content Section -->
            <div class="p-4 overflow-y-auto max-h-64 bg-white relative">
              <div class="absolute top-0 left-0 w-full h-1 bg-gradient-to-r from-purple-500 via-blue-500 to-pink-500"></div>
              <h4 class="text-base font-semibold text-gray-800 mb-3 flex items-center">
                <span class="w-2 h-2 bg-gradient-to-r from-blue-500 to-purple-500 rounded-full mr-2 animate-pulse"></span>
                Detailed Information
              </h4>
              <div id="detailedViewContent" class="overflow-x-auto"></div>
            </div>
            
            <!-- Enhanced Footer -->
            <div class="bg-gradient-to-r from-gray-50 via-blue-50/50 to-purple-50/50 px-4 py-3 border-t border-gray-200/50 relative">
              <div class="absolute inset-0 bg-gradient-to-r from-transparent via-white/30 to-transparent"></div>
              <div class="relative z-10 flex justify-between items-center">
                <p id="modalLastUpdated" class="text-xs text-gray-600 flex items-center">
                  <span class="w-2 h-2 bg-green-500 rounded-full mr-2 animate-pulse"></span>
                  Last updated: <span class="font-medium ml-1"></span>
                </p>
                <button
                  onclick="hideDetailedView()"
                  class="px-4 py-2 bg-gradient-to-r from-purple-600 via-blue-600 to-indigo-600 text-white rounded-lg text-sm font-medium hover:from-purple-700 hover:via-blue-700 hover:to-indigo-700 transition-all duration-300 transform hover:scale-105 hover:shadow-lg relative overflow-hidden group"
                >
                  <span class="absolute inset-0 bg-gradient-to-r from-white/20 to-transparent opacity-0 group-hover:opacity-100 transition-opacity duration-300"></span>
                  <span class="relative z-10">Close</span>
                </button>
              </div>
            </div>
          </div>
        </div>

        <!-- Support Ticket Creation Modal -->
        <div
          id="supportTicketModal"
          class="fixed inset-0 bg-black/50 backdrop-blur-sm z-50 hidden flex items-center justify-center p-4"
        >
          <div
            class="bg-white rounded-2xl shadow-2xl max-w-2xl w-full max-h-[90vh] overflow-y-auto transform transition-all duration-300 scale-95 opacity-0"
            id="supportTicketModalContent"
          >
            <div class="bg-gradient-to-r from-blue-600 to-indigo-600 text-white p-6 rounded-t-2xl">
              <div class="flex items-center justify-between">
                <div class="flex items-center space-x-3">
                  <div class="w-10 h-10 bg-white/20 rounded-lg flex items-center justify-center">
                    <i class="fas fa-ticket-alt text-xl"></i>
                  </div>
                  <div>
                    <h3 class="text-xl font-bold">Create Support Ticket</h3>
                    <p class="text-blue-100 text-sm">Create a new support ticket for client or internal issue</p>
                  </div>
                </div>
                <button
                  onclick="closeSupportTicketModal()"
                  class="w-8 h-8 bg-white/20 hover:bg-white/30 rounded-lg flex items-center justify-center transition-all duration-300"
                >
                  <i class="fas fa-times"></i>
                </button>
              </div>
            </div>
            
            <div class="p-6">
              <form id="supportTicketForm" class="space-y-6">
                <!-- Issue Type -->
                <div>
                  <label class="block text-sm font-medium text-gray-700 mb-2">
                    <i class="fas fa-tag mr-2 text-blue-600"></i>Issue Type
                  </label>
                  <select id="ticketIssueType" class="w-full border border-gray-300 rounded-lg px-4 py-3 focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all duration-300" required>
                    <option value="">Select issue type...</option>
                    <option value="Network Issue">Network Issue</option>
                    <option value="Hardware Problem">Hardware Problem</option>
                    <option value="Software Bug">Software Bug</option>
                    <option value="Installation Request">Installation Request</option>
                    <option value="Maintenance">Maintenance</option>
                    <option value="Repair">Repair</option>
                    <option value="Inspection">Inspection</option>
                    <option value="Asset Recovery">Asset Recovery</option>
                    <option value="Other">Other</option>
                  </select>
                </div>

                <!-- Client Selection -->
                <div>
                  <label class="block text-sm font-medium text-gray-700 mb-2">
                    <i class="fas fa-user mr-2 text-green-600"></i>Client
                  </label>
                  <select id="ticketClient" class="w-full border border-gray-300 rounded-lg px-4 py-3 focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all duration-300" required>
                    <option value="">Select client...</option>
                    <!-- Clients will be loaded dynamically -->
                  </select>
                </div>

                <!-- Priority -->
                <div>
                  <label class="block text-sm font-medium text-gray-700 mb-2">
                    <i class="fas fa-exclamation-triangle mr-2 text-orange-600"></i>Priority
                  </label>
                  <select id="ticketPriority" class="w-full border border-gray-300 rounded-lg px-4 py-3 focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all duration-300" required>
                    <option value="Low">Low</option>
                    <option value="Medium" selected>Medium</option>
                    <option value="High">High</option>
                    <option value="Critical">Critical</option>
                  </select>
                </div>

                <!-- Subject -->
                <div>
                  <label class="block text-sm font-medium text-gray-700 mb-2">
                    <i class="fas fa-heading mr-2 text-purple-600"></i>Subject
                  </label>
                  <input
                    type="text"
                    id="ticketSubject"
                    class="w-full border border-gray-300 rounded-lg px-4 py-3 focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all duration-300"
                    placeholder="Brief description of the issue..."
                    required
                  />
                </div>

                <!-- Description -->
                <div>
                  <label class="block text-sm font-medium text-gray-700 mb-2">
                    <i class="fas fa-align-left mr-2 text-indigo-600"></i>Description
                  </label>
                  <textarea
                    id="ticketDescription"
                    rows="4"
                    class="w-full border border-gray-300 rounded-lg px-4 py-3 focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all duration-300 resize-none"
                    placeholder="Detailed description of the issue, steps to reproduce, and any relevant information..."
                    required
                  ></textarea>
                </div>

                <!-- Assigned Technician -->
                <div>
                  <label class="block text-sm font-medium text-gray-700 mb-2">
                    <i class="fas fa-user-tie mr-2 text-teal-600"></i>Assign to Technician
                  </label>
                  <select id="ticketAssignedTechnician" class="w-full border border-gray-300 rounded-lg px-4 py-3 focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all duration-300">
                    <option value="">Unassigned</option>
                    <option value="John Supervisor">John Supervisor</option>
                    <option value="Sarah Williams">Sarah Williams</option>
                    <option value="Michael Johnson">Michael Johnson</option>
                    <option value="David Brown">David Brown</option>
                    <option value="Emily Davis">Emily Davis</option>
                  </select>
                </div>

                <!-- Action Buttons -->
                <div class="flex space-x-4 pt-4">
                  <button
                    type="button"
                    onclick="closeSupportTicketModal()"
                    class="flex-1 px-6 py-3 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 transition-all duration-300 font-medium"
                  >
                    <i class="fas fa-times mr-2"></i>Cancel
                  </button>
                  <button
                    type="submit"
                    class="flex-1 px-6 py-3 bg-gradient-to-r from-blue-600 to-indigo-600 text-white rounded-lg hover:from-blue-700 hover:to-indigo-700 transition-all duration-300 font-medium transform hover:scale-105"
                  >
                    <i class="fas fa-plus mr-2"></i>Create Ticket
                  </button>
                </div>
              </form>
            </div>
          </div>
        </div>

        <!-- Users Management Section -->
        <div id="users" class="hidden">
          <div class="bg-gradient-to-br from-slate-800 via-purple-900 to-indigo-900 rounded-2xl shadow-2xl border border-purple-700 overflow-hidden">
            <div class="px-6 py-4 border-b border-purple-600 bg-gradient-to-r from-purple-600 to-indigo-600">
              <div class="flex items-center justify-between">
                <div class="flex items-center space-x-3">
                  <div class="w-10 h-10 bg-white/20 rounded-lg flex items-center justify-center">
                    <i class="fas fa-users text-white text-lg"></i>
                  </div>
                  <div>
                    <h3 class="text-xl font-bold text-white">Users Management</h3>
                    <p class="text-purple-100 text-sm">Manage all system users and their roles</p>
                  </div>
                </div>
                <button class="px-4 py-2 bg-white/20 hover:bg-white/30 text-white rounded-lg transition-all duration-300">
                  <i class="fas fa-plus mr-2"></i>Add User
                </button>
              </div>
            </div>
            <div class="p-6">
              <div class="bg-white/5 rounded-lg p-4">
                <h4 class="text-white font-semibold mb-4">User Management Tools</h4>
                <div class="grid grid-cols-2 md:grid-cols-4 gap-4">
                  <button class="p-3 bg-white/10 hover:bg-white/20 rounded-lg transition-all duration-300 text-white text-center">
                    <i class="fas fa-user-plus text-2xl mb-2"></i>
                    <p class="text-sm">Add User</p>
                  </button>
                  <button class="p-3 bg-white/10 hover:bg-white/20 rounded-lg transition-all duration-300 text-white text-center">
                    <i class="fas fa-user-edit text-2xl mb-2"></i>
                    <p class="text-sm">Edit User</p>
                  </button>
                  <button class="p-3 bg-white/10 hover:bg-white/20 rounded-lg transition-all duration-300 text-white text-center">
                    <i class="fas fa-user-cog text-2xl mb-2"></i>
                    <p class="text-sm">Manage Roles</p>
                  </button>
                  <button class="p-3 bg-white/10 hover:bg-white/20 rounded-lg transition-all duration-300 text-white text-center">
                    <i class="fas fa-user-times text-2xl mb-2"></i>
                    <p class="text-sm">Deactivate</p>
                  </button>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- Finance Management Section -->
        <div id="finance" class="hidden">
          <div class="bg-gradient-to-br from-slate-800 via-green-900 to-emerald-900 rounded-2xl shadow-2xl border border-green-700 overflow-hidden">
            <div class="px-6 py-4 border-b border-green-600 bg-gradient-to-r from-green-600 to-emerald-600">
              <div class="flex items-center justify-between">
                <div class="flex items-center space-x-3">
                  <div class="w-10 h-10 bg-white/20 rounded-lg flex items-center justify-center">
                    <i class="fas fa-dollar-sign text-white text-lg"></i>
                  </div>
                  <div>
                    <h3 class="text-xl font-bold text-white">Finance Management</h3>
                    <p class="text-green-100 text-sm">Track revenue, expenses, and financial reports</p>
                  </div>
                </div>
                <button class="px-4 py-2 bg-white/20 hover:bg-white/30 text-white rounded-lg transition-all duration-300">
                  <i class="fas fa-plus mr-2"></i>Add Transaction
                </button>
              </div>
            </div>
            <div class="p-6">
              <div class="bg-white/5 rounded-lg p-4">
                <h4 class="text-white font-semibold mb-4">Financial Tools</h4>
                <div class="grid grid-cols-2 md:grid-cols-4 gap-4">
                  <button class="p-3 bg-white/10 hover:bg-white/20 rounded-lg transition-all duration-300 text-white text-center">
                    <i class="fas fa-file-invoice text-2xl mb-2"></i>
                    <p class="text-sm">Generate Invoice</p>
                  </button>
                  <button class="p-3 bg-white/10 hover:bg-white/20 rounded-lg transition-all duration-300 text-white text-center">
                    <i class="fas fa-chart-bar text-2xl mb-2"></i>
                    <p class="text-sm">View Reports</p>
                  </button>
                  <button class="p-3 bg-white/10 hover:bg-white/20 rounded-lg transition-all duration-300 text-white text-center">
                    <i class="fas fa-receipt text-2xl mb-2"></i>
                    <p class="text-sm">Track Expenses</p>
                  </button>
                  <button class="p-3 bg-white/10 hover:bg-white/20 rounded-lg transition-all duration-300 text-white text-center">
                    <i class="fas fa-credit-card text-2xl mb-2"></i>
                    <p class="text-sm">Payment History</p>
                  </button>
                </div>
              </div>
              
              <!-- Payslip Activation Section -->
              <div class="bg-white/5 rounded-lg p-4 mt-6">
                <h4 class="text-white font-semibold mb-4">Payslip Management</h4>
                <div class="space-y-4">
                  <div class="flex items-center justify-between p-4 bg-white/10 rounded-lg">
                    <div class="flex items-center space-x-3">
                      <i class="fas fa-file-invoice-dollar text-green-400 text-xl"></i>
                      <div>
                        <p class="text-white font-medium">Activate Payslips for Staff</p>
                        <p class="text-white/70 text-sm">Enable staff to download their payslips</p>
                      </div>
                    </div>
                    <button onclick="openPayslipActivation()" class="px-4 py-2 bg-gradient-to-r from-green-500 to-emerald-600 hover:from-green-600 hover:to-emerald-700 text-white rounded-lg transition-all duration-300 transform hover:scale-105">
                      <i class="fas fa-play mr-2"></i>Activate Payslips
                    </button>
                  </div>
                  
                  <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <div class="bg-white/10 rounded-lg p-4">
                      <div class="flex items-center justify-between mb-2">
                        <span class="text-white/80 text-sm">Active Payslips</span>
                        <span class="text-green-400 font-bold" id="activePayslipsCount">0</span>
                      </div>
                      <div class="w-full bg-white/20 rounded-full h-2">
                        <div class="bg-green-400 h-2 rounded-full" id="activePayslipsBar" style="width: 0%"></div>
                      </div>
                    </div>
                    <div class="bg-white/10 rounded-lg p-4">
                      <div class="flex items-center justify-between mb-2">
                        <span class="text-white/80 text-sm">Staff Members</span>
                        <span class="text-blue-400 font-bold" id="totalStaffCount">0</span>
                      </div>
                      <div class="w-full bg-white/20 rounded-full h-2">
                        <div class="bg-blue-400 h-2 rounded-full" id="staffCountBar" style="width: 0%"></div>
                      </div>
                    </div>
                  </div>
                  
                  <!-- CTIO Payslip Downloads -->
                  <div class="mt-6">
                    <div class="flex items-center justify-between p-4 bg-white/10 rounded-lg">
                      <div class="flex items-center space-x-3">
                        <i class="fas fa-download text-blue-400 text-xl"></i>
                        <div>
                          <p class="text-white font-medium">Download Activated Payslips</p>
                          <p class="text-white/70 text-sm">Download payslips for any activated month</p>
                        </div>
                      </div>
                      <button onclick="openCTIOPayslipDownload()" class="px-4 py-2 bg-gradient-to-r from-blue-500 to-cyan-600 hover:from-blue-600 hover:to-cyan-700 text-white rounded-lg transition-all duration-300 transform hover:scale-105">
                        <i class="fas fa-download mr-2"></i>Download Payslips
                      </button>
                    </div>
                  </div>
                  
                  <!-- View All Payslips -->
                  <div class="mt-4">
                    <div class="flex items-center justify-between p-4 bg-white/10 rounded-lg">
                      <div class="flex items-center space-x-3">
                        <i class="fas fa-list text-purple-400 text-xl"></i>
                        <div>
                          <p class="text-white font-medium">View All Payslips</p>
                          <p class="text-white/70 text-sm">View and manage all activated payslips</p>
                        </div>
                      </div>
                      <button onclick="openViewAllPayslips()" class="px-4 py-2 bg-gradient-to-r from-purple-500 to-pink-600 hover:from-purple-600 hover:to-pink-700 text-white rounded-lg transition-all duration-300 transform hover:scale-105">
                        <i class="fas fa-eye mr-2"></i>View All
                      </button>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- Equipment & Tools Section -->
        <div id="equipment" class="hidden">
          <div class="bg-gradient-to-br from-slate-800 via-orange-900 to-red-900 rounded-2xl shadow-2xl border border-orange-700 overflow-hidden">
            <div class="px-6 py-4 border-b border-orange-600 bg-gradient-to-r from-orange-600 to-red-600">
              <div class="flex items-center justify-between">
                <div class="flex items-center space-x-3">
                  <div class="w-10 h-10 bg-white/20 rounded-lg flex items-center justify-center">
                    <i class="fas fa-tools text-white text-lg"></i>
                  </div>
                  <div>
                    <h3 class="text-xl font-bold text-white">Equipment & Tools</h3>
                    <p class="text-orange-100 text-sm">Manage equipment inventory and maintenance</p>
                  </div>
                </div>
                <button class="px-4 py-2 bg-white/20 hover:bg-white/30 text-white rounded-lg transition-all duration-300">
                  <i class="fas fa-plus mr-2"></i>Add Equipment
                </button>
              </div>
            </div>
            <div class="p-6">
              <div class="bg-white/5 rounded-lg p-4">
                <h4 class="text-white font-semibold mb-4">Equipment Management</h4>
                <div class="grid grid-cols-2 md:grid-cols-4 gap-4">
                  <button class="p-3 bg-white/10 hover:bg-white/20 rounded-lg transition-all duration-300 text-white text-center">
                    <i class="fas fa-plus text-2xl mb-2"></i>
                    <p class="text-sm">Add Equipment</p>
                  </button>
                  <button class="p-3 bg-white/10 hover:bg-white/20 rounded-lg transition-all duration-300 text-white text-center">
                    <i class="fas fa-edit text-2xl mb-2"></i>
                    <p class="text-sm">Edit Equipment</p>
                  </button>
                  <button class="p-3 bg-white/10 hover:bg-white/20 rounded-lg transition-all duration-300 text-white text-center">
                    <i class="fas fa-wrench text-2xl mb-2"></i>
                    <p class="text-sm">Schedule Maintenance</p>
                  </button>
                  <button class="p-3 bg-white/10 hover:bg-white/20 rounded-lg transition-all duration-300 text-white text-center">
                    <i class="fas fa-chart-pie text-2xl mb-2"></i>
                    <p class="text-sm">View Reports</p>
                  </button>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- Reports & Logs Section -->
        <div id="reports" class="hidden">
          <div class="bg-gradient-to-br from-slate-800 via-indigo-900 to-purple-900 rounded-2xl shadow-2xl border border-indigo-700 overflow-hidden">
            <div class="px-6 py-4 border-b border-indigo-600 bg-gradient-to-r from-indigo-600 to-purple-600">
              <div class="flex items-center justify-between">
                <div class="flex items-center space-x-3">
                  <div class="w-10 h-10 bg-white/20 rounded-lg flex items-center justify-center">
                    <i class="fas fa-chart-bar text-white text-lg"></i>
                  </div>
                  <div>
                    <h3 class="text-xl font-bold text-white">Reports & Logs</h3>
                    <p class="text-indigo-100 text-sm">Generate reports and view system logs</p>
                  </div>
                </div>
                <button class="px-4 py-2 bg-white/20 hover:bg-white/30 text-white rounded-lg transition-all duration-300">
                  <i class="fas fa-download mr-2"></i>Export Report
                </button>
              </div>
            </div>
            <div class="p-6">
              <!-- Supervisor Reports Section -->
              <div class="bg-white/5 rounded-lg p-4 mb-6">
                <h4 class="text-white font-semibold mb-4 flex items-center">
                  <i class="fas fa-clipboard-list mr-2"></i>
                  Supervisor Reports
                </h4>
                <div class="space-y-4" id="supervisorReportsList">
                  <!-- Reports will be loaded dynamically here -->
                </div>
              </div>
              
              <div class="bg-white/5 rounded-lg p-4">
                <h4 class="text-white font-semibold mb-4">Report Generation</h4>
                <div class="grid grid-cols-2 md:grid-cols-4 gap-4">
                  <button class="p-3 bg-white/10 hover:bg-white/20 rounded-lg transition-all duration-300 text-white text-center">
                    <i class="fas fa-users text-2xl mb-2"></i>
                    <p class="text-sm">User Report</p>
                  </button>
                  <button class="p-3 bg-white/10 hover:bg-white/20 rounded-lg transition-all duration-300 text-white text-center">
                    <i class="fas fa-dollar-sign text-2xl mb-2"></i>
                    <p class="text-sm">Financial Report</p>
                  </button>
                  <button class="p-3 bg-white/10 hover:bg-white/20 rounded-lg transition-all duration-300 text-white text-center">
                    <i class="fas fa-tools text-2xl mb-2"></i>
                    <p class="text-sm">Equipment Report</p>
                  </button>
                  <button class="p-3 bg-white/10 hover:bg-white/20 rounded-lg transition-all duration-300 text-white text-center">
                    <i class="fas fa-chart-line text-2xl mb-2"></i>
                    <p class="text-sm">Analytics Report</p>
                  </button>
                </div>
              </div>
            </div>
          </div>
        </div>
      </section>

      <!-- Sales Management Section -->
      <section id="salesManagement" class="hidden container mx-auto px-1 py-2">
        <div class="bg-gradient-to-br from-slate-800 via-blue-900 to-indigo-900 rounded-2xl shadow-2xl border border-blue-700 overflow-hidden">
          <div class="p-6 md:p-8">
            <!-- Header -->
            <div class="mb-8">
              <h1 class="text-4xl font-bold text-white mb-3 bg-gradient-to-r from-white via-blue-100 to-cyan-100 bg-clip-text text-transparent">
                Sales Management
              </h1>
              <p class="text-blue-100/80 text-lg">View all sales records and generate invoices</p>
            </div>

            <!-- Sales Summary Cards -->
            <div class="grid grid-cols-1 md:grid-cols-4 gap-6 mb-8">
              <div class="bg-gradient-to-br from-green-500/20 to-emerald-500/20 backdrop-blur-lg rounded-xl p-6 border border-white/20">
                <div class="flex items-center justify-between">
                  <div>
                    <p class="text-sm text-blue-100/80 mb-1">Total Sales</p>
                    <p class="text-3xl font-bold text-white" id="totalSalesAmount">Ksh 0</p>
                  </div>
                  <div class="w-12 h-12 bg-green-500/30 rounded-xl flex items-center justify-center">
                    <i class="fas fa-chart-line text-white text-xl"></i>
                  </div>
                </div>
              </div>
              <div class="bg-gradient-to-br from-blue-500/20 to-cyan-500/20 backdrop-blur-lg rounded-xl p-6 border border-white/20">
                <div class="flex items-center justify-between">
                  <div>
                    <p class="text-sm text-blue-100/80 mb-1">Number of Sales</p>
                    <p class="text-3xl font-bold text-white" id="totalSalesCount">0</p>
                  </div>
                  <div class="w-12 h-12 bg-blue-500/30 rounded-xl flex items-center justify-center">
                    <i class="fas fa-receipt text-white text-xl"></i>
                  </div>
                </div>
              </div>
              <div class="bg-gradient-to-br from-purple-500/20 to-pink-500/20 backdrop-blur-lg rounded-xl p-6 border border-white/20">
                <div class="flex items-center justify-between">
                  <div>
                    <p class="text-sm text-blue-100/80 mb-1">Paid Sales</p>
                    <p class="text-3xl font-bold text-white" id="paidSalesAmount">Ksh 0</p>
                  </div>
                  <div class="w-12 h-12 bg-purple-500/30 rounded-xl flex items-center justify-center">
                    <i class="fas fa-check-circle text-white text-xl"></i>
                  </div>
                </div>
              </div>
              <div class="bg-gradient-to-br from-yellow-500/20 to-orange-500/20 backdrop-blur-lg rounded-xl p-6 border border-white/20">
                <div class="flex items-center justify-between">
                  <div>
                    <p class="text-sm text-blue-100/80 mb-1">Pending Sales</p>
                    <p class="text-3xl font-bold text-white" id="pendingSalesAmount">Ksh 0</p>
                  </div>
                  <div class="w-12 h-12 bg-yellow-500/30 rounded-xl flex items-center justify-center">
                    <i class="fas fa-clock text-white text-xl"></i>
                  </div>
                </div>
              </div>
            </div>

            <!-- Filters -->
            <div class="bg-white/10 backdrop-blur-lg rounded-xl p-4 mb-6 border border-white/20">
              <div class="grid grid-cols-1 md:grid-cols-4 gap-4">
                <div>
                  <label class="block text-sm font-medium text-white mb-1">Search</label>
                  <input type="text" id="salesSearchInput" placeholder="Search sales..." class="w-full px-3 py-2 border border-white/30 rounded-lg bg-white/10 text-white placeholder-white/60 focus:ring-2 focus:ring-blue-500 focus:border-blue-500" onkeyup="filterSalesManagement()">
                </div>
                <div>
                  <label class="block text-sm font-medium text-white mb-1">Service Type</label>
                  <select id="salesServiceTypeFilter" class="w-full px-3 py-2 border border-white/30 rounded-lg bg-white/10 text-white focus:ring-2 focus:ring-blue-500 focus:border-blue-500" onchange="filterSalesManagement()">
                    <option value="">All Services</option>
                    <option value="Cyber Services">Cyber Services</option>
                    <option value="Equipment and Accessories">Equipment and Accessories</option>
                    <option value="Technical Support">Technical Support</option>
                    <option value="Other">Other</option>
                  </select>
                </div>
                <div>
                  <label class="block text-sm font-medium text-white mb-1">Payment Status</label>
                  <select id="salesPaymentStatusFilter" class="w-full px-3 py-2 border border-white/30 rounded-lg bg-white/10 text-white focus:ring-2 focus:ring-blue-500 focus:border-blue-500" onchange="filterSalesManagement()">
                    <option value="">All Status</option>
                    <option value="Paid">Paid</option>
                    <option value="Pending">Pending</option>
                    <option value="Partial">Partial</option>
                    <option value="Overdue">Overdue</option>
                  </select>
                </div>
                <div>
                  <label class="block text-sm font-medium text-white mb-1">Date Range</label>
                  <input type="month" id="salesMonthFilter" class="w-full px-3 py-2 border border-white/30 rounded-lg bg-white/10 text-white focus:ring-2 focus:ring-blue-500 focus:border-blue-500" onchange="filterSalesManagement()">
                </div>
              </div>
            </div>

            <!-- Sales Table -->
            <div class="bg-white/10 backdrop-blur-lg rounded-xl border border-white/20 overflow-hidden">
              <div class="overflow-x-auto">
                <table class="w-full">
                  <thead class="bg-white/20">
                    <tr>
                      <th class="text-left py-4 px-4 font-semibold text-white text-sm">Date</th>
                      <th class="text-left py-4 px-4 font-semibold text-white text-sm">Client Name</th>
                      <th class="text-left py-4 px-4 font-semibold text-white text-sm">Service Type</th>
                      <th class="text-left py-4 px-4 font-semibold text-white text-sm">Description</th>
                      <th class="text-right py-4 px-4 font-semibold text-white text-sm">Amount (Ksh)</th>
                      <th class="text-left py-4 px-4 font-semibold text-white text-sm">Status</th>
                      <th class="text-left py-4 px-4 font-semibold text-white text-sm">Created By</th>
                      <th class="text-center py-4 px-4 font-semibold text-white text-sm">Actions</th>
                    </tr>
                  </thead>
                  <tbody id="ctioSalesTableBody" class="divide-y divide-white/10">
                    <!-- Sales will be loaded dynamically here -->
                  </tbody>
                </table>
              </div>
              <div id="ctioSalesEmptyState" class="text-center py-12 hidden">
                <div class="w-16 h-16 bg-white/20 rounded-full flex items-center justify-center mx-auto mb-4">
                  <i class="fas fa-shopping-cart text-2xl text-white/60"></i>
                </div>
                <h3 class="text-lg font-medium text-white mb-2">No Sales Found</h3>
                <p class="text-white/60">Sales recorded by supervisors will appear here</p>
              </div>
            </div>
          </div>
        </div>
      </section>
    </main>

    <!-- Client Management JavaScript -->
    <script>
      // Show/Hide different sections
      function showDeletedClients() {
        hideAllSections();
        document.getElementById("deletedUsers").classList.remove("hidden");
        loadDeletedClients();
      }

      function hideAllSections() {
        const sections = ["dashboard", "deletedUsers", "serviceRequests", "serviceAssignments", "attendance", "users", "finance", "salesManagement", "equipment", "reports"];
        sections.forEach(sectionId => {
          const section = document.getElementById(sectionId);
          if (section) {
            section.classList.add("hidden");
            section.style.display = 'none';
            section.style.visibility = 'hidden';
          }
        });
      }

      function showDashboard() {
        try {
          console.log('üîÑ Showing dashboard...');
          
          // Hide all sections first
          hideAllSections();
          
          // Show dashboard section
          const dashboardSection = document.getElementById("dashboard");
          if (dashboardSection) {
            dashboardSection.classList.remove("hidden");
            dashboardSection.style.display = '';
            dashboardSection.style.visibility = 'visible';
            console.log('‚úÖ Dashboard section shown');
            
            // IMPORTANT: Hide all nested sections inside dashboard
            // These sections are children of dashboard, so they need to be explicitly hidden
            const nestedSections = ['deletedUsers', 'serviceAssignments', 'attendance'];
            nestedSections.forEach(sectionId => {
              const nestedSection = document.getElementById(sectionId);
              if (nestedSection) {
                nestedSection.classList.add("hidden");
                nestedSection.style.display = 'none';
                nestedSection.style.visibility = 'hidden';
                console.log('‚úÖ Nested section hidden:', sectionId);
              }
            });
            
            // IMPORTANT: Restore display of dashboard's main content children
            // (These were hidden when showing nested sections like attendance)
            const dashboardChildren = dashboardSection.children;
            for (let i = 0; i < dashboardChildren.length; i++) {
              const child = dashboardChildren[i];
              // Only restore if it's not a nested section (those stay hidden)
              if (child.id !== 'attendance' && child.id !== 'serviceAssignments' && child.id !== 'deletedUsers') {
                child.style.display = ''; // Reset to default
                console.log('‚úÖ Dashboard child restored:', child.id || child.className);
              }
            }
          } else {
            console.error('‚ùå Dashboard section not found!');
          }
          
          // Explicitly ensure all other sections (outside dashboard) are hidden
          const allOtherSections = ['serviceRequests', 'users', 'finance', 'salesManagement', 'equipment', 'reports'];
          allOtherSections.forEach(sectionId => {
            const section = document.getElementById(sectionId);
            if (section) {
              section.classList.add("hidden");
              section.style.display = 'none';
              section.style.visibility = 'hidden';
            }
          });
          
          // Show logout button only on dashboard
          const logoutButton = document.getElementById("logoutButton");
          if (logoutButton) {
            logoutButton.classList.remove("hidden");
          }
          
          // Load and display profile image
          loadProfileImage();
          
          // Ensure sidebar stays visible on desktop
          ensureSidebarVisible();
          
          console.log('‚úÖ Dashboard shown successfully');
        } catch (error) {
          console.error('‚ùå Error showing dashboard:', error);
        }
      }
      
      // Load profile image for CTIO dashboard
      function loadProfileImage() {
        const profileImageElement = document.getElementById('adminProfileImage');
        if (!profileImageElement) return;
        
        // Try to get profile image from centralized manager
        let imageUrl = null;
        if (window.ProfileImageManager) {
          imageUrl = window.ProfileImageManager.get();
        } else {
          // Fallback to old method
          imageUrl = localStorage.getItem('adminProfileImage');
        }
        
        if (imageUrl) {
          profileImageElement.src = imageUrl;
          profileImageElement.style.display = 'block';
        } else {
          profileImageElement.src = '';
          profileImageElement.style.display = 'none';
        }
      }
      
      // Listen for profile image updates
      if (window.addEventListener) {
        window.addEventListener('profileImageUpdated', () => {
          loadProfileImage();
        });
      }

      function showSupportTickets() {
        // Use the standard showSection function for consistency
        showSection('serviceRequests');
      }
      
      function ensureSidebarVisible() {
        const sidebar = document.getElementById('sidebar');
        const mainContent = document.querySelector('.main-content');
        
        if (sidebar && window.innerWidth >= 1024) {
          // On desktop, ensure sidebar is visible
          sidebar.classList.remove('-translate-x-full');
          sidebar.classList.add('show');
          sidebar.style.transform = 'translateX(0)';
          
          // Ensure main content has proper margin
          if (mainContent) {
            mainContent.style.marginLeft = '280px';
          }
          
          console.log('‚úÖ Sidebar made visible on desktop');
        } else {
          console.log('‚ùå Sidebar not made visible - not desktop or no sidebar');
        }
      }
      
      // Add window resize listener to maintain sidebar visibility
      window.addEventListener('resize', function() {
        ensureSidebarVisible();
      });

      function showSection(sectionId) {
        try {
          console.log('üîÑ Attempting to show section:', sectionId);
          
          // First, hide all sections
          hideAllSections();
          
          // Explicitly ensure dashboard is hidden for all non-dashboard sections
          if (sectionId !== "dashboard") {
            const dashboardSection = document.getElementById("dashboard");
            if (dashboardSection) {
              dashboardSection.classList.add("hidden");
              dashboardSection.style.display = 'none';
              dashboardSection.style.visibility = 'hidden';
              console.log('‚úÖ Dashboard hidden before showing:', sectionId);
            }
          }
          
          // Show the selected section
          const targetSection = document.getElementById(sectionId);
          if (!targetSection) {
            console.error('‚ùå Section not found:', sectionId);
            // Only fallback to dashboard if it's not a special case
            // Special cases (like attendance) handle their own errors
            if (sectionId !== 'attendance') {
              showDashboard();
            }
            return;
          }
          
          // Force remove hidden class and display style
          targetSection.classList.remove("hidden");
          targetSection.style.display = '';
          targetSection.style.visibility = 'visible';
          
          console.log('‚úÖ Section shown:', sectionId);
          console.log('‚úÖ Section classes:', targetSection.className);
          console.log('‚úÖ Section display:', window.getComputedStyle(targetSection).display);
          
          // Hide logout button on all sections except dashboard
          const logoutButton = document.getElementById("logoutButton");
          if (logoutButton) {
            if (sectionId !== "dashboard") {
              logoutButton.classList.add("hidden");
            } else {
              logoutButton.classList.remove("hidden");
            }
          }
          
          // Ensure sidebar stays visible on desktop
          ensureSidebarVisible();
          
          // Load section-specific data
          switch(sectionId) {
          case 'serviceAssignments':
            console.log('üîß Loading service assignments section...');
            loadCtioServiceAssignments();
            break;
          case 'attendance':
            console.log('üë• Loading attendance section...');
            
            // IMPORTANT: Attendance is nested inside dashboard section
            // So we need to show dashboard section but hide its main content
            const dashboard = document.getElementById("dashboard");
            if (dashboard) {
              // Keep dashboard visible since attendance is nested inside it
              dashboard.classList.remove("hidden");
              dashboard.style.display = '';
              dashboard.style.visibility = 'visible';
              
              // Hide dashboard's main content (all direct children except attendance and nested sections)
              const dashboardChildren = dashboard.children;
              for (let i = 0; i < dashboardChildren.length; i++) {
                const child = dashboardChildren[i];
                // Skip attendance, serviceAssignments, deletedUsers - these are handled separately
                if (child.id !== 'attendance' && child.id !== 'serviceAssignments' && child.id !== 'deletedUsers') {
                  child.style.display = 'none';
                  console.log('‚úÖ Dashboard child hidden:', child.id || child.className);
                }
              }
              
              console.log('‚úÖ Dashboard section shown (parent of attendance)');
            }
            
            // Hide other nested sections in dashboard
            const otherNestedSections = ['serviceAssignments', 'deletedUsers'];
            otherNestedSections.forEach(sectionId => {
              const nestedSection = document.getElementById(sectionId);
              if (nestedSection) {
                nestedSection.classList.add("hidden");
                nestedSection.style.display = 'none';
                nestedSection.style.visibility = 'hidden';
              }
            });
            
            // Show attendance section
            const attendanceSection = document.getElementById("attendance");
            if (attendanceSection) {
              // Force remove all hiding classes and styles
              attendanceSection.classList.remove("hidden");
              attendanceSection.style.display = '';
              attendanceSection.style.visibility = 'visible';
              
              // Verify it's actually visible
              const computedStyle = window.getComputedStyle(attendanceSection);
              console.log('‚úÖ Attendance section forced to be visible');
              console.log('‚úÖ Attendance display:', computedStyle.display);
              console.log('‚úÖ Attendance visibility:', computedStyle.visibility);
              
              // If still not visible, try block display
              if (computedStyle.display === 'none' || computedStyle.visibility === 'hidden') {
                attendanceSection.style.display = 'block';
                attendanceSection.style.visibility = 'visible';
                console.log('‚ö†Ô∏è Attendance section display forced to block');
              }
            } else {
              console.error('‚ùå Attendance section element not found!');
              return;
            }
            
            // Wait a bit then load attendance data to ensure DOM is ready
            setTimeout(() => {
              loadCtioAttendance();
            }, 100);
            break;
          case 'serviceRequests':
            loadCtioSupportTickets();
            break;
          case 'deletedClients':
            showDeletedClients();
            break;
          case 'users':
            console.log('üë• Loading users management section...');
            loadUsersData();
            break;
          case 'finance':
            console.log('üí∞ Loading finance management section...');
            loadFinanceData();
            break;
          case 'salesManagement':
            console.log('üõí Loading sales management section...');
            loadSalesManagement();
            break;
          case 'equipment':
            console.log('üõ†Ô∏è Loading equipment management section...');
            loadEquipmentData();
            break;
          case 'reports':
            console.log('üìä Loading reports and logs section...');
            loadReportsData();
            break;
          case 'dashboard':
            showDashboard();
            break;
          default:
            console.log('‚ÑπÔ∏è No specific loader for section:', sectionId);
        }
        } catch (error) {
          console.error('‚ùå Error showing section:', sectionId, error);
          // Fallback: show dashboard on error
          showDashboard();
        }
      }

      // Data loading functions for each section
      function loadUsersData() {
        try {
          // Load users data from localStorage or API
          const users = JSON.parse(localStorage.getItem('users') || '[]');
          const staff = JSON.parse(localStorage.getItem('staff') || '[]');
          const clients = JSON.parse(localStorage.getItem('clients') || '[]');
          
          const totalUsers = users.length + staff.length + clients.length;
          const activeUsers = users.filter(u => u.status === 'active').length + 
                            staff.filter(s => s.status === 'active').length + 
                            clients.filter(c => c.status === 'active').length;
          
          // Update UI elements
          document.getElementById('totalUsersCount').textContent = totalUsers;
          document.getElementById('activeUsersCount').textContent = activeUsers;
          document.getElementById('newUsersCount').textContent = Math.floor(Math.random() * 10); // Mock data
          
          console.log('‚úÖ Users data loaded successfully');
        } catch (error) {
          console.error('Error loading users data:', error);
        }
      }

      function loadFinanceData() {
        try {
          // Load finance data from localStorage or API
          const clients = JSON.parse(localStorage.getItem('clients') || '[]');
          
          let totalRevenue = 0;
          let monthlyIncome = 0;
          let outstandingAmount = 0;
          
          clients.forEach(client => {
            if (client.subscription_amount) {
              totalRevenue += parseFloat(client.subscription_amount) || 0;
              
              // Calculate monthly income (mock calculation)
              if (client.paid_subscription) {
                monthlyIncome += parseFloat(client.subscription_amount) || 0;
              } else {
                outstandingAmount += parseFloat(client.subscription_amount) || 0;
              }
            }
          });
          
          const profitMargin = monthlyIncome > 0 ? Math.round((monthlyIncome - (monthlyIncome * 0.3)) / monthlyIncome * 100) : 0;
          
          // Update UI elements
          document.getElementById('totalRevenue').textContent = `Ksh ${totalRevenue.toLocaleString()}`;
          document.getElementById('monthlyIncome').textContent = `Ksh ${monthlyIncome.toLocaleString()}`;
          document.getElementById('outstandingAmount').textContent = `Ksh ${outstandingAmount.toLocaleString()}`;
          document.getElementById('profitMargin').textContent = `${profitMargin}%`;
          
          // Load payslip stats
          loadPayslipStats();
          
          console.log('‚úÖ Finance data loaded successfully');
        } catch (error) {
          console.error('Error loading finance data:', error);
        }
      }

      // Payslip Management Functions
      function loadPayslipStats() {
        try {
          // Load staff data
          const staffData = JSON.parse(localStorage.getItem('staffData') || '[]');
          const activatedPayslips = JSON.parse(localStorage.getItem('staffPayslips') || '[]');
          
          // Update staff count
          const totalStaff = staffData.length;
          document.getElementById('totalStaffCount').textContent = totalStaff;
          document.getElementById('staffCountBar').style.width = '100%';
          
          // Update active payslips count
          const activePayslips = activatedPayslips.length;
          document.getElementById('activePayslipsCount').textContent = activePayslips;
          
          // Calculate percentage
          const percentage = totalStaff > 0 ? (activePayslips / totalStaff) * 100 : 0;
          document.getElementById('activePayslipsBar').style.width = `${percentage}%`;
          
        } catch (error) {
          console.error('Error loading payslip stats:', error);
        }
      }

      function openPayslipActivation() {
        // Load staff data
        const staffData = JSON.parse(localStorage.getItem('staffData') || '[]');
        
        if (staffData.length === 0) {
          Swal.fire({
            title: 'No Staff Found',
            text: 'Please add staff members first before activating payslips.',
            icon: 'warning',
            confirmButtonText: 'OK'
          });
          return;
        }

        // Get current month and year
        const currentDate = new Date();
        const currentYear = currentDate.getFullYear();
        const currentMonth = currentDate.getMonth() + 1;
        const monthNames = [
          'January', 'February', 'March', 'April', 'May', 'June',
          'July', 'August', 'September', 'October', 'November', 'December'
        ];

        Swal.fire({
          title: 'Activate Payslips for Staff',
          html: `
            <div class="space-y-4">
              <div>
                <label class="block text-sm font-medium text-gray-700 mb-2">Select Staff Member</label>
                <select id="payslipStaffSelect" class="w-full border border-gray-300 rounded-md px-3 py-2">
                  <option value="">Select a staff member...</option>
                  ${staffData.map(staff => `
                    <option value="${JSON.stringify(staff)}">${staff.fullName} - ${staff.role}</option>
                  `).join('')}
                </select>
              </div>
              <div>
                <label class="block text-sm font-medium text-gray-700 mb-2">Pay Period</label>
                <select id="payslipPeriod" class="w-full border border-gray-300 rounded-md px-3 py-2">
                  ${Array.from({length: 12}, (_, i) => {
                    const monthNum = i + 1;
                    const monthName = monthNames[i];
                    const isCurrentMonth = monthNum === currentMonth;
                    return `<option value="${monthName} ${currentYear}" ${isCurrentMonth ? 'selected' : ''}>${monthName} ${currentYear}</option>`;
                  }).join('')}
                </select>
              </div>
              <div>
                <label class="block text-sm font-medium text-gray-700 mb-2">Basic Salary (KSH)</label>
                <input type="number" id="payslipSalary" class="w-full border border-gray-300 rounded-md px-3 py-2" placeholder="Enter basic salary" value="45000">
              </div>
              <div class="flex items-center">
                <input type="checkbox" id="allowSupervisorAccess" class="mr-2" checked>
                <label for="allowSupervisorAccess" class="text-sm text-gray-700">Allow supervisor to download this payslip</label>
              </div>
            </div>
          `,
          width: '500px',
          showCancelButton: true,
          confirmButtonText: 'Activate Payslip',
          cancelButtonText: 'Cancel',
          preConfirm: () => {
            const staffSelect = document.getElementById('payslipStaffSelect');
            const periodSelect = document.getElementById('payslipPeriod');
            const salaryInput = document.getElementById('payslipSalary');
            const allowSupervisorAccess = document.getElementById('allowSupervisorAccess');
            
            if (!staffSelect.value) {
              Swal.showValidationMessage('Please select a staff member');
              return false;
            }
            
            if (!periodSelect.value) {
              Swal.showValidationMessage('Please select a pay period');
              return false;
            }
            
            if (!salaryInput.value || salaryInput.value <= 0) {
              Swal.showValidationMessage('Please enter a valid salary amount');
              return false;
            }
            
            return {
              staff: JSON.parse(staffSelect.value),
              period: periodSelect.value,
              salary: parseFloat(salaryInput.value),
              allowSupervisorAccess: allowSupervisorAccess.checked
            };
          }
        }).then((result) => {
          if (result.isConfirmed) {
            activatePayslipForStaff(result.value.staff, result.value.period, result.value.salary, result.value.allowSupervisorAccess);
          }
        });
      }

      function activatePayslipForStaff(staff, period, salary, allowSupervisorAccess) {
        try {
          // Generate payslip data
          const payslipData = {
            staffId: staff.id,
            staffName: staff.fullName,
            staffRole: staff.role,
            payPeriod: period,
            basicSalary: salary,
            netSalary: salary, // No deductions for now
            activatedBy: 'CTIO',
            activatedDate: new Date().toISOString(),
            status: 'active',
            staffUserId: staff.id,
            staffUserName: staff.fullName,
            staffUserRole: staff.role,
            allowSupervisorAccess: allowSupervisorAccess
          };

          // Store in staff-specific payslips
          let staffPayslips = JSON.parse(localStorage.getItem('staffPayslips') || '[]');
          staffPayslips.push(payslipData);
          localStorage.setItem('staffPayslips', JSON.stringify(staffPayslips));

          // Store in supervisor-accessible payslips if allowed
          if (allowSupervisorAccess) {
            let supervisorPayslips = JSON.parse(localStorage.getItem('supervisorPayslips') || '[]');
            supervisorPayslips.push(payslipData);
            localStorage.setItem('supervisorPayslips', JSON.stringify(supervisorPayslips));
          }

          // Create notification for the staff member
          let staffNotifications = JSON.parse(localStorage.getItem('staffNotifications') || '[]');
          const staffNotification = {
            id: `STAFF${Date.now()}${Math.random().toString(36).substr(2, 5)}`,
            type: 'payslip_activated',
            title: 'Payslip Activated',
            message: `Your payslip for ${period} has been activated and is ready for download`,
            staffId: staff.id,
            payslipId: payslipData.staffId,
            timestamp: Date.now(),
            isRead: false,
            createdBy: 'CTIO',
            createdAt: new Date().toISOString(),
          };

          staffNotifications.unshift(staffNotification);
          if (staffNotifications.length > 100) {
            staffNotifications = staffNotifications.slice(0, 100);
          }
          localStorage.setItem('staffNotifications', JSON.stringify(staffNotifications));

          // Create notification for the supervisor if they have access
          if (allowSupervisorAccess) {
            let supervisorNotifications = JSON.parse(localStorage.getItem('supervisorNotifications') || '[]');
            const supervisorNotification = {
              id: `SUP${Date.now()}${Math.random().toString(36).substr(2, 5)}`,
              type: 'payslip_activated',
              title: 'Staff Payslip Available',
              message: `Payslip for ${staff.fullName} (${period}) is now available for download`,
              staffId: staff.id,
              payslipId: payslipData.staffId,
              timestamp: Date.now(),
              isRead: false,
              createdBy: 'CTIO',
              createdAt: new Date().toISOString(),
            };

            supervisorNotifications.unshift(supervisorNotification);
            if (supervisorNotifications.length > 100) {
              supervisorNotifications = supervisorNotifications.slice(0, 100);
            }
            localStorage.setItem('supervisorNotifications', JSON.stringify(supervisorNotifications));
          }

          // Update payslip stats
          loadPayslipStats();

          // Show success message
          Swal.fire({
            title: 'Payslip Activated!',
            html: `
              <div class="text-center">
                <div class="text-green-500 text-6xl mb-4">‚úì</div>
                <p class="text-lg mb-2">Payslip for <strong>${staff.fullName}</strong> has been activated</p>
                <p class="text-sm text-gray-600">Pay Period: ${period}</p>
                <p class="text-sm text-gray-600">Amount: KSH ${salary.toLocaleString()}</p>
                <p class="text-sm text-gray-600 mt-2">They can now download it from their dashboard</p>
                ${allowSupervisorAccess ? '<p class="text-sm text-blue-600 mt-2">Supervisor can also download this payslip</p>' : ''}
              </div>
            `,
            icon: 'success',
            timer: 5000,
            showConfirmButton: false
          });

          console.log(`‚úÖ Payslip activated for ${staff.fullName} - ${period}`);

        } catch (error) {
          console.error('Error activating payslip:', error);
          Swal.fire({
            title: 'Error',
            text: 'Failed to activate payslip. Please try again.',
            icon: 'error'
          });
        }
      }
      
      // CTIO Payslip Download Functions
      function openCTIOPayslipDownload() {
        const staffPayslips = JSON.parse(localStorage.getItem('staffPayslips') || '[]');
        
        if (staffPayslips.length === 0) {
          Swal.fire({
            title: 'No Payslips Available',
            text: 'No payslips have been activated yet.',
            icon: 'info'
          });
          return;
        }
        
        // Get unique periods
        const periods = [...new Set(staffPayslips.map(p => p.payPeriod))].sort();
        
        Swal.fire({
          title: 'Download Payslips',
          html: `
            <div class="text-left">
              <label class="block text-sm font-medium text-gray-700 mb-2">Select Pay Period</label>
              <select id="ctioPayslipPeriod" class="w-full border border-gray-300 rounded-md px-3 py-2 mb-4">
                ${periods.map(period => `<option value="${period}">${period}</option>`).join('')}
              </select>
              <p class="text-sm text-gray-600">Download all payslips for the selected period</p>
            </div>
          `,
          showCancelButton: true,
          confirmButtonText: 'Download All',
          cancelButtonText: 'Cancel',
          preConfirm: () => {
            const selectedPeriod = document.getElementById('ctioPayslipPeriod').value;
            downloadCTIOPayslips(selectedPeriod);
          }
        });
      }
      
      function downloadCTIOPayslips(period) {
        const staffPayslips = JSON.parse(localStorage.getItem('staffPayslips') || '[]');
        const periodPayslips = staffPayslips.filter(p => p.payPeriod === period);
        
        if (periodPayslips.length === 0) {
          Swal.fire({
            title: 'No Payslips Found',
            text: `No payslips found for ${period}`,
            icon: 'warning'
          });
          return;
        }
        
        // Download each payslip
        periodPayslips.forEach((payslip, index) => {
          setTimeout(() => {
            downloadSingleCTIOPayslip(payslip);
          }, index * 500); // Stagger downloads by 500ms
        });
        
        Swal.fire({
          title: 'Downloads Started',
          text: `Downloading ${periodPayslips.length} payslips for ${period}`,
          icon: 'success',
          timer: 3000,
          showConfirmButton: false
        });
      }
      
      function downloadSingleCTIOPayslip(payslip) {
        const payslipHTML = `
          <!DOCTYPE html>
          <html>
          <head>
            <title>Payslip - ${payslip.payPeriod}</title>
            <style>
              body { font-family: Arial, sans-serif; margin: 20px; }
              .header { text-align: center; margin-bottom: 30px; }
              .company { font-size: 24px; font-weight: bold; color: #1f2937; }
              .payslip-title { font-size: 18px; margin: 10px 0; color: #059669; }
              .details { margin: 20px 0; }
              .row { display: flex; justify-content: space-between; margin: 8px 0; padding: 5px 0; }
              .total { border-top: 2px solid #059669; font-weight: bold; margin-top: 10px; }
              .footer { margin-top: 30px; text-align: center; font-size: 12px; color: #6b7280; }
            </style>
          </head>
          <body>
            <div class="header">
              <div class="company">DR.NET TECHNOLOGY LABS</div>
              <div class="payslip-title">PAYSLIP - ${payslip.payPeriod}</div>
            </div>
            
            <div class="details">
              <div class="row">
                <span>Employee:</span>
                <span>${payslip.staffName}</span>
              </div>
              <div class="row">
                <span>Position:</span>
                <span>${payslip.staffRole}</span>
              </div>
              <div class="row">
                <span>Period:</span>
                <span>${payslip.payPeriod}</span>
              </div>
              <div class="row">
                <span>Basic Salary:</span>
                <span>KSH ${payslip.basicSalary.toLocaleString()}</span>
              </div>
              <div class="row total">
                <span>Net Salary:</span>
                <span>KSH ${payslip.netSalary.toLocaleString()}</span>
              </div>
            </div>
            
            <div class="footer">
              <p>This is a computer generated payslip and does not require a signature.</p>
              <p>Generated on: ${new Date().toLocaleDateString()}</p>
              <p>Activated by: CTIO</p>
            </div>
          </body>
          </html>
        `;
        
        const blob = new Blob([payslipHTML], { type: 'text/html' });
        const url = URL.createObjectURL(blob);
        const a = document.createElement('a');
        a.href = url;
        a.download = `DR-NET-Payslip-${payslip.staffName.replace(/\s+/g, '-')}-${payslip.payPeriod}.html`;
        document.body.appendChild(a);
        a.click();
        document.body.removeChild(a);
        URL.revokeObjectURL(url);
      }
      
      // View All Payslips Function
      function openViewAllPayslips() {
        const staffPayslips = JSON.parse(localStorage.getItem('staffPayslips') || '[]');
        
        if (staffPayslips.length === 0) {
          Swal.fire({
            title: 'No Payslips Available',
            text: 'No payslips have been activated yet.',
            icon: 'info'
          });
          return;
        }
        
        // Group payslips by period
        const payslipsByPeriod = {};
        staffPayslips.forEach(payslip => {
          if (!payslipsByPeriod[payslip.payPeriod]) {
            payslipsByPeriod[payslip.payPeriod] = [];
          }
          payslipsByPeriod[payslip.payPeriod].push(payslip);
        });
        
        // Create HTML for the modal
        let payslipsHTML = `
          <div class="text-left max-h-96 overflow-y-auto">
            <div class="space-y-4">
        `;
        
        // Sort periods (most recent first)
        const sortedPeriods = Object.keys(payslipsByPeriod).sort((a, b) => {
          const dateA = new Date(a + ' 01');
          const dateB = new Date(b + ' 01');
          return dateB - dateA;
        });
        
        sortedPeriods.forEach(period => {
          const periodPayslips = payslipsByPeriod[period];
          payslipsHTML += `
            <div class="border border-gray-200 rounded-lg p-4">
              <div class="flex items-center justify-between mb-3">
                <h4 class="text-lg font-semibold text-gray-800">${period}</h4>
                <span class="bg-blue-100 text-blue-800 text-sm px-2 py-1 rounded-full">
                  ${periodPayslips.length} payslip${periodPayslips.length > 1 ? 's' : ''}
                </span>
              </div>
              <div class="space-y-2">
          `;
          
          periodPayslips.forEach(payslip => {
            payslipsHTML += `
              <div class="flex items-center justify-between p-3 bg-gray-50 rounded-lg">
                <div class="flex items-center space-x-3">
                  <div class="w-8 h-8 bg-green-100 rounded-full flex items-center justify-center">
                    <i class="fas fa-user text-green-600 text-sm"></i>
                  </div>
                  <div>
                    <p class="font-medium text-gray-800">${payslip.staffName}</p>
                    <p class="text-sm text-gray-600">${payslip.staffRole}</p>
                  </div>
                </div>
                <div class="flex items-center space-x-2">
                  <span class="text-sm text-gray-600">KSH ${payslip.netSalary.toLocaleString()}</span>
                  <button onclick="downloadSinglePayslipFromModal('${payslip.payPeriod}', '${payslip.staffId}')" 
                          class="px-3 py-1 bg-blue-600 text-white text-sm rounded hover:bg-blue-700 transition-colors">
                    <i class="fas fa-download mr-1"></i>Download
                  </button>
                </div>
              </div>
            `;
          });
          
          payslipsHTML += `
              </div>
            </div>
          `;
        });
        
        payslipsHTML += `
            </div>
          </div>
        `;
        
        Swal.fire({
          title: 'All Activated Payslips',
          html: payslipsHTML,
          width: '800px',
          showCancelButton: true,
          cancelButtonText: 'Close',
          confirmButtonText: 'Download All Periods',
          confirmButtonColor: '#3b82f6',
          preConfirm: () => {
            // Download all payslips for all periods
            sortedPeriods.forEach(period => {
              setTimeout(() => {
                downloadCTIOPayslips(period);
              }, 1000);
            });
          }
        });
      }
      
      // Helper function to download single payslip from modal
      function downloadSinglePayslipFromModal(period, staffId) {
        const staffPayslips = JSON.parse(localStorage.getItem('staffPayslips') || '[]');
        const payslip = staffPayslips.find(p => p.payPeriod === period && p.staffId === staffId);
        
        if (payslip) {
          downloadSingleCTIOPayslip(payslip);
        } else {
          Swal.fire({
            title: 'Error',
            text: 'Payslip not found',
            icon: 'error'
          });
        }
      }

      function loadEquipmentData() {
        try {
          // Mock equipment data
          const totalEquipment = 25;
          const equipmentInUse = 18;
          const maintenanceDue = 3;
          const outOfService = 4;
          
          // Update UI elements
          document.getElementById('totalEquipment').textContent = totalEquipment;
          document.getElementById('equipmentInUse').textContent = equipmentInUse;
          document.getElementById('maintenanceDue').textContent = maintenanceDue;
          document.getElementById('outOfService').textContent = outOfService;
          
          console.log('‚úÖ Equipment data loaded successfully');
        } catch (error) {
          console.error('Error loading equipment data:', error);
        }
      }

      function loadReportsData() {
        try {
          // Mock reports data
          const systemLogsCount = 1247;
          const errorLogsCount = 23;
          const generatedReports = 15;
          
          // Update UI elements
          document.getElementById('systemLogsCount').textContent = systemLogsCount;
          document.getElementById('errorLogsCount').textContent = errorLogsCount;
          document.getElementById('generatedReports').textContent = generatedReports;
          
          // Load supervisor reports
          loadSupervisorReports();
          
          console.log('‚úÖ Reports data loaded successfully');
        } catch (error) {
          console.error('Error loading reports data:', error);
        }
      }

      // Load Sales Management Data
      function loadSalesManagement() {
        try {
          // Get sales from supervisor (via sendToCTIO) and any CTIO-created sales
          const ctioData = JSON.parse(localStorage.getItem('ctioData') || '{}');
          const supervisorSales = JSON.parse(localStorage.getItem('supervisorSales') || '[]');
          const ctioSales = ctioData.sale || [];
          
          // Combine all sales
          let allSales = [...supervisorSales, ...ctioSales];
          
          // Remove duplicates based on ID
          const uniqueSales = [];
          const seenIds = new Set();
          allSales.forEach(sale => {
            if (!seenIds.has(sale.id)) {
              seenIds.add(sale.id);
              uniqueSales.push(sale);
            }
          });
          
          // Sort by date (newest first)
          uniqueSales.sort((a, b) => {
            const dateA = new Date(a.date || a.createdAt || 0);
            const dateB = new Date(b.date || b.createdAt || 0);
            return dateB - dateA;
          });
          
          // Update summary cards
          const totalAmount = uniqueSales.reduce((sum, s) => sum + parseFloat(s.amount || 0), 0);
          const paidAmount = uniqueSales.filter(s => (s.paymentStatus || 'Pending') === 'Paid')
            .reduce((sum, s) => sum + parseFloat(s.amount || 0), 0);
          const pendingAmount = uniqueSales.filter(s => (s.paymentStatus || 'Pending') === 'Pending')
            .reduce((sum, s) => sum + parseFloat(s.amount || 0), 0);
          
          document.getElementById('totalSalesAmount').textContent = `Ksh ${totalAmount.toLocaleString(undefined, {minimumFractionDigits: 2, maximumFractionDigits: 2})}`;
          document.getElementById('totalSalesCount').textContent = uniqueSales.length;
          document.getElementById('paidSalesAmount').textContent = `Ksh ${paidAmount.toLocaleString(undefined, {minimumFractionDigits: 2, maximumFractionDigits: 2})}`;
          document.getElementById('pendingSalesAmount').textContent = `Ksh ${pendingAmount.toLocaleString(undefined, {minimumFractionDigits: 2, maximumFractionDigits: 2})}`;
          
          // Display sales in table
          displaySalesTable(uniqueSales);
          
          console.log('‚úÖ Sales Management data loaded successfully');
        } catch (error) {
          console.error('Error loading sales management data:', error);
        }
      }

      // Display Sales Table
      function displaySalesTable(sales) {
        const tbody = document.getElementById('ctioSalesTableBody');
        const emptyState = document.getElementById('ctioSalesEmptyState');
        
        if (!tbody) return;
        
        if (sales.length === 0) {
          tbody.innerHTML = '';
          if (emptyState) emptyState.classList.remove('hidden');
          return;
        }
        
        if (emptyState) emptyState.classList.add('hidden');
        
        tbody.innerHTML = sales.map(sale => {
          const statusColors = {
            Paid: 'bg-green-100 text-green-800',
            Pending: 'bg-yellow-100 text-yellow-800',
            Partial: 'bg-blue-100 text-blue-800',
            Overdue: 'bg-red-100 text-red-800'
          };
          const status = sale.paymentStatus || 'Pending';
          const date = new Date(sale.date || sale.createdAt).toLocaleDateString();
          const createdBy = sale.createdBy || 'Unknown';
          
          return `
            <tr class="hover:bg-white/5 transition-colors">
              <td class="py-4 px-4 text-sm text-white/90">${date}</td>
              <td class="py-4 px-4 text-sm text-white font-medium">${sale.clientName || 'N/A'}</td>
              <td class="py-4 px-4 text-sm text-white/90">${sale.serviceType || 'N/A'}</td>
              <td class="py-4 px-4 text-sm text-white/80">${sale.description || 'N/A'}</td>
              <td class="py-4 px-4 text-sm text-right font-semibold text-white">Ksh ${parseFloat(sale.amount || 0).toLocaleString(undefined, {minimumFractionDigits: 2, maximumFractionDigits: 2})}</td>
              <td class="py-4 px-4 text-sm">
                <span class="px-2 py-1 rounded-full text-xs font-medium ${statusColors[status] || statusColors.Pending}">${status}</span>
              </td>
              <td class="py-4 px-4 text-sm text-white/80">${createdBy}</td>
              <td class="py-4 px-4 text-center">
                <button onclick="downloadSaleInvoice('${sale.id}')" class="px-4 py-2 bg-gradient-to-r from-green-600 to-emerald-600 text-white rounded-lg hover:from-green-700 hover:to-emerald-700 transition-all shadow-md" title="Download Invoice">
                  <i class="fas fa-file-invoice-dollar mr-2"></i> Invoice
                </button>
              </td>
            </tr>
          `;
        }).join('');
      }

      // Filter Sales Management
      function filterSalesManagement() {
        const ctioData = JSON.parse(localStorage.getItem('ctioData') || '{}');
        const supervisorSales = JSON.parse(localStorage.getItem('supervisorSales') || '[]');
        const ctioSales = ctioData.sale || [];
        
        let allSales = [...supervisorSales, ...ctioSales];
        const seenIds = new Set();
        allSales = allSales.filter(sale => {
          if (seenIds.has(sale.id)) return false;
          seenIds.add(sale.id);
          return true;
        });
        
        const search = document.getElementById('salesSearchInput')?.value.toLowerCase() || '';
        const serviceFilter = document.getElementById('salesServiceTypeFilter')?.value || '';
        const statusFilter = document.getElementById('salesPaymentStatusFilter')?.value || '';
        const monthFilter = document.getElementById('salesMonthFilter')?.value || '';
        
        const filtered = allSales.filter(sale => {
          const matchSearch = !search || 
            (sale.clientName || '').toLowerCase().includes(search) ||
            (sale.serviceType || '').toLowerCase().includes(search) ||
            (sale.description || '').toLowerCase().includes(search);
          
          const matchService = !serviceFilter || (sale.serviceType || '') === serviceFilter;
          const matchStatus = !statusFilter || (sale.paymentStatus || 'Pending') === statusFilter;
          
          let matchMonth = true;
          if (monthFilter) {
            const saleDate = new Date(sale.date || sale.createdAt);
            const filterDate = new Date(monthFilter + '-01');
            matchMonth = saleDate.getMonth() === filterDate.getMonth() && 
                        saleDate.getFullYear() === filterDate.getFullYear();
          }
          
          return matchSearch && matchService && matchStatus && matchMonth;
        });
        
        displaySalesTable(filtered);
      }

      // Download Sale Invoice
      function downloadSaleInvoice(saleId) {
        try {
          // Get the sale data
          const ctioData = JSON.parse(localStorage.getItem('ctioData') || '{}');
          const supervisorSales = JSON.parse(localStorage.getItem('supervisorSales') || '[]');
          const ctioSales = ctioData.sale || [];
          
          const allSales = [...supervisorSales, ...ctioSales];
          const sale = allSales.find(s => s.id === saleId);
          
          if (!sale) {
            Swal.fire('Error', 'Sale not found', 'error');
            return;
          }
          
          // Generate invoice number
          const invoiceNumber = `INV-${sale.id.replace(/[^0-9]/g, '').substr(-6) || Date.now().toString().substr(-6)}`;
          
          // Get client info (try to find in users/clients if available)
          const clients = JSON.parse(localStorage.getItem('clients') || '[]');
          const users = JSON.parse(localStorage.getItem('users') || '[]');
          const client = clients.find(c => c.name === sale.clientName) || 
                        users.find(u => u.name === sale.clientName) || 
                        { fullName: sale.clientName, phoneNumber: 'N/A', address: 'N/A' };
          
          // Create invoice object
          const invoice = {
            invoiceNumber: invoiceNumber,
            userId: client.id || sale.id,
            userName: sale.clientName,
            userPhone: client.phoneNumber || client.phone || 'N/A',
            userLocation: client.address || client.location || 'N/A',
            amount: parseFloat(sale.amount || 0),
            issueDate: sale.date || sale.createdAt || new Date().toISOString().split('T')[0],
            dueDate: sale.date ? dayjs(sale.date).add(7, 'days').format('YYYY-MM-DD') : dayjs().add(7, 'days').format('YYYY-MM-DD'),
            status: sale.paymentStatus || 'pending',
            serviceType: sale.serviceType,
            description: sale.description || 'Service provided'
          };
          
          // Generate PDF invoice
          if (typeof window.jspdf !== 'undefined') {
            generateSaleInvoicePDF(invoice, sale);
          } else {
            Swal.fire('Error', 'PDF library not loaded. Please refresh the page.', 'error');
          }
          
        } catch (error) {
          console.error('Error generating invoice:', error);
          Swal.fire('Error', 'Failed to generate invoice. Please try again.', 'error');
        }
      }

      // Generate Sale Invoice PDF
      function generateSaleInvoicePDF(invoice, sale) {
        try {
          const { jsPDF } = window.jspdf;
          const pdf = new jsPDF();
          
          // Company branding
          pdf.setFontSize(24);
          pdf.setFont('helvetica', 'bold');
          pdf.setTextColor(220, 38, 127);
          pdf.text('DR.NET TECHNOLOGY LABS', 20, 25);
          
          pdf.setFontSize(10);
          pdf.setFont('helvetica', 'normal');
          pdf.setTextColor(100, 100, 100);
          pdf.text('Internet Service Provider', 20, 33);
          pdf.text('Email: dr.netinnovations@gmail.com | Website: https://drnet.co.ke/', 20, 40);
          pdf.text('P.O. Box 105876 - 00100 NAIROBI', 20, 47);
          pdf.text('Phone: +254111357066', 20, 54);
          
          // Invoice header
          pdf.setFontSize(20);
          pdf.setFont('helvetica', 'bold');
          pdf.setTextColor(0, 0, 0);
          pdf.text('INVOICE', 150, 25);
          
          // Invoice details box
          pdf.setDrawColor(220, 38, 127);
          pdf.setLineWidth(0.5);
          pdf.rect(120, 35, 70, 25);
          
          pdf.setFontSize(10);
          pdf.setFont('helvetica', 'normal');
          pdf.text(`Invoice #: ${invoice.invoiceNumber}`, 125, 42);
          pdf.text(`Issue Date: ${dayjs(invoice.issueDate).format('MMM D, YYYY')}`, 125, 48);
          pdf.text(`Due Date: ${dayjs(invoice.dueDate).format('MMM D, YYYY')}`, 125, 54);
          
          // Client information
          pdf.setFontSize(14);
          pdf.setFont('helvetica', 'bold');
          pdf.text('BILL TO:', 20, 80);
          
          pdf.setFontSize(12);
          pdf.setFont('helvetica', 'normal');
          pdf.text(invoice.userName, 20, 90);
          pdf.text(`Phone: ${invoice.userPhone}`, 20, 98);
          pdf.text(`Location: ${invoice.userLocation}`, 20, 106);
          
          // Service details table
          const startY = 130;
          
          // Table header
          pdf.setFillColor(240, 240, 240);
          pdf.rect(20, startY, 170, 10, 'F');
          
          pdf.setFontSize(10);
          pdf.setFont('helvetica', 'bold');
          pdf.text('DESCRIPTION', 25, startY + 7);
          pdf.text('SERVICE TYPE', 100, startY + 7);
          pdf.text('AMOUNT (KSH)', 140, startY + 7);
          
          // Table content
          pdf.setFont('helvetica', 'normal');
          const contentY = startY + 20;
          const description = invoice.description.length > 40 ? invoice.description.substring(0, 40) + '...' : invoice.description;
          pdf.text(description, 25, contentY);
          pdf.text(invoice.serviceType || 'Service', 100, contentY);
          pdf.text(invoice.amount.toLocaleString(), 145, contentY);
          
          // Subtotal and total
          const totalY = contentY + 30;
          pdf.setDrawColor(0, 0, 0);
          pdf.line(120, totalY - 5, 190, totalY - 5);
          
          pdf.setFont('helvetica', 'bold');
          pdf.text('SUBTOTAL:', 120, totalY);
          pdf.text(`KSH ${invoice.amount.toLocaleString()}`, 160, totalY);
          
          pdf.text('TOTAL DUE:', 120, totalY + 10);
          pdf.setFontSize(12);
          pdf.setTextColor(220, 38, 127);
          pdf.text(`KSH ${invoice.amount.toLocaleString()}`, 160, totalY + 10);
          
          // Payment instructions
          pdf.setFontSize(10);
          pdf.setFont('helvetica', 'normal');
          pdf.setTextColor(0, 0, 0);
          pdf.text('PAYMENT INSTRUCTIONS:', 20, totalY + 30);
          pdf.text('‚Ä¢ M-PESA: Lipa na M-Pesa Buy Goods', 20, totalY + 38);
          pdf.text('‚Ä¢ Till Number: 5626320', 20, totalY + 45);
          pdf.text('‚Ä¢ Name: DR.NET TECHNOLOGY LABS', 20, totalY + 52);
          pdf.text(`‚Ä¢ Reference: ${invoice.invoiceNumber}`, 20, totalY + 59);
          pdf.text('‚Ä¢ Payment due within 7 days of invoice date', 20, totalY + 66);
          pdf.text('‚Ä¢ For assistance call: 0701782354', 20, totalY + 73);
          
          // Footer
          pdf.setFontSize(8);
          pdf.setTextColor(100, 100, 100);
          pdf.text('Thank you for choosing DR.NET TECHNOLOGY LABS!', 20, 270);
          pdf.text('For support: dr.netinnovations@gmail.com or 0701782354', 20, 277);
          
          // Save PDF
          pdf.save(`DR-NET-Invoice-${invoice.invoiceNumber}.pdf`);
          
          Swal.fire({
            title: 'Success!',
            text: 'Invoice PDF generated and downloaded successfully!',
            icon: 'success',
            timer: 2000,
            showConfirmButton: false
          });
          
          console.log('‚úÖ Invoice generated for sale:', sale.id);
        } catch (error) {
          console.error('Error generating invoice PDF:', error);
          Swal.fire('Error', 'Failed to generate invoice PDF. Please try again.', 'error');
        }
      }
      
      function loadSupervisorReports() {
        try {
          const reports = JSON.parse(localStorage.getItem('ctioReports') || '[]');
          const reportsList = document.getElementById('supervisorReportsList');
          
          if (reports.length === 0) {
            reportsList.innerHTML = `
              <div class="text-center py-8 text-white/60">
                <i class="fas fa-clipboard-list text-4xl mb-4"></i>
                <p>No reports received from supervisors yet</p>
              </div>
            `;
            return;
          }
          
          // Sort reports by creation date (newest first)
          reports.sort((a, b) => new Date(b.createdAt) - new Date(a.createdAt));
          
          reportsList.innerHTML = reports.map(report => `
            <div class="bg-white/10 backdrop-blur-sm rounded-lg p-4 border border-white/20 hover:bg-white/15 transition-all duration-300">
              <div class="flex justify-between items-start mb-3">
                <div>
                  <h5 class="font-semibold text-white text-lg">${report.type}</h5>
                  <p class="text-white/70 text-sm">${report.date} ‚Ä¢ From Supervisor</p>
                </div>
                <div class="flex items-center space-x-2">
                  <span class="px-3 py-1 rounded-full text-xs font-medium ${getReportStatusColor(report.status)}">
                    ${getReportStatusText(report.status)}
                  </span>
                  ${report.status === 'pending' ? `
                    <button onclick="approveReport('${report.id}')" class="px-3 py-1 bg-green-600 hover:bg-green-700 text-white rounded-lg text-xs transition-colors">
                      <i class="fas fa-check mr-1"></i> Approve
                    </button>
                    <button onclick="rejectReport('${report.id}')" class="px-3 py-1 bg-red-600 hover:bg-red-700 text-white rounded-lg text-xs transition-colors">
                      <i class="fas fa-times mr-1"></i> Reject
                    </button>
                  ` : ''}
                </div>
              </div>
              
              <div class="mb-3">
                <p class="text-white/90 text-sm">${report.summary.substring(0, 150)}${report.summary.length > 150 ? '...' : ''}</p>
              </div>
              
              <div class="flex justify-between items-center text-xs text-white/60">
                <span>Created: ${new Date(report.createdAt).toLocaleString()}</span>
                <button onclick="viewFullReport('${report.id}')" class="text-blue-400 hover:text-blue-300 transition-colors">
                  <i class="fas fa-eye mr-1"></i> View Full Report
                </button>
              </div>
            </div>
          `).join('');
          
        } catch (error) {
          console.error('Error loading supervisor reports:', error);
        }
      }
      
      function getReportStatusColor(status) {
        switch(status) {
          case 'pending': return 'bg-yellow-500/20 text-yellow-300 border border-yellow-500/30';
          case 'approved': return 'bg-green-500/20 text-green-300 border border-green-500/30';
          case 'rejected': return 'bg-red-500/20 text-red-300 border border-red-500/30';
          default: return 'bg-gray-500/20 text-gray-300 border border-gray-500/30';
        }
      }
      
      function getReportStatusText(status) {
        switch(status) {
          case 'pending': return 'Pending Review';
          case 'approved': return 'Approved';
          case 'rejected': return 'Rejected';
          default: return 'Unknown';
        }
      }
      
      function viewFullReport(reportId) {
        const reports = JSON.parse(localStorage.getItem('ctioReports') || '[]');
        const report = reports.find(r => r.id === reportId);
        
        if (!report) return;
        
        Swal.fire({
          title: `${report.type} - ${report.date}`,
          html: `
            <div class="text-left space-y-4 max-h-96 overflow-y-auto">
              <div>
                <h4 class="font-semibold text-gray-800 mb-2">Summary</h4>
                <p class="text-gray-700">${report.summary}</p>
              </div>
              <div>
                <h4 class="font-semibold text-gray-800 mb-2">Completed Tasks</h4>
                <p class="text-gray-700">${report.completedTasks || 'None specified'}</p>
              </div>
              <div>
                <h4 class="font-semibold text-gray-800 mb-2">Issues/Challenges</h4>
                <p class="text-gray-700">${report.issues || 'None reported'}</p>
              </div>
              <div>
                <h4 class="font-semibold text-gray-800 mb-2">Tomorrow's Plan</h4>
                <p class="text-gray-700">${report.tomorrowPlan || 'None specified'}</p>
              </div>
              <div class="flex items-center space-x-2">
                <span class="px-3 py-1 rounded-full text-xs font-medium ${getReportStatusColor(report.status)}">
                  ${getReportStatusText(report.status)}
                </span>
                ${report.comments ? `<p class="text-sm text-gray-600">Comments: ${report.comments}</p>` : ''}
              </div>
            </div>
          `,
          showCancelButton: false,
          confirmButtonText: 'Close',
          background: 'linear-gradient(135deg, #667eea 0%, #764ba2 100%)',
          color: 'white',
          width: '600px'
        });
      }
      
      function approveReport(reportId) {
        Swal.fire({
          title: 'Approve Report',
          text: 'Are you sure you want to approve this report?',
          icon: 'question',
          showCancelButton: true,
          confirmButtonColor: '#10B981',
          cancelButtonColor: '#6B7280',
          confirmButtonText: 'Yes, Approve',
          cancelButtonText: 'Cancel'
        }).then((result) => {
          if (result.isConfirmed) {
            updateReportStatus(reportId, 'approved');
            showNotification('Report approved successfully', 'success');
          }
        });
      }
      
      function rejectReport(reportId) {
        Swal.fire({
          title: 'Reject Report',
          html: `
            <div class="text-left">
              <label class="block text-sm font-medium text-gray-700 mb-2">Reason for rejection (optional)</label>
              <textarea id="rejectionReason" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-red-500 focus:border-red-500" rows="3" placeholder="Provide feedback for the supervisor..."></textarea>
            </div>
          `,
          showCancelButton: true,
          confirmButtonColor: '#EF4444',
          cancelButtonColor: '#6B7280',
          confirmButtonText: 'Reject Report',
          cancelButtonText: 'Cancel',
          preConfirm: () => {
            const reason = document.getElementById('rejectionReason').value;
            return { reason: reason || 'No reason provided' };
          }
        }).then((result) => {
          if (result.isConfirmed) {
            updateReportStatus(reportId, 'rejected', result.value.reason);
            showNotification('Report rejected', 'error');
          }
        });
      }
      
      function updateReportStatus(reportId, status, comments = null) {
        // Update CTIO reports
        let ctioReports = JSON.parse(localStorage.getItem('ctioReports') || '[]');
        const reportIndex = ctioReports.findIndex(r => r.id === reportId);
        
        if (reportIndex !== -1) {
          ctioReports[reportIndex].status = status;
          ctioReports[reportIndex].approvedBy = 'CTIO';
          ctioReports[reportIndex].approvedAt = new Date().toISOString();
          if (comments) {
            ctioReports[reportIndex].comments = comments;
          }
          
          localStorage.setItem('ctioReports', JSON.stringify(ctioReports));
        }
        
        // Update supervisor reports
        let supervisorReports = JSON.parse(localStorage.getItem('supervisorReports') || '[]');
        const supervisorReportIndex = supervisorReports.findIndex(r => r.id === reportId);
        
        if (supervisorReportIndex !== -1) {
          supervisorReports[supervisorReportIndex].status = status;
          supervisorReports[supervisorReportIndex].approvedBy = 'CTIO';
          supervisorReports[supervisorReportIndex].approvedAt = new Date().toISOString();
          if (comments) {
            supervisorReports[supervisorReportIndex].comments = comments;
          }
          
          localStorage.setItem('supervisorReports', JSON.stringify(supervisorReports));
        }
        
        // Refresh the reports list
        loadSupervisorReports();
      }
      
      function showNotification(message, type) {
        const notification = document.createElement('div');
        notification.className = `fixed top-4 right-4 z-50 p-4 rounded-lg shadow-lg text-white max-w-sm transform transition-all duration-300 translate-x-full`;
        notification.style.backgroundColor = type === 'success' ? '#10B981' : type === 'error' ? '#EF4444' : '#3B82F6';
        
        notification.innerHTML = `
          <div class="flex items-center space-x-3">
            <i class="fas fa-${type === 'success' ? 'check-circle' : type === 'error' ? 'times-circle' : 'info-circle'} text-xl"></i>
            <div>
              <p class="font-semibold">${message}</p>
            </div>
            <button onclick="this.parentElement.parentElement.remove()" class="text-white hover:text-gray-200">
              <i class="fas fa-times"></i>
            </button>
          </div>
        `;
        
        document.body.appendChild(notification);
        
        // Animate in
        setTimeout(() => {
          notification.classList.remove('translate-x-full');
        }, 100);
        
        // Auto remove after 5 seconds
        setTimeout(() => {
          notification.classList.add('translate-x-full');
          setTimeout(() => notification.remove(), 300);
        }, 5000);
      }

      // Load deleted clients
      async function loadDeletedClients() {
        try {
          const response = await fetch("/api/admin/clients/deleted", {
            credentials: "include",
          });
          const deletedClients = await response.json();

          const tableBody = document.getElementById("deletedClientsTableBody");
          tableBody.innerHTML = "";

          if (deletedClients.length === 0) {
            tableBody.innerHTML =
              '<tr><td colspan="5" class="text-center py-8 text-gray-500">No deleted users found</td></tr>';
            return;
          }

          deletedClients.forEach((client) => {
            const deletedDate = new Date(
              client.deleted_at
            ).toLocaleDateString();
            const row = `
              <tr class="hover:bg-red-50 transition-colors">
                <td class="border-b px-6 py-4">${client.name}</td>
                <td class="border-b px-6 py-4">${client.email || "N/A"}</td>
                <td class="border-b px-6 py-4">${client.phone}</td>
                <td class="border-b px-6 py-4">${deletedDate}</td>
                <td class="border-b px-6 py-4">
                  <button 
                    onclick="recoverClient(${client.id}, '${client.name}')"
                    class="bg-green-500 hover:bg-green-600 text-white px-3 py-1 rounded text-sm mr-2 transition-colors"
                  >
                    <i class="fas fa-undo mr-2"></i>Recover
                  </button>
                  <button 
                    onclick="permanentDeleteClient(${client.id}, '${
              client.name
            }')"
                    class="bg-red-600 hover:bg-red-700 text-white px-3 py-1 rounded text-sm transition-colors"
                  >
                    <i class="fas fa-trash mr-2"></i>Delete Permanently
                  </button>
                </td>
              </tr>
            `;
            tableBody.innerHTML += row;
          });
        } catch (error) {
          console.error("Error loading deleted clients:", error);
          alert("Failed to load deleted clients");
        }
      }

      // Recover client
      async function recoverClient(clientId, clientName) {
        if (!confirm(`Are you sure you want to recover ${clientName}?`)) {
          return;
        }

        try {
          const response = await fetch(
            `/api/admin/clients/${clientId}/recover`,
            {
              method: "POST",
              credentials: "include",
            }
          );

          const result = await response.json();

          if (result.success) {
            alert(`${clientName} has been recovered successfully`);
            loadDeletedClients(); // Refresh the deleted clients table
          } else {
            alert("Failed to recover client: " + result.error);
          }
        } catch (error) {
          console.error("Error recovering client:", error);
          alert("Failed to recover client");
        }
      }

      // Permanently delete client
      async function permanentDeleteClient(clientId, clientName) {
        if (
          !confirm(
            `WARNING: This will PERMANENTLY delete ${clientName}. This action cannot be undone! Are you absolutely sure?`
          )
        ) {
          return;
        }

        try {
          const response = await fetch(
            `/api/admin/clients/${clientId}/permanent`,
            {
              method: "DELETE",
              credentials: "include",
            }
          );

          const result = await response.json();

          if (result.success) {
            alert(`${clientName} has been permanently deleted`);
            loadDeletedClients(); // Refresh the deleted clients table
          } else {
            alert("Failed to permanently delete client: " + result.error);
          }
        } catch (error) {
          console.error("Error permanently deleting client:", error);
          alert("Failed to permanently delete client");
        }
      }

      // Refresh functions
      function refreshDeletedClients() {
        loadDeletedClients();
      }

      // Initialize sample client data if none exists
      function initializeSampleClients() {
        const existingClients = JSON.parse(localStorage.getItem('clients') || '[]');
        
        if (existingClients.length === 0) {
          const sampleClients = [
            {
              id: 'CLI001',
              name: 'John Doe',
              phone: '+1-555-0101',
              email: 'john.doe@email.com',
              address: '123 Main St, Anytown',
              serviceType: 'Internet',
              status: 'Active'
            },
            {
              id: 'CLI002',
              name: 'Jane Smith',
              phone: '+1-555-0102',
              email: 'jane.smith@email.com',
              address: '456 Oak Ave, Anytown',
              serviceType: 'Internet + Cable',
              status: 'Active'
            },
            {
              id: 'CLI003',
              name: 'Bob Johnson',
              phone: '+1-555-0103',
              email: 'bob.johnson@email.com',
              address: '789 Pine Rd, Anytown',
              serviceType: 'Business Internet',
              status: 'Active'
            },
            {
              id: 'CLI004',
              name: 'Alice Brown',
              phone: '+1-555-0104',
              email: 'alice.brown@email.com',
              address: '321 Elm St, Anytown',
              serviceType: 'Internet',
              status: 'Active'
            },
            {
              id: 'CLI005',
              name: 'Mike Wilson',
              phone: '+1-555-0105',
              email: 'mike.wilson@email.com',
              address: '654 Maple Dr, Anytown',
              serviceType: 'Enterprise',
              status: 'Active'
            }
          ];
          
          localStorage.setItem('clients', JSON.stringify(sampleClients));
          console.log('Sample client data initialized');
        }
      }

      // Update sidebar click handlers
      document.addEventListener("DOMContentLoaded", function () {
        // Initialize sample client data
        initializeSampleClients();
        
        // Ensure only dashboard is shown on page load
        showDashboard();

        // Initialize service assignments dashboard
        loadAssignmentNotifications();
        updateAssignmentStats();
        loadCtioServiceAssignments();
        
        // Set up periodic refresh for service assignments
        setInterval(loadCtioServiceAssignments, 30000); // Refresh every 30 seconds

        // Initialize attendance system
        initializeCtioAttendanceSystem();
        
        // Set up periodic refresh for attendance
        setInterval(loadCtioAttendance, 30000); // Refresh every 30 seconds
        
        // Listen for attendance data changes
        window.addEventListener('storage', function(e) {
          if (e.key === 'attendanceHistory') {
            // Refresh attendance when data changes
            loadCtioAttendance();
          }
        });
        
        // Listen for custom attendance update events
        window.addEventListener('attendanceUpdated', function(e) {
          console.log('üìä Attendance updated, refreshing CTIO dashboard...');
          loadCtioAttendance();
        });

        // Initialize service requests dashboard
        loadServiceRequestNotifications();
        updateServiceRequestStats();

        // Initialize all notifications
        loadAllNotifications();
        updateNotificationBadge();

        // Refresh every 30 seconds
        setInterval(loadAssignmentNotifications, 30000);
        setInterval(updateAssignmentStats, 30000);
        setInterval(loadSupportTicketNotifications, 30000);
        setInterval(updateSupportTicketStats, 30000);
        setInterval(loadAllNotifications, 30000);
        setInterval(updateNotificationBadge, 30000);
      });

      // Service Assignment Dashboard Functions
      function loadAssignmentNotifications() {
        const adminNotifications = JSON.parse(
          localStorage.getItem("adminNotifications") || "[]"
        );
        const assignmentNotifications = adminNotifications
          .filter((n) => n.type === "assignment")
          .sort((a, b) => new Date(b.createdDate) - new Date(a.createdDate))
          .slice(0, 5);

        const container = document.getElementById(
          "assignmentNotificationsList"
        );
        if (!container) return;

        if (assignmentNotifications.length === 0) {
          container.innerHTML = `
            <div class="text-center py-6 text-gray-500">
              <div class="text-4xl mb-2">üìã</div>
              <p>No recent assignment notifications</p>
            </div>
          `;
          return;
        }

        container.innerHTML = assignmentNotifications
          .map((notification) => {
            const createdDate = dayjs(notification.createdDate);
            const priorityColors = {
              low: "bg-green-100 border-green-200 text-green-800",
              medium: "bg-yellow-100 border-yellow-200 text-yellow-800",
              high: "bg-orange-100 border-orange-200 text-orange-800",
              urgent: "bg-red-100 border-red-200 text-red-800",
            };

            return `
            <div class="bg-white/80 backdrop-blur-sm border ${
              priorityColors[notification.priority] || "border-gray-200"
            } rounded-lg p-4 hover:shadow-md transition-all duration-200">
              <div class="flex items-start justify-between">
                <div class="flex-1">
                  <div class="flex items-center space-x-2 mb-1">
                    <span class="font-semibold text-gray-900">${
                      notification.title
                    }</span>
                    <span class="px-2 py-1 rounded-full text-xs font-medium ${
                      priorityColors[notification.priority] ||
                      "bg-gray-100 text-gray-800"
                    }">
                      ${(notification.priority || "medium").toUpperCase()}
                    </span>
                  </div>
                  <p class="text-sm text-gray-600 mb-2">${
                    notification.message
                  }</p>
                  <p class="text-xs text-gray-500">${createdDate.format(
                    "MMM D, YYYY [at] h:mm A"
                  )}</p>
                </div>
                <div class="flex space-x-2 ml-4">
                  <button onclick="viewAssignmentDetails('${
                    notification.assignmentId
                  }')" class="bg-blue-500 hover:bg-blue-600 text-white px-3 py-1 rounded text-xs transition-colors">
                    View
                  </button>
                  <button onclick="markNotificationAsRead('${
                    notification.id
                  }')" class="bg-gray-500 hover:bg-gray-600 text-white px-3 py-1 rounded text-xs transition-colors">
                    Mark Read
                  </button>
                  <button onclick="deleteNotification('${
                    notification.id
                  }')" class="bg-red-500 hover:bg-red-600 text-white px-3 py-1 rounded text-xs transition-colors" title="Delete Notification">
                    <i class="fas fa-trash"></i>
                  </button>
                </div>
              </div>
            </div>
          `;
          })
          .join("");
      }

      function updateAssignmentStats() {
        const assignments = JSON.parse(
          localStorage.getItem("serviceAssignments") || "[]"
        );

        const totalCount = assignments.length;
        const pendingCount = assignments.filter(
          (a) => a.status === "pending_review"
        ).length;
        const completedTodayCount = assignments.filter((a) => {
          return (
            a.status === "completed" &&
            dayjs(a.scheduledDate).format("YYYY-MM-DD") ===
              dayjs().format("YYYY-MM-DD")
          );
        }).length;

        document.getElementById("dashboardTotalAssignments").textContent =
          totalCount;
        document.getElementById("dashboardPendingAssignments").textContent =
          pendingCount;
        document.getElementById("dashboardCompletedToday").textContent =
          completedTodayCount;
      }

      // Service Requests Dashboard Functions
      function loadServiceRequestNotifications() {
        const serviceRequests = JSON.parse(
          localStorage.getItem("serviceRequests") || "[]"
        );
        const ctioNotifications = JSON.parse(
          localStorage.getItem("ctioNotifications") || "[]"
        );

        // Combine service requests and notifications for display
        const recentActivities = [];

        // Add recent service requests
        serviceRequests
          .sort((a, b) => new Date(b.createdAt) - new Date(a.createdAt))
          .slice(0, 3)
          .forEach((request) => {
            recentActivities.push({
              type: "service_request_created",
              title: `Service Request Created`,
              message: `${request.serviceType} for ${request.client} - Priority: ${request.priority}`,
              timestamp: request.createdAt,
              id: request.id,
              priority: request.priority,
            });
          });

        // Add CTIO notifications
        ctioNotifications
          .filter((n) => n.status === "New")
          .sort((a, b) => new Date(b.receivedAt) - new Date(a.receivedAt))
          .slice(0, 3)
          .forEach((notification) => {
            recentActivities.push({
              type: "ctio_notification",
              title: `CTIO Notification`,
              message: `${notification.message} - Priority: ${notification.priority}`,
              timestamp: notification.receivedAt,
              id: notification.id,
              priority: notification.priority,
            });
          });

        // Sort by timestamp and take top 5
        const sortedActivities = recentActivities
          .sort((a, b) => new Date(b.timestamp) - new Date(a.timestamp))
          .slice(0, 5);

        const container = document.getElementById(
          "serviceRequestNotificationsList"
        );
        if (!container) return;

        if (sortedActivities.length === 0) {
          container.innerHTML = `
            <div class="text-center py-6 text-gray-500">
              <div class="text-4xl mb-2">üõ†Ô∏è</div>
              <p>No recent service activities</p>
            </div>
          `;
          return;
        }

        container.innerHTML = sortedActivities
          .map((activity) => {
            const createdDate = dayjs(activity.timestamp);
            const priorityColor =
              activity.priority === "Critical"
                ? "text-red-600"
                : activity.priority === "High"
                ? "text-orange-600"
                : activity.priority === "Medium"
                ? "text-yellow-600"
                : "text-green-600";
            const typeIcon =
              activity.type === "service_request_created" ? "üõ†Ô∏è" : "üìû";

            return `
            <div class="bg-white/60 backdrop-blur-sm rounded-lg p-4 border border-gray-200 hover:shadow-md transition-all duration-200">
              <div class="flex items-start">
                <div class="text-2xl mr-3">${typeIcon}</div>
                <div class="flex-1">
                  <div class="flex items-center justify-between">
                    <h4 class="font-semibold text-gray-800 text-sm">${
                      activity.title
                    }</h4>
                    <span class="text-xs ${priorityColor} font-medium">${
              activity.priority
            }</span>
                  </div>
                  <p class="text-sm text-gray-600 mb-2">${activity.message}</p>
                  <p class="text-xs text-gray-500">${createdDate.format(
                    "MMM D, YYYY [at] h:mm A"
                  )}</p>
                </div>
                <div class="flex space-x-2 ml-4">
                  <button onclick="viewServiceActivity('${activity.type}', '${
              activity.id
            }')" class="bg-blue-500 hover:bg-blue-600 text-white px-3 py-1 rounded text-xs transition-colors">
                    View
                  </button>
                  <button onclick="handleServiceActivity('${activity.type}', '${
              activity.id
            }')" class="bg-green-500 hover:bg-green-600 text-white px-3 py-1 rounded text-xs transition-colors">
                    Handle
                  </button>
                  <button onclick="deleteActivity('${activity.type}', '${
              activity.id
            }')" class="bg-red-500 hover:bg-red-600 text-white px-3 py-1 rounded text-xs transition-colors" title="Delete Activity">
                    <i class="fas fa-trash"></i>
                  </button>
                </div>
              </div>
            </div>
          `;
          })
          .join("");
      }

      function updateServiceRequestStats() {
        const supportTickets = JSON.parse(localStorage.getItem("supportTickets") || "[]");
        const serviceRequests = JSON.parse(localStorage.getItem("serviceRequests") || "[]");
        const ctioNotifications = JSON.parse(localStorage.getItem("ctioNotifications") || "[]");

        // Use support tickets for main stats
        const openTicketsCount = supportTickets.filter(t => t.status === "Pending").length;
        const clientIssuesCount = supportTickets.filter(t => t.createdBy === "Client").length;
        const assignedTicketsCount = supportTickets.filter(t => t.assignedTechnician && t.assignedTechnician !== "Unassigned").length;
        
        const today = new Date().toDateString();
        const resolvedTodayCount = supportTickets.filter(t => {
          return t.status === "Completed" && new Date(t.updatedAt || t.createdAt).toDateString() === today;
        }).length;

        const elements = {
          dashboardOpenTickets: openTicketsCount,
          dashboardClientIssues: clientIssuesCount,
          dashboardForwardedTickets: assignedTicketsCount,
          dashboardResolvedTickets: resolvedTodayCount,
        };

        Object.entries(elements).forEach(([elementId, value]) => {
          const element = document.getElementById(elementId);
          if (element) {
            element.textContent = value;
          }
        });
      }

      // All Notifications Functions
      function loadAllNotifications() {
        // Get all types of notifications
        const adminNotifications = JSON.parse(localStorage.getItem("adminNotifications") || "[]");
        const ctioNotifications = JSON.parse(localStorage.getItem("ctioNotifications") || "[]");
        const clientNotifications = JSON.parse(localStorage.getItem("clientNotifications") || "[]");
        const supportTickets = JSON.parse(localStorage.getItem("supportTickets") || "[]");
        const serviceRequests = JSON.parse(localStorage.getItem("serviceRequests") || "[]");

        // Combine all notifications
        const allNotifications = [];

        // Add admin notifications
        adminNotifications.forEach(notification => {
          allNotifications.push({
            ...notification,
            source: 'admin',
            timestamp: notification.createdDate || notification.timestamp
          });
        });

        // Add CTIO notifications
        ctioNotifications.forEach(notification => {
          allNotifications.push({
            ...notification,
            source: 'ctio',
            timestamp: notification.receivedAt || notification.timestamp
          });
        });

        // Add client notifications
        clientNotifications.forEach(notification => {
          allNotifications.push({
            ...notification,
            source: 'client',
            timestamp: notification.createdAt || notification.timestamp
          });
        });

        // Add support tickets as notifications
        supportTickets.forEach(ticket => {
          allNotifications.push({
            id: `ticket_${ticket.id}`,
            title: `Support Ticket: ${ticket.subject}`,
            message: ticket.description,
            priority: ticket.priority || 'medium',
            source: 'support',
            timestamp: ticket.createdAt || ticket.timestamp,
            status: ticket.status
          });
        });

        // Add service requests as notifications
        serviceRequests.forEach(request => {
          allNotifications.push({
            id: `request_${request.id}`,
            title: `Service Request: ${request.serviceType}`,
            message: request.description,
            priority: request.priority || 'medium',
            source: 'service',
            timestamp: request.createdAt || request.timestamp,
            status: request.status
          });
        });

        // Sort by timestamp (newest first)
        allNotifications.sort((a, b) => new Date(b.timestamp) - new Date(a.timestamp));

        const container = document.getElementById("allNotificationsList");
        if (!container) return;

        if (allNotifications.length === 0) {
          container.innerHTML = `
            <div class="text-center py-8 text-blue-200">
              <div class="text-4xl mb-4">üîî</div>
              <p class="text-lg font-medium">No notifications</p>
              <p class="text-sm">All caught up!</p>
            </div>
          `;
          return;
        }

        container.innerHTML = allNotifications.map(notification => {
          const timestamp = dayjs(notification.timestamp);
          const priorityColors = {
            low: "bg-green-100 border-green-200 text-green-800",
            medium: "bg-yellow-100 border-yellow-200 text-yellow-800",
            high: "bg-orange-100 border-orange-200 text-orange-800",
            urgent: "bg-red-100 border-red-200 text-red-800",
          };

          const sourceColors = {
            admin: "bg-blue-100 text-blue-800",
            ctio: "bg-purple-100 text-purple-800",
            client: "bg-green-100 text-green-800",
            support: "bg-orange-100 text-orange-800",
            service: "bg-indigo-100 text-indigo-800"
          };

          return `
            <div class="bg-white/10 backdrop-blur-sm border border-blue-400/30 rounded-lg p-4 hover:bg-white/20 transition-all duration-200">
              <div class="flex items-start justify-between">
                <div class="flex-1">
                  <div class="flex items-center space-x-2 mb-2">
                    <span class="font-semibold text-white">${notification.title}</span>
                    <span class="px-2 py-1 rounded-full text-xs font-medium ${priorityColors[notification.priority] || "bg-gray-100 text-gray-800"}">
                      ${(notification.priority || "medium").toUpperCase()}
                    </span>
                    <span class="px-2 py-1 rounded-full text-xs font-medium ${sourceColors[notification.source] || "bg-gray-100 text-gray-800"}">
                      ${notification.source.toUpperCase()}
                    </span>
                  </div>
                  <p class="text-sm text-blue-200 mb-2">${notification.message}</p>
                  <p class="text-xs text-blue-300">${timestamp.format("MMM D, YYYY [at] h:mm A")}</p>
                </div>
                <div class="flex space-x-2 ml-4">
                  <button onclick="deleteNotification('${notification.id}', '${notification.source}')" 
                          class="bg-red-500 hover:bg-red-600 text-white px-3 py-1 rounded text-xs transition-colors" 
                          title="Delete Notification">
                    <i class="fas fa-trash"></i>
                  </button>
                </div>
              </div>
            </div>
          `;
        }).join('');
      }

      function clearAllNotifications() {
        Swal.fire({
          title: 'Clear All Notifications?',
          text: 'This will delete all notifications from the system. This action cannot be undone.',
          icon: 'warning',
          showCancelButton: true,
          confirmButtonColor: '#EF4444',
          cancelButtonColor: '#6B7280',
          confirmButtonText: 'Yes, Clear All',
          cancelButtonText: 'Cancel'
        }).then((result) => {
          if (result.isConfirmed) {
            // Clear all notification types
            localStorage.removeItem('adminNotifications');
            localStorage.removeItem('ctioNotifications');
            localStorage.removeItem('clientNotifications');
            
            // Reload notifications
            loadAllNotifications();
            
            // Update notification badge
            updateNotificationBadge();
            
            Swal.fire({
              title: 'Cleared!',
              text: 'All notifications have been cleared.',
              icon: 'success',
              timer: 2000,
              showConfirmButton: false
            });
          }
        });
      }

      function deleteNotification(notificationId, source) {
        Swal.fire({
          title: 'Delete Notification?',
          text: 'This notification will be permanently removed.',
          icon: 'warning',
          showCancelButton: true,
          confirmButtonColor: '#EF4444',
          cancelButtonColor: '#6B7280',
          confirmButtonText: 'Yes, Delete',
          cancelButtonText: 'Cancel'
        }).then((result) => {
          if (result.isConfirmed) {
            // Delete based on source
            if (source === 'admin') {
              const adminNotifications = JSON.parse(localStorage.getItem("adminNotifications") || "[]");
              const updated = adminNotifications.filter(n => n.id !== notificationId);
              localStorage.setItem("adminNotifications", JSON.stringify(updated));
            } else if (source === 'ctio') {
              const ctioNotifications = JSON.parse(localStorage.getItem("ctioNotifications") || "[]");
              const updated = ctioNotifications.filter(n => n.id !== notificationId);
              localStorage.setItem("ctioNotifications", JSON.stringify(updated));
            } else if (source === 'client') {
              const clientNotifications = JSON.parse(localStorage.getItem("clientNotifications") || "[]");
              const updated = clientNotifications.filter(n => n.id !== notificationId);
              localStorage.setItem("clientNotifications", JSON.stringify(updated));
            } else if (source === 'support') {
              const supportTickets = JSON.parse(localStorage.getItem("supportTickets") || "[]");
              const updated = supportTickets.filter(t => t.id !== notificationId.replace('ticket_', ''));
              localStorage.setItem("supportTickets", JSON.stringify(updated));
            } else if (source === 'service') {
              const serviceRequests = JSON.parse(localStorage.getItem("serviceRequests") || "[]");
              const updated = serviceRequests.filter(r => r.id !== notificationId.replace('request_', ''));
              localStorage.setItem("serviceRequests", JSON.stringify(updated));
            }
            
            // Reload notifications
            loadAllNotifications();
            
            // Update notification badge
            updateNotificationBadge();
            
            Swal.fire({
              title: 'Deleted!',
              text: 'Notification has been removed.',
              icon: 'success',
              timer: 2000,
              showConfirmButton: false
            });
          }
        });
      }

      function updateNotificationBadge() {
        const adminNotifications = JSON.parse(localStorage.getItem("adminNotifications") || "[]");
        const ctioNotifications = JSON.parse(localStorage.getItem("ctioNotifications") || "[]");
        const clientNotifications = JSON.parse(localStorage.getItem("clientNotifications") || "[]");
        
        const totalNotifications = adminNotifications.length + ctioNotifications.length + clientNotifications.length;
        
        const badge = document.getElementById("notificationBadge");
        if (badge) {
          if (totalNotifications > 0) {
            badge.textContent = totalNotifications;
            badge.style.display = "flex";
          } else {
            badge.style.display = "none";
          }
        }
      }

      function viewAllCTIONotifications() {
        // Scroll to the All Notifications section
        const notificationsSection = document.getElementById("allNotificationsList");
        if (notificationsSection) {
          notificationsSection.scrollIntoView({ 
            behavior: 'smooth',
            block: 'start'
          });
          
          // Highlight the section briefly
          notificationsSection.parentElement.style.border = "2px solid #3B82F6";
          setTimeout(() => {
            notificationsSection.parentElement.style.border = "1px solid #1E40AF";
          }, 2000);
        }
        
        // Refresh notifications to show latest
        loadAllNotifications();
      }

      // Support activity handlers
      function viewSupportActivity(type, id) {
        if (type === "ticket_created") {
          // Open support tickets page and highlight specific ticket
          window.location.href = `support-tickets.html#ticket-${id}`;
        } else if (type === "client_issue") {
          // Open support tickets page and show client notifications tab
          window.location.href = `support-tickets.html#notification-${id}`;
        }
      }

      function handleSupportActivity(type, id) {
        if (type === "client_issue") {
          // Open create ticket modal with pre-filled data from client notification
          const clientNotifications = JSON.parse(
            localStorage.getItem("clientNotifications") || "[]"
          );
          const notification = clientNotifications.find((n) => n.id === id);
          if (notification) {
            // Redirect to support tickets page with pre-fill parameters
            window.location.href = `support-tickets.html?action=create&from=${id}`;
          }
        } else {
          // View ticket details
          viewSupportActivity(type, id);
        }
      }

      // Service activity handlers
      function viewServiceActivity(type, id) {
        if (type === "service_request_created") {
          // Open service requests dashboard and highlight specific request
          window.location.href = `supervisor-dashboard.html#request-${id}`;
        } else if (type === "ctio_notification") {
          // Open service requests dashboard and show CTIO notifications tab
          window.location.href = `supervisor-dashboard.html#notification-${id}`;
        }
      }

      function handleServiceActivity(type, id) {
        if (type === "ctio_notification") {
          // Mark CTIO notification as handled
          const ctioNotifications = JSON.parse(
            localStorage.getItem("ctioNotifications") || "[]"
          );
          const notification = ctioNotifications.find((n) => n.id === id);
          if (notification) {
            notification.status = "Handled";
            localStorage.setItem(
              "ctioNotifications",
              JSON.stringify(ctioNotifications)
            );
            loadServiceRequestNotifications();
            updateServiceRequestStats();
          }
        } else {
          // View service request details
          viewServiceActivity(type, id);
        }
      }

      // Delete activity function for CTIO
      function deleteActivity(type, id) {
        Swal.fire({
          title: 'Delete Activity?',
          text: 'This action cannot be undone. The activity will be permanently removed.',
          icon: 'warning',
          showCancelButton: true,
          confirmButtonColor: '#ef4444',
          cancelButtonColor: '#6b7280',
          confirmButtonText: 'Yes, delete it',
          cancelButtonText: 'Cancel'
        }).then((result) => {
          if (result.isConfirmed) {
            if (type === "service_request_created") {
              // Delete from service requests
              const serviceRequests = JSON.parse(localStorage.getItem("serviceRequests") || "[]");
              const updatedRequests = serviceRequests.filter(req => req.id !== id);
              localStorage.setItem("serviceRequests", JSON.stringify(updatedRequests));
            } else if (type === "ctio_notification") {
              // Delete from CTIO notifications
              const ctioNotifications = JSON.parse(localStorage.getItem("ctioNotifications") || "[]");
              const updatedNotifications = ctioNotifications.filter(notif => notif.id !== id);
              localStorage.setItem("ctioNotifications", JSON.stringify(updatedNotifications));
            } else if (type === "ticket_created") {
              // Delete from support tickets
              const supportTickets = JSON.parse(localStorage.getItem("supportTickets") || "[]");
              const updatedTickets = supportTickets.filter(ticket => ticket.id !== id);
              localStorage.setItem("supportTickets", JSON.stringify(updatedTickets));
            }
            
            // Refresh the activities display
            loadServiceRequestNotifications();
            updateServiceRequestStats();
            
            Swal.fire({
              title: 'Deleted!',
              text: 'The activity has been removed.',
              icon: 'success',
              timer: 1500,
              showConfirmButton: false
            });
          }
        });
      }

      function refreshAssignmentNotifications() {
        loadAssignmentNotifications();
        updateAssignmentStats();

        // Show success message
        const btn = event.target;
        const originalText = btn.textContent;
        btn.textContent = "‚úì Refreshed";
        btn.disabled = true;

        setTimeout(() => {
          btn.textContent = originalText;
          btn.disabled = false;
        }, 2000);
      }

      function viewAssignmentDetails(assignmentId) {
        window.open(
          `service-assignments.html?assignment=${assignmentId}`,
          "_blank"
        );
      }

      function markNotificationAsRead(notificationId) {
        const adminNotifications = JSON.parse(
          localStorage.getItem("adminNotifications") || "[]"
        );
        const updatedNotifications = adminNotifications.map((notification) => {
          if (notification.id === notificationId) {
            return { ...notification, read: true };
          }
          return notification;
        });

        localStorage.setItem(
          "adminNotifications",
          JSON.stringify(updatedNotifications)
        );
        loadAssignmentNotifications();
      }

      // Delete notification function for CTIO
      function deleteNotification(notificationId) {
        Swal.fire({
          title: 'Delete Notification?',
          text: 'This action cannot be undone. The notification will be permanently removed.',
          icon: 'warning',
          showCancelButton: true,
          confirmButtonColor: '#ef4444',
          cancelButtonColor: '#6b7280',
          confirmButtonText: 'Yes, delete it',
          cancelButtonText: 'Cancel'
        }).then((result) => {
          if (result.isConfirmed) {
            const adminNotifications = JSON.parse(
              localStorage.getItem("adminNotifications") || "[]"
            );
            const updatedNotifications = adminNotifications.filter(notification => notification.id !== notificationId);
            
            localStorage.setItem(
              "adminNotifications",
              JSON.stringify(updatedNotifications)
            );
            
            // Refresh the notifications display
            loadAssignmentNotifications();
            
            Swal.fire({
              title: 'Deleted!',
              text: 'The notification has been removed.',
              icon: 'success',
              timer: 1500,
              showConfirmButton: false
            });
          }
        });
      }

      // Make functions globally available
      window.refreshAssignmentNotifications = refreshAssignmentNotifications;
      window.viewAssignmentDetails = viewAssignmentDetails;
      window.markNotificationAsRead = markNotificationAsRead;

      // ============================================
      // SUPPORT TICKET CREATION FOR CTIO
      // ============================================

      function createSupportTicket() {
        // Load clients for the dropdown
        loadClientsForTicket();
        
        // Show the modal
        const modal = document.getElementById('supportTicketModal');
        const modalContent = document.getElementById('supportTicketModalContent');
        
        modal.classList.remove('hidden');
        modal.classList.add('flex');
        
        // Animate the modal
        setTimeout(() => {
          modalContent.style.transform = 'scale(1)';
          modalContent.style.opacity = '1';
        }, 10);
        
        // Add form submission handler
        const form = document.getElementById('supportTicketForm');
        form.onsubmit = handleTicketFormSubmission;
      }

      function closeSupportTicketModal() {
        const modal = document.getElementById('supportTicketModal');
        const modalContent = document.getElementById('supportTicketModalContent');
        
        // Animate out
        modalContent.style.transform = 'scale(0.95)';
        modalContent.style.opacity = '0';
        
        setTimeout(() => {
          modal.classList.add('hidden');
          modal.classList.remove('flex');
        }, 300);
      }

      async function handleTicketFormSubmission(event) {
        event.preventDefault();
        
        try {
          const ticketData = {
            issueType: document.getElementById('ticketIssueType').value,
            client: document.getElementById('ticketClient').value,
            priority: document.getElementById('ticketPriority').value,
            subject: document.getElementById('ticketSubject').value,
            description: document.getElementById('ticketDescription').value,
            assignedTechnician: document.getElementById('ticketAssignedTechnician').value
          };
          
          // Validate required fields
          if (!ticketData.issueType || !ticketData.client || !ticketData.subject || !ticketData.description) {
            Swal.fire({
              title: 'Validation Error',
              text: 'Please fill in all required fields',
              icon: 'warning'
            });
            return;
          }
          
          // Generate unique support ticket ID
          const ticketId = 'TKT' + Date.now().toString().substr(-6) + Math.random().toString(36).substr(2, 3).toUpperCase();
          
          // Create support ticket object
          const newSupportTicket = {
            id: ticketId,
            issueType: ticketData.issueType,
            client: ticketData.client,
            priority: ticketData.priority,
            subject: ticketData.subject,
            description: ticketData.description,
            assignedTechnician: ticketData.assignedTechnician || 'Unassigned',
            status: 'Pending',
            createdBy: 'CTIO',
            createdAt: new Date().toISOString(),
            updatedAt: new Date().toISOString(),
            lastUpdatedBy: 'CTIO',
            notes: '',
            statusHistory: [{
              status: 'Pending',
              notes: 'Ticket created by CTIO',
              updatedBy: 'CTIO',
              timestamp: new Date().toISOString()
            }]
          };

          // Save to centralized support tickets storage
          let allSupportTickets = JSON.parse(localStorage.getItem("supportTickets") || "[]");
          allSupportTickets.unshift(newSupportTicket);
          localStorage.setItem("supportTickets", JSON.stringify(allSupportTickets));

          // Create notification for Supervisor about new ticket
          let supervisorNotifications = JSON.parse(localStorage.getItem('supervisorNotifications') || '[]');
          const supervisorNotification = {
            id: `SUP${Date.now()}${Math.random().toString(36).substr(2, 5)}`,
            type: "support_ticket_created",
            title: `New Support Ticket from CTIO`,
            message: `${newSupportTicket.issueType} for ${newSupportTicket.client}: ${newSupportTicket.description.substring(0, 80)}...`,
            ticketId: newSupportTicket.id,
            priority: newSupportTicket.priority,
            clientName: newSupportTicket.client,
            timestamp: Date.now(),
            isRead: false,
            createdBy: 'CTIO',
            ticketType: 'staff',
            createdAt: new Date().toISOString(),
          };

          supervisorNotifications.unshift(supervisorNotification);
          if (supervisorNotifications.length > 100) {
            supervisorNotifications = supervisorNotifications.slice(0, 100);
          }
          localStorage.setItem('supervisorNotifications', JSON.stringify(supervisorNotifications));

          // Create notification for CTIO about successful creation
          let ctioNotifications = JSON.parse(localStorage.getItem('ctioNotifications') || '[]');
          const ctioNotification = {
            id: `CTIO${Date.now()}${Math.random().toString(36).substr(2, 5)}`,
            type: "support_ticket_created",
            title: `You created support ticket`,
            message: `${newSupportTicket.issueType} for ${newSupportTicket.client}`,
            ticketId: newSupportTicket.id,
            priority: newSupportTicket.priority,
            clientName: newSupportTicket.client,
            timestamp: Date.now(),
            isRead: false,
            createdBy: 'CTIO',
            ticketType: 'staff',
            createdAt: new Date().toISOString(),
          };

          ctioNotifications.unshift(ctioNotification);
          if (ctioNotifications.length > 100) {
            ctioNotifications = ctioNotifications.slice(0, 100);
          }
          localStorage.setItem('ctioNotifications', JSON.stringify(ctioNotifications));

          // Refresh the support tickets display
          loadCtioSupportTickets();

          // Close the modal
          closeSupportTicketModal();

          // Show success message
          Swal.fire({
            title: "Support Ticket Created Successfully! üéâ",
            html: `
              <div class="text-center">
                <p class="text-lg mb-2">Support Ticket #${newSupportTicket.id} has been created</p>
                <div class="bg-gray-100 p-4 rounded-lg text-left">
                  <p class="text-sm"><strong>Issue:</strong> ${newSupportTicket.issueType}</p>
                  <p class="text-sm"><strong>Client:</strong> ${newSupportTicket.client}</p>
                  <p class="text-sm"><strong>Priority:</strong> ${newSupportTicket.priority}</p>
                </div>
              </div>
            `,
            icon: "success",
            timer: 4000,
            showConfirmButton: false
          });

          console.log(`‚úÖ CTIO created support ticket: ${ticketId}`);
          
        } catch (error) {
          console.error("Error creating support ticket:", error);
          Swal.fire({
            title: "Error Creating Support Ticket",
            text: "There was an error creating the support ticket. Please try again.",
            icon: "error"
          });
        }
      }

      // Make function globally available
      window.createSupportTicket = createSupportTicket;

      // Function to load clients for support ticket creation
      async function loadClientsForTicket() {
        const clientSelect = document.getElementById('ticketClient');
        if (!clientSelect) return;

        try {
          // Try to fetch from API first
          const response = await fetch('/api/admin/clients', {
            credentials: 'include'
          });
          
          if (response.ok) {
            const clients = await response.json();
            clientSelect.innerHTML = '<option value="">Select a client</option>';
            
            clients.forEach(client => {
              const option = document.createElement('option');
              option.value = client.name;
              option.textContent = `${client.name} (${client.phone})`;
              option.setAttribute('data-client-id', client.id);
              option.setAttribute('data-client-phone', client.phone);
              option.setAttribute('data-client-email', client.email || '');
              clientSelect.appendChild(option);
            });
            
            // Add option for manual entry (hotspot subscribers)
            const otherOption = document.createElement('option');
            otherOption.value = 'other';
            otherOption.textContent = 'Other (Enter manually for hotspot subscribers)';
            clientSelect.appendChild(otherOption);
            return;
          }
        } catch (error) {
          console.log('API not available, trying localStorage fallback...');
        }

        // Fallback to localStorage if API is not available
        try {
          const localClients = JSON.parse(localStorage.getItem('clients') || '[]');
          
          if (localClients.length > 0) {
            clientSelect.innerHTML = '<option value="">Select a client</option>';
            
            localClients.forEach(client => {
              const option = document.createElement('option');
              option.value = client.name || client.fullName || client.clientName;
              option.textContent = `${client.name || client.fullName || client.clientName}${client.phone ? ` (${client.phone})` : ''}`;
              option.setAttribute('data-client-id', client.id || client.clientId);
              option.setAttribute('data-client-phone', client.phone || '');
              option.setAttribute('data-client-email', client.email || '');
              clientSelect.appendChild(option);
            });
            
            // Add option for manual entry
            const otherOption = document.createElement('option');
            otherOption.value = 'other';
            otherOption.textContent = 'Other (Enter manually for hotspot subscribers)';
            clientSelect.appendChild(otherOption);
          } else {
            // No clients available, provide sample data and manual entry
            clientSelect.innerHTML = `
              <option value="">Select a client</option>
              <option value="John Doe">John Doe (Sample Client)</option>
              <option value="Jane Smith">Jane Smith (Sample Client)</option>
              <option value="Bob Johnson">Bob Johnson (Sample Client)</option>
              <option value="other">Other (Enter manually)</option>
            `;
          }
        } catch (error) {
          console.error('Error loading clients from localStorage:', error);
          // Provide basic options as last resort
          clientSelect.innerHTML = `
            <option value="">Select a client</option>
            <option value="other">Enter manually</option>
          `;
        }
      }

      // Function to handle client selection (show manual input for "other")
      function handleClientSelection() {
        const clientSelect = document.getElementById('serviceClient');
        const manualInput = document.getElementById('manualClientName');
        
        if (clientSelect && manualInput) {
          if (clientSelect.value === 'other') {
            manualInput.classList.remove('hidden');
            manualInput.required = true;
            clientSelect.required = false;
          } else {
            manualInput.classList.add('hidden');
            manualInput.required = false;
            manualInput.value = '';
            clientSelect.required = true;
          }
        }
      }

      // CTIO Service Requests Management Functions
      function loadCtioSupportTickets() {
        const tickets = JSON.parse(localStorage.getItem('supportTickets') || '[]');
        const container = document.getElementById('ctioSupportTicketsList');
        const emptyState = document.getElementById('ctioEmptyState');

        if (!container) return;

        if (tickets.length === 0) {
          container.innerHTML = '';
          if (emptyState) emptyState.classList.remove('hidden');
          return;
        }

        if (emptyState) emptyState.classList.add('hidden');
        
        container.innerHTML = tickets
          .sort((a, b) => new Date(b.createdAt) - new Date(a.createdAt))
          .map(ticket => {
            const priorityColors = {
              'Low': 'bg-green-100 text-green-800',
              'Medium': 'bg-yellow-100 text-yellow-800',
              'High': 'bg-orange-100 text-orange-800',
              'Critical': 'bg-red-100 text-red-800'
            };
            
            const statusColors = {
              'Pending': 'bg-blue-100 text-blue-800',
              'In Progress': 'bg-purple-100 text-purple-800',
              'Resolved': 'bg-green-100 text-green-800',
              'Completed': 'bg-green-100 text-green-800',
              'Cancelled': 'bg-gray-100 text-gray-800'
            };

            const creatorIcon = ticket.createdBy === 'Client' ? 'fas fa-user' : 
                               ticket.createdBy === 'CTIO' ? 'fas fa-crown' : 'fas fa-user-tie';
            
            const creatorColor = ticket.createdBy === 'Client' ? 'text-purple-600' : 
                                ticket.createdBy === 'CTIO' ? 'text-blue-600' : 'text-green-600';
            
            return `
              <div class="bg-gradient-to-br from-slate-700 to-blue-800 border border-blue-600 rounded-lg p-4 hover:border-blue-400 transition-all duration-300 shadow-lg hover:shadow-xl">
                <div class="flex items-start justify-between mb-3">
                  <div class="flex-1">
                    <div class="flex items-center space-x-2 mb-2">
                      <span class="inline-flex items-center px-2 py-1 rounded text-xs font-medium ${priorityColors[ticket.priority] || 'bg-gray-600 text-gray-200'}">
                        ${ticket.priority}
                      </span>
                      <span class="inline-flex items-center px-2 py-1 rounded text-xs font-medium ${statusColors[ticket.status] || 'bg-gray-600 text-gray-200'}">
                        ${ticket.status}
                      </span>
                      <span class="inline-flex items-center px-2 py-1 rounded text-xs font-medium bg-blue-600 text-blue-100">
                        <i class="${creatorIcon} mr-1 text-blue-200"></i>
                        ${ticket.createdBy || 'Unknown'}
                      </span>
                    </div>
                    <h3 class="text-base font-medium text-white mb-1">${ticket.issueType}</h3>
                    <p class="text-sm text-blue-200 mb-2 line-clamp-2">${ticket.description}</p>
                  </div>
                  <div class="ml-3 flex space-x-2">
                    <button 
                      onclick="viewTicketDetails('${ticket.id}')"
                      class="px-3 py-1 bg-gradient-to-r from-green-500 to-emerald-600 text-white rounded text-xs hover:from-green-600 hover:to-emerald-700 transition-all duration-300 transform hover:scale-105 shadow-md"
                    >
                      View
                    </button>
                    <button 
                      onclick="updateTicketStatus('${ticket.id}')"
                      class="px-3 py-1 bg-gradient-to-r from-blue-500 to-indigo-600 text-white rounded text-xs hover:from-blue-600 hover:to-indigo-700 transition-all duration-300 transform hover:scale-105 shadow-md"
                    >
                      Update
                    </button>
                    <button 
                      onclick="deleteTicket('${ticket.id}')"
                      class="px-3 py-1 bg-gradient-to-r from-red-500 to-red-600 text-white rounded text-xs hover:from-red-600 hover:to-red-700 transition-all duration-300 transform hover:scale-105 shadow-md"
                    >
                      Delete
                    </button>
                  </div>
                </div>
                <div class="border-t border-blue-600 pt-3">
                  <div class="grid grid-cols-2 gap-4 text-xs text-blue-300">
                    <div>
                      <span class="font-medium text-blue-100">Client:</span> ${ticket.client}
                    </div>
                    <div>
                      <span class="font-medium text-blue-100">Assigned:</span> ${ticket.assignedTechnician || 'Unassigned'}
                    </div>
                    <div>
                      <span class="font-medium text-blue-100">ID:</span> ${ticket.id}
                    </div>
                    <div>
                      <span class="font-medium text-blue-100">Created:</span> ${new Date(ticket.createdAt).toLocaleDateString()}
                    </div>
                  </div>
                </div>
              </div>
            `;
          }).join('');
      }

      function refreshServiceRequests() {
        loadCtioSupportTickets();
        // Also refresh the dashboard stats
        loadServiceRequestNotifications();
        updateServiceRequestStats();
        
        // Show success message
        if (typeof Swal !== 'undefined') {
          Swal.fire({
            title: 'Refreshed!',
            text: 'Service requests have been updated',
            icon: 'success',
            timer: 1500,
            showConfirmButton: false
          });
        }
      }

      function viewTicketDetails(ticketId) {
        const tickets = JSON.parse(localStorage.getItem('supportTickets') || '[]');
        const ticket = tickets.find(t => t.id === ticketId);
        
        if (!ticket) {
          Swal.fire('Error', 'Ticket not found', 'error');
          return;
        }
        
        const priorityColors = {
          'Low': 'bg-green-100 text-green-800',
          'Medium': 'bg-yellow-100 text-yellow-800',
          'High': 'bg-orange-100 text-orange-800',
          'Critical': 'bg-red-100 text-red-800'
        };
        
        const statusColors = {
          'Pending': 'bg-blue-100 text-blue-800',
          'In Progress': 'bg-purple-100 text-purple-800',
          'Completed': 'bg-green-100 text-green-800',
          'Cancelled': 'bg-gray-100 text-gray-800',
          'Closed': 'bg-gray-100 text-gray-800',
          'On Hold': 'bg-red-100 text-red-800'
        };
        
        Swal.fire({
          title: `üé´ Ticket Details: #${ticket.id}`,
          html: `
            <div class="text-left space-y-4">
              <div class="bg-gray-50 p-4 rounded-lg">
                <div class="grid grid-cols-2 gap-4">
                  <div>
                    <p class="text-xs text-gray-500 mb-1">Issue Type</p>
                    <p class="font-semibold">${ticket.issueType || 'Unknown'}</p>
                  </div>
                  <div>
                    <p class="text-xs text-gray-500 mb-1">Priority</p>
                    <span class="inline-flex items-center px-2 py-1 rounded text-xs font-medium ${priorityColors[ticket.priority] || 'bg-gray-100 text-gray-800'}">
                      ${ticket.priority || 'Unknown'}
                    </span>
                  </div>
                  <div>
                    <p class="text-xs text-gray-500 mb-1">Status</p>
                    <span class="inline-flex items-center px-2 py-1 rounded text-xs font-medium ${statusColors[ticket.status] || 'bg-gray-100 text-gray-800'}">
                      ${ticket.status || 'Unknown'}
                    </span>
                  </div>
                  <div>
                    <p class="text-xs text-gray-500 mb-1">Created By</p>
                    <p class="font-semibold">${ticket.createdBy || 'Unknown'}</p>
                  </div>
                </div>
              </div>
              
              <div>
                <p class="text-xs text-gray-500 mb-2">Client</p>
                <p class="bg-blue-50 p-3 rounded-lg font-medium">${ticket.client || ticket.clientName || 'Unknown Client'}</p>
              </div>
              
              <div>
                <p class="text-xs text-gray-500 mb-2">Description</p>
                <p class="bg-gray-50 p-3 rounded-lg">${ticket.description || 'No description provided'}</p>
              </div>
              
              <div class="grid grid-cols-2 gap-4">
                <div>
                  <p class="text-xs text-gray-500 mb-2">Assigned Technician</p>
                  <p class="bg-green-50 p-3 rounded-lg font-medium text-green-800">
                    ${ticket.assignedTechnician || 'Unassigned'}
                  </p>
                </div>
                <div>
                  <p class="text-xs text-gray-500 mb-2">Location</p>
                  <p class="bg-gray-50 p-3 rounded-lg">${ticket.location || 'Not specified'}</p>
                </div>
              </div>
              
              <div class="grid grid-cols-2 gap-4">
                <div>
                  <p class="text-xs text-gray-500 mb-2">Preferred Date</p>
                  <p class="bg-gray-50 p-3 rounded-lg">${ticket.preferredDate || 'Not specified'}</p>
                </div>
                <div>
                  <p class="text-xs text-gray-500 mb-2">Created Date</p>
                  <p class="bg-gray-50 p-3 rounded-lg">${ticket.createdAt ? new Date(ticket.createdAt).toLocaleString() : 'Unknown'}</p>
                </div>
              </div>
              
              ${ticket.statusHistory && ticket.statusHistory.length > 0 ? `
              <div>
                <p class="text-xs text-gray-500 mb-2">Status History</p>
                <div class="bg-gray-50 p-3 rounded-lg max-h-32 overflow-y-auto">
                  ${ticket.statusHistory.map(entry => `
                    <div class="text-xs mb-1">
                      <span class="font-medium">${entry.status}</span> - 
                      <span class="text-gray-600">${entry.updatedBy}</span> - 
                      <span class="text-gray-500">${new Date(entry.timestamp).toLocaleString()}</span>
                      ${entry.notes ? `<br><span class="text-gray-600 italic">${entry.notes}</span>` : ''}
                    </div>
                  `).join('')}
                </div>
              </div>
              ` : ''}
            </div>
          `,
          width: '700px',
          showConfirmButton: true,
          confirmButtonText: 'Close',
          confirmButtonColor: '#3b82f6'
        });
      }

      // Service Assignment Functions
      function createServiceAssignment() {
        if (typeof Swal === "undefined") {
          alert("Please wait for the page to fully load, then try again.");
          return;
        }

        Swal.fire({
          title: '<i class="fas fa-tasks mr-2"></i>Create Service Assignment',
          html: `
            <div class="text-left space-y-3" style="background: linear-gradient(135deg, #10b981 0%, #059669 100%); padding: 20px; border-radius: 12px; color: white;">
              <div class="grid grid-cols-2 gap-3">
                <div>
                  <label class="block text-sm font-medium mb-1 text-white">Service Type: <span class="text-red-300">*</span></label>
                  <select id="serviceType" class="w-full p-2 border border-white/30 rounded-lg focus:ring-2 focus:ring-white/50 focus:border-white/50 bg-white/10 text-white">
                    <option value="" class="text-gray-800">Select service type</option>
                    <option value="installation" class="text-gray-800">üîß Installation</option>
                    <option value="maintenance" class="text-gray-800">üõ†Ô∏è Maintenance</option>
                    <option value="asset_recovery" class="text-gray-800">üì¶ Asset Recovery</option>
                    <option value="repair" class="text-gray-800">üî® Repair</option>
                    <option value="inspection" class="text-gray-800">üîç Inspection</option>
                  </select>
                </div>
                <div>
                  <label class="block text-sm font-medium mb-1 text-white">Priority:</label>
                  <select id="priority" class="w-full p-2 border border-white/30 rounded-lg focus:ring-2 focus:ring-white/50 focus:border-white/50 bg-white/10 text-white">
                    <option value="low" class="text-gray-800">Low</option>
                    <option value="medium" selected class="text-gray-800">Medium</option>
                    <option value="high" class="text-gray-800">High</option>
                    <option value="urgent" class="text-gray-800">Urgent</option>
                  </select>
                </div>
              </div>
              
              <div class="grid grid-cols-2 gap-3">
                <div>
                  <label class="block text-sm font-medium mb-1 text-white">Client Name: <span class="text-red-300">*</span></label>
                  <input type="text" id="clientName" class="w-full p-2 border border-white/30 rounded-lg focus:ring-2 focus:ring-white/50 focus:border-white/50 bg-white/10 text-white placeholder-white/70" placeholder="Client name" required>
                </div>
                <div>
                  <label class="block text-sm font-medium mb-1 text-white">Client Contact:</label>
                  <input type="text" id="clientContact" class="w-full p-2 border border-white/30 rounded-lg focus:ring-2 focus:ring-white/50 focus:border-white/50 bg-white/10 text-white placeholder-white/70" placeholder="Phone/Email">
                </div>
              </div>
              
              <div>
                <label class="block text-sm font-medium mb-1 text-white">Service Address: <span class="text-red-300">*</span></label>
                <textarea id="serviceAddress" rows="2" class="w-full p-2 border border-white/30 rounded-lg focus:ring-2 focus:ring-white/50 focus:border-white/50 bg-white/10 text-white placeholder-white/70" placeholder="Complete service address..." required></textarea>
              </div>
              
              <div class="grid grid-cols-2 gap-3">
                <div>
                  <label class="block text-sm font-medium mb-1 text-white">Assigned Technician: <span class="text-red-300">*</span></label>
                  <select id="technicianId" class="w-full p-2 border border-white/30 rounded-lg focus:ring-2 focus:ring-white/50 focus:border-white/50 bg-white/10 text-white" required>
                    <option value="" class="text-gray-800">Select technician</option>
                    <option value="john_smith" class="text-gray-800">John Smith - Senior Technician</option>
                    <option value="sarah_johnson" class="text-gray-800">Sarah Johnson - Network Specialist</option>
                    <option value="mike_davis" class="text-gray-800">Mike Davis - Installation Expert</option>
                    <option value="lisa_chen" class="text-gray-800">Lisa Chen - Hardware Specialist</option>
                    <option value="david_wilson" class="text-gray-800">David Wilson - Emergency Response</option>
                  </select>
                </div>
                <div>
                  <label class="block text-sm font-medium mb-1 text-white">Scheduled Date:</label>
                  <input type="date" id="scheduledDate" class="w-full p-2 border border-white/30 rounded-lg focus:ring-2 focus:ring-white/50 focus:border-white/50 bg-white/10 text-white">
                </div>
              </div>
              
              <div>
                <label class="block text-sm font-medium mb-1 text-white">Description: <span class="text-red-300">*</span></label>
                <textarea id="description" rows="2" class="w-full p-2 border border-white/30 rounded-lg focus:ring-2 focus:ring-white/50 focus:border-white/50 bg-white/10 text-white placeholder-white/70" placeholder="Detailed description of the service assignment..." required></textarea>
              </div>
              
              <div>
                <label class="block text-sm font-medium mb-1 text-white">Required Equipment:</label>
                <textarea id="requiredEquipment" rows="2" class="w-full p-2 border border-white/30 rounded-lg focus:ring-2 focus:ring-white/50 focus:border-white/50 bg-white/10 text-white placeholder-white/70" placeholder="List any equipment or assets required..."></textarea>
              </div>
            </div>
          `,
          showCancelButton: true,
          confirmButtonText: '<i class="fas fa-tasks mr-2"></i>Create Assignment',
          cancelButtonText: 'Cancel',
          confirmButtonColor: '#10b981',
          cancelButtonColor: '#6b7280',
          width: '600px',
          preConfirm: () => {
            const serviceType = document.getElementById('serviceType').value;
            const priority = document.getElementById('priority').value;
            const clientName = document.getElementById('clientName').value.trim();
            const clientContact = document.getElementById('clientContact').value.trim();
            const serviceAddress = document.getElementById('serviceAddress').value.trim();
            const technicianId = document.getElementById('technicianId').value;
            const scheduledDate = document.getElementById('scheduledDate').value;
            const description = document.getElementById('description').value.trim();
            const requiredEquipment = document.getElementById('requiredEquipment').value.trim();

            if (!serviceType || !clientName || !serviceAddress || !technicianId || !description) {
              Swal.showValidationMessage("Please fill in all required fields");
              return false;
            }

            return {
              serviceType,
              priority,
              clientName,
              clientContact,
              serviceAddress,
              technicianId,
              scheduledDate,
              description,
              requiredEquipment
            };
          }
        }).then((result) => {
          if (result.isConfirmed) {
            const assignmentData = result.value;
            
            // Generate unique assignment ID
            const timestamp = Date.now().toString().slice(-6);
            const random = Math.random().toString(36).substring(2, 6).toUpperCase();
            const assignmentId = `SA${timestamp}${random}`;
            
            // Get technician name
            const technicianNames = {
              'john_smith': 'John Smith',
              'sarah_johnson': 'Sarah Johnson',
              'mike_davis': 'Mike Davis',
              'lisa_chen': 'Lisa Chen',
              'david_wilson': 'David Wilson'
            };
            
            // Create service assignment object
            const newAssignment = {
              id: assignmentId,
              serviceType: assignmentData.serviceType,
              priority: assignmentData.priority,
              status: 'assigned',
              clientName: assignmentData.clientName,
              clientContact: assignmentData.clientContact,
              serviceAddress: assignmentData.serviceAddress,
              technicianId: assignmentData.technicianId,
              technicianName: technicianNames[assignmentData.technicianId] || 'Unknown',
              assignedTo: technicianNames[assignmentData.technicianId] || 'Unknown',
              description: assignmentData.description,
              requiredEquipment: assignmentData.requiredEquipment,
              scheduledDate: assignmentData.scheduledDate || new Date().toISOString().split('T')[0],
              createdDate: new Date().toISOString(),
              createdAt: new Date().toISOString(),
              createdBy: 'CTIO',
              assignmentNumber: `SA-${String(Date.now()).slice(-6)}`,
              source: 'ctio'
            };
            
            // Save to centralized service assignments storage
            let allAssignments = JSON.parse(localStorage.getItem('serviceAssignments') || '[]');
            allAssignments.unshift(newAssignment);
            localStorage.setItem('serviceAssignments', JSON.stringify(allAssignments));
            
            console.log('üíæ CTIO service assignment saved:', newAssignment);
            console.log('üìä Total assignments in storage:', allAssignments.length);
            
            // Create notification for Supervisor
            let supervisorNotifications = JSON.parse(localStorage.getItem('supervisorNotifications') || '[]');
            const supervisorNotification = {
              id: `SUP${Date.now()}${Math.random().toString(36).substr(2, 5)}`,
              type: 'service_assignment_created',
              title: `New Service Assignment from CTIO`,
              message: `${newAssignment.serviceType} assignment for ${newAssignment.clientName} assigned to ${newAssignment.technicianName}`,
              assignmentId: newAssignment.id,
              priority: newAssignment.priority,
              clientName: newAssignment.clientName,
              timestamp: Date.now(),
              isRead: false,
              createdBy: 'CTIO',
              assignmentType: 'service',
              createdAt: new Date().toISOString(),
            };
            
            supervisorNotifications.unshift(supervisorNotification);
            if (supervisorNotifications.length > 100) {
              supervisorNotifications = supervisorNotifications.slice(0, 100);
            }
            localStorage.setItem('supervisorNotifications', JSON.stringify(supervisorNotifications));
            
            Swal.fire({
              title: 'Assignment Created!',
              text: `Service assignment created and assigned to ${newAssignment.technicianName}`,
              icon: 'success',
              timer: 2000,
              showConfirmButton: false
            });
            
            console.log(`‚úÖ CTIO created service assignment #${assignmentId} assigned to: ${newAssignment.technicianName}`);
            
            // Refresh the service assignments list
            loadCtioServiceAssignments();
          }
        });
      }

      // Service Assignment Management Functions
      function manageServiceAssignment(assignmentId, action) {
        const assignments = JSON.parse(localStorage.getItem('serviceAssignments') || '[]');
        const assignment = assignments.find(a => a.id === assignmentId);
        
        if (!assignment) {
          Swal.fire('Error', 'Assignment not found', 'error');
          return;
        }
        
        let actionText = '';
        let newStatus = '';
        let icon = '';
        
        switch(action) {
          case 'approve':
            actionText = 'Approve';
            newStatus = 'approved';
            icon = 'success';
            break;
          case 'reject':
            actionText = 'Reject';
            newStatus = 'rejected';
            icon = 'error';
            break;
          case 'close':
            actionText = 'Close';
            newStatus = 'completed';
            icon = 'info';
            break;
        }
        
        Swal.fire({
          title: `${actionText} Service Assignment?`,
          html: `
            <div class="text-left">
              <p class="mb-3"><strong>Assignment:</strong> ${assignment.serviceType} for ${assignment.clientName}</p>
              <p class="mb-3"><strong>Technician:</strong> ${assignment.technicianName}</p>
              <p class="mb-3"><strong>Current Status:</strong> ${assignment.status}</p>
              ${action === 'reject' ? `
                <div>
                  <label class="block text-sm font-medium mb-2">Rejection Reason:</label>
                  <textarea id="rejectionReason" rows="3" class="w-full p-2 border border-gray-300 rounded-lg" placeholder="Please provide a reason for rejection..."></textarea>
                </div>
              ` : ''}
            </div>
          `,
          showCancelButton: true,
          confirmButtonText: `${actionText} Assignment`,
          cancelButtonText: 'Cancel',
          confirmButtonColor: action === 'approve' ? '#10b981' : action === 'reject' ? '#ef4444' : '#3b82f6',
          preConfirm: () => {
            if (action === 'reject') {
              const reason = document.getElementById('rejectionReason').value.trim();
              if (!reason) {
                Swal.showValidationMessage('Please provide a rejection reason');
                return false;
              }
              return { reason };
            }
            return true;
          }
        }).then((result) => {
          if (result.isConfirmed) {
            // Update assignment status
            assignment.status = newStatus;
            assignment.updatedAt = new Date().toISOString();
            assignment.updatedBy = 'CTIO';
            assignment.actionTaken = action;
            
            if (action === 'reject' && result.value.reason) {
              assignment.rejectionReason = result.value.reason;
            }
            
            // Save updated assignment
            const assignmentIndex = assignments.findIndex(a => a.id === assignmentId);
            assignments[assignmentIndex] = assignment;
            localStorage.setItem('serviceAssignments', JSON.stringify(assignments));
            
            // Create notification for Supervisor
            let supervisorNotifications = JSON.parse(localStorage.getItem('supervisorNotifications') || '[]');
            const supervisorNotification = {
              id: `SUP${Date.now()}${Math.random().toString(36).substr(2, 5)}`,
              type: 'service_assignment_updated',
              title: `Service Assignment ${actionText}d by CTIO`,
              message: `Assignment #${assignmentId} (${assignment.serviceType} for ${assignment.clientName}) has been ${actionText.toLowerCase()}d`,
              assignmentId: assignment.id,
              priority: assignment.priority,
              clientName: assignment.clientName,
              timestamp: Date.now(),
              isRead: false,
              createdBy: 'CTIO',
              assignmentType: 'service',
              action: action,
              createdAt: new Date().toISOString(),
            };
            
            supervisorNotifications.unshift(supervisorNotification);
            if (supervisorNotifications.length > 100) {
              supervisorNotifications = supervisorNotifications.slice(0, 100);
            }
            localStorage.setItem('supervisorNotifications', JSON.stringify(supervisorNotifications));
            
            Swal.fire({
              title: 'Assignment Updated!',
              text: `Service assignment has been ${actionText.toLowerCase()}d`,
              icon: icon,
              timer: 2000,
              showConfirmButton: false
            });
            
            console.log(`‚úÖ CTIO ${actionText.toLowerCase()}d service assignment #${assignmentId}`);
            
            // Refresh the service assignments list
            loadCtioServiceAssignments();
          }
        });
      }

      // Refresh service assignments for CTIO
      function refreshCtioServiceAssignments() {
        loadCtioServiceAssignments();
        Swal.fire({
          title: 'Refreshed!',
          text: 'Service assignments list has been updated',
          icon: 'success',
          timer: 1500,
          showConfirmButton: false
        });
      }

      // Load and display service assignments for CTIO
      function loadCtioServiceAssignments() {
        const assignments = JSON.parse(localStorage.getItem('serviceAssignments') || '[]');
        const container = document.getElementById('ctioServiceAssignmentsList');
        const emptyState = document.getElementById('ctioServiceAssignmentsEmptyState');

        console.log('üîß Loading CTIO service assignments...');
        console.log('üìä Total assignments found:', assignments.length);
        console.log('üìã Container element:', container);

        if (!container) {
          console.error('‚ùå CTIO service assignments container not found!');
          return;
        }

        if (assignments.length === 0) {
          container.innerHTML = '';
          if (emptyState) emptyState.classList.remove('hidden');
          return;
        }

        if (emptyState) emptyState.classList.add('hidden');
        
        container.innerHTML = assignments
          .sort((a, b) => new Date(b.createdAt) - new Date(a.createdAt))
          .map(assignment => {
            const priorityColors = {
              'low': 'bg-green-100 text-green-800',
              'medium': 'bg-yellow-100 text-yellow-800',
              'high': 'bg-orange-100 text-orange-800',
              'urgent': 'bg-red-100 text-red-800'
            };
            
            const statusColors = {
              'assigned': 'bg-blue-100 text-blue-800',
              'approved': 'bg-green-100 text-green-800',
              'rejected': 'bg-red-100 text-red-800',
              'completed': 'bg-gray-100 text-gray-800',
              'in-progress': 'bg-purple-100 text-purple-800'
            };

            const creatorIcon = assignment.createdBy === 'CTIO' ? 'fas fa-crown' : 'fas fa-user-tie';
            const creatorColor = assignment.createdBy === 'CTIO' ? 'text-blue-600' : 'text-green-600';
            
            return `
              <div class="bg-gradient-to-br from-slate-700 to-green-800 border border-green-600 rounded-lg p-4 hover:border-green-400 transition-all duration-300 shadow-lg hover:shadow-xl">
                <div class="flex items-start justify-between mb-3">
                  <div class="flex-1">
                    <div class="flex items-center space-x-2 mb-2">
                      <span class="inline-flex items-center px-2 py-1 rounded text-xs font-medium ${priorityColors[assignment.priority] || 'bg-gray-600 text-gray-200'}">
                        ${assignment.priority || 'Unknown'}
                      </span>
                      <span class="inline-flex items-center px-2 py-1 rounded text-xs font-medium ${statusColors[assignment.status] || 'bg-gray-600 text-gray-200'}">
                        ${assignment.status || 'Unknown'}
                      </span>
                      <span class="inline-flex items-center px-2 py-1 rounded text-xs font-medium bg-green-600 text-green-100">
                        <i class="${creatorIcon} mr-1 text-green-200"></i>
                        ${assignment.createdBy || 'Unknown'}
                      </span>
                    </div>
                    <h3 class="text-base font-medium text-white mb-1">${assignment.serviceType || 'Unknown Service'}</h3>
                    <p class="text-sm text-green-200 mb-2 line-clamp-2">${assignment.description || 'No description provided'}</p>
                  </div>
                  <div class="ml-3 flex space-x-2">
                    ${assignment.createdBy === 'CTIO' ? `
                      <button 
                        onclick="manageServiceAssignment('${assignment.id}', 'approve')"
                        class="px-3 py-1 bg-gradient-to-r from-green-500 to-emerald-600 text-white rounded text-xs hover:from-green-600 hover:to-emerald-700 transition-all duration-300 transform hover:scale-105 shadow-md"
                      >
                        Approve
                      </button>
                      <button 
                        onclick="manageServiceAssignment('${assignment.id}', 'reject')"
                        class="px-3 py-1 bg-gradient-to-r from-red-500 to-red-600 text-white rounded text-xs hover:from-red-600 hover:to-red-700 transition-all duration-300 transform hover:scale-105 shadow-md"
                      >
                        Reject
                      </button>
                      <button 
                        onclick="manageServiceAssignment('${assignment.id}', 'close')"
                        class="px-3 py-1 bg-gradient-to-r from-blue-500 to-indigo-600 text-white rounded text-xs hover:from-blue-600 hover:to-indigo-700 transition-all duration-300 transform hover:scale-105 shadow-md"
                      >
                        Close
                      </button>
                    ` : `
                      <button 
                        onclick="viewServiceAssignmentDetails('${assignment.id}')"
                        class="px-3 py-1 bg-gradient-to-r from-blue-500 to-indigo-600 text-white rounded text-xs hover:from-blue-600 hover:to-indigo-700 transition-all duration-300 transform hover:scale-105 shadow-md"
                      >
                        View
                      </button>
                    `}
                  </div>
                </div>
                <div class="border-t border-green-600 pt-3">
                  <div class="grid grid-cols-2 gap-4 text-xs text-green-300">
                    <div>
                      <span class="font-medium text-green-100">Client:</span> ${assignment.clientName || 'Unknown Client'}
                    </div>
                    <div>
                      <span class="font-medium text-green-100">Technician:</span> ${assignment.technicianName || 'Unassigned'}
                    </div>
                    <div>
                      <span class="font-medium text-green-100">ID:</span> ${assignment.id || 'Unknown ID'}
                    </div>
                    <div>
                      <span class="font-medium text-green-100">Created:</span> ${assignment.createdAt ? new Date(assignment.createdAt).toLocaleDateString() : 'Unknown Date'}
                    </div>
                  </div>
                </div>
              </div>
            `;
          }).join('');
      }

      // View service assignment details
      function viewServiceAssignmentDetails(assignmentId) {
        const assignments = JSON.parse(localStorage.getItem('serviceAssignments') || '[]');
        const assignment = assignments.find(a => a.id === assignmentId);
        
        if (!assignment) {
          Swal.fire('Error', 'Assignment not found', 'error');
          return;
        }
        
        const priorityColors = {
          'low': 'bg-green-100 text-green-800',
          'medium': 'bg-yellow-100 text-yellow-800',
          'high': 'bg-orange-100 text-orange-800',
          'urgent': 'bg-red-100 text-red-800'
        };
        
        const statusColors = {
          'assigned': 'bg-blue-100 text-blue-800',
          'approved': 'bg-green-100 text-green-800',
          'rejected': 'bg-red-100 text-red-800',
          'completed': 'bg-gray-100 text-gray-800',
          'in-progress': 'bg-purple-100 text-purple-800'
        };
        
        Swal.fire({
          title: `üîß Service Assignment: #${assignment.id}`,
          html: `
            <div class="text-left space-y-4">
              <div class="bg-gray-50 p-4 rounded-lg">
                <div class="grid grid-cols-2 gap-4">
                  <div>
                    <p class="text-xs text-gray-500 mb-1">Service Type</p>
                    <p class="font-semibold">${assignment.serviceType || 'Unknown'}</p>
                  </div>
                  <div>
                    <p class="text-xs text-gray-500 mb-1">Priority</p>
                    <span class="inline-flex items-center px-2 py-1 rounded text-xs font-medium ${priorityColors[assignment.priority] || 'bg-gray-100 text-gray-800'}">
                      ${assignment.priority || 'Unknown'}
                    </span>
                  </div>
                  <div>
                    <p class="text-xs text-gray-500 mb-1">Status</p>
                    <span class="inline-flex items-center px-2 py-1 rounded text-xs font-medium ${statusColors[assignment.status] || 'bg-gray-100 text-gray-800'}">
                      ${assignment.status || 'Unknown'}
                    </span>
                  </div>
                  <div>
                    <p class="text-xs text-gray-500 mb-1">Created By</p>
                    <p class="font-semibold">${assignment.createdBy || 'Unknown'}</p>
                  </div>
                </div>
              </div>
              
              <div>
                <p class="text-xs text-gray-500 mb-2">Client</p>
                <p class="bg-blue-50 p-3 rounded-lg font-medium">${assignment.clientName || 'Unknown Client'}</p>
              </div>
              
              <div>
                <p class="text-xs text-gray-500 mb-2">Description</p>
                <p class="bg-gray-50 p-3 rounded-lg">${assignment.description || 'No description provided'}</p>
              </div>
              
              <div class="grid grid-cols-2 gap-4">
                <div>
                  <p class="text-xs text-gray-500 mb-2">Assigned Technician</p>
                  <p class="bg-green-50 p-3 rounded-lg font-medium text-green-800">
                    ${assignment.technicianName || 'Unassigned'}
                  </p>
                </div>
                <div>
                  <p class="text-xs text-gray-500 mb-2">Service Address</p>
                  <p class="bg-gray-50 p-3 rounded-lg">${assignment.serviceAddress || 'Not specified'}</p>
                </div>
              </div>
              
              <div class="grid grid-cols-2 gap-4">
                <div>
                  <p class="text-xs text-gray-500 mb-2">Scheduled Date</p>
                  <p class="bg-gray-50 p-3 rounded-lg">${assignment.scheduledDate || 'Not specified'}</p>
                </div>
                <div>
                  <p class="text-xs text-gray-500 mb-2">Created Date</p>
                  <p class="bg-gray-50 p-3 rounded-lg">${assignment.createdAt ? new Date(assignment.createdAt).toLocaleString() : 'Unknown'}</p>
                </div>
              </div>
              
              ${assignment.requiredEquipment ? `
              <div>
                <p class="text-xs text-gray-500 mb-2">Required Equipment</p>
                <p class="bg-gray-50 p-3 rounded-lg">${assignment.requiredEquipment}</p>
              </div>
              ` : ''}
            </div>
          `,
          width: '700px',
          showConfirmButton: true,
          confirmButtonText: 'Close',
          confirmButtonColor: '#3b82f6'
        });
      }

      function updateTicketStatus(ticketId) {
        const tickets = JSON.parse(localStorage.getItem('supportTickets') || '[]');
        const ticket = tickets.find(t => t.id === ticketId);
        
        if (!ticket) return;
        
        if (typeof Swal !== 'undefined') {
          Swal.fire({
            title: 'Update Ticket Status',
            html: `
              <div class="text-left space-y-4">
                <div>
                  <label class="block text-sm font-medium mb-2">Current Status: <strong>${ticket.status}</strong></label>
                  <select id="newStatus" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
                    <option value="Pending" ${ticket.status === 'Pending' ? 'selected' : ''}>Pending</option>
                    <option value="In Progress" ${ticket.status === 'In Progress' ? 'selected' : ''}>In Progress</option>
                    <option value="Completed" ${ticket.status === 'Completed' ? 'selected' : ''}>Completed</option>
                    <option value="Cancelled" ${ticket.status === 'Cancelled' ? 'selected' : ''}>Cancelled</option>
                  </select>
                </div>
                <div>
                  <label class="block text-sm font-medium mb-2">Notes (optional):</label>
                  <textarea id="statusNotes" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500" rows="3" placeholder="Add any notes about this status update..."></textarea>
                </div>
              </div>
            `,
            showCancelButton: true,
            confirmButtonText: 'Update Status',
            cancelButtonText: 'Cancel',
            confirmButtonColor: '#3b82f6',
            preConfirm: () => {
              const newStatus = document.getElementById('newStatus').value;
              const notes = document.getElementById('statusNotes').value;
              
              // Update the ticket
              ticket.status = newStatus;
              ticket.updatedAt = new Date().toISOString();
              ticket.lastUpdatedBy = 'CTIO';
              ticket.updatedBy = 'CTIO';
              
              // Add to status history
              if (!ticket.statusHistory) {
                ticket.statusHistory = [];
              }
              ticket.statusHistory.push({
                status: newStatus,
                notes: notes,
                updatedBy: 'CTIO',
                timestamp: new Date().toISOString()
              });
              
              if (notes) {
                ticket.statusNotes = notes;
              }
              
              // Save back to localStorage
              localStorage.setItem('supportTickets', JSON.stringify(tickets));
              
              // Create notification for Supervisor about status update
              let supervisorNotifications = JSON.parse(localStorage.getItem('supervisorNotifications') || '[]');
              const supervisorNotification = {
                id: `SUP${Date.now()}${Math.random().toString(36).substr(2, 5)}`,
                type: 'ticket_status_updated',
                title: `Ticket Status Updated by CTIO`,
                message: `Ticket #${ticket.id} status changed to ${newStatus}`,
                ticketId: ticket.id,
                priority: ticket.priority,
                clientName: ticket.client,
                timestamp: Date.now(),
                isRead: false,
                createdBy: 'CTIO',
                ticketType: 'staff',
                createdAt: new Date().toISOString(),
              };

              supervisorNotifications.unshift(supervisorNotification);
              if (supervisorNotifications.length > 100) {
                supervisorNotifications = supervisorNotifications.slice(0, 100);
              }
              localStorage.setItem('supervisorNotifications', JSON.stringify(supervisorNotifications));
              
              return { newStatus, notes };
            }
          }).then((result) => {
            if (result.isConfirmed) {
              loadCtioSupportTickets();
              Swal.fire('Updated!', `Ticket status changed to ${result.value.newStatus}`, 'success');
              console.log(`‚úÖ CTIO updated ticket #${ticketId} status to: ${result.value.newStatus}`);
            }
          });
        }
      }

      // Delete ticket function
      function deleteTicket(ticketId) {
        if (typeof Swal !== 'undefined') {
          Swal.fire({
            title: 'Delete Support Ticket',
            text: 'Are you sure you want to delete this support ticket? This action cannot be undone.',
            icon: 'warning',
            showCancelButton: true,
            confirmButtonText: 'Yes, Delete',
            cancelButtonText: 'Cancel',
            confirmButtonColor: '#ef4444'
          }).then((result) => {
            if (result.isConfirmed) {
              const tickets = JSON.parse(localStorage.getItem('supportTickets') || '[]');
              const updatedTickets = tickets.filter(t => t.id !== ticketId);
              localStorage.setItem('supportTickets', JSON.stringify(updatedTickets));
              
              // Refresh display
              loadCtioSupportTickets();
              
              // Create notification for Supervisor about ticket deletion
              let supervisorNotifications = JSON.parse(localStorage.getItem('supervisorNotifications') || '[]');
              const supervisorNotification = {
                id: `SUP${Date.now()}${Math.random().toString(36).substr(2, 5)}`,
                type: 'ticket_deleted',
                title: `Support Ticket Deleted by CTIO`,
                message: `Ticket #${ticketId} has been deleted`,
                ticketId: ticketId,
                timestamp: Date.now(),
                isRead: false,
                createdBy: 'CTIO',
                ticketType: 'staff',
                createdAt: new Date().toISOString(),
              };

              supervisorNotifications.unshift(supervisorNotification);
              if (supervisorNotifications.length > 100) {
                supervisorNotifications = supervisorNotifications.slice(0, 100);
              }
              localStorage.setItem('supervisorNotifications', JSON.stringify(supervisorNotifications));
              
              Swal.fire({
                title: 'Deleted!',
                text: 'Support ticket has been deleted successfully',
                icon: 'success',
                timer: 2000,
                showConfirmButton: false
              });
            }
          });
        }
      }

      // CTIO Attendance Functions
      function loadCtioAttendance() {
        console.log('üìä CTIO: Loading attendance data...');
        
        // Get data sent from supervisor (stored in ctioAttendance)
        const ctioAttendance = JSON.parse(localStorage.getItem('ctioAttendance') || '[]');
        const selectedDate = document.getElementById('ctioAttendanceDateFilter')?.value || new Date().toISOString().split('T')[0];
        
        console.log('üìä CTIO: ctioAttendance data:', ctioAttendance);
        console.log('üìÖ CTIO: Selected date:', selectedDate);
        
        const tableBody = document.getElementById('ctioAttendanceTableBody');
        const noRecordsMessage = document.getElementById('ctioNoAttendanceRecords');
        
        console.log('üìä CTIO: Table body element:', tableBody);
        console.log('üìä CTIO: No records message element:', noRecordsMessage);
        
        if (!tableBody) {
          console.error('‚ùå CTIO: Table body element not found!');
          return;
        }
        
        // Filter attendance records by selected date
        const filteredRecords = ctioAttendance.filter(record => {
          const recordDate = record.date || new Date(record.timestamp).toISOString().split('T')[0];
          return recordDate === selectedDate;
        });
        
        if (filteredRecords.length === 0) {
          tableBody.innerHTML = '';
          if (noRecordsMessage) {
            noRecordsMessage.classList.remove('hidden');
          }
          updateCtioAttendanceStats();
          return;
        }
        
        if (noRecordsMessage) {
          noRecordsMessage.classList.add('hidden');
        }

        // Generate table rows for attendance records
        console.log('üìä Generating table rows for', filteredRecords.length, 'records');
        tableBody.innerHTML = filteredRecords.map(record => {
          const statusClass = getCtioAttendanceStatusClass(record.status);
          const timestamp = new Date(record.timestamp).toLocaleString();
          
          console.log('üìä Creating row for record:', record.id, record.employeeName);
          
          return `
            <tr class="hover:bg-gray-50 transition-colors">
              <td class="px-6 py-3 text-sm text-gray-700 border-b">${record.employeeId}</td>
              <td class="px-6 py-3 text-sm text-gray-700 border-b font-medium">${record.employeeName}</td>
              <td class="px-6 py-3 text-sm text-gray-700 border-b">${record.department}</td>
              <td class="px-6 py-3 text-sm text-gray-700 border-b">${record.role}</td>
              <td class="px-6 py-3 text-sm text-gray-700 border-b">${record.phone || 'N/A'}</td>
              <td class="px-6 py-3 text-sm text-gray-700 border-b">${record.email || 'N/A'}</td>
              <td class="px-6 py-3 text-sm text-gray-700 border-b">
                <span class="px-2 py-1 text-xs font-medium ${record.timeIn !== 'N/A' && record.timeIn ? 'text-green-600' : 'text-gray-400'}">
                  ${record.timeIn || 'N/A'}
                </span>
              </td>
              <td class="px-6 py-3 text-sm text-gray-700 border-b">
                <span class="px-2 py-1 text-xs font-medium ${record.timeOut !== 'N/A' && record.timeOut ? 'text-blue-600' : 'text-gray-400'}">
                  ${record.timeOut || 'N/A'}
                </span>
              </td>
              <td class="px-6 py-3 text-sm text-gray-700 border-b">
                <span class="px-2 py-1 text-xs rounded-full bg-green-100 text-green-800">
                  active
                </span>
              </td>
              <td class="px-6 py-3 text-sm border-b">
                <span class="px-3 py-1 text-xs rounded-full font-medium ${statusClass}">
                  ${record.status}
                </span>
              </td>
              <td class="px-6 py-3 text-sm text-gray-500 border-b">${record.markedBy}</td>
              <td class="px-6 py-3 text-sm text-gray-500 border-b">
                ${timestamp}
              </td>
              <td class="px-6 py-3 text-sm border-b">
                <button 
                  onclick="deleteCtioAttendance('${record.id}')" 
                  class="text-red-600 hover:text-red-800 hover:bg-red-50 p-2 rounded-lg transition-colors"
                  title="Delete attendance record"
                >
                  <i class="fas fa-trash text-sm"></i>
                </button>
              </td>
            </tr>
          `;
        }).join('');
        
        updateCtioAttendanceStats();
      }

      function getCtioAttendanceStatusClass(status) {
        switch (status) {
          case 'Present':
            return 'bg-green-100 text-green-800';
          case 'Absent':
            return 'bg-red-100 text-red-800';
          case 'Off Duty':
            return 'bg-yellow-100 text-yellow-800';
          case 'On Leave':
            return 'bg-blue-100 text-blue-800';
          default:
            return 'bg-gray-100 text-gray-800';
        }
      }

      function updateCtioAttendanceStats() {
        // Statistics cards removed - function kept for compatibility but does nothing
        return;
      }

      function filterCtioAttendance() {
        // Reload data with current filters
        loadCtioAttendance();
      }

      function refreshCtioAttendance() {
        loadCtioAttendance();
        Swal.fire({
          title: 'Refreshed!',
          text: 'Attendance records have been updated',
          icon: 'success',
          timer: 1500,
          showConfirmButton: false
        });
      }

      function markAttendance() {
        // Use the same attendance marking function as supervisor
        // This will create attendance records that both dashboards can see
        Swal.fire({
          title: 'Mark Staff Attendance',
          html: `
            <div class="text-left space-y-4">
              <div>
                <label class="block text-sm font-medium mb-1">Employee ID: <span class="text-red-500">*</span></label>
                <input type="text" id="employeeId" class="w-full p-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500" placeholder="Enter employee ID" required>
              </div>
              <div>
                <label class="block text-sm font-medium mb-1">Employee Name: <span class="text-red-500">*</span></label>
                <input type="text" id="employeeName" class="w-full p-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500" placeholder="Enter employee name" required>
              </div>
              <div>
                <label class="block text-sm font-medium mb-1">Department: <span class="text-red-500">*</span></label>
                <select id="department" class="w-full p-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500" required>
                  <option value="">Select department</option>
                  <option value="Technical">Technical</option>
                  <option value="Customer Service">Customer Service</option>
                  <option value="Installation">Installation</option>
                  <option value="Maintenance">Maintenance</option>
                </select>
              </div>
              <div>
                <label class="block text-sm font-medium mb-1">Role: <span class="text-red-500">*</span></label>
                <select id="role" class="w-full p-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500" required>
                  <option value="">Select role</option>
                  <option value="Supervisor">Supervisor</option>
                  <option value="Customer Care">Customer Care</option>
                  <option value="Sales Representative">Sales Representative</option>
                  <option value="Technician">Technician</option>
                </select>
              </div>
              <div>
                <label class="block text-sm font-medium mb-1">Phone:</label>
                <input type="text" id="phone" class="w-full p-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500" placeholder="Enter phone number">
              </div>
              <div>
                <label class="block text-sm font-medium mb-1">Email:</label>
                <input type="email" id="email" class="w-full p-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500" placeholder="Enter email">
              </div>
              <div>
                <label class="block text-sm font-medium mb-1">Attendance Status: <span class="text-red-500">*</span></label>
                <select id="attendanceStatus" class="w-full p-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500" required>
                  <option value="">Select status</option>
                  <option value="Present">Present</option>
                  <option value="Absent">Absent</option>
                  <option value="Off Duty">Off Duty</option>
                  <option value="On Leave">On Leave</option>
                </select>
              </div>
            </div>
          `,
          showCancelButton: true,
          confirmButtonText: 'Mark Attendance',
          cancelButtonText: 'Cancel',
          confirmButtonColor: '#3b82f6',
          cancelButtonColor: '#6b7280',
          preConfirm: () => {
            const employeeId = document.getElementById('employeeId').value.trim();
            const employeeName = document.getElementById('employeeName').value.trim();
            const department = document.getElementById('department').value;
            const role = document.getElementById('role').value.trim();
            const phone = document.getElementById('phone').value.trim();
            const email = document.getElementById('email').value.trim();
            const attendanceStatus = document.getElementById('attendanceStatus').value;

            if (!employeeId || !employeeName || !department || !role || !attendanceStatus) {
              Swal.showValidationMessage('Please fill in all required fields');
              return false;
            }

            return {
              employeeId,
              employeeName,
              department,
              role,
              phone,
              email,
              attendanceStatus
            };
          }
        }).then((result) => {
          if (result.isConfirmed) {
            const attendanceRecord = {
              id: `ATT${Date.now()}${Math.random().toString(36).substr(2, 5)}`,
              employeeId: result.value.employeeId,
              employeeName: result.value.employeeName,
              department: result.value.department,
              role: result.value.role,
              phone: result.value.phone,
              email: result.value.email,
              status: result.value.attendanceStatus,
              timestamp: new Date().toISOString(),
              markedBy: 'CTIO',
              date: new Date().toISOString().split('T')[0]
            };

            // Save to attendance history
            let attendanceHistory = JSON.parse(localStorage.getItem('attendanceHistory') || '[]');
            
            // Check for duplicate (same employee, same date)
            const existingIndex = attendanceHistory.findIndex(r => 
              r.employeeId === attendanceRecord.employeeId && r.date === attendanceRecord.date
            );
            
            if (existingIndex >= 0) {
              // Update existing record
              attendanceHistory[existingIndex] = attendanceRecord;
            } else {
              // Add new record
              attendanceHistory.push(attendanceRecord);
            }
            
            // Keep only last 1000 records
            if (attendanceHistory.length > 1000) {
              attendanceHistory = attendanceHistory.slice(-1000);
            }
            
            localStorage.setItem('attendanceHistory', JSON.stringify(attendanceHistory));
            
            // Dispatch custom event for real-time updates
            window.dispatchEvent(new CustomEvent('attendanceUpdated', { 
              detail: { attendanceRecord, attendanceHistory } 
            }));
            
            // Notify supervisor
            const notification = {
              id: Date.now().toString(),
              type: 'attendance_update',
              title: 'Staff Attendance Update',
              message: `CTIO marked attendance for ${attendanceRecord.employeeName} - ${attendanceRecord.status}`,
              timestamp: new Date().toISOString(),
              read: false,
              source: 'ctio_dashboard'
            };
            
            let notifications = JSON.parse(localStorage.getItem('supervisorNotifications') || '[]');
            notifications.unshift(notification);
            localStorage.setItem('supervisorNotifications', JSON.stringify(notifications));
            
            // Refresh attendance display
            loadCtioAttendance();
            
            Swal.fire('Success!', 'Attendance marked successfully', 'success');
          }
        });
      }

      function deleteCtioAttendance(recordId) {
        // Find the record to get employee details for confirmation
        const attendanceHistory = JSON.parse(localStorage.getItem('attendanceHistory') || '[]');
        const recordToDelete = attendanceHistory.find(record => record.id === recordId);
        
        if (!recordToDelete) {
          Swal.fire('Error!', 'Attendance record not found', 'error');
          return;
        }
        
        // Show confirmation dialog
        Swal.fire({
          title: 'Delete Attendance Record?',
          html: `
            <div class="text-left">
              <p class="mb-2"><strong>Employee:</strong> ${recordToDelete.employeeName}</p>
              <p class="mb-2"><strong>ID:</strong> ${recordToDelete.employeeId}</p>
              <p class="mb-2"><strong>Status:</strong> ${recordToDelete.status}</p>
              <p class="mb-2"><strong>Date:</strong> ${new Date(recordToDelete.timestamp).toLocaleDateString()}</p>
              <p class="text-red-600 font-medium">This action cannot be undone!</p>
            </div>
          `,
          icon: 'warning',
          showCancelButton: true,
          confirmButtonColor: '#dc2626',
          cancelButtonColor: '#6b7280',
          confirmButtonText: 'Yes, Delete',
          cancelButtonText: 'Cancel'
        }).then((result) => {
          if (result.isConfirmed) {
            // Remove the record from attendance history
            const updatedHistory = attendanceHistory.filter(record => record.id !== recordId);
            localStorage.setItem('attendanceHistory', JSON.stringify(updatedHistory));
            
            // Dispatch custom event for real-time updates
            window.dispatchEvent(new CustomEvent('attendanceUpdated', { 
              detail: { deletedRecord: recordToDelete, attendanceHistory: updatedHistory } 
            }));
            
            // Notify supervisor about the deletion
            const notification = {
              id: Date.now().toString(),
              type: 'attendance_deleted',
              title: 'Attendance Record Deleted',
              message: `CTIO deleted attendance record for ${recordToDelete.employeeName} (${recordToDelete.status})`,
              timestamp: new Date().toISOString(),
              read: false,
              source: 'ctio_dashboard'
            };
            
            let notifications = JSON.parse(localStorage.getItem('supervisorNotifications') || '[]');
            notifications.unshift(notification);
            localStorage.setItem('supervisorNotifications', JSON.stringify(notifications));
            
            // Refresh attendance display
            loadCtioAttendance();
            
            Swal.fire('Deleted!', 'Attendance record has been removed', 'success');
          }
        });
      }

      function deleteAllCtioAttendance() {
        const attendanceHistory = JSON.parse(localStorage.getItem('attendanceHistory') || '[]');
        const selectedDate = document.getElementById('ctioAttendanceDateFilter')?.value || new Date().toISOString().split('T')[0];
        
        // Filter records for the selected date
        const recordsForDate = attendanceHistory.filter(record => {
          const recordDate = new Date(record.timestamp).toISOString().split('T')[0];
          return recordDate === selectedDate;
        });
        
        if (recordsForDate.length === 0) {
          Swal.fire('No Records', 'No attendance records found for the selected date', 'info');
          return;
        }
        
        // Show confirmation dialog
        Swal.fire({
          title: 'Delete All Attendance Records?',
          html: `
            <div class="text-left">
              <p class="mb-2"><strong>Date:</strong> ${new Date(selectedDate).toLocaleDateString()}</p>
              <p class="mb-2"><strong>Records to delete:</strong> ${recordsForDate.length}</p>
              <div class="max-h-32 overflow-y-auto mb-2">
                ${recordsForDate.map(record => 
                  `<p class="text-sm">‚Ä¢ ${record.employeeName} (${record.status})</p>`
                ).join('')}
              </div>
              <p class="text-red-600 font-medium">This action cannot be undone!</p>
            </div>
          `,
          icon: 'warning',
          showCancelButton: true,
          confirmButtonColor: '#dc2626',
          cancelButtonColor: '#6b7280',
          confirmButtonText: 'Yes, Delete All',
          cancelButtonText: 'Cancel'
        }).then((result) => {
          if (result.isConfirmed) {
            // Remove all records for the selected date
            const updatedHistory = attendanceHistory.filter(record => {
              const recordDate = new Date(record.timestamp).toISOString().split('T')[0];
              return recordDate !== selectedDate;
            });
            
            localStorage.setItem('attendanceHistory', JSON.stringify(updatedHistory));
            
            // Dispatch custom event for real-time updates
            window.dispatchEvent(new CustomEvent('attendanceUpdated', { 
              detail: { deletedRecords: recordsForDate, attendanceHistory: updatedHistory } 
            }));
            
            // Notify supervisor about the bulk deletion
            const notification = {
              id: Date.now().toString(),
              type: 'attendance_bulk_deleted',
              title: 'Attendance Records Deleted',
              message: `CTIO deleted ${recordsForDate.length} attendance records for ${new Date(selectedDate).toLocaleDateString()}`,
              timestamp: new Date().toISOString(),
              read: false,
              source: 'ctio_dashboard'
            };
            
            let notifications = JSON.parse(localStorage.getItem('supervisorNotifications') || '[]');
            notifications.unshift(notification);
            localStorage.setItem('supervisorNotifications', JSON.stringify(notifications));
            
            // Refresh attendance display
            loadCtioAttendance();
            
            Swal.fire('Deleted!', `${recordsForDate.length} attendance records have been removed`, 'success');
          }
        });
      }

      function testCtioAttendance() {
        console.log('üß™ CTIO: Testing attendance system...');
        
        // Check if elements exist
        const tableBody = document.getElementById('ctioAttendanceTableBody');
        const noRecordsMessage = document.getElementById('ctioNoAttendanceRecords');
        const dateFilter = document.getElementById('ctioAttendanceDateFilter');
        
        console.log('üß™ CTIO: Table body:', tableBody);
        console.log('üß™ CTIO: No records message:', noRecordsMessage);
        console.log('üß™ CTIO: Date filter:', dateFilter);
        
        // Check localStorage data
        const attendanceHistory = JSON.parse(localStorage.getItem('attendanceHistory') || '[]');
        console.log('üß™ CTIO: Attendance history:', attendanceHistory);
        
        // Force add test data
        addCtioTestAttendanceData();
        
        // Force reload
        loadCtioAttendance();
        
        Swal.fire({
          title: 'Test Complete!',
          text: 'Check console for debugging information',
          icon: 'info',
          timer: 3000,
          showConfirmButton: false
        });
      }

      function initializeCtioAttendanceSystem() {
        console.log('üöÄ CTIO: Initializing attendance system...');
        
        // Set default date filter to today
        const dateFilter = document.getElementById('ctioAttendanceDateFilter');
        if (dateFilter) {
          dateFilter.value = new Date().toISOString().split('T')[0];
          console.log('üìÖ CTIO: Date filter set to:', dateFilter.value);
        } else {
          console.error('‚ùå CTIO: Date filter element not found!');
        }
        
        // Add some test data if none exists
        addCtioTestAttendanceData();
        
        // Load initial attendance data
        loadCtioAttendance();
        
        console.log('‚úÖ CTIO: Attendance system initialized');
      }

      function addCtioTestAttendanceData() {
        console.log('üß™ CTIO: Adding test attendance data...');
        
        const testData = [
          {
            id: 'ATT_CTIO_001',
            employeeId: 'EMP001',
            employeeName: 'John Smith',
            department: 'Technical',
            role: 'Senior Technician',
            phone: '+1234567890',
            email: 'john@example.com',
            status: 'Present',
            timestamp: new Date().toISOString(),
            markedBy: 'CTIO',
            date: new Date().toISOString().split('T')[0]
          },
          {
            id: 'ATT_CTIO_002',
            employeeId: 'EMP002',
            employeeName: 'Sarah Johnson',
            department: 'Customer Service',
            role: 'Support Specialist',
            phone: '+1234567891',
            email: 'sarah@example.com',
            status: 'Present',
            timestamp: new Date().toISOString(),
            markedBy: 'CTIO',
            date: new Date().toISOString().split('T')[0]
          },
          {
            id: 'ATT_CTIO_003',
            employeeId: 'EMP003',
            employeeName: 'Mike Wilson',
            department: 'Technical',
            role: 'Network Engineer',
            phone: '+1234567892',
            email: 'mike@example.com',
            status: 'Absent',
            timestamp: new Date().toISOString(),
            markedBy: 'CTIO',
            date: new Date().toISOString().split('T')[0]
          }
        ];
        
        let attendanceHistory = JSON.parse(localStorage.getItem('attendanceHistory') || '[]');
        
        // Check if we already have test data
        const hasTestData = attendanceHistory.some(record => record.id.startsWith('ATT_CTIO_'));
        
        if (!hasTestData) {
          // Add CTIO test data
          attendanceHistory = [...attendanceHistory, ...testData];
          localStorage.setItem('attendanceHistory', JSON.stringify(attendanceHistory));
          console.log('üß™ CTIO: Test attendance data added:', testData.length, 'records');
        } else {
          console.log('üìä CTIO: Test data already exists');
        }
      }

    </script>

    <script src="js/config.js"></script>
    <script src="js/common.js"></script>
    <script src="js/profile-image-manager.js"></script>
    <script src="js/sidebar-responsive.js"></script>
    <script src="js/dashboard.js"></script>
  </body>
</html>