<style>
  .stat-card {
    transition: transform 0.2s;
  }
  .stat-card:hover {
    transform: translateY(-4px);
  }

  /* Skeleton Loading */
  @keyframes skeleton {
    0% {
      background-color: #f3f4f6;
    }
    100% {
      background-color: #e5e7eb;
    }
  }
  .skeleton {
    background: #e5e7eb;
    animation: skeleton 1.2s ease-in-out infinite;
    border-radius: 0.5rem;
  }
  .skeleton-text {
    height: 1rem;
  }
  .skeleton-title {
    height: 1.5rem;
    width: 60%;
  }
  .skeleton-circle {
    width: 2.5rem;
    height: 2.5rem;
    border-radius: 9999px;
  }
</style>
<div class="mb-6">
  <h1 id="pageTitle" class="text-3xl font-bold text-teal-800">Dashboard</h1>
  <p id="pageSubtitle" class="text-teal-600">
    Welcome to Dr.Net Technology Labs Management System
  </p>
</div>

<!-- Quick Stats Grid -->
<div
  class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8"
  id="statsGrid"
>
  <!-- Skeleton Loader -->
  <div
    class="stat-card bg-teal-50 rounded-xl shadow-lg p-6 border border-teal-400"
  >
    <div class="flex items-center justify-between">
      <div class="space-y-3">
        <div class="skeleton skeleton-title"></div>
        <div class="skeleton h-8 w-16"></div>
      </div>
      <div class="skeleton skeleton-circle"></div>
    </div>
  </div>
  <div
    class="stat-card bg-blue-50 rounded-xl shadow-lg p-6 border border-blue-400"
  >
    <div class="flex items-center justify-between">
      <div class="space-y-3">
        <div class="skeleton skeleton-title"></div>
        <div class="skeleton h-8 w-16"></div>
      </div>
      <div class="skeleton skeleton-circle"></div>
    </div>
  </div>
  <div
    class="stat-card bg-green-50 rounded-xl shadow-lg p-6 border border-green-400"
  >
    <div class="flex items-center justify-between">
      <div class="space-y-3">
        <div class="skeleton skeleton-title"></div>
        <div class="skeleton h-8 w-16"></div>
      </div>
      <div class="skeleton skeleton-circle"></div>
    </div>
  </div>
  <div
    class="stat-card bg-orange-50 rounded-xl shadow-lg p-6 border border-orange-400"
  >
    <div class="flex items-center justify-between">
      <div class="space-y-3">
        <div class="skeleton skeleton-title"></div>
        <div class="skeleton h-8 w-16"></div>
      </div>
      <div class="skeleton skeleton-circle"></div>
    </div>
  </div>
</div>

<!-- Charts + Tasks -->
<div class="grid grid-cols-1 lg:grid-cols-2 gap-6 mb-8">
  <!-- Weekly Performance Chart -->
  <div class="bg-white shadow-lg p-6 rounded-xl">
    <div class="flex items-center justify-between mb-6">
      <h3 class="text-lg font-semibold text-gray-800">
        Performance Trend (Weekly)
      </h3>
    </div>
    <div class="h-64 relative">
      <canvas id="revenueChart" class="skeleton w-full h-full"></canvas>
    </div>
  </div>

  <!-- Today's Tasks -->
  <div class="bg-white shadow-lg p-6 rounded-xl">
    <div class="flex items-center justify-between mb-6">
      <h3 class="text-lg font-semibold text-gray-800">Today's Tasks</h3>
      <a
        href="#"
        class="inline-flex items-center px-4 py-2 bg-teal-100 text-teal-700 font-semibold text-sm rounded-lg hover:bg-teal-200 transition duration-200"
      >
        View more
        <svg
          class="w-4 h-4 ml-2"
          fill="none"
          stroke="currentColor"
          stroke-width="2"
          viewBox="0 0 24 24"
        >
          <path
            stroke-linecap="round"
            stroke-linejoin="round"
            d="M9 5l7 7-7 7"
          ></path>
        </svg>
      </a>
    </div>
    <div id="tasksList" class="space-y-3 max-h-96 overflow-y-auto">
      <!-- Skeleton Tasks -->
      <div
        class="flex flex-col md:flex-row md:items-center justify-between p-3 bg-gray-50 rounded-lg border border-gray-200"
      >
        <div class="space-y-2 flex-1">
          <div class="skeleton h-4 w-48"></div>
          <div class="skeleton h-3 w-32"></div>
          <div class="skeleton h-3 w-28"></div>
        </div>
        <div class="skeleton h-5 w-20 mt-2 md:mt-0"></div>
      </div>
      <div
        class="flex flex-col md:flex-row md:items-center justify-between p-3 bg-gray-50 rounded-lg border border-gray-200"
      >
        <div class="space-y-2 flex-1">
          <div class="skeleton h-4 w-44"></div>
          <div class="skeleton h-3 w-36"></div>
          <div class="skeleton h-3 w-24"></div>
        </div>
        <div class="skeleton h-5 w-24 mt-2 md:mt-0"></div>
      </div>
      <div
        class="flex flex-col md:flex-row md:items-center justify-between p-3 bg-gray-50 rounded-lg border border-gray-200"
      >
        <div class="space-y-2 flex-1">
          <div class="skeleton h-4 w-40"></div>
          <div class="skeleton h-3 w-30"></div>
          <div class="skeleton h-3 w-32"></div>
        </div>
        <div class="skeleton h-5 w-20 mt-2 md:mt-0"></div>
      </div>
    </div>
  </div>
</div>

<!-- Payslips + Quick Actions -->
<div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
  <!-- My Payslips -->
  <div class="lg:col-span-2 bg-white shadow-lg p-6 rounded-xl">
    <div class="flex items-center justify-between mb-6">
      <h3 class="text-lg font-semibold text-gray-800">My Payslips</h3>
      <a
        href="payslips.html"
        class="inline-flex items-center px-4 py-2 bg-teal-100 text-teal-700 font-semibold text-sm rounded-lg hover:bg-teal-200 transition duration-200"
      >
        View all
        <svg
          class="w-4 h-4 ml-2"
          fill="none"
          stroke="currentColor"
          stroke-width="2"
          viewBox="0 0 24 24"
        >
          <path
            stroke-linecap="round"
            stroke-linejoin="round"
            d="M9 5l7 7-7 7"
          ></path>
        </svg>
      </a>
    </div>
    <div id="payslipsList" class="space-y-4">
      <!-- Skeleton Payslips -->
      <div
        class="flex items-center space-x-4 p-3 border border-gray-200 rounded-lg"
      >
        <div class="skeleton skeleton-circle"></div>
        <div class="flex-1 space-y-2">
          <div class="skeleton h-4 w-40"></div>
          <div class="skeleton h-3 w-32"></div>
        </div>
        <div class="skeleton h-4 w-20"></div>
      </div>
      <div
        class="flex items-center space-x-4 p-3 border border-gray-200 rounded-lg"
      >
        <div class="skeleton skeleton-circle"></div>
        <div class="flex-1 space-y-2">
          <div class="skeleton h-4 w-36"></div>
          <div class="skeleton h-3 w-28"></div>
        </div>
        <div class="skeleton h-4 w-20"></div>
      </div>
      <div
        class="flex items-center space-x-4 p-3 border border-gray-200 rounded-lg"
      >
        <div class="skeleton skeleton-circle"></div>
        <div class="flex-1 space-y-2">
          <div class="skeleton h-4 w-44"></div>
          <div class="skeleton h-3 w-30"></div>
        </div>
        <div class="skeleton h-4 w-20"></div>
      </div>
    </div>
  </div>

  <!-- Quick Actions -->
  <div class="bg-white shadow-lg p-6 rounded-xl">
    <h3 class="text-lg font-semibold text-gray-800 mb-6">Quick Actions</h3>
    <div class="grid grid-cols-2 gap-4">
      <a
        href="team-performance.html"
        class="bg-teal-50 hover:bg-teal-100 rounded-lg p-4 text-center transition-colors group"
      >
        <div
          class="w-12 h-12 bg-teal-500 rounded-lg flex items-center justify-center mx-auto mb-2 group-hover:bg-teal-600 transition-colors"
        >
          <i class="fas fa-chart-line text-white text-xl"></i>
        </div>
        <p class="font-medium text-teal-700">Team Performance</p>
      </a>
      <a
        href="/staff/communication-team"
        class="bg-blue-50 hover:bg-blue-100 rounded-lg p-4 text-center transition-colors group"
      >
        <div
          class="w-12 h-12 bg-blue-500 rounded-lg flex items-center justify-center mx-auto mb-2 group-hover:bg-blue-600 transition-colors"
        >
          <i class="fas fa-comments text-white text-xl"></i>
        </div>
        <p class="font-medium text-blue-700">Team Communication</p>
      </a>
      <a
        href="schedule.html"
        class="bg-green-50 hover:bg-green-100 rounded-lg p-4 text-center transition-colors group"
      >
        <div
          class="w-12 h-12 bg-green-500 rounded-lg flex items-center justify-center mx-auto mb-2 group-hover:bg-green-600 transition-colors"
        >
          <i class="fas fa-calendar-alt text-white text-xl"></i>
        </div>
        <p class="font-medium text-green-700">View Schedule</p>
      </a>
      <a
        href="financial-reports.html"
        class="bg-purple-50 hover:bg-purple-100 rounded-lg p-4 text-center transition-colors group"
      >
        <div
          class="w-12 h-12 bg-purple-500 rounded-lg flex items-center justify-center mx-auto mb-2 group-hover:bg-purple-600 transition-colors"
        >
          <i class="fas fa-file-alt text-white text-xl"></i>
        </div>
        <p class="font-medium text-purple-700">Financial Reports</p>
      </a>
    </div>
  </div>
</div>
<script>
  const API_BASE = "/api";
  const $ = (id) => document.getElementById(id);
  let chart = null;

  // Notification
  function showNotification(msg, type = "info") {
    const div = Object.assign(document.createElement("div"), {
      className: `fixed top-4 right-4 text-white px-6 py-3 rounded-lg shadow-lg z-50 ${
        type === "error"
          ? "bg-red-500"
          : type === "success"
          ? "bg-green-500"
          : "bg-blue-500"
      }`,
      textContent: msg,
    });
    document.body.appendChild(div);
    setTimeout(() => div.remove(), 3000);
  }

  // Format Date
  function formatDate(date) {
    return dayjs(date).format("MMM YYYY");
  }

  // Render Stats
  function renderStats(stats) {
    const container = $("statsGrid");
    container.innerHTML = `
      <div class="stat-card bg-teal-50 rounded-xl shadow-lg p-6 border border-teal-400">
        <div class="flex items-center justify-between">
          <div>
            <p class="text-teal-600 text-sm font-bold">Open Tickets</p>
            <h3 class="text-3xl font-bold text-gray-800 mt-2">${stats.openTickets}</h3>
          </div>
          <div class="w-12 h-12 bg-teal-100 rounded-lg flex items-center justify-center">
            <i class="fas fa-ticket-alt text-teal-600 text-xl"></i>
          </div>
        </div>
      </div>
      <div class="stat-card bg-blue-50 rounded-xl shadow-lg p-6 border border-blue-400">
        <div class="flex items-center justify-between">
          <div>
            <p class="text-blue-600 text-sm font-bold">Active Tasks</p>
            <h3 class="text-3xl font-bold text-gray-800 mt-2">${stats.activeTasks}</h3>
          </div>
          <div class="w-12 h-12 bg-blue-100 rounded-lg flex items-center justify-center">
            <i class="fas fa-tasks text-blue-600 text-xl"></i>
          </div>
        </div>
      </div>
      <div class="stat-card bg-green-50 rounded-xl shadow-lg p-6 border border-green-400">
        <div class="flex items-center justify-between">
          <div>
            <p class="text-green-600 text-sm font-bold">Tasks Completed</p>
            <h3 class="text-3xl font-bold text-gray-800 mt-2">${stats.completedTasks}</h3>
          </div>
          <div class="w-12 h-12 bg-green-100 rounded-lg flex items-center justify-center">
            <i class="fas fa-check-circle text-green-600 text-xl"></i>
          </div>
        </div>
      </div>
      <div class="stat-card bg-orange-50 rounded-xl shadow-lg p-6 border border-orange-400">
        <div class="flex items-center justify-between">
          <div>
            <p class="text-orange-600 text-sm font-bold">Performance Score</p>
            <h3 class="text-3xl font-bold text-gray-800 mt-2">${stats.performanceScore}%</h3>
          </div>
          <div class="w-12 h-12 bg-orange-100 rounded-lg flex items-center justify-center">
            <i class="fas fa-star-half-alt text-orange-600 text-xl"></i>
          </div>
        </div>
      </div>
    `;
  }

  // Render Tasks
  function renderTasks(tasks) {
    const container = $("tasksList");
    container.innerHTML =
      tasks.length === 0
        ? `<p class="text-gray-500 text-center py-4">No tasks for today.</p>`
        : tasks
            .map(
              (t) => `
        <div class="flex flex-col md:flex-row md:items-center justify-between p-3 bg-gray-50 rounded-lg border border-gray-200">
          <div>
            <p class="font-medium text-gray-800">${t.title} - ${t.client}</p>
            <p class="text-gray-500 text-sm">Address: ${t.address}</p>
            <p class="text-gray-500 text-sm">Time: ${t.time}</p>
          </div>
          <span class="text-${t.statusColor}-600 font-semibold mt-2 md:mt-0">${t.status}</span>
        </div>
      `
            )
            .join("");
  }

  // Render Payslips
  function renderPayslips(payslips) {
    const container = $("payslipsList");
    container.innerHTML =
      payslips.length === 0
        ? `<p class="text-gray-500 text-center py-4">No payslips available.</p>`
        : payslips
            .map(
              (p) => `
        <a href="payslip-single.html?id=${p.id}" class="block">
          <div class="flex items-center space-x-4 p-3 hover:bg-teal-50 border border-gray-200 rounded-lg transition-colors">
            <div class="w-10 h-10 bg-teal-100 rounded-full flex items-center justify-center">
              <i class="fas fa-file-invoice-dollar text-teal-600"></i>
            </div>
            <div class="flex-1">
              <p class="font-medium text-gray-800">${p.month} Salary Payslip</p>
              <p class="text-gray-600 text-sm">Basic + Commission + Allowances</p>
            </div>
            <span class="text-gray-500 text-sm">${formatDate(p.date)}</span>
            <svg class="w-4 h-4 ml-2" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" d="M9 5l7 7-7 7"></path>
            </svg>
          </div>
        </a>
      `
            )
            .join("");
  }

  // Render Chart
  function renderChart(weeklyData) {
    const canvas = $("revenueChart");
    canvas.classList.remove("skeleton");
    const ctx = canvas.getContext("2d");
    if (chart) chart.destroy();
    chart = new Chart(ctx, {
      type: "line",
      data: {
        labels: weeklyData.labels,
        datasets: [
          {
            label: "Performance (%)",
            data: weeklyData.values,
            borderColor: "#0d9488",
            backgroundColor: "rgba(13, 148, 136, 0.1)",
            fill: true,
            tension: 0.3,
          },
        ],
      },
      options: {
        responsive: true,
        maintainAspectRatio: false,
        scales: {
          y: {
            suggestedMin: 0,
            suggestedMax: 100,
            ticks: { callback: (v) => v + "%" },
          },
        },
      },
    });
  }

  // Load Dashboard
  async function loadDashboard() {
    try {
      const [statsRes, tasksRes, payslipsRes, chartRes] = await Promise.all([
        fetch(`${API_BASE}/stats`),
        fetch(`${API_BASE}/tasks/today`),
        fetch(`${API_BASE}/payslips/recent`),
        fetch(`${API_BASE}/performance/weekly`),
      ]);

      const stats = await statsRes.json();
      const tasks = await tasksRes.json();
      const payslips = await payslipsRes.json();
      const chartData = await chartRes.json();

      renderStats(stats);
      renderTasks(tasks);
      renderPayslips(payslips);
      renderChart(chartData);
    } catch (err) {
      console.error("Dashboard load error:", err);
      showNotification("Failed to load dashboard data", "error");
    }
  }

  // Init
  window.onload = loadDashboard;
</script>
