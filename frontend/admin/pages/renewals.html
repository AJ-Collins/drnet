<!DOCTYPE html>
<html lang="en" class="bg-gray-100">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta
      http-equiv="Cache-Control"
      content="no-cache, no-store, must-revalidate"
    />
    <meta http-equiv="Pragma" content="no-cache" />
    <meta http-equiv="Expires" content="0" />
    <meta http-equiv="Last-Modified" content="0" />
    <meta http-equiv="ETag" content="0" />
    <title>Dr.Net Admin Portal - Renewals</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/dayjs@1/dayjs.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css"
    />
    <link rel="stylesheet" href="css/styles.css" />
    <link rel="stylesheet" href="css/ctio-gradients.css" />

    <style>
      /* Professional CTIO Design System */
      .ctio-professional {
        background: #1e293b;
      }

      .ctio-professional-accent {
        background: #0f172a;
      }

      /* Sidebar Styles - Always visible on renewals page */
      .sidebar {
        position: fixed !important;
        top: 0 !important;
        left: 0 !important;
        height: 100vh !important;
        width: 280px !important;
        transform: translateX(0) !important; /* Always visible */
        transition: transform 0.3s ease-in-out;
        z-index: 60 !important;
        backdrop-filter: blur(20px);
        display: flex !important;
        flex-direction: column !important;
      }

      .sidebar.show {
        transform: translateX(0) !important;
      }

      .main-content {
        margin-left: 280px; /* Account for always-visible sidebar */
        transition: margin-left 0.3s ease-in-out;
        position: relative;
        z-index: 1;
      }

      /* Desktop styles */
      @media (min-width: 1024px) {
        .sidebar {
          transform: translateX(0);
          position: fixed;
        }

        .main-content {
          margin-left: 280px;
        }

        .mobile-toggle {
          display: none !important;
        }
      }

      /* Mobile responsive */
      @media (max-width: 1023px) {
        .main-content {
          margin-left: 0 !important;
        }

        .sidebar {
          z-index: 60;
        }
      }

      /* Hover effects - Higher specificity to override external CSS */
      .sidebar .nav-item:hover {
        transform: translateX(8px) !important;
        background: rgba(255, 255, 255, 0.15) !important;
      }

      /* Custom scrollbar */
      .sidebar::-webkit-scrollbar {
        width: 6px;
      }

      .sidebar::-webkit-scrollbar-track {
        background: rgba(255, 255, 255, 0.1);
      }

      .sidebar::-webkit-scrollbar-thumb {
        background: rgba(255, 255, 255, 0.3);
        border-radius: 3px;
      }

      /* Prevent external CSS from interfering with sidebar */
      .sidebar * {
        box-sizing: border-box;
      }

      .sidebar .nav-item {
        position: relative !important;
        overflow: visible !important;
      }

      .sidebar .nav-item::before {
        display: none !important;
      }

      /* Ensure sidebar navigation items maintain proper styling */
      .sidebar nav {
        position: relative !important;
        z-index: 1 !important;
      }
    </style>
  </head>
  <body class="bg-gray-50 min-h-screen">
    <!-- Sidebar -->
    <!-- Mobile backdrop -->
    <div
      id="sidebarBackdrop"
      class="fixed inset-0 bg-black bg-opacity-60 z-40 lg:hidden hidden transition-opacity duration-300"
    ></div>

    <!-- Modern Sidebar -->
    <aside
      id="sidebar"
      class="sidebar ctio-professional shadow-2xl flex flex-col text-white"
    >
      <!-- Sidebar Header -->
      <div class="p-6 border-b border-white/20">
        <div class="flex items-center justify-between">
          <div class="flex items-center space-x-3">
            <div
              class="w-12 h-12 bg-white/20 rounded-xl flex items-center justify-center backdrop-blur-lg"
            >
              <i class="fas fa-network-wired text-xl text-white"></i>
            </div>
            <div>
              <h2 class="text-xl font-bold">DR.NET CTIO</h2>
              <p class="text-white/80 text-sm">Julius Ojwang - CTO</p>
            </div>
          </div>
          <button
            id="closeSidebar"
            class="mobile-toggle text-white/80 hover:text-white p-2 rounded-lg hover:bg-white/10 transition-all duration-200"
          >
            <i class="fas fa-times text-lg"></i>
          </button>
        </div>
      </div>

      <!-- Navigation -->
      <nav class="flex-1 p-4 space-y-2 overflow-y-auto">
        <a
          href="dashboard.html"
          class="nav-item group flex items-center px-4 py-3 rounded-xl transition-all duration-300 hover:bg-white/15 text-white/90 hover:text-white"
        >
          <div
            class="w-10 h-10 bg-white/10 rounded-lg flex items-center justify-center mr-4 group-hover:bg-white/20 transition-all duration-300"
          >
            <i class="fas fa-chart-pie text-lg"></i>
          </div>
          <span class="font-medium">Dashboard</span>
        </a>

        <a
          href="register-user.html"
          class="nav-item group flex items-center px-4 py-3 rounded-xl transition-all duration-300 hover:bg-white/15 text-white/90 hover:text-white"
        >
          <div
            class="w-10 h-10 bg-white/10 rounded-lg flex items-center justify-center mr-4 group-hover:bg-white/20 transition-all duration-300"
          >
            <i class="fas fa-user-plus text-lg"></i>
          </div>
          <span class="font-medium">Register User</span>
        </a>

        <a
          href="manage-users.html"
          class="nav-item group flex items-center px-4 py-3 rounded-xl transition-all duration-300 hover:bg-white/15 text-white/90 hover:text-white"
        >
          <div
            class="w-10 h-10 bg-white/10 rounded-lg flex items-center justify-center mr-4 group-hover:bg-white/20 transition-all duration-300"
          >
            <i class="fas fa-users text-lg"></i>
          </div>
          <span class="font-medium">Manage Users</span>
        </a>

        <a
          href="deleted-users.html"
          class="nav-item group flex items-center px-4 py-3 rounded-xl transition-all duration-300 hover:bg-white/15 text-white/90 hover:text-white"
        >
          <div
            class="w-10 h-10 bg-white/10 rounded-lg flex items-center justify-center mr-4 group-hover:bg-white/20 transition-all duration-300"
          >
            <i class="fas fa-trash text-lg"></i>
          </div>
          <span class="font-medium">Deleted Users</span>
        </a>

        <a
          href="service-assignments.html"
          class="nav-item group flex items-center px-4 py-3 rounded-xl transition-all duration-300 hover:bg-white/15 text-white/90 hover:text-white"
        >
          <div
            class="w-10 h-10 bg-white/10 rounded-lg flex items-center justify-center mr-4 group-hover:bg-white/20 transition-all duration-300"
          >
            <i class="fas fa-tools text-lg"></i>
          </div>
          <span class="font-medium">Service Assignments</span>
        </a>

        <a
          href="support-tickets.html"
          class="nav-item group flex items-center px-4 py-3 rounded-xl transition-all duration-300 hover:bg-white/15 text-white/90 hover:text-white"
        >
          <div
            class="w-10 h-10 bg-white/10 rounded-lg flex items-center justify-center mr-4 group-hover:bg-white/20 transition-all duration-300"
          >
            <i class="fas fa-ticket-alt text-lg"></i>
          </div>
          <span class="font-medium">Support Tickets</span>
        </a>

        <a
          href="renewals.html"
          class="nav-item group flex items-center px-4 py-3 rounded-xl bg-white/20 text-white transition-all duration-300"
        >
          <div
            class="w-10 h-10 bg-white/20 rounded-lg flex items-center justify-center mr-4 transition-all duration-300"
          >
            <i class="fas fa-sync-alt text-lg"></i>
          </div>
          <span class="font-medium">Renewals</span>
        </a>

        <a
          href="invoice-generator.html"
          class="nav-item group flex items-center px-4 py-3 rounded-xl transition-all duration-300 hover:bg-white/15 text-white/90 hover:text-white"
        >
          <div
            class="w-10 h-10 bg-white/10 rounded-lg flex items-center justify-center mr-4 group-hover:bg-white/20 transition-all duration-300"
          >
            <i class="fas fa-file-invoice-dollar text-lg"></i>
          </div>
          <span class="font-medium">Finance and Reports</span>
        </a>

        <a
          href="website-bookings.html"
          class="nav-item group flex items-center px-4 py-3 rounded-xl transition-all duration-300 hover:bg-white/15 text-white/90 hover:text-white"
        >
          <div
            class="w-10 h-10 bg-white/10 rounded-lg flex items-center justify-center mr-4 group-hover:bg-white/20 transition-all duration-300"
          >
            <i class="fas fa-globe text-lg"></i>
          </div>
          <span class="font-medium">Website Bookings</span>
        </a>

        <a
          href="team-communication.html"
          class="nav-item group flex items-center px-4 py-3 rounded-xl transition-all duration-300 hover:bg-white/15 text-white/90 hover:text-white"
        >
          <div
            class="w-10 h-10 bg-white/10 rounded-lg flex items-center justify-center mr-4 group-hover:bg-white/20 transition-all duration-300"
          >
            <i class="fas fa-comments text-lg"></i>
          </div>
          <span class="font-medium">Team Communication</span>
        </a>

        <a
          href="settings.html"
          class="nav-item group flex items-center px-4 py-3 rounded-xl transition-all duration-300 hover:bg-white/15 text-white/90 hover:text-white"
        >
          <div
            class="w-10 h-10 bg-white/10 rounded-lg flex items-center justify-center mr-4 group-hover:bg-white/20 transition-all duration-300"
          >
            <i class="fas fa-cog text-lg"></i>
          </div>
          <span class="font-medium">Settings</span>
        </a>
      </nav>
    </aside>

    <!-- Main Content -->
    <main
      class="main-content min-h-screen bg-gradient-to-br from-slate-50 via-blue-50 to-indigo-50"
    >
      <!-- Modern Responsive Header -->
      <header
        class="bg-white/80 backdrop-blur-lg shadow-lg border-b border-white/20 sticky top-0 z-30"
      >
        <div class="px-4 sm:px-6 lg:px-8 py-4">
          <div class="flex items-center justify-between">
            <!-- Left Section -->
            <div class="flex items-center space-x-4">
              <button
                id="toggleSidebar"
                class="mobile-toggle p-2 rounded-xl bg-gradient-to-r from-blue-500 to-purple-600 text-white hover:from-blue-600 hover:to-purple-700 transition-all duration-200 shadow-lg"
              >
                <i class="fas fa-bars text-lg"></i>
              </button>
              <div>
                <h1
                  class="text-xl sm:text-2xl lg:text-3xl font-bold bg-gradient-to-r from-blue-600 to-purple-600 bg-clip-text text-transparent"
                >
                  Renewals
                </h1>
                <p class="text-sm text-gray-600 hidden sm:block">
                  Subscription & Service Renewals
                </p>
              </div>
            </div>

            <!-- Right Section -->
            <div class="flex items-center space-x-4">
              <!-- User Profile -->
              <div class="flex items-center space-x-2">
              </div>
            </div>
          </div>
        </div>
      </header>

      <!-- Content Area -->
      <div class="p-4 sm:p-6 lg:p-8">
        <section id="renewals" class="space-y-6 lg:space-y-8">
          <div class="flex justify-between items-center">
            <h3
              class="text-2xl font-bold bg-gradient-to-r from-purple-600 to-blue-600 bg-clip-text text-transparent"
            >
              Renewal Management
            </h3>
            <button
              onclick="exportRenewalsToCSV()"
              class="bg-gradient-to-r from-indigo-600 to-purple-600 text-white px-6 py-3 rounded-xl hover:from-indigo-700 hover:to-purple-700 transition-all duration-300 font-semibold shadow-lg transform hover:-translate-y-1"
            >
              <span class="mr-2">ðŸ“¥</span> Export to CSV
            </button>
          </div>

          <!-- Quick Renewal Form -->
          <div class="bg-white/80 backdrop-blur-sm p-8 rounded-2xl shadow-lg">
            <h4 class="text-xl font-semibold text-gray-800 mb-6">
              ðŸ”„ Quick User Renewal
            </h4>
            <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
              <div>
                <label class="block text-sm font-semibold text-gray-700 mb-2"
                  >Select User</label
                >
                <select
                  id="renewalUser"
                  class="w-full p-4 rounded-xl border-2 border-gray-200 focus:border-indigo-500 focus:ring-4 focus:ring-indigo-100"
                >
                  <option value="">Choose a user...</option>
                </select>
              </div>
              <div>
                <label class="block text-sm font-semibold text-gray-700 mb-2"
                  >Renewal Amount (Ksh)</label
                >
                <input
                  id="renewalAmount"
                  type="number"
                  placeholder="Enter amount"
                  class="w-full p-4 rounded-xl border-2 border-gray-200 focus:border-indigo-500 focus:ring-4 focus:ring-indigo-100"
                />
              </div>
              <div class="flex items-end">
                <button
                  onclick="processQuickRenewal()"
                  class="w-full bg-gradient-to-r from-green-500 to-green-600 text-white px-6 py-4 rounded-xl hover:from-green-600 hover:to-green-700 transition font-semibold transform hover:-translate-y-1"
                >
                  ðŸ”„ Renew Now
                </button>
              </div>
            </div>
          </div>

          <!-- Renewals Summary -->
          <div class="bg-white/80 backdrop-blur-sm p-8 rounded-2xl shadow-lg">
            <h4
              id="renewalsSummaryTitle"
              class="text-xl font-semibold text-gray-800 mb-6"
            >
              ðŸ’° Renewals Summary
            </h4>
            <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-6">
              <div
                class="text-center p-6 bg-gradient-to-r from-green-50 to-green-100 rounded-xl border border-green-200"
              >
                <p id="renewalsCount" class="text-3xl font-bold text-green-600">
                  0
                </p>
                <p class="text-sm text-gray-600 font-medium">
                  Renewals This Month
                </p>
              </div>
              <div
                class="text-center p-6 bg-gradient-to-r from-blue-50 to-blue-100 rounded-xl border border-blue-200"
              >
                <p
                  id="renewalsRevenue"
                  class="text-3xl font-bold text-blue-600"
                >
                  Ksh 0
                </p>
                <p class="text-sm text-gray-600 font-medium">Total Revenue</p>
              </div>
              <div
                class="text-center p-6 bg-gradient-to-r from-yellow-50 to-yellow-100 rounded-xl border border-yellow-200"
              >
                <p
                  id="renewalsAverage"
                  class="text-3xl font-bold text-yellow-600"
                >
                  0
                </p>
                <p class="text-sm text-gray-600 font-medium">
                  Average Per Renewal
                </p>
              </div>
            </div>
            <hr class="my-6 border-gray-200" />
            <div>
              <h5 class="font-semibold text-gray-800 mb-4">Recent Renewals</h5>
              <div id="recentRenewalsList" class="space-y-3"></div>
            </div>
          </div>

          <!-- All Renewals -->
          <div class="bg-white/80 backdrop-blur-sm p-8 rounded-2xl shadow-lg">
            <h4 class="text-xl font-semibold text-gray-800 mb-6">
              ðŸ“‹ All Renewals
            </h4>
            <div class="mb-6 flex flex-col md:flex-row md:items-center gap-4">
              <div class="flex-1">
                <input
                  id="renewalSearchInput"
                  type="text"
                  placeholder="Search by name, phone, or location..."
                  class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 bg-white text-gray-900"
                />
              </div>
              <div class="flex gap-4">
                <select
                  id="renewalSubscriptionFilter"
                  class="p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 bg-white text-gray-900"
                >
                  <option value="all">All Subscriptions</option>
                  <option value="paid">Paid</option>
                  <option value="unpaid">Unpaid</option>
                </select>
                <select
                  id="renewalStatusFilter"
                  class="p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 bg-white text-gray-900"
                >
                  <option value="all">All Statuses</option>
                  <option value="active">Active</option>
                  <option value="expired">Expired</option>
                </select>
              </div>
            </div>
            <div id="allRenewalsList" class="relative z-10 space-y-4"></div>
          </div>
        </section>
      </div>
    </main>

    <script>
      // Modern Sidebar Toggle Functionality
      function initSidebarToggle() {
        const sidebar = document.getElementById("sidebar");
        const toggleSidebar = document.getElementById("toggleSidebar");
        const closeSidebar = document.getElementById("closeSidebar");
        const backdrop = document.getElementById("sidebarBackdrop");

        function showSidebar() {
          sidebar.classList.add("show");
          // backdrop.classList.remove("hidden"); // No backdrop needed
          // document.body.style.overflow = "hidden"; // No need to prevent scrolling
        }

        function hideSidebar() {
          // Don't actually hide the sidebar on renewals page
          // sidebar.classList.remove("show");
          // backdrop.classList.add("hidden");
          // document.body.style.overflow = "";
        }

        if (toggleSidebar) {
          toggleSidebar.addEventListener("click", showSidebar);
        }

        if (closeSidebar) {
          closeSidebar.addEventListener("click", hideSidebar);
        }

        // Remove backdrop click to close functionality to keep sidebar always open
        // if (backdrop) {
        //   backdrop.addEventListener("click", hideSidebar);
        // }

        // Remove escape key to close functionality to keep sidebar always open
        // document.addEventListener("keydown", (e) => {
        //   if (e.key === "Escape" && !sidebar.classList.contains("hidden")) {
        //     hideSidebar();
        //   }
        // });

        // Handle window resize - keep sidebar open on all screen sizes
        window.addEventListener("resize", () => {
          // Always keep sidebar open on renewals page
          if (!sidebar.classList.contains("show")) {
            showSidebar();
          }
        });

        // Keep sidebar open on renewals page for better UX
        // Auto-show sidebar on page load for all screen sizes
        setTimeout(() => {
          showSidebar();
        }, 100);

        // Prevent sidebar from closing when clicking navigation links
        const navLinks = document.querySelectorAll('.nav-item');
        navLinks.forEach(link => {
          link.addEventListener('click', (e) => {
            // Don't close sidebar when clicking on renewals link
            if (link.getAttribute('href') === 'renewals.html') {
              e.preventDefault();
              // Keep sidebar open, just update active state
              navLinks.forEach(nav => nav.classList.remove('bg-white/20', 'text-white'));
              navLinks.forEach(nav => nav.classList.add('text-white/90'));
              link.classList.remove('text-white/90');
              link.classList.add('bg-white/20', 'text-white');
            }
          });
        });
      }

      // Initialize when DOM loads
      document.addEventListener("DOMContentLoaded", initSidebarToggle);
    </script>

    <script src="js/config.js"></script>
    <script src="js/common.js"></script>
    <script src="js/renewals.js"></script>
  </body>
</html>
