<H1>Coming soon</H1>
<!-- <style>
    .comm-card { border-left: 4px solid transparent; transition: all 0.2s; }
    .comm-card.priority-high { border-left-color: #f43f5e; } 
    .comm-card.priority-med { border-left-color: #f59e0b; } 
    .comm-card.priority-low { border-left-color: #10b981; } 
    
    .comm-card:hover { background-color: #f8fafc; }
    .comm-card.active { background-color: #f0fdfa; border-right: 3px solid #0d9488; }
    
    .status-badge { padding: 2px 8px; border-radius: 99px; font-size: 10px; font-bold: 700; text-transform: uppercase; }
    .status-pending { background: #fff7ed; color: #c2410c; border: 1px solid #ffedd5; }
    .status-approved { background: #f0fdf4; color: #15803d; border: 1px solid #dcfce7; }
    .status-draft { background: #f1f5f9; color: #475569; border: 1px solid #e2e8f0; }

    .msg-bubble { max-width: 75%; padding: 12px 16px; position: relative; font-size: 13px; line-height: 1.5; }
    .msg-in { border-radius: 12px 12px 12px 0; background: white; border: 1px solid #e2e8f0; color: #334155; }
    .msg-out { border-radius: 12px 12px 0 12px; background: #ccfbf1; color: #115e59; margin-left: auto; }
    .msg-draft { border-radius: 12px 12px 0 12px; background: #fff1f2; border: 1px dashed #f43f5e; color: #881337; margin-left: auto; }
    
    .event-card { background: #f0f9ff; border: 1px solid #bae6fd; border-radius: 12px; padding: 12px; display: flex; gap: 12px; align-items: center; margin: 12px auto; max-width: 80%; }
    
    .modal-enter { animation: fadeIn 0.2s ease-out forwards; }
    @keyframes fadeIn { from { opacity: 0; transform: scale(0.95); } to { opacity: 1; transform: scale(1); } }
</style>

<div class="flex flex-1 min-h-0 bg-[#fbfcfd]">
    
    <div id="localToast" class="absolute top-4 right-4 z-50 flex flex-col gap-2"></div>

    <div class="flex flex-1 overflow-hidden min-h-0">
        
        <main class="flex-1 flex flex-col bg-[#f8fafc] overflow-hidden order-1 min-h-0">
            
            <div id="threadHeader" class="h-16 border-b bg-white flex items-center justify-between px-6 shrink-0 z-10 shadow-sm">
                <div class="flex items-center gap-3">
                    <div class="w-10 h-10 rounded-full bg-slate-200 animate-pulse"></div> 
                </div>
            </div>

            <div id="messageStream" class="flex-1 overflow-y-auto min-h-0 p-6 space-y-4 custom-scrollbar">
                <div class="h-full flex flex-col items-center justify-center text-slate-400 opacity-50">
                    <i class="far fa-comments text-4xl mb-2"></i>
                    <p class="text-xs font-bold uppercase">Select a conversation</p>
                </div>
            </div>

            <div id="actionArea" class="bg-white border-t p-6 shrink-0 hidden">
                <div class="flex gap-2 mb-3 overflow-x-auto pb-2 custom-scrollbar">
                    <span class="text-[9px] font-bold text-slate-400 uppercase self-center mr-2">Templates:</span>
                    <button onclick="useTemplate('meeting')" class="whitespace-nowrap px-3 py-1.5 bg-slate-50 border border-slate-200 rounded-lg text-[10px] font-bold text-slate-600 hover:bg-teal-50 hover:text-teal-700 hover:border-teal-200 transition-colors">
                        <i class="fas fa-calendar-check mr-1"></i> Schedule Meeting
                    </button>
                    <button onclick="useTemplate('quote')" class="whitespace-nowrap px-3 py-1.5 bg-slate-50 border border-slate-200 rounded-lg text-[10px] font-bold text-slate-600 hover:bg-teal-50 hover:text-teal-700 hover:border-teal-200 transition-colors">
                        <i class="fas fa-file-invoice mr-1"></i> Request Quote
                    </button>
                    <button onclick="useTemplate('update')" class="whitespace-nowrap px-3 py-1.5 bg-slate-50 border border-slate-200 rounded-lg text-[10px] font-bold text-slate-600 hover:bg-teal-50 hover:text-teal-700 hover:border-teal-200 transition-colors">
                        <i class="fas fa-info-circle mr-1"></i> Status Update
                    </button>
                </div>

                <div class="relative group">
                    <textarea id="responseDraft" placeholder="Draft response for executive approval..." 
                              class="w-full p-4 pr-32 bg-slate-50 border border-slate-200 rounded-2xl outline-none focus:bg-white focus:border-teal-500 focus:ring-4 focus:ring-teal-500/10 transition-all h-28 resize-none text-sm text-slate-700"></textarea>
                    
                    <div class="absolute bottom-3 right-3 flex gap-2">
                        <button onclick="saveAsDraft()" class="px-3 py-1.5 text-[10px] font-bold text-slate-500 bg-slate-200 rounded-lg hover:bg-slate-300 transition-colors">
                            SAVE DRAFT
                        </button>
                        <button onclick="requestApproval()" class="px-4 py-1.5 text-[10px] font-bold text-white bg-slate-900 rounded-lg shadow-lg hover:bg-teal-600 hover:shadow-teal-500/30 transition-all flex items-center">
                            REQUEST APPROVAL <i class="fas fa-paper-plane ml-2"></i>
                        </button>
                    </div>
                </div>
            </div>
        </main>

        <aside class="bg-white border-l border-slate-200 flex flex-col w-[320px] shrink-0 overflow-hidden order-2 min-h-0">
            <div class="p-5 border-b shrink-0">
                <div class="flex justify-between items-center mb-4">
                    <div>
                        <h2 class="text-lg font-black text-slate-900">Coordination</h2>
                        <p class="text-[10px] text-slate-400 font-bold uppercase">Executive Support Inbox</p>
                    </div>
                    <button class="w-8 h-8 rounded-full bg-slate-100 hover:bg-slate-200 text-slate-500 flex items-center justify-center">
                        <i class="fas fa-filter text-xs"></i>
                    </button>
                </div>
                <div class="flex bg-slate-100 p-1 rounded-lg">
                    <button onclick="filterInbox('active')" id="tab-active" class="flex-1 py-1.5 bg-white shadow-sm rounded-md text-[10px] font-bold text-teal-700">ACTIVE</button>
                    <button onclick="filterInbox('pending')" id="tab-pending" class="flex-1 py-1.5 text-[10px] font-bold text-slate-500 hover:text-slate-700">PENDING</button>
                </div>
            </div>
            
            <div class="flex-1 overflow-y-auto min-h-0 custom-scrollbar" id="commInboxList">
                </div>
        </aside>

    </div>

    <div id="meetingModal" class="hidden absolute inset-0 bg-slate-900/60 backdrop-blur-sm z-[60] flex items-center justify-center modal-enter">
        <div class="bg-white rounded-2xl w-[400px] shadow-2xl p-6">
            <div class="flex justify-between items-center mb-6">
                <h3 class="font-bold text-slate-800">Schedule Meeting</h3>
                <button onclick="toggleModal('meetingModal', false)" class="text-slate-400 hover:text-slate-600"><i class="fas fa-times"></i></button>
            </div>
            
            <div class="space-y-4">
                <div>
                    <label class="text-[10px] font-bold text-slate-400 uppercase">Type</label>
                    <select id="meetType" class="w-full mt-1 p-2 bg-slate-50 border rounded-lg text-sm outline-none">
                        <option value="Site Visit">üèóÔ∏è Site Visit</option>
                        <option value="Strategy Call">üìû Strategy Call</option>
                        <option value="Vendor Negotiation">ü§ù Vendor Negotiation</option>
                    </select>
                </div>
                <div>
                    <label class="text-[10px] font-bold text-slate-400 uppercase">Date & Time</label>
                    <input type="datetime-local" id="meetDate" class="w-full mt-1 p-2 bg-slate-50 border rounded-lg text-sm outline-none">
                </div>
                <div>
                    <label class="text-[10px] font-bold text-slate-400 uppercase">Agenda / Note</label>
                    <input type="text" id="meetNote" placeholder="e.g. Discuss cement pricing" class="w-full mt-1 p-2 bg-slate-50 border rounded-lg text-sm outline-none">
                </div>
                
                <button onclick="confirmMeeting()" class="w-full py-3 bg-teal-600 hover:bg-teal-700 text-white font-bold rounded-xl text-xs mt-2 shadow-lg shadow-teal-500/20">
                    CONFIRM & ADD TO THREAD
                </button>
            </div>
        </div>
    </div>
</div>

<script>
    // --- 1. MOCK DATA STORE & API SERVICE ---
    const api = {
        data: [
            {
                id: 101,
                contact: "Eng. Mwangi",
                role: "Lead Contractor",
                org: "BuildRight Ltd",
                channel: "WhatsApp",
                priority: "high",
                status: "active",
                avatar: "M",
                history: [
                    { id: 1, type: 'in', text: "We are ready to pour the slab. The cement truck arrives at 8 PM tonight. Need confirmation.", time: "10:15 AM" },
                    { id: 2, type: 'draft', text: "Noted Eng. I will inform the security team to let them in.", time: "10:30 AM", status: 'draft' }
                ]
            },
            {
                id: 102,
                contact: "Alice Kamau",
                role: "HR Manager",
                org: "Internal",
                channel: "Email",
                priority: "med",
                status: "active",
                avatar: "A",
                history: [
                    { id: 1, type: 'in', text: "Please review the draft memo for the weekend maintenance schedule.", time: "Yesterday" }
                ]
            },
            {
                id: 103,
                contact: "Fundi John",
                role: "Plumbing Lead",
                org: "Freelance",
                channel: "Phone",
                priority: "low",
                status: "active",
                avatar: "J",
                history: [
                    { id: 1, type: 'event', title: "Site Visit Scheduled", date: "Dec 25, 2:00 PM", note: "Inspect leak in Unit 4" },
                    { id: 2, type: 'out', text: "See you then, John.", time: "Yesterday" }
                ]
            }
        ],

        getThreads: async () => new Promise(resolve => setTimeout(() => resolve(api.data), 100)),

        saveMessage: async (threadId, msgData) => {
            const thread = api.data.find(t => t.id === threadId);
            if(thread) {
                thread.history.push(msgData);
                const idx = api.data.indexOf(thread);
                api.data.splice(idx, 1);
                api.data.unshift(thread);
                return true;
            }
            return false;
        }
    };

    // --- 2. APP STATE ---
    let state = {
        threads: [],
        activeThreadId: null,
        filter: 'active' 
    };

    // --- 3. INITIALIZATION ---
    window.onload = async () => {
        await refreshData();
    };

    async function refreshData() {
        state.threads = await api.getThreads();
        renderInbox();
        if(state.activeThreadId) openThread(state.activeThreadId);
    }

    // --- 4. VIEW LOGIC: INBOX ---
    function renderInbox() {
        const list = document.getElementById('commInboxList');
        const filterBtnActive = document.getElementById('tab-active');
        const filterBtnPending = document.getElementById('tab-pending');

        if(state.filter === 'active') {
            filterBtnActive.className = "flex-1 py-1.5 bg-white shadow-sm rounded-md text-[10px] font-bold text-teal-700 transition-all";
            filterBtnPending.className = "flex-1 py-1.5 text-[10px] font-bold text-slate-500 hover:text-slate-700 transition-all";
        } else {
            filterBtnPending.className = "flex-1 py-1.5 bg-white shadow-sm rounded-md text-[10px] font-bold text-teal-700 transition-all";
            filterBtnActive.className = "flex-1 py-1.5 text-[10px] font-bold text-slate-500 hover:text-slate-700 transition-all";
        }

        let filtered = state.threads.filter(t => state.filter === 'active' ? true : false);
        if (state.filter === 'pending') {
            filtered = state.threads.filter(t => t.history.some(m => m.type === 'draft' && m.status === 'pending'));
        }

        list.innerHTML = filtered.map(t => {
            const lastMsg = t.history[t.history.length - 1];
            const isPending = t.history.some(m => m.type === 'draft' && m.status === 'pending');
            
            return `
            <div onclick="openThread(${t.id})" class="comm-card p-4 border-b border-slate-100 cursor-pointer priority-${t.priority} ${state.activeThreadId === t.id ? 'active' : ''}">
                <div class="flex justify-between items-start mb-1">
                    <h4 class="font-bold text-sm text-slate-800">${t.contact}</h4>
                    <span class="text-[9px] font-bold text-slate-400">${lastMsg?.time || 'Now'}</span>
                </div>
                <div class="flex items-center gap-2 mb-2">
                    <span class="text-[9px] font-bold uppercase text-slate-500 bg-slate-100 px-1.5 rounded">${t.role}</span>
                    ${isPending ? '<span class="status-badge status-pending">Needs Approval</span>' : ''}
                </div>
                <div class="flex items-center gap-2 text-slate-500">
                    <i class="fab fa-${t.channel.toLowerCase()} text-[10px]"></i>
                    <p class="text-xs truncate flex-1 opacity-80">${lastMsg?.text || (lastMsg?.title ? 'Event: ' + lastMsg.title : 'Attachment')}</p>
                </div>
            </div>`;
        }).join('');
    }

    function filterInbox(type) {
        state.filter = type;
        renderInbox();
    }

    // --- 5. VIEW LOGIC: THREAD & CHAT ---
    function openThread(id) {
        state.activeThreadId = id;
        const t = state.threads.find(x => x.id === id);
        if(!t) return;

        document.getElementById('threadHeader').innerHTML = `
            <div class="flex items-center gap-4">
                <div class="w-10 h-10 bg-gradient-to-br from-teal-500 to-slate-800 text-white rounded-full flex items-center justify-center font-bold shadow-md">${t.avatar}</div>
                <div>
                    <h3 class="font-bold text-slate-900 leading-tight">${t.contact}</h3>
                    <p class="text-[10px] text-slate-500 uppercase font-bold tracking-wide">${t.role} @ ${t.org} ‚Ä¢ via ${t.channel}</p>
                </div>
            </div>
            <div class="flex gap-2">
                <button onclick="showToast('Calling', 'Initiating call via ${t.channel}...')" class="w-8 h-8 rounded-lg border border-slate-200 text-slate-400 hover:text-teal-600 hover:bg-teal-50 flex items-center justify-center transition-colors"><i class="fas fa-phone"></i></button>
                <button class="w-8 h-8 rounded-lg border border-slate-200 text-slate-400 hover:text-teal-600 hover:bg-teal-50 flex items-center justify-center transition-colors"><i class="fas fa-ellipsis-v"></i></button>
            </div>
        `;

        const stream = document.getElementById('messageStream');
        stream.innerHTML = t.history.map(m => {
            if(m.type === 'event') {
                return `
                <div class="event-card">
                    <div class="w-10 h-10 bg-blue-100 rounded-lg flex items-center justify-center text-blue-600"><i class="fas fa-calendar-alt text-lg"></i></div>
                    <div class="flex-1">
                        <p class="text-xs font-bold text-slate-700 uppercase">System Event</p>
                        <p class="font-bold text-slate-900 text-sm">${m.title}</p>
                        <p class="text-xs text-slate-500">${m.date} ‚Ä¢ ${m.note}</p>
                    </div>
                </div>`;
            }
            
            if(m.type === 'draft') {
                const badge = m.status === 'pending' 
                    ? `<div class="flex justify-between items-center mb-1 pb-1 border-b border-rose-200"><span class="text-[9px] font-black uppercase text-rose-600">Pending Exec Approval</span> <i class="fas fa-clock text-rose-400 text-[10px]"></i></div>`
                    : `<div class="flex justify-between items-center mb-1 pb-1 border-b border-rose-200"><span class="text-[9px] font-black uppercase text-rose-400">Draft</span></div>`;
                
                return `
                <div class="flex w-full mb-2">
                    <div class="msg-bubble msg-draft">
                        ${badge}
                        ${m.text}
                        <span class="block text-[9px] text-right mt-1 opacity-50">${m.time}</span>
                    </div>
                </div>`;
            }

            return `
            <div class="flex w-full mb-2 ${m.type === 'out' ? 'justify-end' : 'justify-start'}">
                <div class="msg-bubble ${m.type === 'out' ? 'msg-out' : 'msg-in'}">
                    ${m.text}
                    <span class="block text-[9px] text-right mt-1 opacity-50">${m.time}</span>
                </div>
            </div>`;
        }).join('');

        document.getElementById('actionArea').classList.remove('hidden');
        renderInbox(); 
        stream.scrollTop = stream.scrollHeight;
    }

    // --- 6. ACTION LOGIC ---
    async function saveAsDraft() {
        const input = document.getElementById('responseDraft');
        if(!input.value.trim()) return showToast("Error", "Draft cannot be empty");

        const newMsg = {
            id: Date.now(),
            type: 'draft',
            text: input.value,
            time: new Date().toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'}),
            status: 'draft'
        };

        await api.saveMessage(state.activeThreadId, newMsg);
        input.value = '';
        showToast("Success", "Saved to drafts locally.");
        await refreshData();
    }

    async function requestApproval() {
        const input = document.getElementById('responseDraft');
        if(!input.value.trim()) return showToast("Error", "Message cannot be empty");

        const newMsg = {
            id: Date.now(),
            type: 'draft',
            text: input.value,
            time: new Date().toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'}),
            status: 'pending'
        };

        await api.saveMessage(state.activeThreadId, newMsg);
        input.value = '';
        showToast("Sent for Approval", "Executive notified via Dashboard.");
        await refreshData();
    }

    function useTemplate(type) {
        const tmpl = {
            meeting: "Hi, I'd like to schedule a site visit to discuss progress. Are you available on [Date] at [Time]?",
            quote: "Could you please send over the updated quotation for the additional materials we discussed?",
            update: "Please provide a brief status update on the current phase. We need to report to the client by EOD."
        };
        const input = document.getElementById('responseDraft');
        input.value = tmpl[type] || "";
        input.focus();
        if(type === 'meeting') toggleModal('meetingModal', true);
    }

    function toggleModal(id, show) {
        const el = document.getElementById(id);
        if(show) el.classList.remove('hidden');
        else el.classList.add('hidden');
    }

    async function confirmMeeting() {
        const type = document.getElementById('meetType').value;
        const date = document.getElementById('meetDate').value;
        const note = document.getElementById('meetNote').value;

        if(!date) return showToast("Error", "Please select a date.");

        const eventMsg = {
            id: Date.now(),
            type: 'event',
            title: type,
            date: new Date(date).toLocaleString(),
            note: note,
            time: "Just now"
        };

        await api.saveMessage(state.activeThreadId, eventMsg);
        toggleModal('meetingModal', false);
        showToast("Scheduled", "Meeting added to thread.");
        await refreshData();
    }

    function showToast(title, msg) {
        const container = document.getElementById('localToast');
        const t = document.createElement('div');
        t.className = "bg-slate-900 text-white p-4 rounded-xl shadow-2xl border-l-4 border-teal-500 animate-[slideIn_0.3s_ease-out] min-w-[250px]";
        t.innerHTML = `<h5 class="text-[10px] font-black text-teal-400 uppercase tracking-widest mb-1">${title}</h5><p class="text-xs text-slate-300 font-medium">${msg}</p>`;
        container.appendChild(t);
        setTimeout(() => t.remove(), 3500);
    }
</script> -->