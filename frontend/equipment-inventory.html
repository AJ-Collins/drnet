<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Dr.Net CTIO - Equipment & Tools Inventory</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <script src="https://cdn.jsdelivr.net/npm/dayjs@1/dayjs.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/dayjs@1/plugin/relativeTime.js"></script>
    <script>
      dayjs.extend(window.dayjs_plugin_relativeTime);
    </script>
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css"
    />
    <link rel="stylesheet" href="css/styles.css" />

    <style>
      /* Professional CTIO Design System */
      .ctio-professional {
        background: #1e293b;
      }

      /* Sidebar Styles */
      .sidebar {
        position: fixed;
        top: 0;
        left: 0;
        height: 100vh;
        width: 280px;
        transform: translateX(-100%);
        transition: transform 0.3s ease-in-out;
        z-index: 60;
        backdrop-filter: blur(20px);
      }

      .sidebar.show {
        transform: translateX(0);
      }

      .main-content {
        margin-left: 0;
        transition: margin-left 0.3s ease-in-out;
      }

      /* Desktop styles */
      @media (min-width: 1024px) {
        .sidebar {
          transform: translateX(0);
          position: fixed;
        }

        .main-content {
          margin-left: 280px;
        }

        .mobile-toggle {
          display: none !important;
        }
      }

      /* Hover effects */
      .nav-item:hover {
        transform: translateX(8px);
        background: rgba(255, 255, 255, 0.15);
      }
    </style>
  </head>
  <body class="bg-gray-50 min-h-screen">
    <!-- Mobile backdrop -->
    <div
      id="sidebarBackdrop"
      class="fixed inset-0 bg-black bg-opacity-60 z-40 lg:hidden hidden transition-opacity duration-300"
    ></div>

    <!-- Sidebar -->
    <aside
      class="sidebar bg-gradient-to-b from-slate-800 via-blue-900 to-indigo-900 text-white overflow-y-auto shadow-2xl"
    >
      <!-- Logo and Brand -->
      <div class="p-6 border-b border-white/20">
        <div class="flex items-center space-x-3">
          <div class="w-10 h-10 bg-white/20 rounded-lg flex items-center justify-center">
            <i class="fas fa-network-wired text-white text-lg"></i>
          </div>
          <div>
            <h1 class="text-xl font-bold">Dr.Net CTIO</h1>
            <p class="text-white/70 text-sm">Technology Labs</p>
          </div>
        </div>
      </div>

      <!-- Navigation Menu -->
      <nav class="p-4 space-y-2 flex-1">
        <a
          href="dashboard.html"
          class="nav-item group flex items-center px-4 py-3 rounded-xl transition-all duration-300 hover:bg-white/15 text-white/90 hover:text-white"
        >
          <div
            class="w-10 h-10 bg-white/10 rounded-lg flex items-center justify-center mr-4 group-hover:bg-white/20 transition-all duration-300"
          >
            <i class="fas fa-tachometer-alt text-lg"></i>
          </div>
          <span class="font-medium">Dashboard</span>
        </a>
        <a
          href="equipment-inventory.html"
          class="nav-item group flex items-center px-4 py-3 rounded-xl bg-white/20 text-white transition-all duration-300"
        >
          <div
            class="w-10 h-10 bg-white/20 rounded-lg flex items-center justify-center mr-4 transition-all duration-300"
          >
            <i class="fas fa-tools text-lg"></i>
          </div>
          <span class="font-medium">Equipment & Tools</span>
        </a>
        <a
          href="team-communication.html"
          class="nav-item group flex items-center px-4 py-3 rounded-xl transition-all duration-300 hover:bg-white/15 text-white/90 hover:text-white"
        >
          <div
            class="w-10 h-10 bg-white/10 rounded-lg flex items-center justify-center mr-4 group-hover:bg-white/20 transition-all duration-300"
          >
            <i class="fas fa-comments text-lg"></i>
          </div>
          <span class="font-medium">Team Communication</span>
        </a>
        <a
          href="settings.html"
          class="nav-item group flex items-center px-4 py-3 rounded-xl transition-all duration-300 hover:bg-white/15 text-white/90 hover:text-white"
        >
          <div
            class="w-10 h-10 bg-white/10 rounded-lg flex items-center justify-center mr-4 group-hover:bg-white/20 transition-all duration-300"
          >
            <i class="fas fa-cog text-lg"></i>
          </div>
          <span class="font-medium">Settings</span>
        </a>
      </nav>

      <!-- User Profile Section -->
      <div class="p-4 border-t border-white/20">
        <div class="flex items-center space-x-3 mb-4">
          <div
            class="w-10 h-10 bg-indigo-500 rounded-full flex items-center justify-center"
          >
            <span class="text-white font-bold text-lg">JO</span>
          </div>
          <div>
            <p class="text-sm font-medium">Julius Ojwang</p>
            <p class="text-white/70 text-xs">Chief Technology Officer</p>
          </div>
        </div>
        <button
          onclick="logout()"
          class="w-full bg-red-600/80 hover:bg-red-600 text-white px-4 py-2 rounded-lg transition-all duration-200 flex items-center justify-center space-x-2"
        >
          <i class="fas fa-sign-out-alt"></i>
          <span>Log Out</span>
        </button>
      </div>
    </aside>

    <!-- Mobile Menu Toggle -->
    <button
      id="toggleSidebar"
      class="mobile-toggle fixed top-6 left-6 z-50 bg-white/20 backdrop-blur-lg text-gray-800 p-3 rounded-xl shadow-lg hover:bg-white/30 transition-all duration-300 lg:hidden"
    >
      <i class="fas fa-bars text-lg"></i>
    </button>

    <!-- Main Content -->
    <main class="main-content min-h-screen">
      <!-- Header -->
      <div class="bg-white shadow-sm border-b p-6">
        <div class="flex items-center justify-between">
          <div>
            <h1 class="text-3xl font-bold text-gray-900 mb-2 flex items-center">
              <i class="fas fa-tools mr-3 text-blue-600"></i>
              Equipment & Tools Inventory
            </h1>
            <p class="text-gray-600">
              Manage equipment inventory, track quantities, and oversee priority restocking as CTIO
            </p>
          </div>
          <div class="flex items-center space-x-4">
            <div class="flex items-center space-x-2 text-sm">
              <div
                class="w-3 h-3 bg-green-500 rounded-full animate-pulse"
              ></div>
              <span class="text-gray-600">System Active</span>
            </div>
          </div>
        </div>
      </div>

      <!-- Equipment Inventory Content -->
      <div class="p-6">
        <div class="bg-white rounded-lg shadow-sm border">
          <div class="px-6 py-4 border-b border-gray-200">
            <div class="flex flex-col sm:flex-row sm:items-center sm:justify-between space-y-3 sm:space-y-0">
              <div>
                <h2 class="text-lg font-semibold text-gray-900">Inventory Management</h2>
                <p class="text-sm text-gray-500">Full CTIO access to equipment inventory with priority management</p>
              </div>
              <div class="flex space-x-3">
                <button onclick="downloadInventoryReport()" class="bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-lg font-medium transition duration-200 flex items-center shadow-sm">
                  <i class="fas fa-download mr-2"></i>
                  Download Report
                </button>
                <button onclick="downloadDepletedReport()" class="bg-yellow-600 hover:bg-yellow-700 text-white px-4 py-2 rounded-lg font-medium transition duration-200 flex items-center shadow-sm">
                  <i class="fas fa-exclamation-triangle mr-2"></i>
                  Depleted Items
                </button>
                <button onclick="openAddEquipmentModal()" class="bg-green-600 hover:bg-green-700 text-white px-4 py-2 rounded-lg font-medium transition duration-200 flex items-center shadow-sm">
                  <i class="fas fa-plus mr-2"></i>
                  Add Equipment
                </button>
              </div>
            </div>
          </div>
          
          <div class="p-6">
            <!-- Stats Cards -->
            <div class="grid grid-cols-1 md:grid-cols-5 gap-4 mb-6">
              <div class="bg-blue-50 border border-blue-200 rounded-lg p-4">
                <div class="flex items-center">
                  <div class="w-8 h-8 bg-blue-600 rounded flex items-center justify-center">
                    <i class="fas fa-boxes text-white text-sm"></i>
                  </div>
                  <div class="ml-3">
                    <p class="text-sm font-medium text-blue-900">Total Items</p>
                    <p class="text-xl font-bold text-blue-600" id="totalItems">0</p>
                  </div>
                </div>
              </div>
              <div class="bg-green-50 border border-green-200 rounded-lg p-4">
                <div class="flex items-center">
                  <div class="w-8 h-8 bg-green-600 rounded flex items-center justify-center">
                    <i class="fas fa-check-circle text-white text-sm"></i>
                  </div>
                  <div class="ml-3">
                    <p class="text-sm font-medium text-green-900">In Stock</p>
                    <p class="text-xl font-bold text-green-600" id="inStock">0</p>
                  </div>
                </div>
              </div>
              <div class="bg-yellow-50 border border-yellow-200 rounded-lg p-4">
                <div class="flex items-center">
                  <div class="w-8 h-8 bg-yellow-600 rounded flex items-center justify-center">
                    <i class="fas fa-exclamation-triangle text-white text-sm"></i>
                  </div>
                  <div class="ml-3">
                    <p class="text-sm font-medium text-yellow-900">Low Stock</p>
                    <p class="text-xl font-bold text-yellow-600" id="lowStock">0</p>
                  </div>
                </div>
              </div>
              <div class="bg-red-50 border border-red-200 rounded-lg p-4">
                <div class="flex items-center">
                  <div class="w-8 h-8 bg-red-600 rounded flex items-center justify-center">
                    <i class="fas fa-times-circle text-white text-sm"></i>
                  </div>
                  <div class="ml-3">
                    <p class="text-sm font-medium text-red-900">Out of Stock</p>
                    <p class="text-xl font-bold text-red-600" id="outOfStock">0</p>
                  </div>
                </div>
              </div>
              <div class="bg-purple-50 border border-purple-200 rounded-lg p-4">
                <div class="flex items-center">
                  <div class="w-8 h-8 bg-purple-600 rounded flex items-center justify-center">
                    <i class="fas fa-flag text-white text-sm"></i>
                  </div>
                  <div class="ml-3">
                    <p class="text-sm font-medium text-purple-900">Priority Items</p>
                    <p class="text-xl font-bold text-purple-600" id="priorityItems">0</p>
                  </div>
                </div>
              </div>
            </div>

            <!-- Filters and Search -->
            <div class="mb-6 flex flex-col sm:flex-row sm:items-center sm:justify-between space-y-3 sm:space-y-0">
              <div class="flex space-x-3">
                <select id="categoryFilter" onchange="filterEquipment()" class="px-3 py-2 border border-gray-300 rounded-lg focus:ring-blue-500 focus:border-blue-500">
                  <option value="">All Categories</option>
                  <option value="network">Network Equipment</option>
                  <option value="tools">Tools</option>
                  <option value="cables">Cables & Accessories</option>
                  <option value="hardware">Hardware</option>
                  <option value="safety">Safety Equipment</option>
                </select>
                <select id="statusFilter" onchange="filterEquipment()" class="px-3 py-2 border border-gray-300 rounded-lg focus:ring-blue-500 focus:border-blue-500">
                  <option value="">All Status</option>
                  <option value="in-stock">In Stock</option>
                  <option value="low-stock">Low Stock</option>
                  <option value="out-of-stock">Out of Stock</option>
                  <option value="priority">Priority Restock</option>
                </select>
                <select id="addedByFilter" onchange="filterEquipment()" class="px-3 py-2 border border-gray-300 rounded-lg focus:ring-blue-500 focus:border-blue-500">
                  <option value="">All Added By</option>
                  <option value="CTIO">CTIO</option>
                  <option value="Supervisor">Supervisor</option>
                </select>
              </div>
              <div class="relative">
                <input
                  type="text"
                  id="equipmentSearch"
                  placeholder="Search equipment..."
                  onkeyup="searchEquipment()"
                  class="w-full sm:w-64 px-4 py-2 pl-10 border border-gray-300 rounded-lg focus:ring-blue-500 focus:border-blue-500"
                />
                <i class="fas fa-search absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400"></i>
              </div>
            </div>

            <!-- Equipment Table -->
            <div class="overflow-x-auto">
              <table class="min-w-full divide-y divide-gray-200">
                <thead class="bg-gray-50">
                  <tr>
                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Equipment</th>
                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Serial Number</th>
                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Category</th>
                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Quantity</th>
                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Status</th>
                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Priority</th>
                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Added By</th>
                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Actions</th>
                  </tr>
                </thead>
                <tbody id="equipmentTableBody" class="bg-white divide-y divide-gray-200">
                  <!-- Equipment items will be loaded here -->
                </tbody>
              </table>
            </div>
          </div>
        </div>
      </div>
    </main>

    <!-- Include the same modals from supervisor dashboard -->
    <!-- Add Equipment Modal -->
    <div id="addEquipmentModal" class="fixed inset-0 z-50 hidden overflow-y-auto">
      <div class="flex min-h-screen items-center justify-center p-4">
        <div class="fixed inset-0 bg-black bg-opacity-50" onclick="closeEquipmentModal()"></div>
        <div class="relative bg-white rounded-lg shadow-xl max-w-2xl w-full max-h-[90vh] overflow-y-auto">
          <div class="p-6">
            <div class="flex items-center justify-between mb-6">
              <h3 class="text-lg font-semibold text-gray-900" id="equipmentModalTitle">Add New Equipment</h3>
              <button onclick="closeEquipmentModal()" class="text-gray-400 hover:text-gray-600">
                <i class="fas fa-times text-xl"></i>
              </button>
            </div>
            
            <form id="equipmentForm" class="space-y-6">
              <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                <div>
                  <label class="block text-sm font-medium text-gray-700 mb-2">Equipment Name</label>
                  <input
                    type="text"
                    id="equipmentName"
                    required
                    class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-blue-500 focus:border-blue-500"
                    placeholder="e.g., Router, Drill, Network Cable"
                  />
                </div>
                <div>
                  <label class="block text-sm font-medium text-gray-700 mb-2">Serial Number</label>
                  <input
                    type="text"
                    id="equipmentSerial"
                    required
                    class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-blue-500 focus:border-blue-500"
                    placeholder="e.g., RT-001, DR-ABC123"
                  />
                </div>
              </div>

              <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                <div>
                  <label class="block text-sm font-medium text-gray-700 mb-2">Category</label>
                  <select
                    id="equipmentCategory"
                    required
                    class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-blue-500 focus:border-blue-500"
                  >
                    <option value="">Select Category</option>
                    <option value="network">Network Equipment</option>
                    <option value="tools">Tools</option>
                    <option value="cables">Cables & Accessories</option>
                    <option value="hardware">Hardware</option>
                    <option value="safety">Safety Equipment</option>
                  </select>
                </div>
                <div>
                  <label class="block text-sm font-medium text-gray-700 mb-2">Brand/Manufacturer</label>
                  <input
                    type="text"
                    id="equipmentBrand"
                    class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-blue-500 focus:border-blue-500"
                    placeholder="e.g., Cisco, Mikrotik, Bosch"
                  />
                </div>
              </div>

              <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                <div>
                  <label class="block text-sm font-medium text-gray-700 mb-2">Total Quantity</label>
                  <input
                    type="number"
                    id="equipmentQuantity"
                    required
                    min="0"
                    class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-blue-500 focus:border-blue-500"
                    placeholder="0"
                  />
                </div>
                <div>
                  <label class="block text-sm font-medium text-gray-700 mb-2">Available Quantity</label>
                  <input
                    type="number"
                    id="equipmentAvailable"
                    required
                    min="0"
                    class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-blue-500 focus:border-blue-500"
                    placeholder="0"
                  />
                </div>
                <div>
                  <label class="block text-sm font-medium text-gray-700 mb-2">Minimum Stock Level</label>
                  <input
                    type="number"
                    id="equipmentMinStock"
                    required
                    min="0"
                    class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-blue-500 focus:border-blue-500"
                    placeholder="5"
                  />
                </div>
              </div>

              <div>
                <label class="block text-sm font-medium text-gray-700 mb-2">Description</label>
                <textarea
                  id="equipmentDescription"
                  rows="3"
                  class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-blue-500 focus:border-blue-500"
                  placeholder="Equipment specifications, usage notes, compatibility..."
                ></textarea>
              </div>

              <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                <div>
                  <label class="block text-sm font-medium text-gray-700 mb-2">Location/Storage</label>
                  <input
                    type="text"
                    id="equipmentLocation"
                    class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-blue-500 focus:border-blue-500"
                    placeholder="e.g., Storage Room A, Warehouse Shelf 3"
                  />
                </div>
                <div>
                  <label class="block text-sm font-medium text-gray-700 mb-2">Unit Price (Optional)</label>
                  <input
                    type="number"
                    id="equipmentPrice"
                    step="0.01"
                    min="0"
                    class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-blue-500 focus:border-blue-500"
                    placeholder="0.00"
                  />
                </div>
              </div>

              <div class="flex items-center space-x-4">
                <label class="flex items-center">
                  <input type="checkbox" id="equipmentPriority" class="mr-2 text-red-600 focus:ring-red-500">
                  <span class="text-sm font-medium text-gray-700">Flag as High Priority for Restocking</span>
                </label>
              </div>

              <div class="flex justify-end space-x-3 pt-4 border-t">
                <button
                  type="button"
                  onclick="closeEquipmentModal()"
                  class="px-4 py-2 border border-gray-300 rounded-lg text-gray-700 hover:bg-gray-50 font-medium"
                >
                  Cancel
                </button>
                <button
                  type="submit"
                  class="px-6 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded-lg font-medium"
                >
                  <span id="equipmentSubmitText">Add Equipment</span>
                </button>
              </div>
            </form>
          </div>
        </div>
      </div>
    </div>

    <!-- Equipment Details Modal -->
    <div id="equipmentDetailsModal" class="fixed inset-0 z-50 hidden overflow-y-auto">
      <div class="flex min-h-screen items-center justify-center p-4">
        <div class="fixed inset-0 bg-black bg-opacity-50" onclick="closeEquipmentDetailsModal()"></div>
        <div class="relative bg-white rounded-lg shadow-xl max-w-lg w-full">
          <div class="p-6">
            <div class="flex items-center justify-between mb-4">
              <h3 class="text-lg font-semibold text-gray-900">Equipment Details</h3>
              <button onclick="closeEquipmentDetailsModal()" class="text-gray-400 hover:text-gray-600">
                <i class="fas fa-times text-xl"></i>
              </button>
            </div>
            <div id="equipmentDetailsContent">
              <!-- Equipment details will be loaded here -->
            </div>
          </div>
        </div>
      </div>
    </div>

    <script src="js/config.js"></script>
    <script src="js/common.js"></script>
    <script src="js/sidebar-responsive.js"></script>

    <script>
      // CTIO Equipment Management - Same functions as supervisor dashboard but with CTIO permissions
      let currentUser = { name: "CTIO", role: "CTIO" };

      // Initialize on page load
      document.addEventListener('DOMContentLoaded', function() {
        loadEquipmentData();
        updateInventoryStats();
        
        // Initialize equipment form
        const equipmentForm = document.getElementById('equipmentForm');
        if (equipmentForm) {
          equipmentForm.addEventListener('submit', handleEquipmentSubmit);
        }
      });

      // Include all the equipment management functions from supervisor dashboard
      // (Copy all the functions from the supervisor dashboard here)
      
      function loadEquipmentData() {
        const equipmentData = getStoredEquipment();
        const tableBody = document.getElementById('equipmentTableBody');
        
        if (!tableBody) return;

        if (equipmentData.length === 0) {
          tableBody.innerHTML = `
            <tr>
              <td colspan="8" class="px-6 py-8 text-center text-gray-500">
                <div class="flex flex-col items-center">
                  <i class="fas fa-boxes text-4xl text-gray-300 mb-3"></i>
                  <p class="text-lg font-medium">No equipment registered yet</p>
                  <p class="text-sm">Click "Add Equipment" to start managing your inventory</p>
                </div>
              </td>
            </tr>
          `;
          return;
        }

        tableBody.innerHTML = equipmentData.map(equipment => {
          const statusBadge = getStatusBadge(equipment);
          const priorityBadge = equipment.isPriority ? 
            '<span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-red-100 text-red-800"><i class="fas fa-flag mr-1"></i>High Priority</span>' : 
            '<span class="text-gray-400">-</span>';

          return `
            <tr class="hover:bg-gray-50">
              <td class="px-6 py-4 whitespace-nowrap">
                <div>
                  <div class="text-sm font-medium text-gray-900">${equipment.name}</div>
                  <div class="text-sm text-gray-500">${equipment.brand || 'N/A'}</div>
                </div>
              </td>
              <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">${equipment.serialNumber}</td>
              <td class="px-6 py-4 whitespace-nowrap">
                <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ${getCategoryColor(equipment.category)}">
                  ${getCategoryIcon(equipment.category)} ${formatCategory(equipment.category)}
                </span>
              </td>
              <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">
                ${equipment.availableQuantity}/${equipment.totalQuantity}
              </td>
              <td class="px-6 py-4 whitespace-nowrap">${statusBadge}</td>
              <td class="px-6 py-4 whitespace-nowrap">${priorityBadge}</td>
              <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">${equipment.addedBy || 'Unknown'}</td>
              <td class="px-6 py-4 whitespace-nowrap text-sm font-medium space-x-2">
                <button onclick="viewEquipmentDetails('${equipment.id}')" class="text-blue-600 hover:text-blue-900" title="View Details">
                  <i class="fas fa-eye"></i>
                </button>
                <button onclick="editEquipment('${equipment.id}')" class="text-green-600 hover:text-green-900" title="Edit">
                  <i class="fas fa-edit"></i>
                </button>
                <button onclick="togglePriority('${equipment.id}')" class="text-orange-600 hover:text-orange-900" title="Toggle Priority">
                  <i class="fas fa-flag"></i>
                </button>
                <button onclick="deleteEquipment('${equipment.id}')" class="text-red-600 hover:text-red-900" title="Delete">
                  <i class="fas fa-trash"></i>
                </button>
              </td>
            </tr>
          `;
        }).join('');
      }

      // Copy all other functions from supervisor dashboard with CTIO modifications
      function getStoredEquipment() {
        try {
          return JSON.parse(localStorage.getItem('equipmentInventory') || '[]');
        } catch (e) {
          console.error('Error loading equipment data:', e);
          return [];
        }
      }

      function saveEquipmentData(equipmentData) {
        try {
          localStorage.setItem('equipmentInventory', JSON.stringify(equipmentData));
          return true;
        } catch (e) {
          console.error('Error saving equipment data:', e);
          return false;
        }
      }

      function getStatusBadge(equipment) {
        const available = equipment.availableQuantity;
        const minimum = equipment.minimumStock;
        
        if (available === 0) {
          return '<span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-red-100 text-red-800">Out of Stock</span>';
        } else if (available <= minimum) {
          return '<span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-yellow-100 text-yellow-800">Low Stock</span>';
        } else {
          return '<span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-green-100 text-green-800">In Stock</span>';
        }
      }

      function getCategoryColor(category) {
        const colors = {
          'network': 'bg-blue-100 text-blue-800',
          'tools': 'bg-green-100 text-green-800',
          'cables': 'bg-purple-100 text-purple-800',
          'hardware': 'bg-gray-100 text-gray-800',
          'safety': 'bg-orange-100 text-orange-800'
        };
        return colors[category] || 'bg-gray-100 text-gray-800';
      }

      function getCategoryIcon(category) {
        const icons = {
          'network': '<i class="fas fa-network-wired mr-1"></i>',
          'tools': '<i class="fas fa-tools mr-1"></i>',
          'cables': '<i class="fas fa-ethernet mr-1"></i>',
          'hardware': '<i class="fas fa-microchip mr-1"></i>',
          'safety': '<i class="fas fa-hard-hat mr-1"></i>'
        };
        return icons[category] || '<i class="fas fa-box mr-1"></i>';
      }

      function formatCategory(category) {
        const names = {
          'network': 'Network Equipment',
          'tools': 'Tools',
          'cables': 'Cables & Accessories',
          'hardware': 'Hardware',
          'safety': 'Safety Equipment'
        };
        return names[category] || category;
      }

      function updateInventoryStats() {
        const equipmentData = getStoredEquipment();
        
        const totalItems = equipmentData.length;
        const inStock = equipmentData.filter(item => item.availableQuantity > item.minimumStock).length;
        const lowStock = equipmentData.filter(item => item.availableQuantity <= item.minimumStock && item.availableQuantity > 0).length;
        const outOfStock = equipmentData.filter(item => item.availableQuantity === 0).length;
        const priorityItems = equipmentData.filter(item => item.isPriority).length;

        document.getElementById('totalItems').textContent = totalItems;
        document.getElementById('inStock').textContent = inStock;
        document.getElementById('lowStock').textContent = lowStock;
        document.getElementById('outOfStock').textContent = outOfStock;
        document.getElementById('priorityItems').textContent = priorityItems;
      }

      function openAddEquipmentModal() {
        document.getElementById('addEquipmentModal').classList.remove('hidden');
        document.getElementById('equipmentModalTitle').textContent = 'Add New Equipment (CTIO)';
        document.getElementById('equipmentSubmitText').textContent = 'Add Equipment';
        document.getElementById('equipmentForm').reset();
        delete document.getElementById('equipmentForm').dataset.editId;
      }

      function closeEquipmentModal() {
        document.getElementById('addEquipmentModal').classList.add('hidden');
      }

      function closeEquipmentDetailsModal() {
        document.getElementById('equipmentDetailsModal').classList.add('hidden');
      }

      function handleEquipmentSubmit(e) {
        e.preventDefault();
        
        const formData = {
          id: this.dataset.editId || 'EQP' + Date.now(),
          name: document.getElementById('equipmentName').value,
          serialNumber: document.getElementById('equipmentSerial').value,
          category: document.getElementById('equipmentCategory').value,
          brand: document.getElementById('equipmentBrand').value,
          totalQuantity: parseInt(document.getElementById('equipmentQuantity').value),
          availableQuantity: parseInt(document.getElementById('equipmentAvailable').value),
          minimumStock: parseInt(document.getElementById('equipmentMinStock').value),
          description: document.getElementById('equipmentDescription').value,
          location: document.getElementById('equipmentLocation').value,
          unitPrice: parseFloat(document.getElementById('equipmentPrice').value) || 0,
          isPriority: document.getElementById('equipmentPriority').checked,
          addedBy: currentUser.name,
          dateAdded: this.dataset.editId ? undefined : new Date().toISOString(),
          lastModified: new Date().toISOString()
        };

        if (formData.availableQuantity > formData.totalQuantity) {
          Swal.fire({
            title: 'Invalid Quantity',
            text: 'Available quantity cannot be greater than total quantity.',
            icon: 'warning',
            confirmButtonColor: '#3b82f6'
          });
          return;
        }

        const equipmentData = getStoredEquipment();
        const existingIndex = equipmentData.findIndex(item => item.id === formData.id);

        if (existingIndex >= 0) {
          equipmentData[existingIndex] = { ...equipmentData[existingIndex], ...formData };
        } else {
          equipmentData.push(formData);
        }

        if (saveEquipmentData(equipmentData)) {
          Swal.fire({
            title: 'Success!',
            text: `Equipment ${this.dataset.editId ? 'updated' : 'added'} successfully.`,
            icon: 'success',
            confirmButtonColor: '#3b82f6'
          });
          
          closeEquipmentModal();
          loadEquipmentData();
          updateInventoryStats();
        } else {
          Swal.fire({
            title: 'Error',
            text: 'Failed to save equipment data.',
            icon: 'error',
            confirmButtonColor: '#3b82f6'
          });
        }
      }

      function editEquipment(equipmentId) {
        const equipmentData = getStoredEquipment();
        const equipment = equipmentData.find(item => item.id === equipmentId);
        
        if (!equipment) return;

        document.getElementById('equipmentName').value = equipment.name;
        document.getElementById('equipmentSerial').value = equipment.serialNumber;
        document.getElementById('equipmentCategory').value = equipment.category;
        document.getElementById('equipmentBrand').value = equipment.brand || '';
        document.getElementById('equipmentQuantity').value = equipment.totalQuantity;
        document.getElementById('equipmentAvailable').value = equipment.availableQuantity;
        document.getElementById('equipmentMinStock').value = equipment.minimumStock;
        document.getElementById('equipmentDescription').value = equipment.description || '';
        document.getElementById('equipmentLocation').value = equipment.location || '';
        document.getElementById('equipmentPrice').value = equipment.unitPrice || '';
        document.getElementById('equipmentPriority').checked = equipment.isPriority || false;

        const form = document.getElementById('equipmentForm');
        form.dataset.editId = equipmentId;
        
        document.getElementById('equipmentModalTitle').textContent = 'Edit Equipment (CTIO)';
        document.getElementById('equipmentSubmitText').textContent = 'Update Equipment';
        document.getElementById('addEquipmentModal').classList.remove('hidden');
      }

      function viewEquipmentDetails(equipmentId) {
        const equipmentData = getStoredEquipment();
        const equipment = equipmentData.find(item => item.id === equipmentId);
        
        if (!equipment) return;

        const detailsHTML = `
          <div class="space-y-4">
            <div class="grid grid-cols-2 gap-4">
              <div>
                <label class="block text-sm font-medium text-gray-700">Equipment Name</label>
                <p class="text-sm text-gray-900">${equipment.name}</p>
              </div>
              <div>
                <label class="block text-sm font-medium text-gray-700">Serial Number</label>
                <p class="text-sm text-gray-900">${equipment.serialNumber}</p>
              </div>
            </div>
            
            <div class="grid grid-cols-2 gap-4">
              <div>
                <label class="block text-sm font-medium text-gray-700">Category</label>
                <p class="text-sm text-gray-900">${formatCategory(equipment.category)}</p>
              </div>
              <div>
                <label class="block text-sm font-medium text-gray-700">Brand</label>
                <p class="text-sm text-gray-900">${equipment.brand || 'N/A'}</p>
              </div>
            </div>

            <div class="grid grid-cols-3 gap-4">
              <div>
                <label class="block text-sm font-medium text-gray-700">Total Quantity</label>
                <p class="text-sm text-gray-900">${equipment.totalQuantity}</p>
              </div>
              <div>
                <label class="block text-sm font-medium text-gray-700">Available</label>
                <p class="text-sm text-gray-900">${equipment.availableQuantity}</p>
              </div>
              <div>
                <label class="block text-sm font-medium text-gray-700">Minimum Stock</label>
                <p class="text-sm text-gray-900">${equipment.minimumStock}</p>
              </div>
            </div>

            ${equipment.description ? `
              <div>
                <label class="block text-sm font-medium text-gray-700">Description</label>
                <p class="text-sm text-gray-900">${equipment.description}</p>
              </div>
            ` : ''}

            <div class="grid grid-cols-2 gap-4">
              <div>
                <label class="block text-sm font-medium text-gray-700">Location</label>
                <p class="text-sm text-gray-900">${equipment.location || 'N/A'}</p>
              </div>
              <div>
                <label class="block text-sm font-medium text-gray-700">Unit Price</label>
                <p class="text-sm text-gray-900">$${equipment.unitPrice || '0.00'}</p>
              </div>
            </div>

            <div class="grid grid-cols-2 gap-4">
              <div>
                <label class="block text-sm font-medium text-gray-700">Priority Status</label>
                <p class="text-sm ${equipment.isPriority ? 'text-red-600' : 'text-gray-900'}">
                  ${equipment.isPriority ? 'ðŸš© High Priority' : 'Normal'}
                </p>
              </div>
              <div>
                <label class="block text-sm font-medium text-gray-700">Added By</label>
                <p class="text-sm text-gray-900">${equipment.addedBy || 'Unknown'}</p>
              </div>
            </div>

            ${equipment.dateAdded ? `
              <div>
                <label class="block text-sm font-medium text-gray-700">Date Added</label>
                <p class="text-sm text-gray-900">${new Date(equipment.dateAdded).toLocaleDateString()}</p>
              </div>
            ` : ''}

            <div class="pt-4 border-t flex justify-end space-x-2">
              <button onclick="editEquipment('${equipment.id}'); closeEquipmentDetailsModal();" class="px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded-lg text-sm font-medium">
                <i class="fas fa-edit mr-1"></i> Edit
              </button>
              <button onclick="togglePriority('${equipment.id}'); closeEquipmentDetailsModal(); loadEquipmentData();" class="px-4 py-2 bg-orange-600 hover:bg-orange-700 text-white rounded-lg text-sm font-medium">
                <i class="fas fa-flag mr-1"></i> Toggle Priority
              </button>
              <button onclick="deleteEquipment('${equipment.id}'); closeEquipmentDetailsModal();" class="px-4 py-2 bg-red-600 hover:bg-red-700 text-white rounded-lg text-sm font-medium">
                <i class="fas fa-trash mr-1"></i> Delete
              </button>
            </div>
          </div>
        `;

        document.getElementById('equipmentDetailsContent').innerHTML = detailsHTML;
        document.getElementById('equipmentDetailsModal').classList.remove('hidden');
      }

      function togglePriority(equipmentId) {
        const equipmentData = getStoredEquipment();
        const equipmentIndex = equipmentData.findIndex(item => item.id === equipmentId);
        
        if (equipmentIndex === -1) return;

        equipmentData[equipmentIndex].isPriority = !equipmentData[equipmentIndex].isPriority;
        equipmentData[equipmentIndex].lastModified = new Date().toISOString();

        if (saveEquipmentData(equipmentData)) {
          const priorityStatus = equipmentData[equipmentIndex].isPriority ? 'flagged as high priority' : 'removed from high priority';
          
          Swal.fire({
            title: 'Priority Updated!',
            text: `Equipment has been ${priorityStatus} by CTIO.`,
            icon: 'success',
            confirmButtonColor: '#3b82f6',
            timer: 2000,
            showConfirmButton: false
          });
          
          loadEquipmentData();
          updateInventoryStats();
        }
      }

      function deleteEquipment(equipmentId) {
        const equipmentData = getStoredEquipment();
        const equipment = equipmentData.find(item => item.id === equipmentId);
        
        if (!equipment) return;

        Swal.fire({
          title: 'Delete Equipment?',
          text: `Are you sure you want to delete "${equipment.name}"? This action cannot be undone.`,
          icon: 'warning',
          showCancelButton: true,
          confirmButtonColor: '#ef4444',
          cancelButtonColor: '#6b7280',
          confirmButtonText: 'Delete',
          cancelButtonText: 'Cancel'
        }).then((result) => {
          if (result.isConfirmed) {
            const updatedData = equipmentData.filter(item => item.id !== equipmentId);
            
            if (saveEquipmentData(updatedData)) {
              Swal.fire({
                title: 'Deleted!',
                text: 'Equipment has been deleted by CTIO.',
                icon: 'success',
                confirmButtonColor: '#3b82f6',
                timer: 2000,
                showConfirmButton: false
              });
              
              loadEquipmentData();
              updateInventoryStats();
            }
          }
        });
      }

      function filterEquipment() {
        const categoryFilter = document.getElementById('categoryFilter').value;
        const statusFilter = document.getElementById('statusFilter').value;
        const addedByFilter = document.getElementById('addedByFilter').value;
        const searchTerm = document.getElementById('equipmentSearch').value.toLowerCase();
        
        let equipmentData = getStoredEquipment();

        if (categoryFilter) {
          equipmentData = equipmentData.filter(item => item.category === categoryFilter);
        }

        if (statusFilter) {
          equipmentData = equipmentData.filter(item => {
            const available = item.availableQuantity;
            const minimum = item.minimumStock;
            
            switch (statusFilter) {
              case 'in-stock':
                return available > minimum;
              case 'low-stock':
                return available <= minimum && available > 0;
              case 'out-of-stock':
                return available === 0;
              case 'priority':
                return item.isPriority;
              default:
                return true;
            }
          });
        }

        if (addedByFilter) {
          equipmentData = equipmentData.filter(item => item.addedBy === addedByFilter);
        }

        if (searchTerm) {
          equipmentData = equipmentData.filter(item => 
            item.name.toLowerCase().includes(searchTerm) ||
            item.serialNumber.toLowerCase().includes(searchTerm) ||
            (item.brand && item.brand.toLowerCase().includes(searchTerm)) ||
            (item.description && item.description.toLowerCase().includes(searchTerm))
          );
        }

        displayFilteredEquipment(equipmentData);
      }

      function searchEquipment() {
        filterEquipment();
      }

      function displayFilteredEquipment(equipmentData) {
        const tableBody = document.getElementById('equipmentTableBody');
        
        if (equipmentData.length === 0) {
          tableBody.innerHTML = `
            <tr>
              <td colspan="8" class="px-6 py-8 text-center text-gray-500">
                <i class="fas fa-search text-4xl text-gray-300 mb-3"></i>
                <p class="text-lg font-medium">No equipment found</p>
                <p class="text-sm">Try adjusting your search or filters</p>
              </td>
            </tr>
          `;
          return;
        }

        tableBody.innerHTML = equipmentData.map(equipment => {
          const statusBadge = getStatusBadge(equipment);
          const priorityBadge = equipment.isPriority ? 
            '<span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-red-100 text-red-800"><i class="fas fa-flag mr-1"></i>High Priority</span>' : 
            '<span class="text-gray-400">-</span>';

          return `
            <tr class="hover:bg-gray-50">
              <td class="px-6 py-4 whitespace-nowrap">
                <div>
                  <div class="text-sm font-medium text-gray-900">${equipment.name}</div>
                  <div class="text-sm text-gray-500">${equipment.brand || 'N/A'}</div>
                </div>
              </td>
              <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">${equipment.serialNumber}</td>
              <td class="px-6 py-4 whitespace-nowrap">
                <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ${getCategoryColor(equipment.category)}">
                  ${getCategoryIcon(equipment.category)} ${formatCategory(equipment.category)}
                </span>
              </td>
              <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">
                ${equipment.availableQuantity}/${equipment.totalQuantity}
              </td>
              <td class="px-6 py-4 whitespace-nowrap">${statusBadge}</td>
              <td class="px-6 py-4 whitespace-nowrap">${priorityBadge}</td>
              <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">${equipment.addedBy || 'Unknown'}</td>
              <td class="px-6 py-4 whitespace-nowrap text-sm font-medium space-x-2">
                <button onclick="viewEquipmentDetails('${equipment.id}')" class="text-blue-600 hover:text-blue-900" title="View Details">
                  <i class="fas fa-eye"></i>
                </button>
                <button onclick="editEquipment('${equipment.id}')" class="text-green-600 hover:text-green-900" title="Edit">
                  <i class="fas fa-edit"></i>
                </button>
                <button onclick="togglePriority('${equipment.id}')" class="text-orange-600 hover:text-orange-900" title="Toggle Priority">
                  <i class="fas fa-flag"></i>
                </button>
                <button onclick="deleteEquipment('${equipment.id}')" class="text-red-600 hover:text-red-900" title="Delete">
                  <i class="fas fa-trash"></i>
                </button>
              </td>
            </tr>
          `;
        }).join('');
      }

      function downloadInventoryReport() {
        const equipmentData = getStoredEquipment();
        
        if (equipmentData.length === 0) {
          Swal.fire({
            title: 'No Data',
            text: 'No equipment data available to download.',
            icon: 'info',
            confirmButtonColor: '#3b82f6'
          });
          return;
        }

        const headers = ['Equipment Name', 'Serial Number', 'Category', 'Brand', 'Total Qty', 'Available Qty', 'Min Stock', 'Status', 'Priority', 'Location', 'Unit Price', 'Added By', 'Date Added'];
        
        const csvContent = [
          headers.join(','),
          ...equipmentData.map(equipment => {
            const available = equipment.availableQuantity;
            const minimum = equipment.minimumStock;
            let status = 'In Stock';
            
            if (available === 0) {
              status = 'Out of Stock';
            } else if (available <= minimum) {
              status = 'Low Stock';
            }
            
            return [
              `"${equipment.name}"`,
              `"${equipment.serialNumber}"`,
              `"${formatCategory(equipment.category)}"`,
              `"${equipment.brand || 'N/A'}"`,
              equipment.totalQuantity,
              equipment.availableQuantity,
              equipment.minimumStock,
              `"${status}"`,
              equipment.isPriority ? 'High Priority' : 'Normal',
              `"${equipment.location || 'N/A'}"`,
              equipment.unitPrice || 0,
              `"${equipment.addedBy || 'Unknown'}"`,
              equipment.dateAdded ? new Date(equipment.dateAdded).toLocaleDateString() : 'N/A'
            ].join(',');
          })
        ].join('\n');

        const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });
        const link = document.createElement('a');
        const url = URL.createObjectURL(blob);
        link.setAttribute('href', url);
        link.setAttribute('download', `equipment_inventory_ctio_${new Date().toISOString().split('T')[0]}.csv`);
        link.style.visibility = 'hidden';
        document.body.appendChild(link);
        link.click();
        document.body.removeChild(link);

        Swal.fire({
          title: 'Download Complete!',
          text: 'Equipment inventory report has been downloaded.',
          icon: 'success',
          confirmButtonColor: '#3b82f6',
          timer: 2000,
          showConfirmButton: false
        });
      }

      function downloadDepletedReport() {
        const equipmentData = getStoredEquipment();
        const depletedItems = equipmentData.filter(item => 
          item.availableQuantity === 0 || 
          item.availableQuantity <= item.minimumStock ||
          item.isPriority
        );
        
        if (depletedItems.length === 0) {
          Swal.fire({
            title: 'No Depleted Items',
            text: 'No equipment is currently depleted or needs restocking.',
            icon: 'info',
            confirmButtonColor: '#3b82f6'
          });
          return;
        }

        const headers = ['Equipment Name', 'Serial Number', 'Category', 'Available Qty', 'Min Stock', 'Status', 'Priority', 'Added By'];
        
        const csvContent = [
          headers.join(','),
          ...depletedItems.map(equipment => {
            const available = equipment.availableQuantity;
            const minimum = equipment.minimumStock;
            let status = 'Low Stock';
            
            if (available === 0) {
              status = 'Out of Stock';
            }
            
            return [
              `"${equipment.name}"`,
              `"${equipment.serialNumber}"`,
              `"${formatCategory(equipment.category)}"`,
              equipment.availableQuantity,
              equipment.minimumStock,
              `"${status}"`,
              equipment.isPriority ? 'HIGH PRIORITY' : 'Normal',
              `"${equipment.addedBy || 'Unknown'}"`
            ].join(',');
          })
        ].join('\n');

        const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });
        const link = document.createElement('a');
        const url = URL.createObjectURL(blob);
        link.setAttribute('href', url);
        link.setAttribute('download', `depleted_equipment_ctio_${new Date().toISOString().split('T')[0]}.csv`);
        link.style.visibility = 'hidden';
        document.body.appendChild(link);
        link.click();
        document.body.removeChild(link);

        Swal.fire({
          title: 'Download Complete!',
          text: `Depleted equipment report (${depletedItems.length} items) has been downloaded.`,
          icon: 'success',
          confirmButtonColor: '#3b82f6',
          timer: 2000,
          showConfirmButton: false
        });
      }

      function logout() {
        Swal.fire({
          title: 'Logout Confirmation',
          text: 'Are you sure you want to logout?',
          icon: 'question',
          showCancelButton: true,
          confirmButtonColor: '#dc2626',
          cancelButtonColor: '#6b7280',
          confirmButtonText: 'Yes, logout'
        }).then((result) => {
          if (result.isConfirmed) {
            localStorage.clear();
            sessionStorage.clear();
            window.location.href = 'index.html';
          }
        });
      }

      function clearFilters() {
        document.getElementById('categoryFilter').value = '';
        document.getElementById('statusFilter').value = '';
        document.getElementById('addedByFilter').value = '';
        document.getElementById('equipmentSearch').value = '';
        loadEquipmentData();
      }

      function populateAddedByFilter() {
        const equipmentData = getStoredEquipment();
        const addedByUsers = [...new Set(equipmentData.map(item => item.addedBy).filter(Boolean))];
        
        const addedByFilter = document.getElementById('addedByFilter');
        addedByFilter.innerHTML = '<option value="">All Users</option>';
        
        addedByUsers.forEach(user => {
          addedByFilter.innerHTML += `<option value="${user}">${user}</option>`;
        });
      }

      // Mobile sidebar functionality
      document.getElementById('toggleSidebar').addEventListener('click', function() {
        const sidebar = document.querySelector('.sidebar');
        const backdrop = document.getElementById('sidebarBackdrop');
        
        sidebar.classList.toggle('show');
        backdrop.classList.toggle('hidden');
      });

      document.getElementById('sidebarBackdrop').addEventListener('click', function() {
        const sidebar = document.querySelector('.sidebar');
        const backdrop = document.getElementById('sidebarBackdrop');
        
        sidebar.classList.remove('show');
        backdrop.classList.add('hidden');
      });
    </script>
  </body>
</html>
            window.location.href = 'index.html';
          }
        });
      }
    </script>
  </body>
</html>