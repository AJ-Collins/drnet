<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Supervisor Dashboard</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
  <script src="https://cdn.jsdelivr.net/npm/dayjs@1/dayjs.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/dayjs@1/plugin/relativeTime.js"></script>
  <script src="js/common.js"></script>
  <script src="js/profile-image-manager.js"></script>
  <script>
    dayjs.extend(window.dayjs_plugin_relativeTime);
  </script>
    <style>
      :root {
        --primary-gradient: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        --secondary-gradient: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
        --card-gradient: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
        --dark-gradient: linear-gradient(135deg, #2c3e50 0%, #4a5568 100%);
      }

      /* Chat styles */
      .message-bubble {
        max-width: 70%;
        word-wrap: break-word;
      }

      .message-bubble.sent {
        margin-left: auto;
        background: linear-gradient(135deg, #3b82f6, #1d4ed8);
      }

      .message-bubble.received {
        margin-right: auto;
        background: #f3f4f6;
        color: #374151;
      }
    
    body {
      font-family: 'Inter', sans-serif;
    }
    
    .gradient-bg {
      background: var(--primary-gradient);
    }
    
    .card-gradient {
      background: var(--card-gradient);
    }
    
    .sidebar-gradient {
      background: var(--dark-gradient);
    }
    
    .hover-scale {
      transition: transform 0.3s ease;
    }
    
    .hover-scale:hover {
      transform: scale(1.05);
    }
    
    .nav-item {
      transition: all 0.3s ease;
      border-left: 4px solid transparent;
    }
    
    .nav-item:hover, .nav-item.active {
      background: rgba(255, 255, 255, 0.1);
      border-left: 4px solid #667eea;
    }
    
    .card-shadow {
      box-shadow: 0 10px 20px rgba(0, 0, 0, 0.1);
    }
    
    .page-section {
      display: none;
      animation: fadeIn 0.5s ease;
      position: relative;
    }
    
    .page-section.active {
      display: block;
    }
    
    /* Specific styling for equipment, reports, communication, and settings sections */
    .page-section#equipment,
    .page-section#reports,
    .page-section#communication,
    .page-section#settings {
      display: none;
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      width: 100%;
      height: 100%;
    }
    
    .page-section#equipment.active,
    .page-section#reports.active,
    .page-section#communication.active,
    .page-section#settings.active {
      display: block;
      z-index: 10;
    }
    
    .page-section#equipment > div,
    .page-section#reports > div,
    .page-section#communication > div,
    .page-section#settings > div {
      width: 100%;
      height: 100%;
      overflow-y: auto;
      overflow-x: hidden;
      -webkit-overflow-scrolling: touch;
    }
    
    /* Custom scrollable content areas */
    .scrollable-content {
      height: calc(100vh - 120px);
      overflow-y: auto;
      scrollbar-width: none; /* Firefox */
      -ms-overflow-style: none; /* Internet Explorer 10+ */
    }
    
    .scrollable-content::-webkit-scrollbar {
      display: none; /* WebKit */
    }
    
    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(10px); }
      to { opacity: 1; transform: translateY(0); }
    }
    
    .notification-badge {
      position: absolute;
      top: -5px;
      right: -5px;
      background: #ef4444;
      color: white;
      border-radius: 50%;
      width: 20px;
      height: 20px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 12px;
    }
    
    .form-input {
      transition: all 0.3s ease;
    }
    
    .form-input:focus {
      border-color: #667eea;
      box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
    }
    
    .btn-gradient {
      background: var(--primary-gradient);
      transition: all 0.3s ease;
    }

    /* Settings Tab Styles */
    .settings-tab-btn {
      background: #f8f9fa;
      color: #6c757d;
    }

    .settings-tab-btn.active {
      background: #667eea;
      color: white;
    }

    .settings-tab-btn:hover {
      background: #e9ecef;
    }

    .settings-tab-btn.active:hover {
      background: #5a6fd8;
    }

    .settings-tab-content {
      animation: fadeIn 0.3s ease;
    }

    /* Chat Message Styles */
    .message-sent {
      background: #667eea;
      color: white;
      border-radius: 18px 18px 4px 18px;
      margin-left: auto;
      max-width: 70%;
    }

    .message-received {
      background: #f1f3f4;
      color: #333;
      border-radius: 18px 18px 18px 4px;
      margin-right: auto;
      max-width: 70%;
    }

    /* Status Badge Styles */
    .status-available {
      background: #10b981;
      color: white;
    }

    .status-in-use {
      background: #f59e0b;
      color: white;
    }

    .status-maintenance {
      background: #ef4444;
      color: white;
    }

    .status-pending {
      background: #6b7280;
      color: white;
    }

    /* Toggle Switch Styles */
    .toggle-switch {
      width: 48px;
      height: 24px;
      appearance: none;
      background: #cbd5e0;
      border-radius: 12px;
      position: relative;
      cursor: pointer;
    }

    .toggle-switch:checked {
      background: #667eea;
    }

    .toggle-switch::before {
      content: '';
      position: absolute;
      width: 20px;
      height: 20px;
      background: white;
      border-radius: 50%;
      top: 2px;
      left: 2px;
      transition: transform 0.2s;
    }

    .toggle-switch:checked::before {
      transform: translateX(24px);
    }
    
    .btn-gradient:hover {
      transform: translateY(-2px);
      box-shadow: 0 10px 20px rgba(102, 126, 234, 0.3);
    }

    /* Custom Animations */
    @keyframes fade-in {
      from { opacity: 0; transform: translateY(20px); }
      to { opacity: 1; transform: translateY(0); }
    }

    @keyframes slide-up {
      from { opacity: 0; transform: translateY(30px); }
      to { opacity: 1; transform: translateY(0); }
    }

    @keyframes float {
      0%, 100% { transform: translateY(0px); }
      50% { transform: translateY(-10px); }
    }

    @keyframes glow {
      0%, 100% { box-shadow: 0 0 20px rgba(59, 130, 246, 0.3); }
      50% { box-shadow: 0 0 40px rgba(59, 130, 246, 0.6); }
    }

    @keyframes shimmer {
      0% { background-position: -200% 0; }
      100% { background-position: 200% 0; }
    }

    .animate-fade-in {
      animation: fade-in 1s ease-out;
    }

    .animate-slide-up {
      animation: slide-up 0.8s ease-out;
    }

    .animate-float {
      animation: float 3s ease-in-out infinite;
    }

    .animate-glow {
      animation: glow 2s ease-in-out infinite;
    }

    .animate-shimmer {
      background: linear-gradient(90deg, transparent, rgba(255,255,255,0.2), transparent);
      background-size: 200% 100%;
      animation: shimmer 2s infinite;
    }

    /* Glass morphism effect */
    .glass-card {
      background: rgba(255, 255, 255, 0.1);
      backdrop-filter: blur(20px);
      border: 1px solid rgba(255, 255, 255, 0.2);
    }

    /* Gradient text */
    .gradient-text {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
    }

    /* Hover effects */
    .card-hover {
      transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    }

    .card-hover:hover {
      transform: translateY(-8px) scale(1.02);
      box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.25);
    }

    /* Progress bar animation */
    .progress-bar {
      transition: width 2s ease-in-out;
    }

    /* Icon pulse animation */
    .icon-pulse {
      animation: pulse 2s infinite;
    }

    @keyframes pulse {
      0%, 100% { transform: scale(1); }
      50% { transform: scale(1.1); }
    }
    
    .message-bubble {
      max-width: 70%;
      padding: 10px 15px;
      border-radius: 18px;
      margin-bottom: 10px;
      animation: messageSlide 0.3s ease;
    }
    
    @keyframes messageSlide {
      from { opacity: 0; transform: translateY(10px); }
      to { opacity: 1; transform: translateY(0); }
    }
    
    .message-sent {
      background: #667eea;
      color: white;
      align-self: flex-end;
    }
    
    .message-received {
      background: #e5e7eb;
      color: #1f2937;
      align-self: flex-start;
    }
    
    .status-badge {
      padding: 4px 8px;
      border-radius: 12px;
      font-size: 12px;
      font-weight: 600;
    }
    
    .status-active {
      background: #d1fae5;
      color: #065f46;
    }
    
    .status-pending {
      background: #fed7aa;
      color: #92400e;
    }
    
    .status-inactive {
      background: #fee2e2;
      color: #991b1b;
    }
    
    .modal {
      display: none;
      position: fixed;
      z-index: 50;
      left: 0;
      top: 0;
      width: 100%;
      height: 100%;
      background-color: rgba(0, 0, 0, 0.5);
      animation: fadeIn 0.3s ease;
    }
    
    .modal.active {
      display: flex;
      align-items: center;
      justify-content: center;
    }
    
    .modal-content {
      background: white;
      border-radius: 16px;
      width: 90%;
      max-width: 600px;
      max-height: 90vh;
      overflow-y: auto;
      box-shadow: 0 20px 40px rgba(0, 0, 0, 0.2);
      animation: slideUp 0.3s ease;
    }
    
    @keyframes slideUp {
      from { transform: translateY(50px); opacity: 0; }
      to { transform: translateY(0); opacity: 1; }
    }
    
    .modal-header {
      background: var(--primary-gradient);
      color: white;
      padding: 20px;
      border-radius: 16px 16px 0 0;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    
    .modal-body {
      padding: 20px;
    }
    
    .modal-footer {
      padding: 15px 20px;
      border-top: 1px solid #e5e7eb;
      display: flex;
      justify-content: flex-end;
      gap: 10px;
    }
    
    .profile-upload {
      position: relative;
      width: 120px;
      height: 120px;
      border-radius: 50%;
      overflow: hidden;
      background: #f3f4f6;
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      transition: all 0.3s ease;
    }
    
    .profile-upload:hover {
      background: #e5e7eb;
    }
    
    .profile-upload img {
      width: 100%;
      height: 100%;
      object-fit: cover;
    }
    
    .profile-upload-overlay {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.5);
      display: flex;
      align-items: center;
      justify-content: center;
      opacity: 0;
      transition: opacity 0.3s ease;
    }
    
    .profile-upload:hover .profile-upload-overlay {
      opacity: 1;
    }
    
    .typing-indicator {
      display: flex;
      align-items: center;
      padding: 8px 12px;
      background: #e5e7eb;
      border-radius: 18px;
      margin-bottom: 10px;
    }
    
    .typing-indicator span {
      width: 8px;
      height: 8px;
      border-radius: 50%;
      background: #6b7280;
      margin: 0 2px;
      animation: typing 1.4s infinite;
    }
    
    .typing-indicator span:nth-child(2) {
      animation-delay: 0.2s;
    }
    
    .typing-indicator span:nth-child(3) {
      animation-delay: 0.4s;
    }
    
    @keyframes typing {
      0%, 60%, 100% {
        transform: translateY(0);
      }
      30% {
        transform: translateY(-10px);
      }
    }

    /* Ensure the sidebar remains visible */
    .sidebar-gradient {
      position: fixed;
      top: 0;
      left: 0;
      height: 100%;
      z-index: 50;
    }

    .main-content {
      margin-left: 16rem; /* Adjust based on sidebar width */
    }
  </style>
</head>
<body class="bg-gray-50 min-h-screen">
  <div class="flex h-screen overflow-hidden">
    <!-- Sidebar -->
    <aside class="w-64 sidebar-gradient text-white h-full overflow-y-auto">
      <div class="p-6">
        <div class="flex items-center mb-8">
          <div class="w-12 h-12 bg-white rounded-lg flex items-center justify-center mr-3">
            <i class="fas fa-chart-line text-purple-600 text-xl"></i>
          </div>
          <h1 class="text-xl font-bold">Supervisor Dashboard</h1>
        </div>
        
        <nav class="space-y-2">
          <a href="#" class="nav-item flex items-center py-3 px-4 rounded-lg active" data-page="overview">
            <i class="fas fa-home w-5 mr-3"></i>
            <span>Dashboard Overview</span>
          </a>
          <a href="#" class="nav-item flex items-center py-3 px-4 rounded-lg" data-page="attendance">
            <i class="fas fa-user-check w-5 mr-3"></i>
            <span>Staff Attendance</span>
          </a>
          <a href="#" class="nav-item flex items-center py-3 px-4 rounded-lg relative" data-page="tickets">
            <i class="fas fa-ticket-alt w-5 mr-3"></i>
            <span>Support Tickets</span>
            <span class="notification-badge">3</span>
          </a>
          <a href="#" class="nav-item flex items-center py-3 px-4 rounded-lg" data-page="assignments">
            <i class="fas fa-tasks w-5 mr-3"></i>
            <span>Service Assignments</span>
          </a>
          <a href="#" class="nav-item flex items-center py-3 px-4 rounded-lg" data-page="bookings">
            <i class="fas fa-calendar-plus w-5 mr-3"></i>
            <span>Add Booking</span>
          </a>
          <a href="#" class="nav-item flex items-center py-3 px-4 rounded-lg" data-page="users">
            <i class="fas fa-users w-5 mr-3"></i>
            <span>Users</span>
          </a>
          <a href="#" class="nav-item flex items-center py-3 px-4 rounded-lg" data-page="finance">
            <i class="fas fa-dollar-sign w-5 mr-3"></i>
            <span>Finance</span>
          </a>
          <a href="#" class="nav-item flex items-center py-3 px-4 rounded-lg" data-page="equipment">
            <i class="fas fa-tools w-5 mr-3"></i>
            <span>Equipment & Tools</span>
          </a>
          <a href="#" class="nav-item flex items-center py-3 px-4 rounded-lg" data-page="reports">
            <i class="fas fa-file-alt w-5 mr-3"></i>
            <span>Reports & Logs</span>
          </a>
          <a href="#" class="nav-item flex items-center py-3 px-4 rounded-lg relative" data-page="communication">
            <i class="fas fa-comments w-5 mr-3"></i>
            <span>Team Communication</span>
            <span class="notification-badge">5</span>
          </a>
          <a href="#" class="nav-item flex items-center py-3 px-4 rounded-lg" data-page="settings">
            <i class="fas fa-cog w-5 mr-3"></i>
            <span>Settings</span>
          </a>
        </nav>
      </div>
      
      <div class="p-6 mt-auto">
        <div class="bg-white bg-opacity-10 rounded-lg p-4">
          <div class="flex items-center mb-2">
            <img src="https://picsum.photos/seed/supervisor/40/40.jpg" alt="Profile" class="w-10 h-10 rounded-full mr-3">
            <div>
              <p class="font-semibold">John Supervisor</p>
              <p class="text-xs opacity-75">Online</p>
            </div>
          </div>
          <button class="w-full mt-3 py-2 bg-white bg-opacity-20 rounded-lg hover:bg-opacity-30 transition-all">
            <i class="fas fa-sign-out-alt mr-2"></i> Logout
          </button>
        </div>
      </div>
    </aside>

    <!-- Main Content -->
    <main class="flex-1 main-content relative overflow-hidden">
      <!-- Dashboard Overview -->
      <section id="overview" class="page-section active p-6 relative overflow-hidden">
        <!-- Animated Background -->
        <div class="absolute inset-0 bg-gradient-to-br from-indigo-900 via-purple-900 to-pink-900 opacity-95"></div>
        <div class="absolute inset-0 bg-gradient-to-tr from-blue-600/20 via-transparent to-cyan-600/20"></div>
        
        <!-- Floating Orbs Animation -->
        <div class="absolute top-10 left-10 w-32 h-32 bg-gradient-to-r from-blue-400/30 to-purple-400/30 rounded-full blur-xl animate-pulse animate-float"></div>
        <div class="absolute top-32 right-20 w-24 h-24 bg-gradient-to-r from-pink-400/30 to-rose-400/30 rounded-full blur-lg animate-bounce"></div>
        <div class="absolute bottom-20 left-1/4 w-40 h-40 bg-gradient-to-r from-cyan-400/20 to-blue-400/20 rounded-full blur-2xl animate-pulse"></div>
        <div class="absolute bottom-10 right-10 w-28 h-28 bg-gradient-to-r from-purple-400/30 to-indigo-400/30 rounded-full blur-xl animate-bounce"></div>
        
        <!-- Additional Floating Elements -->
        <div class="absolute top-1/2 left-1/3 w-16 h-16 bg-gradient-to-r from-yellow-400/20 to-orange-400/20 rounded-full blur-lg animate-float" style="animation-delay: 1s;"></div>
        <div class="absolute top-1/3 right-1/3 w-20 h-20 bg-gradient-to-r from-emerald-400/25 to-teal-400/25 rounded-full blur-xl animate-pulse" style="animation-delay: 2s;"></div>
        <div class="absolute bottom-1/3 left-1/2 w-12 h-12 bg-gradient-to-r from-violet-400/30 to-purple-400/30 rounded-full blur-md animate-bounce" style="animation-delay: 0.5s;"></div>
        
        <!-- Animated Grid Pattern -->
        <div class="absolute inset-0 opacity-10">
          <div class="absolute inset-0" style="background-image: radial-gradient(circle at 25% 25%, rgba(59, 130, 246, 0.1) 0%, transparent 50%), radial-gradient(circle at 75% 75%, rgba(147, 51, 234, 0.1) 0%, transparent 50%);"></div>
        </div>
        
        <!-- Content -->
        <div class="relative z-10">
          <!-- Profile Picture Section -->
          <div class="mb-6 text-center">
            <div class="flex flex-col items-center justify-center mb-4">
              <div class="relative group">
                <div class="w-24 h-24 rounded-full bg-white/20 backdrop-blur-lg border-3 border-white/30 shadow-xl overflow-hidden flex items-center justify-center">
                  <img 
                    id="supervisorHeaderProfileImage" 
                    src="" 
                    alt="Profile Picture" 
                    class="w-full h-full object-cover hidden"
                    onerror="this.style.display='none'; this.nextElementSibling.style.display='flex';"
                  />
                  <div id="supervisorHeaderProfilePlaceholder" class="w-full h-full flex items-center justify-center">
                    <svg class="w-12 h-12 text-white/80" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"></path>
                    </svg>
                  </div>
                </div>
                <div class="absolute -bottom-1.5 left-1/2 transform -translate-x-1/2">
                  <span class="w-3.5 h-3.5 bg-green-500 rounded-full border-3 border-white shadow-lg animate-pulse"></span>
                </div>
              </div>
              <h2 id="supervisorHeaderName" class="text-xl font-bold text-white mt-3 mb-1">Supervisor</h2>
              <p class="text-blue-100/80 text-sm">Online</p>
            </div>
          </div>
          
          <div class="mb-6 text-center">
            <h1 class="text-4xl font-bold text-white mb-3 bg-gradient-to-r from-white via-blue-100 to-cyan-100 bg-clip-text text-transparent animate-fade-in">
              DR.NET TECHNOLOGY LABS
            </h1>
            <p class="text-base text-blue-100/80 animate-slide-up">Welcome to the Supervisor Dashboard. Here's a summary of your activities.</p>
          </div>
          
          <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8">
            <!-- Staff Attendance Card -->
            <div class="group relative bg-gradient-to-br from-blue-500/20 to-cyan-500/20 backdrop-blur-lg rounded-xl p-6 border border-white/20 hover:border-white/40 transition-all duration-500 hover:scale-105 hover:shadow-xl hover:shadow-blue-500/25 animate-slide-up" data-metric="attendance" style="animation-delay: 0.1s">
              <div class="absolute inset-0 bg-gradient-to-br from-blue-600/10 to-cyan-600/10 rounded-xl opacity-0 group-hover:opacity-100 transition-opacity duration-500"></div>
              <div class="relative z-10">
                <div class="flex items-center justify-between mb-4">
                  <div class="w-12 h-12 bg-gradient-to-br from-blue-400 to-cyan-400 rounded-xl flex items-center justify-center shadow-md group-hover:scale-110 transition-transform duration-300">
                    <i class="fas fa-users text-white text-lg"></i>
                  </div>
                  <span class="text-xs text-blue-100/80 font-medium">Today</span>
                </div>
                <h3 class="text-3xl font-bold text-white mb-2 group-hover:text-cyan-200 transition-colors duration-300">0</h3>
                <p class="text-sm text-blue-100/70 group-hover:text-blue-100 transition-colors duration-300">0/6 staff present</p>
                <div class="mt-3 h-1 bg-gradient-to-r from-blue-400/30 to-cyan-400/30 rounded-full overflow-hidden">
                  <div class="h-full bg-gradient-to-r from-blue-400 to-cyan-400 rounded-full transition-all duration-1000" style="width: 0%"></div>
                </div>
              </div>
            </div>
            
            <!-- Support Tickets Card -->
            <div class="group relative bg-gradient-to-br from-purple-500/20 to-pink-500/20 backdrop-blur-lg rounded-xl p-6 border border-white/20 hover:border-white/40 transition-all duration-500 hover:scale-105 hover:shadow-xl hover:shadow-purple-500/25 animate-slide-up" data-metric="tickets" style="animation-delay: 0.2s">
              <div class="absolute inset-0 bg-gradient-to-br from-purple-600/10 to-pink-600/10 rounded-xl opacity-0 group-hover:opacity-100 transition-opacity duration-500"></div>
              <div class="relative z-10">
                <div class="flex items-center justify-between mb-4">
                  <div class="w-12 h-12 bg-gradient-to-br from-purple-400 to-pink-400 rounded-xl flex items-center justify-center shadow-md group-hover:scale-110 transition-transform duration-300">
                    <i class="fas fa-ticket-alt text-white text-lg"></i>
                  </div>
                  <span class="text-xs text-purple-100/80 font-medium">Open</span>
                </div>
                <h3 class="text-3xl font-bold text-white mb-2 group-hover:text-pink-200 transition-colors duration-300">0</h3>
                <p class="text-sm text-purple-100/70 group-hover:text-purple-100 transition-colors duration-300">0 open, 0 pending</p>
                <div class="mt-3 h-1 bg-gradient-to-r from-purple-400/30 to-pink-400/30 rounded-full overflow-hidden">
                  <div class="h-full bg-gradient-to-r from-purple-400 to-pink-400 rounded-full transition-all duration-1000" style="width: 0%"></div>
                </div>
              </div>
            </div>
            
            <!-- Service Assignments Card -->
            <div class="group relative bg-gradient-to-br from-orange-500/20 to-red-500/20 backdrop-blur-lg rounded-xl p-6 border border-white/20 hover:border-white/40 transition-all duration-500 hover:scale-105 hover:shadow-xl hover:shadow-orange-500/25 animate-slide-up" data-metric="assignments" style="animation-delay: 0.3s">
              <div class="absolute inset-0 bg-gradient-to-br from-orange-600/10 to-red-600/10 rounded-xl opacity-0 group-hover:opacity-100 transition-opacity duration-500"></div>
              <div class="relative z-10">
                <div class="flex items-center justify-between mb-4">
                  <div class="w-12 h-12 bg-gradient-to-br from-orange-400 to-red-400 rounded-xl flex items-center justify-center shadow-md group-hover:scale-110 transition-transform duration-300">
                    <i class="fas fa-wrench text-white text-lg"></i>
                  </div>
                  <span class="text-xs text-orange-100/80 font-medium">Active</span>
                </div>
                <h3 class="text-3xl font-bold text-white mb-2 group-hover:text-red-200 transition-colors duration-300">0</h3>
                <p class="text-sm text-orange-100/70 group-hover:text-orange-100 transition-colors duration-300">0 active, 0 completed</p>
                <div class="mt-3 h-1 bg-gradient-to-r from-orange-400/30 to-red-400/30 rounded-full overflow-hidden">
                  <div class="h-full bg-gradient-to-r from-orange-400 to-red-400 rounded-full transition-all duration-1000" style="width: 0%"></div>
                </div>
              </div>
            </div>
            
            <!-- Reports Card -->
            <div class="group relative bg-gradient-to-br from-green-500/20 to-emerald-500/20 backdrop-blur-lg rounded-xl p-6 border border-white/20 hover:border-white/40 transition-all duration-500 hover:scale-105 hover:shadow-xl hover:shadow-green-500/25 animate-slide-up" style="animation-delay: 0.4s">
              <div class="absolute inset-0 bg-gradient-to-br from-green-600/10 to-emerald-600/10 rounded-xl opacity-0 group-hover:opacity-100 transition-opacity duration-500"></div>
              <div class="relative z-10">
                <div class="flex items-center justify-between mb-4">
                  <div class="w-12 h-12 bg-gradient-to-br from-green-400 to-emerald-400 rounded-xl flex items-center justify-center shadow-md group-hover:scale-110 transition-transform duration-300">
                    <i class="fas fa-check-circle text-white text-lg"></i>
                  </div>
                  <span class="text-xs text-green-100/80 font-medium">This Week</span>
                </div>
                <h3 class="text-3xl font-bold text-white mb-2 group-hover:text-emerald-200 transition-colors duration-300">0</h3>
                <p class="text-sm text-green-100/70 group-hover:text-green-100 transition-colors duration-300">Reports Sent</p>
                <div class="mt-3 h-1 bg-gradient-to-r from-green-400/30 to-emerald-400/30 rounded-full overflow-hidden">
                  <div class="h-full bg-gradient-to-r from-green-400 to-emerald-400 rounded-full transition-all duration-1000" style="width: 0%"></div>
                </div>
              </div>
            </div>
          </div>
        
        <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
          <!-- Recent Activities Card -->
          <div class="relative bg-gradient-to-br from-white/10 to-white/5 backdrop-blur-lg rounded-xl p-6 border border-white/20 hover:border-white/40 transition-all duration-500 animate-slide-up" style="animation-delay: 0.5s">
            <div class="absolute inset-0 bg-gradient-to-br from-blue-600/5 to-purple-600/5 rounded-xl"></div>
            <div class="relative z-10">
              <h2 class="text-xl font-bold text-white mb-5 bg-gradient-to-r from-white to-blue-100 bg-clip-text text-transparent">Recent Activities</h2>
              <div class="space-y-3">
                <div class="flex items-start p-4 bg-gradient-to-r from-blue-500/10 to-cyan-500/10 rounded-lg border border-blue-400/20 hover:border-blue-400/40 transition-all duration-300 group">
                  <div class="w-10 h-10 bg-gradient-to-br from-blue-400 to-cyan-400 rounded-full flex items-center justify-center mr-3 group-hover:scale-110 transition-transform duration-300 flex-shrink-0">
                    <i class="fas fa-user-check text-white text-sm"></i>
                  </div>
                  <div>
                    <p class="text-white font-medium text-sm group-hover:text-cyan-200 transition-colors duration-300">Marked staff attendance</p>
                    <p class="text-blue-100/70 text-xs">10 staff members marked present</p>
                    <p class="text-blue-100/50 text-xs mt-1">2 hours ago</p>
                  </div>
                </div>
                
                <div class="flex items-start p-4 bg-gradient-to-r from-green-500/10 to-emerald-500/10 rounded-lg border border-green-400/20 hover:border-green-400/40 transition-all duration-300 group">
                  <div class="w-10 h-10 bg-gradient-to-br from-green-400 to-emerald-400 rounded-full flex items-center justify-center mr-3 group-hover:scale-110 transition-transform duration-300 flex-shrink-0">
                    <i class="fas fa-check text-white text-sm"></i>
                  </div>
                  <div>
                    <p class="text-white font-medium text-sm group-hover:text-emerald-200 transition-colors duration-300">Completed service assignment</p>
                    <p class="text-green-100/70 text-xs">Installation at ABC Company</p>
                    <p class="text-green-100/50 text-xs mt-1">5 hours ago</p>
                  </div>
                </div>
                
                <div class="flex items-start p-4 bg-gradient-to-r from-purple-500/10 to-pink-500/10 rounded-lg border border-purple-400/20 hover:border-purple-400/40 transition-all duration-300 group">
                  <div class="w-10 h-10 bg-gradient-to-br from-purple-400 to-pink-400 rounded-full flex items-center justify-center mr-3 group-hover:scale-110 transition-transform duration-300 flex-shrink-0">
                    <i class="fas fa-ticket-alt text-white text-sm"></i>
                  </div>
                  <div>
                    <p class="text-white font-medium text-sm group-hover:text-pink-200 transition-colors duration-300">Created support ticket</p>
                    <p class="text-purple-100/70 text-xs">Ticket #1023 - Network Issue</p>
                    <p class="text-purple-100/50 text-xs mt-1">Yesterday</p>
                  </div>
                </div>
              </div>
            </div>
          </div>
          
          <!-- Team Performance Card -->
          <div class="relative bg-gradient-to-br from-white/10 to-white/5 backdrop-blur-lg rounded-xl p-6 border border-white/20 hover:border-white/40 transition-all duration-500 animate-slide-up" style="animation-delay: 0.6s">
            <div class="absolute inset-0 bg-gradient-to-br from-purple-600/5 to-pink-600/5 rounded-xl"></div>
            <div class="relative z-10">
              <h2 class="text-xl font-bold text-white mb-5 bg-gradient-to-r from-white to-purple-100 bg-clip-text text-transparent">Team Performance</h2>
              <div class="space-y-4">
                <div class="group">
                  <div class="flex justify-between mb-2">
                    <span class="text-white font-medium group-hover:text-purple-200 transition-colors duration-300">Installation</span>
                    <span class="text-white font-bold group-hover:text-purple-200 transition-colors duration-300">85%</span>
                  </div>
                  <div class="w-full bg-gradient-to-r from-blue-400/20 to-cyan-400/20 rounded-full h-3 overflow-hidden">
                    <div class="h-full bg-gradient-to-r from-blue-400 to-cyan-400 rounded-full progress-bar animate-shimmer" style="width: 85%"></div>
                  </div>
                </div>
                
                <div class="group">
                  <div class="flex justify-between mb-2">
                    <span class="text-white font-medium group-hover:text-green-200 transition-colors duration-300">Maintenance</span>
                    <span class="text-white font-bold group-hover:text-green-200 transition-colors duration-300">70%</span>
                  </div>
                  <div class="w-full bg-gradient-to-r from-green-400/20 to-emerald-400/20 rounded-full h-3 overflow-hidden">
                    <div class="h-full bg-gradient-to-r from-green-400 to-emerald-400 rounded-full progress-bar animate-shimmer" style="width: 70%"></div>
                  </div>
                </div>
                
                <div class="group">
                  <div class="flex justify-between mb-2">
                    <span class="text-white font-medium group-hover:text-purple-200 transition-colors duration-300">Repair</span>
                    <span class="text-white font-bold group-hover:text-purple-200 transition-colors duration-300">60%</span>
                  </div>
                  <div class="w-full bg-gradient-to-r from-purple-400/20 to-pink-400/20 rounded-full h-3 overflow-hidden">
                    <div class="h-full bg-gradient-to-r from-purple-400 to-pink-400 rounded-full progress-bar animate-shimmer" style="width: 60%"></div>
                  </div>
                </div>
                
                <div class="group">
                  <div class="flex justify-between mb-2">
                    <span class="text-white font-medium group-hover:text-orange-200 transition-colors duration-300">Inspection</span>
                    <span class="text-white font-bold group-hover:text-orange-200 transition-colors duration-300">90%</span>
                  </div>
                  <div class="w-full bg-gradient-to-r from-orange-400/20 to-red-400/20 rounded-full h-3 overflow-hidden">
                    <div class="h-full bg-gradient-to-r from-orange-400 to-red-400 rounded-full progress-bar animate-shimmer" style="width: 90%"></div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </section>

      <!-- Staff Attendance -->
      <section id="attendance" class="page-section p-6 relative overflow-hidden">
        <!-- Animated Background -->
        <div class="absolute inset-0 bg-gradient-to-br from-indigo-900 via-purple-900 to-pink-900 opacity-95"></div>
        <div class="absolute inset-0 bg-gradient-to-tr from-blue-600/20 via-transparent to-cyan-600/20"></div>
        
        <!-- Floating Orbs Animation -->
        <div class="absolute top-10 left-10 w-32 h-32 bg-gradient-to-r from-blue-400/30 to-purple-400/30 rounded-full blur-xl animate-pulse animate-float"></div>
        <div class="absolute top-32 right-20 w-24 h-24 bg-gradient-to-r from-pink-400/30 to-rose-400/30 rounded-full blur-lg animate-bounce"></div>
        <div class="absolute bottom-20 left-1/4 w-40 h-40 bg-gradient-to-r from-cyan-400/20 to-blue-400/20 rounded-full blur-2xl animate-pulse"></div>
        <div class="absolute bottom-10 right-10 w-28 h-28 bg-gradient-to-r from-purple-400/30 to-indigo-400/30 rounded-full blur-xl animate-bounce"></div>
        
        <!-- Additional Floating Elements -->
        <div class="absolute top-1/2 left-1/3 w-16 h-16 bg-gradient-to-r from-yellow-400/20 to-orange-400/20 rounded-full blur-lg animate-float" style="animation-delay: 1s;"></div>
        <div class="absolute top-1/3 right-1/3 w-20 h-20 bg-gradient-to-r from-emerald-400/25 to-teal-400/25 rounded-full blur-xl animate-pulse" style="animation-delay: 2s;"></div>
        <div class="absolute bottom-1/3 left-1/2 w-12 h-12 bg-gradient-to-r from-violet-400/30 to-purple-400/30 rounded-full blur-md animate-bounce" style="animation-delay: 0.5s;"></div>
        
        <!-- Animated Grid Pattern -->
        <div class="absolute inset-0 opacity-10">
          <div class="absolute inset-0" style="background-image: radial-gradient(circle at 25% 25%, rgba(59, 130, 246, 0.1) 0%, transparent 50%), radial-gradient(circle at 75% 75%, rgba(147, 51, 234, 0.1) 0%, transparent 50%);"></div>
        </div>
        
        <!-- Content -->
        <div class="relative z-10">
          <div class="mb-8 text-center">
            <h1 class="text-5xl font-bold text-white mb-4 bg-gradient-to-r from-white via-blue-100 to-cyan-100 bg-clip-text text-transparent animate-fade-in">
              Staff Attendance
            </h1>
            <p class="text-xl text-blue-100/80 animate-slide-up">Mark staff attendance. Data will be sent to the CTIO under Manage Users.</p>
          </div>
        
        <!-- Staff Attendance Marking Form -->
        <div class="bg-white rounded-xl p-6 card-shadow mb-6">
          <div class="flex justify-between items-center mb-6">
            <h2 class="text-xl font-bold text-gray-800">Mark Staff Attendance</h2>
            <div class="flex space-x-3">
              <div class="relative">
                <input type="date" id="attendanceDatePicker" class="px-4 py-2 bg-gray-200 text-gray-700 rounded-lg hover:bg-gray-300 transition-all cursor-pointer" value="">
                <i class="fas fa-calendar-alt absolute right-3 top-1/2 transform -translate-y-1/2 text-gray-500 pointer-events-none"></i>
              </div>
              <button class="px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 transition-all" onclick="submitAttendanceToCTIO()">
                <i class="fas fa-paper-plane mr-2"></i> Send to CTIO
              </button>
            </div>
          </div>
          
          <!-- Individual Staff Attendance Form -->
          <div class="bg-gradient-to-br from-blue-50 to-indigo-50 rounded-lg p-6 border border-blue-200">
            <form id="attendanceForm" onsubmit="markIndividualAttendance(event)">
              <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4 mb-4">
                <!-- Staff Selection -->
                <div>
                  <label class="block text-sm font-medium text-gray-700 mb-2">
                    Select Staff <span class="text-red-500">*</span>
                  </label>
                  <select id="staffSelect" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500" required>
                    <option value="">Select a staff member</option>
                    <!-- Staff options will be loaded here -->
                  </select>
                </div>
                
                <!-- Time In -->
                <div>
                  <label class="block text-sm font-medium text-gray-700 mb-2">
                    Time In <span class="text-red-500">*</span>
                  </label>
                  <input type="time" id="timeIn" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500" required>
                </div>
                
                <!-- Time Out -->
                <div>
                  <label class="block text-sm font-medium text-gray-700 mb-2">
                    Time Out <span class="text-red-500">*</span>
                  </label>
                  <input type="time" id="timeOut" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500" required>
                </div>
                
                <!-- Status Selection -->
                <div>
                  <label class="block text-sm font-medium text-gray-700 mb-2">
                    Status <span class="text-red-500">*</span>
                  </label>
                  <select id="attendanceStatus" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500" required>
                    <option value="">Select status</option>
                    <option value="Present">Present</option>
                    <option value="Absent">Absent</option>
                    <option value="Off Duty">Off Duty</option>
                    <option value="On Leave">On Leave</option>
                  </select>
                </div>
              </div>
              
              <!-- Notes Section -->
              <div class="mb-4">
                <label class="block text-sm font-medium text-gray-700 mb-2">
                  Notes (Optional)
                </label>
                <textarea id="attendanceNotes" rows="2" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500" placeholder="Add any notes about the attendance..."></textarea>
              </div>
              
              <!-- Action Buttons -->
              <div class="flex space-x-3">
                <button type="submit" class="px-6 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-all font-medium">
                  <i class="fas fa-save mr-2"></i> Save Attendance
                </button>
                <button type="button" onclick="clearSavedAttendance()" class="px-6 py-2 bg-red-500 text-white rounded-lg hover:bg-red-600 transition-all font-medium">
                  <i class="fas fa-trash-alt mr-2"></i> Clear Saved Attendance
                </button>
              </div>
            </form>
          </div>
          
          <!-- Recently Marked Attendance (Last 5) -->
          <div class="mt-6">
            <h3 class="text-lg font-semibold text-gray-800 mb-3">Recently Marked Attendance</h3>
            <div id="recentAttendanceList" class="space-y-2">
              <!-- Recent attendance records will be shown here -->
            </div>
          </div>
        </div>

        <!-- Attendance Records Data Table -->
        <div class="bg-white rounded-xl p-6 card-shadow mb-6">
          <div class="flex justify-between items-center mb-6">
            <h2 class="text-xl font-bold text-gray-800">Attendance Records</h2>
            <div class="flex space-x-3">
              <input type="text" id="attendanceSearch" placeholder="Search staff..." 
                     class="px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"
                     onkeyup="filterAttendanceRecords()">
              <select id="attendanceStatusFilter" class="px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500" onchange="filterAttendanceRecords()">
                <option value="">All Status</option>
                <option value="Present">Present</option>
                <option value="Absent">Absent</option>
                <option value="Off Duty">Off Duty</option>
                <option value="On Leave">On Leave</option>
              </select>
              <button class="px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 transition-all" onclick="refreshAttendanceRecords()">
                <i class="fas fa-sync-alt mr-2"></i> Refresh
              </button>
            </div>
          </div>
          
          <!-- Data Table -->
          <div class="overflow-x-auto">
            <table class="min-w-full divide-y divide-gray-200">
              <thead class="bg-gray-50">
                <tr>
                  <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Employee ID</th>
                  <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Name</th>
                  <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Department</th>
                  <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Role</th>
                  <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Phone</th>
                  <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Email</th>
                  <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Time In</th>
                  <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Time Out</th>
                  <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Status</th>
                  <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Date</th>
                  <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Marked By</th>
                  <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Actions</th>
                </tr>
              </thead>
              <tbody id="attendanceTableBody" class="bg-white divide-y divide-gray-200">
                <!-- Attendance records will be loaded here -->
              </tbody>
            </table>
            <div id="noAttendanceRecords" class="text-center py-8 hidden">
              <i class="fas fa-user-clock text-4xl text-gray-400 mb-4"></i>
              <p class="text-lg font-medium">No attendance records</p>
              <p class="text-sm">No attendance records found for the selected date</p>
            </div>
          </div>
        </div>
        
        <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
          <div class="bg-white rounded-xl p-6 card-shadow">
            <div class="flex items-center justify-between mb-4">
              <h3 class="text-lg font-semibold text-gray-800">Present Today</h3>
              <div class="w-10 h-10 bg-green-100 rounded-lg flex items-center justify-center">
                <i class="fas fa-user-check text-green-600"></i>
              </div>
            </div>
            <p class="text-3xl font-bold text-gray-800">8</p>
            <p class="text-gray-600 text-sm mt-1">Out of 10 staff members</p>
          </div>
          
          <div class="bg-white rounded-xl p-6 card-shadow">
            <div class="flex items-center justify-between mb-4">
              <h3 class="text-lg font-semibold text-gray-800">Absent Today</h3>
              <div class="w-10 h-10 bg-red-100 rounded-lg flex items-center justify-center">
                <i class="fas fa-user-times text-red-600"></i>
              </div>
            </div>
            <p class="text-3xl font-bold text-gray-800">2</p>
            <p class="text-gray-600 text-sm mt-1">Out of 10 staff members</p>
          </div>
          
          <div class="bg-white rounded-xl p-6 card-shadow">
            <div class="flex items-center justify-between mb-4">
              <h3 class="text-lg font-semibold text-gray-800">Attendance Rate</h3>
              <div class="w-10 h-10 bg-blue-100 rounded-lg flex items-center justify-center">
                <i class="fas fa-chart-line text-blue-600"></i>
              </div>
            </div>
            <p class="text-3xl font-bold text-gray-800">80%</p>
            <p class="text-gray-600 text-sm mt-1">This week's average</p>
          </div>
        </div>
      </section>

      <!-- Support Tickets -->
      <section id="tickets" class="page-section p-6 relative overflow-hidden">
        <!-- Animated Background -->
        <div class="absolute inset-0 bg-gradient-to-br from-indigo-900 via-purple-900 to-pink-900 opacity-95"></div>
        <div class="absolute inset-0 bg-gradient-to-tr from-blue-600/20 via-transparent to-cyan-600/20"></div>
        
        <!-- Floating Orbs Animation -->
        <div class="absolute top-10 left-10 w-32 h-32 bg-gradient-to-r from-blue-400/30 to-purple-400/30 rounded-full blur-xl animate-pulse animate-float"></div>
        <div class="absolute top-32 right-20 w-24 h-24 bg-gradient-to-r from-pink-400/30 to-rose-400/30 rounded-full blur-lg animate-bounce"></div>
        <div class="absolute bottom-20 left-1/4 w-40 h-40 bg-gradient-to-r from-cyan-400/20 to-blue-400/20 rounded-full blur-2xl animate-pulse"></div>
        <div class="absolute bottom-10 right-10 w-28 h-28 bg-gradient-to-r from-purple-400/30 to-indigo-400/30 rounded-full blur-xl animate-bounce"></div>
        
        <!-- Additional Floating Elements -->
        <div class="absolute top-1/2 left-1/3 w-16 h-16 bg-gradient-to-r from-yellow-400/20 to-orange-400/20 rounded-full blur-lg animate-float" style="animation-delay: 1s;"></div>
        <div class="absolute top-1/3 right-1/3 w-20 h-20 bg-gradient-to-r from-emerald-400/25 to-teal-400/25 rounded-full blur-xl animate-pulse" style="animation-delay: 2s;"></div>
        <div class="absolute bottom-1/3 left-1/2 w-12 h-12 bg-gradient-to-r from-violet-400/30 to-purple-400/30 rounded-full blur-md animate-bounce" style="animation-delay: 0.5s;"></div>
        
        <!-- Animated Grid Pattern -->
        <div class="absolute inset-0 opacity-10">
          <div class="absolute inset-0" style="background-image: radial-gradient(circle at 25% 25%, rgba(59, 130, 246, 0.1) 0%, transparent 50%), radial-gradient(circle at 75% 75%, rgba(147, 51, 234, 0.1) 0%, transparent 50%);"></div>
        </div>
        
        <!-- Content -->
        <div class="relative z-10">
          <div class="mb-8 text-center">
            <h1 class="text-5xl font-bold text-white mb-4 bg-gradient-to-r from-white via-blue-100 to-cyan-100 bg-clip-text text-transparent animate-fade-in">
              Support Tickets
            </h1>
            <p class="text-xl text-blue-100/80 animate-slide-up">Create and view support tickets. Client-created tickets are also visible here.</p>
          </div>
        
        <div class="bg-white rounded-xl p-6 card-shadow mb-6">
          <div class="flex justify-between items-center mb-6">
            <h2 class="text-xl font-bold text-gray-800">Support Tickets</h2>
            <button class="px-4 py-2 btn-gradient text-white rounded-lg" onclick="openModal('ticketModal')">
              <i class="fas fa-plus mr-2"></i> New Ticket
            </button>
          </div>
          
          <div class="flex justify-between items-center mb-4">
            <div class="flex space-x-2">
              <button class="px-4 py-2 bg-blue-600 text-white rounded-lg" onclick="filterTickets('all')">All</button>
              <button class="px-4 py-2 bg-gray-200 text-gray-700 rounded-lg hover:bg-gray-300 transition-all" onclick="filterTickets('open')">Open</button>
              <button class="px-4 py-2 bg-gray-200 text-gray-700 rounded-lg hover:bg-gray-300 transition-all" onclick="filterTickets('in-progress')">In Progress</button>
              <button class="px-4 py-2 bg-gray-200 text-gray-700 rounded-lg hover:bg-gray-300 transition-all" onclick="filterTickets('resolved')">Resolved</button>
            </div>
            <div class="flex items-center">
              <input type="text" class="form-input border border-gray-300 rounded-lg px-4 py-2 mr-2" placeholder="Search tickets...">
              <button class="px-4 py-2 bg-gray-200 text-gray-700 rounded-lg hover:bg-gray-300 transition-all">
                <i class="fas fa-search"></i>
              </button>
            </div>
          </div>
          
          <div class="space-y-4" id="ticketsList">
            <!-- Support tickets will be loaded dynamically here -->
          </div>
        </div>
      </section>

      <!-- Service Assignments -->
      <section id="assignments" class="page-section p-6 relative overflow-hidden">
        <!-- Animated Background -->
        <div class="absolute inset-0 bg-gradient-to-br from-indigo-900 via-purple-900 to-pink-900 opacity-95"></div>
        <div class="absolute inset-0 bg-gradient-to-tr from-blue-600/20 via-transparent to-cyan-600/20"></div>
        
        <!-- Floating Orbs Animation -->
        <div class="absolute top-10 left-10 w-32 h-32 bg-gradient-to-r from-blue-400/30 to-purple-400/30 rounded-full blur-xl animate-pulse animate-float"></div>
        <div class="absolute top-32 right-20 w-24 h-24 bg-gradient-to-r from-pink-400/30 to-rose-400/30 rounded-full blur-lg animate-bounce"></div>
        <div class="absolute bottom-20 left-1/4 w-40 h-40 bg-gradient-to-r from-cyan-400/20 to-blue-400/20 rounded-full blur-2xl animate-pulse"></div>
        <div class="absolute bottom-10 right-10 w-28 h-28 bg-gradient-to-r from-purple-400/30 to-indigo-400/30 rounded-full blur-xl animate-bounce"></div>
        
        <!-- Additional Floating Elements -->
        <div class="absolute top-1/2 left-1/3 w-16 h-16 bg-gradient-to-r from-yellow-400/20 to-orange-400/20 rounded-full blur-lg animate-float" style="animation-delay: 1s;"></div>
        <div class="absolute top-1/3 right-1/3 w-20 h-20 bg-gradient-to-r from-emerald-400/25 to-teal-400/25 rounded-full blur-xl animate-pulse" style="animation-delay: 2s;"></div>
        <div class="absolute bottom-1/3 left-1/2 w-12 h-12 bg-gradient-to-r from-violet-400/30 to-purple-400/30 rounded-full blur-md animate-bounce" style="animation-delay: 0.5s;"></div>
        
        <!-- Animated Grid Pattern -->
        <div class="absolute inset-0 opacity-10">
          <div class="absolute inset-0" style="background-image: radial-gradient(circle at 25% 25%, rgba(59, 130, 246, 0.1) 0%, transparent 50%), radial-gradient(circle at 75% 75%, rgba(147, 51, 234, 0.1) 0%, transparent 50%);"></div>
        </div>
        
        <!-- Content -->
        <div class="relative z-10">
          <div class="mb-8 text-center">
            <h1 class="text-5xl font-bold text-white mb-4 bg-gradient-to-r from-white via-blue-100 to-cyan-100 bg-clip-text text-transparent animate-fade-in">
              Service Assignments
            </h1>
            <p class="text-xl text-blue-100/80 animate-slide-up">Create and manage service assignments. All assignments are visible to the CTIO.</p>
          </div>
        
        <div class="bg-white rounded-xl p-6 card-shadow mb-6">
          <div class="flex justify-between items-center mb-6">
            <h2 class="text-xl font-bold text-gray-800">Service Assignments</h2>
            <button class="px-4 py-2 btn-gradient text-white rounded-lg" onclick="openModal('assignmentModal')">
              <i class="fas fa-plus mr-2"></i> New Assignment
            </button>
          </div>
          
          <div class="flex justify-between items-center mb-4">
            <div class="flex space-x-2">
              <button class="px-4 py-2 bg-blue-600 text-white rounded-lg" onclick="filterAssignments('all')">All</button>
              <button class="px-4 py-2 bg-gray-200 text-gray-700 rounded-lg hover:bg-gray-300 transition-all" onclick="filterAssignments('Installation')">Installation</button>
              <button class="px-4 py-2 bg-gray-200 text-gray-700 rounded-lg hover:bg-gray-300 transition-all" onclick="filterAssignments('Maintenance')">Maintenance</button>
              <button class="px-4 py-2 bg-gray-200 text-gray-700 rounded-lg hover:bg-gray-300 transition-all" onclick="filterAssignments('Repair')">Repair</button>
              <button class="px-4 py-2 bg-gray-200 text-gray-700 rounded-lg hover:bg-gray-300 transition-all" onclick="filterAssignments('Inspection')">Inspection</button>
              <button class="px-4 py-2 bg-gray-200 text-gray-700 rounded-lg hover:bg-gray-300 transition-all" onclick="filterAssignments('Asset Recovery')">Asset Recovery</button>
              <button class="px-4 py-2 bg-gray-200 text-gray-700 rounded-lg hover:bg-gray-300 transition-all" onclick="filterAssignments('Relocation')">Relocation</button>
            </div>
            <div class="flex items-center">
              <input type="text" class="form-input border border-gray-300 rounded-lg px-4 py-2 mr-2" placeholder="Search assignments...">
              <button class="px-4 py-2 bg-gray-200 text-gray-700 rounded-lg hover:bg-gray-300 transition-all">
                <i class="fas fa-search"></i>
              </button>
            </div>
          </div>
          
          <div class="space-y-4" id="assignmentsList">
            <!-- Service assignments will be loaded dynamically here -->
          </div>
        </div>
      </section>

      <!-- Add Booking Section -->
      <section id="bookings" class="page-section p-6">
        <div class="mb-6">
          <h1 class="text-3xl font-bold text-gray-800 mb-2">Add Booking</h1>
          <p class="text-gray-600">Book a client for installation services.</p>
        </div>
        
        <div class="bg-white rounded-xl p-6 card-shadow mb-6">
          <div class="flex justify-between items-center mb-6">
            <h2 class="text-xl font-bold text-gray-800">Bookings</h2>
            <button class="px-4 py-2 btn-gradient text-white rounded-lg" onclick="openModal('bookingModal')">
              <i class="fas fa-plus mr-2"></i> New Booking
            </button>
          </div>
          
          <div class="overflow-x-auto">
            <table class="w-full">
              <thead>
                <tr class="border-b border-gray-200">
                  <th class="text-left py-3 px-4 font-semibold text-gray-700">Booking ID</th>
                  <th class="text-left py-3 px-4 font-semibold text-gray-700">Client Name</th>
                  <th class="text-left py-3 px-4 font-semibold text-gray-700">Phone</th>
                  <th class="text-left py-3 px-4 font-semibold text-gray-700">Location</th>
                  <th class="text-left py-3 px-4 font-semibold text-gray-700">Package</th>
                  <th class="text-left py-3 px-4 font-semibold text-gray-700">Status</th>
                  <th class="text-left py-3 px-4 font-semibold text-gray-700">Installation Date</th>
                  <th class="text-left py-3 px-4 font-semibold text-gray-700">Actions</th>
                </tr>
              </thead>
              <tbody>
                <tr class="border-b border-gray-100 hover:bg-gray-50">
                  <td class="py-3 px-4 font-medium">#B1023</td>
                  <td class="py-3 px-4">John Smith</td>
                  <td class="py-3 px-4">+254 712 345 678</td>
                  <td class="py-3 px-4">Nairobi, CBD</td>
                  <td class="py-3 px-4">Basic Package</td>
                  <td class="py-3 px-4">
                    <span class="status-badge status-pending">Pending</span>
                  </td>
                  <td class="py-3 px-4">2023-06-25</td>
                  <td class="py-3 px-4">
                    <button class="text-blue-600 hover:text-blue-800 mr-2">
                      <i class="fas fa-eye"></i>
                    </button>
                    <button class="text-green-600 hover:text-green-800">
                      <i class="fas fa-edit"></i>
                    </button>
                  </td>
                </tr>
                
                <tr class="border-b border-gray-100 hover:bg-gray-50">
                  <td class="py-3 px-4 font-medium">#B1022</td>
                  <td class="py-3 px-4">Sarah Johnson</td>
                  <td class="py-3 px-4">+254 723 456 789</td>
                  <td class="py-3 px-4">Mombasa, Nyali</td>
                  <td class="py-3 px-4">Premium Package</td>
                  <td class="py-3 px-4">
                    <span class="status-badge status-active">Confirmed</span>
                  </td>
                  <td class="py-3 px-4">2023-06-28</td>
                  <td class="py-3 px-4">
                    <button class="text-blue-600 hover:text-blue-800 mr-2">
                      <i class="fas fa-eye"></i>
                    </button>
                    <button class="text-green-600 hover:text-green-800">
                      <i class="fas fa-edit"></i>
                    </button>
                  </td>
                </tr>
                
                <tr class="border-b border-gray-100 hover:bg-gray-50">
                  <td class="py-3 px-4 font-medium">#B1021</td>
                  <td class="py-3 px-4">Tech Corp</td>
                  <td class="py-3 px-4">+254 734 567 890</td>
                  <td class="py-3 px-4">Kisumu, Milimani</td>
                  <td class="py-3 px-4">Enterprise Package</td>
                  <td class="py-3 px-4">
                    <span class="status-badge status-active">Scheduled</span>
                  </td>
                  <td class="py-3 px-4">2023-07-05</td>
                  <td class="py-3 px-4">
                    <button class="text-blue-600 hover:text-blue-800 mr-2">
                      <i class="fas fa-eye"></i>
                    </button>
                    <button class="text-green-600 hover:text-green-800">
                      <i class="fas fa-edit"></i>
                    </button>
                  </td>
                </tr>
              </tbody>
            </table>
          </div>
        </div>
      </section>

      <!-- Users Section - CTIO Import (Read-Only) -->
      <section id="users" class="page-section p-6">
        <div class="mb-6">
          <h1 class="text-3xl font-bold text-gray-800 flex items-center mb-2">
            <i class="fas fa-users mr-3 text-blue-600"></i>
            Users Management
          </h1>
          <p class="text-gray-600">
            View clients and staff from CTIO's user management system. Attendance is managed by CTIO only.
          </p>
        </div>
        
        <div class="flex justify-between items-center mb-6">
          <div class="flex items-center space-x-4">
            <div class="flex items-center space-x-2 text-sm">
              <div class="w-3 h-3 bg-green-500 rounded-full animate-pulse"></div>
              <span class="text-gray-600">View Only Mode</span>
            </div>
            <button
              id="exportButton"
              onclick="exportToCSV()"
              class="bg-blue-600 text-white px-6 py-3 rounded-xl hover:bg-blue-700 transition-all duration-300 font-semibold shadow-lg hover:shadow-xl"
            >
              <i class="fas fa-download mr-2"></i> Export to CSV
            </button>
          </div>
        </div>

        <!-- Tab Navigation -->
        <div class="mb-8">
          <div class="flex space-x-1 bg-gray-200 p-1 rounded-lg w-fit">
            <button
              id="clientsTab"
              class="tab-button px-6 py-3 rounded-md font-medium transition-all duration-200 bg-white text-blue-600 shadow-sm active"
              onclick="switchUserTab('clients')"
            >
              <i class="fas fa-users mr-2"></i> Clients
            </button>
            <button
              id="staffTab"
              class="tab-button px-6 py-3 rounded-md font-medium transition-all duration-200 text-gray-600 hover:text-blue-600"
              onclick="switchUserTab('staff')"
            >
              <i class="fas fa-user-tie mr-2"></i> Staff
            </button>
          </div>
        </div>

        <!-- Clients Section -->
        <div
          id="clientsSection"
          class="bg-white p-8 rounded-xl shadow-lg border border-gray-200"
        >
          <!-- Search and Filter Controls for Clients -->
          <div class="mb-6 flex flex-col md:flex-row md:items-center gap-4">
            <div class="flex-1">
              <input
                id="clientSearchInput"
                type="text"
                placeholder="Search by name, phone, or location..."
                class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 bg-white text-gray-900"
              />
            </div>
            <div class="flex gap-4">
              <select
                id="subscriptionFilter"
                class="p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 bg-white text-gray-900"
              >
                <option value="all">All Subscriptions</option>
                <option value="paid">Paid</option>
                <option value="unpaid">Unpaid</option>
              </select>
              <select
                id="statusFilter"
                class="p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 bg-white text-gray-900"
              >
                <option value="all">All Statuses</option>
                <option value="active">Active</option>
                <option value="expired">Expired</option>
              </select>
            </div>
          </div>
          <div id="clientListContent" class="space-y-4"></div>
        </div>

        <!-- Staff Section -->
        <div
          id="staffSection"
          class="hidden bg-white p-8 rounded-xl shadow-lg border border-gray-200"
        >
          <!-- Search and Filter Controls for Staff -->
          <div class="mb-6 flex flex-col md:flex-row md:items-center gap-4">
            <div class="flex-1">
              <input
                id="staffSearchInput"
                type="text"
                placeholder="Search by name, employee ID, position, or department..."
                class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-green-500 bg-white text-gray-900"
              />
            </div>
            <div class="flex gap-4">
              <select
                id="departmentFilter"
                class="p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-green-500 bg-white text-gray-900"
              >
                <option value="all">All Departments</option>
                <option value="Technical">Technical</option>
                <option value="Customer Service">Customer Service</option>
                <option value="Sales">Sales</option>
                <option value="Operations">Operations</option>
                <option value="Administration">Administration</option>
                <option value="Finance">Finance</option>
                <option value="Marketing">Marketing</option>
              </select>
              <select
                id="staffStatusFilter"
                class="p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-green-500 bg-white text-gray-900"
              >
                <option value="all">All Staff</option>
                <option value="active">Active</option>
                <option value="inactive">Inactive</option>
              </select>
            </div>
          </div>
          <div id="staffListContent" class="space-y-4"></div>
        </div>

      </section>

      <!-- Finance Section -->
      <section id="finance" class="page-section p-6 relative overflow-hidden">
        <!-- Animated Background -->
        <div class="absolute inset-0 bg-gradient-to-br from-indigo-900 via-purple-900 to-pink-900 opacity-95"></div>
        <div class="absolute inset-0 bg-gradient-to-tr from-blue-600/20 via-transparent to-cyan-600/20"></div>
        
        <!-- Floating Orbs Animation -->
        <div class="absolute top-10 left-10 w-32 h-32 bg-gradient-to-r from-blue-400/30 to-purple-400/30 rounded-full blur-xl animate-pulse animate-float"></div>
        <div class="absolute top-32 right-20 w-24 h-24 bg-gradient-to-r from-pink-400/30 to-rose-400/30 rounded-full blur-lg animate-bounce"></div>
        <div class="absolute bottom-20 left-1/4 w-40 h-40 bg-gradient-to-r from-cyan-400/20 to-blue-400/20 rounded-full blur-2xl animate-pulse"></div>
        <div class="absolute bottom-10 right-10 w-28 h-28 bg-gradient-to-r from-purple-400/30 to-indigo-400/30 rounded-full blur-xl animate-bounce"></div>
        
        <!-- Additional Floating Elements -->
        <div class="absolute top-1/2 left-1/3 w-16 h-16 bg-gradient-to-r from-yellow-400/20 to-orange-400/20 rounded-full blur-lg animate-float" style="animation-delay: 1s;"></div>
        <div class="absolute top-1/3 right-1/3 w-20 h-20 bg-gradient-to-r from-emerald-400/25 to-teal-400/25 rounded-full blur-xl animate-pulse" style="animation-delay: 2s;"></div>
        <div class="absolute bottom-1/3 left-1/2 w-12 h-12 bg-gradient-to-r from-violet-400/30 to-purple-400/30 rounded-full blur-md animate-bounce" style="animation-delay: 0.5s;"></div>
        
        <!-- Animated Grid Pattern -->
        <div class="absolute inset-0 opacity-10">
          <div class="absolute inset-0" style="background-image: radial-gradient(circle at 25% 25%, rgba(59, 130, 246, 0.1) 0%, transparent 50%), radial-gradient(circle at 75% 75%, rgba(147, 51, 234, 0.1) 0%, transparent 50%);"></div>
        </div>
        
        <!-- Content -->
        <div class="relative z-10">
          <div class="mb-8 text-center">
            <h1 class="text-5xl font-bold text-white mb-4 bg-gradient-to-r from-white via-blue-100 to-cyan-100 bg-clip-text text-transparent animate-fade-in">
              Finance
            </h1>
            <p class="text-xl text-blue-100/80 animate-slide-up">Manage payslips, expenses, and sales.</p>
          </div>
        
        <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-6">
          <!-- Payslips Card -->
          <div class="relative overflow-hidden rounded-2xl p-6 cursor-pointer transform hover:scale-105 transition-all duration-300 shadow-2xl bg-gradient-to-br from-blue-500 via-blue-600 to-indigo-700 hover:from-blue-600 hover:via-blue-700 hover:to-indigo-800" onclick="openPayslipsModal()">
            <div class="absolute inset-0 bg-gradient-to-br from-white/10 to-transparent"></div>
            <div class="relative z-10">
              <div class="flex items-center justify-between mb-4">
                <h3 class="text-lg font-semibold text-white">Payslips</h3>
                <div class="w-12 h-12 bg-white/20 backdrop-blur-sm rounded-xl flex items-center justify-center">
                  <i class="fas fa-file-invoice-dollar text-white text-xl"></i>
                </div>
              </div>
              <p class="text-4xl font-bold text-white mb-2">2</p>
              <p class="text-blue-100 text-sm">New payslips available</p>
              <div class="mt-4 flex items-center text-white/90 font-medium">
                <span>View Details</span>
                <i class="fas fa-arrow-right ml-2 transform group-hover:translate-x-1 transition-transform"></i>
              </div>
            </div>
            <div class="absolute -bottom-4 -right-4 w-24 h-24 bg-white/10 rounded-full"></div>
            <div class="absolute -top-2 -left-2 w-16 h-16 bg-white/5 rounded-full"></div>
          </div>
          
          <!-- Expenses Card -->
          <div class="relative overflow-hidden rounded-2xl p-6 cursor-pointer transform hover:scale-105 transition-all duration-300 shadow-2xl bg-gradient-to-br from-orange-500 via-red-500 to-pink-600 hover:from-orange-600 hover:via-red-600 hover:to-pink-700" onclick="openExpensesModal()">
            <div class="absolute inset-0 bg-gradient-to-br from-white/10 to-transparent"></div>
            <div class="relative z-10">
              <div class="flex items-center justify-between mb-4">
                <h3 class="text-lg font-semibold text-white">Expenses</h3>
                <div class="w-12 h-12 bg-white/20 backdrop-blur-sm rounded-xl flex items-center justify-center">
                  <i class="fas fa-receipt text-white text-xl"></i>
                </div>
              </div>
              <p class="text-4xl font-bold text-white mb-2">Ksh 1,250</p>
              <p class="text-orange-100 text-sm">This month's expenses</p>
              <div class="mt-4 flex items-center text-white/90 font-medium">
                <span>View Details</span>
                <i class="fas fa-arrow-right ml-2 transform group-hover:translate-x-1 transition-transform"></i>
              </div>
            </div>
            <div class="absolute -bottom-4 -right-4 w-24 h-24 bg-white/10 rounded-full"></div>
            <div class="absolute -top-2 -left-2 w-16 h-16 bg-white/5 rounded-full"></div>
          </div>
          
          <!-- Sales Card -->
          <div class="relative overflow-hidden rounded-2xl p-6 cursor-pointer transform hover:scale-105 transition-all duration-300 shadow-2xl bg-gradient-to-br from-green-500 via-emerald-600 to-teal-700 hover:from-green-600 hover:via-emerald-700 hover:to-teal-800" onclick="openSalesModal()">
            <div class="absolute inset-0 bg-gradient-to-br from-white/10 to-transparent"></div>
            <div class="relative z-10">
              <div class="flex items-center justify-between mb-4">
                <h3 class="text-lg font-semibold text-white">Sales</h3>
                <div class="w-12 h-12 bg-white/20 backdrop-blur-sm rounded-xl flex items-center justify-center">
                  <i class="fas fa-chart-line text-white text-xl"></i>
                </div>
              </div>
              <p class="text-4xl font-bold text-white mb-2">Ksh 8,750</p>
              <p class="text-green-100 text-sm">This month's sales</p>
              <div class="mt-4 flex items-center text-white/90 font-medium">
                <span>View Details</span>
                <i class="fas fa-arrow-right ml-2 transform group-hover:translate-x-1 transition-transform"></i>
              </div>
            </div>
            <div class="absolute -bottom-4 -right-4 w-24 h-24 bg-white/10 rounded-full"></div>
            <div class="absolute -top-2 -left-2 w-16 h-16 bg-white/5 rounded-full"></div>
          </div>
        </div>
        
        <div class="bg-white rounded-xl p-6 card-shadow">
          <div class="flex justify-between items-center mb-6">
            <h2 class="text-xl font-bold text-gray-800">Finance Management</h2>
            <div class="flex space-x-2">
              <button class="px-4 py-2 bg-blue-600 text-white rounded-lg" onclick="showFinanceTab('payslips')">Payslips</button>
              <button class="px-4 py-2 bg-gray-200 text-gray-700 rounded-lg hover:bg-gray-300 transition-all" onclick="showFinanceTab('expenses')">Expenses</button>
              <button class="px-4 py-2 bg-gray-200 text-gray-700 rounded-lg hover:bg-gray-300 transition-all" onclick="showFinanceTab('sales')">Sales</button>
            </div>
          </div>
          
          <!-- Payslips Tab -->
          <div id="payslipsTab" class="finance-tab">
            <div class="mb-4">
              <p class="text-gray-600 mb-4">Download your payslips when activated by the CTIO.</p>
              <div id="supervisorPayslipsList" class="space-y-3">
                <!-- Payslips will be loaded dynamically here -->
                <div class="text-center text-gray-500 py-8" id="noPayslipsMessage">
                  <i class="fas fa-file-invoice-dollar text-4xl mb-4"></i>
                  <p>No payslips available yet.</p>
                  <p class="text-sm">Payslips will appear here when activated by the CTIO.</p>
                </div>
              </div>
            </div>
          </div>
          
          <!-- Expenses Tab -->
          <div id="expensesTab" class="finance-tab hidden">
            <!-- Expenses Header with Actions -->
            <div class="flex flex-col md:flex-row justify-between items-start md:items-center gap-4 mb-6 pb-4 border-b border-gray-200">
              <div>
                <h3 class="text-lg font-bold text-gray-800 mb-1">Expense Management</h3>
                <p class="text-sm text-gray-600">Track and manage all expenses</p>
              </div>
              <div class="flex flex-wrap gap-2">
                <button class="px-4 py-2 bg-gradient-to-r from-green-600 to-blue-600 text-white rounded-lg hover:from-green-700 hover:to-blue-700 transition-all shadow-md" onclick="openModal('expenseModal')">
                  <i class="fas fa-plus mr-2"></i> Add Expense
                </button>
                <button class="px-4 py-2 bg-gradient-to-r from-emerald-600 to-teal-600 text-white rounded-lg hover:from-emerald-700 hover:to-teal-700 transition-all shadow-md" onclick="exportExpensesToExcel()">
                  <i class="fas fa-file-excel mr-2"></i> Export to Excel
                </button>
              </div>
            </div>
            
            <!-- Expenses Summary Cards -->
            <div class="grid grid-cols-1 md:grid-cols-4 gap-4 mb-6">
              <div class="bg-gradient-to-br from-red-50 to-pink-50 border border-red-200 rounded-lg p-4">
                <div class="flex items-center justify-between">
                  <div>
                    <p class="text-sm text-gray-600 mb-1">Total Expenses</p>
                    <p class="text-2xl font-bold text-red-600" id="totalExpenses">Ksh 0</p>
                  </div>
                  <div class="w-12 h-12 bg-red-100 rounded-lg flex items-center justify-center">
                    <i class="fas fa-receipt text-red-600 text-xl"></i>
                  </div>
                </div>
              </div>
              <div class="bg-gradient-to-br from-yellow-50 to-orange-50 border border-yellow-200 rounded-lg p-4">
                <div class="flex items-center justify-between">
                  <div>
                    <p class="text-sm text-gray-600 mb-1">Pending</p>
                    <p class="text-2xl font-bold text-yellow-600" id="pendingExpenses">0</p>
                  </div>
                  <div class="w-12 h-12 bg-yellow-100 rounded-lg flex items-center justify-center">
                    <i class="fas fa-clock text-yellow-600 text-xl"></i>
                  </div>
                </div>
              </div>
              <div class="bg-gradient-to-br from-green-50 to-emerald-50 border border-green-200 rounded-lg p-4">
                <div class="flex items-center justify-between">
                  <div>
                    <p class="text-sm text-gray-600 mb-1">Approved</p>
                    <p class="text-2xl font-bold text-green-600" id="approvedExpenses">0</p>
                  </div>
                  <div class="w-12 h-12 bg-green-100 rounded-lg flex items-center justify-center">
                    <i class="fas fa-check-circle text-green-600 text-xl"></i>
                  </div>
                </div>
              </div>
              <div class="bg-gradient-to-br from-blue-50 to-cyan-50 border border-blue-200 rounded-lg p-4">
                <div class="flex items-center justify-between">
                  <div>
                    <p class="text-sm text-gray-600 mb-1">This Month</p>
                    <p class="text-2xl font-bold text-blue-600" id="monthlyExpenses">Ksh 0</p>
                  </div>
                  <div class="w-12 h-12 bg-blue-100 rounded-lg flex items-center justify-center">
                    <i class="fas fa-calendar text-blue-600 text-xl"></i>
                  </div>
                </div>
              </div>
            </div>
            
            <!-- Filters -->
            <div class="bg-gray-50 rounded-lg p-4 mb-4">
              <div class="grid grid-cols-1 md:grid-cols-4 gap-4">
                <div>
                  <label class="block text-sm font-medium text-gray-700 mb-1">Search</label>
                  <input type="text" id="expenseSearch" placeholder="Search expenses..." class="w-full px-3 py-2 border border-gray-300 rounded-lg text-sm focus:ring-2 focus:ring-blue-500 focus:border-blue-500" onkeyup="filterExpenses()">
                </div>
                <div>
                  <label class="block text-sm font-medium text-gray-700 mb-1">Type</label>
                  <select id="expenseTypeFilter" class="w-full px-3 py-2 border border-gray-300 rounded-lg text-sm focus:ring-2 focus:ring-blue-500 focus:border-blue-500" onchange="filterExpenses()">
                    <option value="">All Types</option>
                    <option value="Travel">Travel</option>
                    <option value="Meals">Meals</option>
                    <option value="Supplies">Supplies</option>
                    <option value="Equipment">Equipment</option>
                    <option value="Transportation">Transportation</option>
                    <option value="Repair and Maintenance">Repair and Maintenance</option>
                    <option value="Other">Other</option>
                  </select>
                </div>
                <div>
                  <label class="block text-sm font-medium text-gray-700 mb-1">Status</label>
                  <select id="expenseStatusFilter" class="w-full px-3 py-2 border border-gray-300 rounded-lg text-sm focus:ring-2 focus:ring-blue-500 focus:border-blue-500" onchange="filterExpenses()">
                    <option value="">All Status</option>
                    <option value="pending">Pending</option>
                    <option value="approved">Approved</option>
                    <option value="rejected">Rejected</option>
                  </select>
                </div>
                <div>
                  <label class="block text-sm font-medium text-gray-700 mb-1">Date Range</label>
                  <input type="month" id="expenseMonthFilter" class="w-full px-3 py-2 border border-gray-300 rounded-lg text-sm focus:ring-2 focus:ring-blue-500 focus:border-blue-500" onchange="filterExpenses()">
                </div>
              </div>
            </div>
            
            <!-- Expenses Table -->
            <div class="bg-white rounded-lg border border-gray-200 overflow-hidden">
              <div class="overflow-x-auto">
                <table class="w-full">
                  <thead class="bg-gradient-to-r from-gray-50 to-gray-100">
                    <tr>
                      <th class="text-left py-3 px-4 font-semibold text-gray-700 text-sm">Date</th>
                      <th class="text-left py-3 px-4 font-semibold text-gray-700 text-sm">Type</th>
                      <th class="text-left py-3 px-4 font-semibold text-gray-700 text-sm">Description</th>
                      <th class="text-left py-3 px-4 font-semibold text-gray-700 text-sm">Vendor</th>
                      <th class="text-left py-3 px-4 font-semibold text-gray-700 text-sm">Payee</th>
                      <th class="text-right py-3 px-4 font-semibold text-gray-700 text-sm">Amount (Ksh)</th>
                      <th class="text-left py-3 px-4 font-semibold text-gray-700 text-sm">Status</th>
                      <th class="text-center py-3 px-4 font-semibold text-gray-700 text-sm">Actions</th>
                    </tr>
                  </thead>
                  <tbody id="expensesTableBody" class="divide-y divide-gray-200">
                    <!-- Expenses will be loaded dynamically here -->
                  </tbody>
                </table>
              </div>
              <div id="expensesEmptyState" class="text-center py-12 hidden">
                <div class="w-16 h-16 bg-gray-100 rounded-full flex items-center justify-center mx-auto mb-4">
                  <i class="fas fa-receipt text-2xl text-gray-400"></i>
                </div>
                <h3 class="text-lg font-medium text-gray-800 mb-2">No Expenses Found</h3>
                <p class="text-gray-600 mb-6">Start by adding your first expense</p>
                <button onclick="openModal('expenseModal')" class="px-6 py-3 bg-gradient-to-r from-green-600 to-blue-600 text-white rounded-lg hover:from-green-700 hover:to-blue-700 transition-all">
                  <i class="fas fa-plus mr-2"></i> Add Expense
                </button>
              </div>
            </div>
          </div>
          
          <!-- Sales Tab -->
          <div id="salesTab" class="finance-tab hidden">
            <!-- Sales Header with Actions -->
            <div class="flex flex-col md:flex-row justify-between items-start md:items-center gap-4 mb-6 pb-4 border-b border-gray-200">
              <div>
                <h3 class="text-lg font-bold text-gray-800 mb-1">Sales Management</h3>
                <p class="text-sm text-gray-600">Track and manage all sales</p>
              </div>
              <div class="flex flex-wrap gap-2">
                <button class="px-4 py-2 bg-gradient-to-r from-green-600 to-blue-600 text-white rounded-lg hover:from-green-700 hover:to-blue-700 transition-all shadow-md" onclick="openModal('salesModal')">
                  <i class="fas fa-plus mr-2"></i> Add Sale
                </button>
                <button class="px-4 py-2 bg-gradient-to-r from-emerald-600 to-teal-600 text-white rounded-lg hover:from-emerald-700 hover:to-teal-700 transition-all shadow-md" onclick="exportSalesToExcel()">
                  <i class="fas fa-file-excel mr-2"></i> Export to Excel
                </button>
              </div>
            </div>
            
            <!-- Sales Summary Cards -->
            <div class="grid grid-cols-1 md:grid-cols-4 gap-4 mb-6">
              <div class="bg-gradient-to-br from-green-50 to-emerald-50 border border-green-200 rounded-lg p-4">
                <div class="flex items-center justify-between">
                  <div>
                    <p class="text-sm text-gray-600 mb-1">Total Sales</p>
                    <p class="text-2xl font-bold text-green-600" id="totalSales">Ksh 0</p>
                  </div>
                  <div class="w-12 h-12 bg-green-100 rounded-lg flex items-center justify-center">
                    <i class="fas fa-chart-line text-green-600 text-xl"></i>
                  </div>
                </div>
              </div>
              <div class="bg-gradient-to-br from-blue-50 to-cyan-50 border border-blue-200 rounded-lg p-4">
                <div class="flex items-center justify-between">
                  <div>
                    <p class="text-sm text-gray-600 mb-1">Paid</p>
                    <p class="text-2xl font-bold text-blue-600" id="paidSales">Ksh 0</p>
                  </div>
                  <div class="w-12 h-12 bg-blue-100 rounded-lg flex items-center justify-center">
                    <i class="fas fa-check-circle text-blue-600 text-xl"></i>
                  </div>
                </div>
              </div>
              <div class="bg-gradient-to-br from-yellow-50 to-orange-50 border border-yellow-200 rounded-lg p-4">
                <div class="flex items-center justify-between">
                  <div>
                    <p class="text-sm text-gray-600 mb-1">Pending</p>
                    <p class="text-2xl font-bold text-yellow-600" id="pendingSales">Ksh 0</p>
                  </div>
                  <div class="w-12 h-12 bg-yellow-100 rounded-lg flex items-center justify-center">
                    <i class="fas fa-clock text-yellow-600 text-xl"></i>
                  </div>
                </div>
              </div>
              <div class="bg-gradient-to-br from-purple-50 to-pink-50 border border-purple-200 rounded-lg p-4">
                <div class="flex items-center justify-between">
                  <div>
                    <p class="text-sm text-gray-600 mb-1">This Month</p>
                    <p class="text-2xl font-bold text-purple-600" id="monthlySales">Ksh 0</p>
                  </div>
                  <div class="w-12 h-12 bg-purple-100 rounded-lg flex items-center justify-center">
                    <i class="fas fa-calendar text-purple-600 text-xl"></i>
                  </div>
                </div>
              </div>
            </div>
            
            <!-- Filters -->
            <div class="bg-gray-50 rounded-lg p-4 mb-4">
              <div class="grid grid-cols-1 md:grid-cols-4 gap-4">
                <div>
                  <label class="block text-sm font-medium text-gray-700 mb-1">Search</label>
                  <input type="text" id="salesSearch" placeholder="Search sales..." class="w-full px-3 py-2 border border-gray-300 rounded-lg text-sm focus:ring-2 focus:ring-blue-500 focus:border-blue-500" onkeyup="filterSales()">
                </div>
                <div>
                  <label class="block text-sm font-medium text-gray-700 mb-1">Service Type</label>
                  <select id="salesServiceFilter" class="w-full px-3 py-2 border border-gray-300 rounded-lg text-sm focus:ring-2 focus:ring-blue-500 focus:border-blue-500" onchange="filterSales()">
                    <option value="">All Services</option>
                    <option value="Cyber Services">Cyber Services</option>
                    <option value="Equipment and Accessories">Equipment and Accessories</option>
                    <option value="Technical Support">Technical Support</option>
                    <option value="Other">Other</option>
                  </select>
                </div>
                <div>
                  <label class="block text-sm font-medium text-gray-700 mb-1">Payment Status</label>
                  <select id="salesStatusFilter" class="w-full px-3 py-2 border border-gray-300 rounded-lg text-sm focus:ring-2 focus:ring-blue-500 focus:border-blue-500" onchange="filterSales()">
                    <option value="">All Status</option>
                    <option value="Paid">Paid</option>
                    <option value="Pending">Pending</option>
                    <option value="Partial">Partial</option>
                    <option value="Overdue">Overdue</option>
                  </select>
                </div>
                <div>
                  <label class="block text-sm font-medium text-gray-700 mb-1">Date Range</label>
                  <input type="month" id="salesMonthFilter" class="w-full px-3 py-2 border border-gray-300 rounded-lg text-sm focus:ring-2 focus:ring-blue-500 focus:border-blue-500" onchange="filterSales()">
                </div>
              </div>
            </div>
            
            <!-- Sales Table -->
            <div class="bg-white rounded-lg border border-gray-200 overflow-hidden">
              <div class="overflow-x-auto">
                <table class="w-full">
                  <thead class="bg-gradient-to-r from-gray-50 to-gray-100">
                    <tr>
                      <th class="text-left py-3 px-4 font-semibold text-gray-700 text-sm">Date</th>
                      <th class="text-left py-3 px-4 font-semibold text-gray-700 text-sm">Client</th>
                      <th class="text-left py-3 px-4 font-semibold text-gray-700 text-sm">Service</th>
                      <th class="text-left py-3 px-4 font-semibold text-gray-700 text-sm">Description</th>
                      <th class="text-right py-3 px-4 font-semibold text-gray-700 text-sm">Amount (Ksh)</th>
                      <th class="text-left py-3 px-4 font-semibold text-gray-700 text-sm">Status</th>
                      <th class="text-center py-3 px-4 font-semibold text-gray-700 text-sm">Actions</th>
                    </tr>
                  </thead>
                  <tbody id="salesTableBody" class="divide-y divide-gray-200">
                    <!-- Sales will be loaded dynamically here -->
                  </tbody>
                </table>
              </div>
              <div id="salesEmptyState" class="text-center py-12 hidden">
                <div class="w-16 h-16 bg-gray-100 rounded-full flex items-center justify-center mx-auto mb-4">
                  <i class="fas fa-chart-line text-2xl text-gray-400"></i>
                </div>
                <h3 class="text-lg font-medium text-gray-800 mb-2">No Sales Found</h3>
                <p class="text-gray-600 mb-6">Start by adding your first sale</p>
                <button onclick="openModal('salesModal')" class="px-6 py-3 bg-gradient-to-r from-green-600 to-blue-600 text-white rounded-lg hover:from-green-700 hover:to-blue-700 transition-all">
                  <i class="fas fa-plus mr-2"></i> Add Sale
                </button>
              </div>
            </div>
          </div>
            </div>
          </div>
        </div>
      </section>

      <!-- Equipment & Tools Section -->
      <section id="equipment" class="page-section">
        <div class="bg-gray-50 h-full overflow-y-auto">
          <div class="max-w-7xl mx-auto p-4">
            <div class="mb-6">
              <h1 class="text-3xl font-bold text-gray-900 mb-2 flex items-center">
                <i class="fas fa-tools mr-3 text-blue-600"></i>
                Equipment & Tools Management
              </h1>
              <p class="text-gray-600">Manage inventory, track equipment status, and assign tools to field technicians.</p>
            </div>

        <!-- Equipment Statistics -->
        <div class="grid grid-cols-1 md:grid-cols-5 gap-4 mb-6">
          <div class="bg-blue-50 border border-blue-200 rounded-lg p-4">
            <div class="flex items-center">
              <div class="w-8 h-8 bg-blue-600 rounded flex items-center justify-center">
                <i class="fas fa-boxes text-white text-sm"></i>
              </div>
              <div class="ml-3">
                <p class="text-sm font-medium text-blue-900">Total Items</p>
                <p class="text-xl font-bold text-blue-600" id="totalItems">0</p>
              </div>
            </div>
          </div>
          <div class="bg-green-50 border border-green-200 rounded-lg p-4">
            <div class="flex items-center">
              <div class="w-8 h-8 bg-green-600 rounded flex items-center justify-center">
                <i class="fas fa-check-circle text-white text-sm"></i>
              </div>
              <div class="ml-3">
                <p class="text-sm font-medium text-green-900">Available</p>
                <p class="text-xl font-bold text-green-600" id="inStock">0</p>
              </div>
            </div>
          </div>
          <div class="bg-yellow-50 border border-yellow-200 rounded-lg p-4">
            <div class="flex items-center">
              <div class="w-8 h-8 bg-yellow-600 rounded flex items-center justify-center">
                <i class="fas fa-exclamation-triangle text-white text-sm"></i>
              </div>
              <div class="ml-3">
                <p class="text-sm font-medium text-yellow-900">Low Stock</p>
                <p class="text-xl font-bold text-yellow-600" id="lowStock">0</p>
              </div>
            </div>
          </div>
          <div class="bg-red-50 border border-red-200 rounded-lg p-4">
            <div class="flex items-center">
              <div class="w-8 h-8 bg-red-600 rounded flex items-center justify-center">
                <i class="fas fa-times-circle text-white text-sm"></i>
              </div>
              <div class="ml-3">
                <p class="text-sm font-medium text-red-900">Out of Stock</p>
                <p class="text-xl font-bold text-red-600" id="outOfStock">0</p>
              </div>
            </div>
          </div>
          <div class="bg-orange-50 border border-orange-200 rounded-lg p-4">
            <div class="flex items-center">
              <div class="w-8 h-8 bg-orange-600 rounded flex items-center justify-center">
                <i class="fas fa-user-check text-white text-sm"></i>
              </div>
              <div class="ml-3">
                <p class="text-sm font-medium text-orange-900">Assigned</p>
                <p class="text-xl font-bold text-orange-600" id="assignedItems">0</p>
              </div>
            </div>
          </div>
        </div>

        <!-- Equipment Management Panel -->
        <div class="bg-white rounded-xl shadow-lg border">
          <div class="px-6 py-4 border-b border-gray-200">
            <div class="flex flex-col sm:flex-row sm:items-center sm:justify-between space-y-3 sm:space-y-0">
              <div>
                <h2 class="text-lg font-semibold text-gray-900">Inventory Management</h2>
                <p class="text-sm text-gray-500">Supervisor access to equipment inventory and field assignments</p>
              </div>
              <div class="flex space-x-3">
                <button onclick="downloadInventoryReport()" class="bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-lg font-medium transition duration-200 flex items-center shadow-sm">
                  <i class="fas fa-download mr-2"></i>
                  Download Report
                </button>
                <button onclick="openAddEquipmentModal()" class="bg-green-600 hover:bg-green-700 text-white px-4 py-2 rounded-lg font-medium transition duration-200 flex items-center shadow-sm">
                  <i class="fas fa-plus mr-2"></i>
                  Add Equipment
                </button>
              </div>
            </div>
          </div>
          
          <div class="p-6">
            <!-- Filters and Search -->
            <div class="mb-6 flex flex-col sm:flex-row sm:items-center sm:justify-between space-y-3 sm:space-y-0">
              <div class="flex space-x-3">
                <select id="categoryFilter" onchange="filterEquipment()" class="px-3 py-2 border border-gray-300 rounded-lg focus:ring-blue-500 focus:border-blue-500">
                  <option value="">All Categories</option>
                  <option value="network">Network Equipment</option>
                  <option value="tools">Tools</option>
                  <option value="cables">Cables & Accessories</option>
                  <option value="hardware">Hardware</option>
                  <option value="safety">Safety Equipment</option>
                </select>
                <select id="statusFilter" onchange="filterEquipment()" class="px-3 py-2 border border-gray-300 rounded-lg focus:ring-blue-500 focus:border-blue-500">
                  <option value="">All Status</option>
                  <option value="in-stock">In Stock</option>
                  <option value="low-stock">Low Stock</option>
                  <option value="out-of-stock">Out of Stock</option>
                  <option value="assigned">Assigned to Tech</option>
                </select>
              </div>
              <div class="relative">
                <input
                  type="text"
                  id="equipmentSearch"
                  placeholder="Search equipment..."
                  onkeyup="filterEquipment()"
                  class="pl-10 pr-4 py-2 border border-gray-300 rounded-lg focus:ring-blue-500 focus:border-blue-500 w-64"
                />
                <div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
                  <i class="fas fa-search text-gray-400"></i>
                </div>
              </div>
            </div>

            <!-- Equipment Table -->
            <div class="bg-white rounded-lg border overflow-hidden scrollable-content">
              <div class="overflow-x-auto">
                <table class="min-w-full divide-y divide-gray-200">
                  <thead class="bg-gray-50">
                    <tr>
                      <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Equipment</th>
                      <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Category</th>
                      <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Stock</th>
                      <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Assigned</th>
                      <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Status</th>
                      <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Actions</th>
                    </tr>
                  </thead>
                  <tbody id="equipmentTableBody" class="bg-white divide-y divide-gray-200">
                    <!-- Equipment items will be loaded here -->
                  </tbody>
                </table>
              </div>
            </div>
          </div>
        </div>
      </section>

      <!-- Reports & Logs Section -->
      <section id="reports" class="page-section">
        <div class="bg-gray-50 h-full overflow-y-auto">
          <div class="max-w-7xl mx-auto p-4">
            <div class="mb-6">
              <h1 class="text-3xl font-bold text-gray-900 mb-2 flex items-center">
                <i class="fas fa-file-alt mr-3 text-green-600"></i>
                Reports & Logs
              </h1>
              <p class="text-gray-600">Generate reports, view system logs, and track operational activities.</p>
            </div>

        <!-- Report Statistics -->
        <div class="grid grid-cols-1 md:grid-cols-4 gap-6 mb-8">
          <div class="bg-gradient-to-r from-purple-500 to-purple-600 rounded-xl p-6 text-white">
            <div class="flex items-center justify-between">
              <div>
                <p class="text-purple-100">Today's Reports</p>
                <p class="text-3xl font-bold" id="todayReports">12</p>
              </div>
              <i class="fas fa-calendar-day text-4xl text-purple-200"></i>
            </div>
          </div>
          
          <div class="bg-gradient-to-r from-indigo-500 to-indigo-600 rounded-xl p-6 text-white">
            <div class="flex items-center justify-between">
              <div>
                <p class="text-indigo-100">This Week</p>
                <p class="text-3xl font-bold" id="weekReports">87</p>
              </div>
              <i class="fas fa-calendar-week text-4xl text-indigo-200"></i>
            </div>
          </div>
          
          <div class="bg-gradient-to-r from-teal-500 to-teal-600 rounded-xl p-6 text-white">
            <div class="flex items-center justify-between">
              <div>
                <p class="text-teal-100">Pending Review</p>
                <p class="text-3xl font-bold" id="pendingReports">5</p>
              </div>
              <i class="fas fa-clock text-4xl text-teal-200"></i>
            </div>
          </div>
          
          <div class="bg-gradient-to-r from-emerald-500 to-emerald-600 rounded-xl p-6 text-white">
            <div class="flex items-center justify-between">
              <div>
                <p class="text-emerald-100">Approved</p>
                <p class="text-3xl font-bold" id="approvedReports">234</p>
              </div>
              <i class="fas fa-check-double text-4xl text-emerald-200"></i>
            </div>
          </div>
        </div>

        <!-- Report Generation Panel -->
        <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 mb-6">
          <!-- Generate New Report -->
          <div class="bg-white rounded-xl shadow-lg p-6">
            <h3 class="text-lg font-bold text-gray-800 mb-4">Generate New Report</h3>
            <form id="reportForm">
              <div class="mb-4">
                <label class="block text-gray-700 font-medium mb-2">Report Type</label>
                <select id="reportType" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500">
                  <option value="daily">Daily Activity Report</option>
                  <option value="equipment">Equipment Status Report</option>
                  <option value="staff">Staff Performance Report</option>
                  <option value="incident">Incident Report</option>
                  <option value="maintenance">Maintenance Report</option>
                </select>
              </div>
              
              <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4">
                <div>
                  <label class="block text-gray-700 font-medium mb-2">Start Date</label>
                  <input type="date" id="reportStartDate" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500">
                </div>
                <div>
                  <label class="block text-gray-700 font-medium mb-2">End Date</label>
                  <input type="date" id="reportEndDate" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500">
                </div>
              </div>
              
              <div class="mb-4">
                <label class="block text-gray-700 font-medium mb-2">Description</label>
                <textarea id="reportDescription" rows="3" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500" placeholder="Enter report description..."></textarea>
              </div>
              
              <button type="submit" class="w-full bg-blue-600 hover:bg-blue-700 text-white py-2 px-4 rounded-lg transition-colors">
                <i class="fas fa-plus mr-2"></i>Generate Report
              </button>
            </form>
          </div>

          <!-- Quick Actions -->
          <div class="bg-white rounded-xl shadow-lg p-6">
            <h3 class="text-lg font-bold text-gray-800 mb-4">Quick Actions</h3>
            <div class="space-y-3">
              <button onclick="generateDailyReport()" class="w-full text-left px-4 py-3 bg-gray-50 hover:bg-gray-100 rounded-lg transition-colors">
                <i class="fas fa-calendar-day text-blue-600 mr-3"></i>
                <span class="font-medium">Daily Summary</span>
              </button>
              <button onclick="exportAllReports()" class="w-full text-left px-4 py-3 bg-gray-50 hover:bg-gray-100 rounded-lg transition-colors">
                <i class="fas fa-download text-green-600 mr-3"></i>
                <span class="font-medium">Export All Reports</span>
              </button>
              <button onclick="viewSystemLogs()" class="w-full text-left px-4 py-3 bg-gray-50 hover:bg-gray-100 rounded-lg transition-colors">
                <i class="fas fa-list-alt text-purple-600 mr-3"></i>
                <span class="font-medium">View System Logs</span>
              </button>
              <button onclick="scheduleReport()" class="w-full text-left px-4 py-3 bg-gray-50 hover:bg-gray-100 rounded-lg transition-colors">
                <i class="fas fa-clock text-orange-600 mr-3"></i>
                <span class="font-medium">Schedule Report</span>
              </button>
            </div>
          </div>
        </div>

        <!-- Recent Reports -->
        <div class="bg-white rounded-xl shadow-lg p-6">
          <h3 class="text-lg font-bold text-gray-800 mb-4">Recent Reports</h3>
          <div class="overflow-x-auto">
            <table class="w-full">
              <thead class="bg-gray-50">
                <tr>
                  <th class="text-left py-3 px-4 font-semibold text-gray-700">Report Name</th>
                  <th class="text-left py-3 px-4 font-semibold text-gray-700">Type</th>
                  <th class="text-left py-3 px-4 font-semibold text-gray-700">Generated By</th>
                  <th class="text-left py-3 px-4 font-semibold text-gray-700">Date</th>
                  <th class="text-left py-3 px-4 font-semibold text-gray-700">Status</th>
                  <th class="text-left py-3 px-4 font-semibold text-gray-700">Actions</th>
                </tr>
              </thead>
              <tbody id="reportsTableBody">
                <!-- Reports will be populated by JavaScript -->
              </tbody>
            </table>
          </div>
        </div>
      </section>

      <!-- Team Communication Section -->
      <section id="communication" class="page-section">
        <div class="bg-gray-50 h-full overflow-y-auto">
          <div class="max-w-7xl mx-auto p-4">
            <div class="mb-6">
              <h1 class="text-3xl font-bold text-gray-900 mb-2 flex items-center">
                <i class="fas fa-comments mr-3 text-purple-600"></i>
                Team Communication
              </h1>
              <p class="text-gray-600">Real-time messaging, announcements, and team collaboration tools.</p>
            </div>

        <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
          <!-- Chat Panel -->
          <div class="lg:col-span-2">
            <div class="bg-white rounded-xl shadow-lg h-[600px] flex flex-col">
              <!-- Chat Header -->
              <div class="border-b border-gray-200 p-4">
                <div class="flex items-center justify-between">
                  <div class="flex items-center space-x-3">
                    <div class="w-10 h-10 bg-purple-600 rounded-full flex items-center justify-center">
                      <i class="fas fa-users text-white"></i>
                    </div>
                    <div>
                      <h3 class="font-semibold text-gray-900">Team Chat</h3>
                      <p class="text-sm text-gray-500" id="onlineCount">8 members online</p>
                    </div>
                  </div>
                  <div class="flex items-center space-x-2">
                    <button onclick="clearChat()" class="text-gray-400 hover:text-red-600 transition-colors p-2">
                      <i class="fas fa-trash"></i>
                    </button>
                    <button onclick="refreshChat()" class="text-gray-400 hover:text-blue-600 transition-colors p-2">
                      <i class="fas fa-sync-alt"></i>
                    </button>
                  </div>
                </div>
              </div>

              <!-- Messages Area -->
              <div id="chatMessages" class="flex-1 overflow-y-auto p-4 space-y-4">
                <!-- Chat messages will be populated here -->
              </div>

              <!-- Message Input -->
              <div class="border-t border-gray-200 p-4">
                <div class="flex items-center space-x-3">
                  <input type="text" id="messageInput" placeholder="Type your message..." class="flex-1 px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-purple-500">
                  <button onclick="sendMessage()" class="bg-purple-600 hover:bg-purple-700 text-white px-6 py-2 rounded-lg transition-colors">
                    <i class="fas fa-paper-plane"></i>
                  </button>
                </div>
              </div>
            </div>
          </div>

          <!-- Team Panel -->
          <div class="space-y-6">
            <!-- Online Team Members -->
            <div class="bg-white rounded-xl shadow-lg p-6">
              <h3 class="text-lg font-bold text-gray-800 mb-4">Team Members</h3>
              <div id="teamMembers" class="space-y-3">
                <!-- Team members will be populated here -->
              </div>
            </div>

            <!-- Announcements -->
            <div class="bg-white rounded-xl shadow-lg p-6">
              <div class="flex justify-between items-center mb-4">
                <h3 class="text-lg font-bold text-gray-800">Announcements</h3>
                <button onclick="createAnnouncement()" class="text-purple-600 hover:text-purple-700">
                  <i class="fas fa-plus"></i>
                </button>
              </div>
              <div id="announcements" class="space-y-3">
                <!-- Announcements will be populated here -->
              </div>
            </div>
          </div>
        </div>
      </section>

      <!-- Settings Section -->
      <section id="settings" class="page-section">
        <div class="bg-gray-50 h-full overflow-y-auto">
          <div class="max-w-7xl mx-auto p-4">
            <div class="mb-6">
              <h1 class="text-3xl font-bold text-gray-900 mb-2 flex items-center">
                <i class="fas fa-cog mr-3 text-gray-600"></i>
                Settings & Configuration
              </h1>
              <p class="text-gray-600">Manage system settings, user preferences, and account configuration.</p>
            </div>

        <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
          <!-- Settings Menu -->
          <div class="bg-white rounded-xl shadow-lg p-6">
            <h3 class="text-lg font-bold text-gray-800 mb-4">Settings Categories</h3>
            <nav class="space-y-2">
              <button onclick="showSettingsTab('profile')" class="settings-tab-btn active w-full text-left px-4 py-3 rounded-lg transition-colors">
                <i class="fas fa-user mr-3"></i>Profile Settings
              </button>
              <button onclick="showSettingsTab('account')" class="settings-tab-btn w-full text-left px-4 py-3 rounded-lg transition-colors">
                <i class="fas fa-shield-alt mr-3"></i>Account Security
              </button>
              <button onclick="showSettingsTab('notifications')" class="settings-tab-btn w-full text-left px-4 py-3 rounded-lg transition-colors">
                <i class="fas fa-bell mr-3"></i>Notifications
              </button>
              <button onclick="showSettingsTab('system')" class="settings-tab-btn w-full text-left px-4 py-3 rounded-lg transition-colors">
                <i class="fas fa-cogs mr-3"></i>System Settings
              </button>
              <button onclick="showSettingsTab('backup')" class="settings-tab-btn w-full text-left px-4 py-3 rounded-lg transition-colors">
                <i class="fas fa-database mr-3"></i>Backup & Export
              </button>
            </nav>
          </div>

          <!-- Settings Content -->
          <div class="lg:col-span-2">
            <!-- Profile Settings Tab -->
            <div id="profileSettings" class="settings-tab-content bg-white rounded-xl shadow-lg p-6">
              <h3 class="text-lg font-bold text-gray-800 mb-6">Profile Information</h3>
              <form id="profileForm">
                <div class="flex items-center space-x-6 mb-6">
                  <div class="w-24 h-24 bg-gray-200 rounded-full flex items-center justify-center">
                    <i class="fas fa-user text-3xl text-gray-400"></i>
                  </div>
                  <div>
                    <button type="button" class="bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-lg transition-colors">
                      Change Photo
                    </button>
                    <p class="text-sm text-gray-500 mt-2">JPG, PNG or GIF. Max size 2MB.</p>
                  </div>
                </div>
                
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-6">
                  <div>
                    <label class="block text-gray-700 font-medium mb-2">Full Name</label>
                    <input type="text" value="John Supervisor" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500">
                  </div>
                  <div>
                    <label class="block text-gray-700 font-medium mb-2">Employee ID</label>
                    <input type="text" value="SUP001" class="w-full px-4 py-2 border border-gray-300 rounded-lg bg-gray-50" readonly>
                  </div>
                  <div>
                    <label class="block text-gray-700 font-medium mb-2">Email</label>
                    <input type="email" value="john.supervisor@company.com" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500">
                  </div>
                  <div>
                    <label class="block text-gray-700 font-medium mb-2">Phone</label>
                    <input type="tel" value="+254 712 345 678" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500">
                  </div>
                </div>
                
                <button type="submit" class="bg-blue-600 hover:bg-blue-700 text-white px-6 py-2 rounded-lg transition-colors">
                  <i class="fas fa-save mr-2"></i>Save Changes
                </button>
              </form>
            </div>

            <!-- Account Security Tab -->
            <div id="accountSettings" class="settings-tab-content bg-white rounded-xl shadow-lg p-6" style="display: none;">
              <h3 class="text-lg font-bold text-gray-800 mb-6">Account Security</h3>
              <form id="securityForm">
                <div class="mb-6">
                  <label class="block text-gray-700 font-medium mb-2">Current Password</label>
                  <input type="password" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500">
                </div>
                
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-6">
                  <div>
                    <label class="block text-gray-700 font-medium mb-2">New Password</label>
                    <input type="password" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500">
                  </div>
                  <div>
                    <label class="block text-gray-700 font-medium mb-2">Confirm Password</label>
                    <input type="password" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500">
                  </div>
                </div>
                
                <div class="mb-6">
                  <label class="flex items-center">
                    <input type="checkbox" class="mr-2">
                    <span class="text-gray-700">Enable two-factor authentication</span>
                  </label>
                </div>
                
                <button type="submit" class="bg-red-600 hover:bg-red-700 text-white px-6 py-2 rounded-lg transition-colors">
                  <i class="fas fa-shield-alt mr-2"></i>Update Security
                </button>
              </form>
            </div>

            <!-- Other settings tabs can be added similarly -->
            <div id="notificationsSettings" class="settings-tab-content bg-white rounded-xl shadow-lg p-6" style="display: none;">
              <h3 class="text-lg font-bold text-gray-800 mb-6">Notification Preferences</h3>
              <!-- Notification settings content -->
              <div class="space-y-4">
                <label class="flex items-center justify-between">
                  <span class="text-gray-700">Email notifications</span>
                  <input type="checkbox" checked class="toggle-switch">
                </label>
                <label class="flex items-center justify-between">
                  <span class="text-gray-700">SMS notifications</span>
                  <input type="checkbox" class="toggle-switch">
                </label>
                <label class="flex items-center justify-between">
                  <span class="text-gray-700">Push notifications</span>
                  <input type="checkbox" checked class="toggle-switch">
                </label>
              </div>
            </div>
          </div>
        </div>
          </div>
        </div>
      </section>
    </main>
  </div>

  <!-- Modals -->
  <!-- Ticket Modal -->
  <div id="ticketModal" class="modal">
    <div class="modal-content">
      <div class="modal-header">
        <h2 class="text-xl font-bold">Create New Ticket</h2>
        <button class="text-white hover:text-gray-200" onclick="closeModal('ticketModal')">
          <i class="fas fa-times text-xl"></i>
        </button>
      </div>
      <div class="modal-body">
        <form>
          <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4">
            <div>
              <label class="block text-gray-700 font-medium mb-2">Ticket Title</label>
              <input type="text" class="form-input border border-gray-300 rounded-lg px-4 py-2 w-full" placeholder="Enter ticket title">
            </div>
            <div>
              <label class="block text-gray-700 font-medium mb-2">Priority</label>
              <select class="form-input border border-gray-300 rounded-lg px-4 py-2 w-full">
                <option>Low</option>
                <option>Medium</option>
                <option>High</option>
                <option>Urgent</option>
              </select>
            </div>
          </div>
          
          <div class="mb-4">
            <label class="block text-gray-700 font-medium mb-2">Description</label>
            <textarea class="form-input border border-gray-300 rounded-lg px-4 py-2 w-full" rows="4" placeholder="Describe the issue"></textarea>
          </div>
          
          <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4">
            <div>
              <label class="block text-gray-700 font-medium mb-2">Client Name</label>
              <input type="text" class="form-input border border-gray-300 rounded-lg px-4 py-2 w-full" placeholder="Enter client name">
            </div>
            <div>
              <label class="block text-gray-700 font-medium mb-2">Client Location</label>
              <input type="text" class="form-input border border-gray-300 rounded-lg px-4 py-2 w-full" placeholder="Enter client location">
            </div>
          </div>
          
          <div class="mb-4">
            <label class="block text-gray-700 font-medium mb-2">Contact Information</label>
            <input type="text" class="form-input border border-gray-300 rounded-lg px-4 py-2 w-full" placeholder="Phone or email">
          </div>
        </form>
      </div>
      <div class="modal-footer">
        <button type="button" class="px-4 py-2 bg-gray-200 text-gray-700 rounded-lg hover:bg-gray-300 transition-all" onclick="closeModal('ticketModal')">
          Cancel
        </button>
        <button type="button" class="px-4 py-2 btn-gradient text-white rounded-lg" onclick="submitTicket()">
          <i class="fas fa-paper-plane mr-2"></i> Submit Ticket
        </button>
      </div>
    </div>
  </div>

  <!-- Assignment Modal -->
  <div id="assignmentModal" class="modal">
    <div class="modal-content">
      <div class="modal-header">
        <h2 class="text-xl font-bold">Create New Assignment</h2>
        <button class="text-white hover:text-gray-200" onclick="closeModal('assignmentModal')">
          <i class="fas fa-times text-xl"></i>
        </button>
      </div>
      <div class="modal-body">
        <form>
          <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4">
            <div>
              <label class="block text-gray-700 font-medium mb-2">Assignment Type</label>
              <select id="assignmentType" class="form-input border border-gray-300 rounded-lg px-4 py-2 w-full">
                <option>Installation</option>
                <option>Maintenance</option>
                <option>Repair</option>
                <option>Inspection</option>
                <option>Asset Recovery</option>
                <option>Relocation</option>
              </select>
            </div>
            <div>
              <label class="block text-gray-700 font-medium mb-2">Client Name</label>
              <input type="text" id="assignmentClientName" class="form-input border border-gray-300 rounded-lg px-4 py-2 w-full" placeholder="Enter client name">
            </div>
          </div>
          
          <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4">
            <div>
              <label class="block text-gray-700 font-medium mb-2">Location</label>
              <input type="text" id="assignmentLocation" class="form-input border border-gray-300 rounded-lg px-4 py-2 w-full" placeholder="Enter location">
            </div>
            <div>
              <label class="block text-gray-700 font-medium mb-2">Assigned Technician</label>
              <select id="assignmentTechnician" class="form-input border border-gray-300 rounded-lg px-4 py-2 w-full">
                <option>Michael Johnson</option>
                <option>Sarah Williams</option>
                <option>David Brown</option>
                <option>Emily Davis</option>
              </select>
            </div>
          </div>
          
          <div class="mb-4">
            <label class="block text-gray-700 font-medium mb-2">Equipment Assigned</label>
            <textarea id="assignmentEquipment" class="form-input border border-gray-300 rounded-lg px-4 py-2 w-full" rows="3" placeholder="List equipment assigned (manual entry)"></textarea>
          </div>
          
          <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4">
            <div>
              <label class="block text-gray-700 font-medium mb-2">Scheduled Date</label>
              <input type="date" id="assignmentDate" class="form-input border border-gray-300 rounded-lg px-4 py-2 w-full">
            </div>
            <div>
              <label class="block text-gray-700 font-medium mb-2">Priority</label>
              <select id="assignmentPriority" class="form-input border border-gray-300 rounded-lg px-4 py-2 w-full">
                <option>Low</option>
                <option>Medium</option>
                <option>High</option>
                <option>Urgent</option>
              </select>
            </div>
          </div>
          
          <div class="mb-4">
            <label class="block text-gray-700 font-medium mb-2">Notes</label>
            <textarea id="assignmentNotes" class="form-input border border-gray-300 rounded-lg px-4 py-2 w-full" rows="3" placeholder="Additional notes"></textarea>
          </div>
        </form>
      </div>
      <div class="modal-footer">
        <button type="button" class="px-4 py-2 bg-gray-200 text-gray-700 rounded-lg hover:bg-gray-300 transition-all" onclick="closeModal('assignmentModal')">
          Cancel
        </button>
        <button type="button" class="px-4 py-2 btn-gradient text-white rounded-lg" onclick="submitAssignment()">
          <i class="fas fa-save mr-2"></i> Create Assignment
        </button>
      </div>
    </div>
  </div>

  <!-- Booking Modal -->
  <div id="bookingModal" class="modal">
    <div class="modal-content">
      <div class="modal-header">
        <h2 class="text-xl font-bold">Add New Booking</h2>
        <button class="text-white hover:text-gray-200" onclick="closeModal('bookingModal')">
          <i class="fas fa-times text-xl"></i>
        </button>
      </div>
      <div class="modal-body">
        <form>
          <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4">
            <div>
              <label class="block text-gray-700 font-medium mb-2">Full Name *</label>
              <input type="text" class="form-input border border-gray-300 rounded-lg px-4 py-2 w-full" placeholder="Enter full name" required>
            </div>
            <div>
              <label class="block text-gray-700 font-medium mb-2">Phone Number *</label>
              <div class="relative">
                <span class="absolute left-3 top-2 text-gray-500">+254</span>
                <input type="tel" class="form-input border border-gray-300 rounded-lg px-4 py-2 w-full pl-16" placeholder="xxx xxx xxx" required>
              </div>
            </div>
          </div>
          
          <div class="mb-4">
            <label class="block text-gray-700 font-medium mb-2">Email Address</label>
            <input type="email" class="form-input border border-gray-300 rounded-lg px-4 py-2 w-full" placeholder="email@example.com">
          </div>
          
          <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4">
            <div>
              <label class="block text-gray-700 font-medium mb-2">Location *</label>
              <input type="text" class="form-input border border-gray-300 rounded-lg px-4 py-2 w-full" placeholder="Enter location" required>
            </div>
            <div>
              <label class="block text-gray-700 font-medium mb-2">Exact Location *</label>
              <input type="text" class="form-input border border-gray-300 rounded-lg px-4 py-2 w-full" placeholder="Enter location" required>
            </div>
          </div>
          
          <div class="mb-4">
            <label class="block text-gray-700 font-medium mb-2">Package *</label>
            <select class="form-input border border-gray-300 rounded-lg px-4 py-2 w-full" required>
              <option value="">Choose a Package</option>
              <option value="Bronze Plan - Up to 5 Mbps (Ksh 1,500/Month)">Bronze Plan - Up to 5 Mbps (Ksh 1,500/Month)</option>
              <option value="Silver Plan - Up to 10 Mbps (Ksh 2,000/Month)">Silver Plan - Up to 10 Mbps (Ksh 2,000/Month)</option>
              <option value="Gold Plan - Up to 15 Mbps (Ksh 2,500/Month)">Gold Plan - Up to 15 Mbps (Ksh 2,500/Month)</option>
              <option value="Platinum Plan - Up to 20 Mbps (Ksh 3,000/Month)">Platinum Plan - Up to 20 Mbps (Ksh 3,000/Month)</option>
              <option value="Super Plan - Up to 35 Mbps (Ksh 4,500/Month)">Super Plan - Up to 35 Mbps (Ksh 4,500/Month)</option>
              <option value="Dedicated Link - Up to 200 Mbps (Contact for Quote)">Dedicated Link - Up to 200 Mbps (Contact for Quote)</option>
            </select>
          </div>
          
          <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4">
            <div>
              <label class="block text-gray-700 font-medium mb-2">Status</label>
              <select class="form-input border border-gray-300 rounded-lg px-4 py-2 w-full">
                <option value="pending">Pending</option>
                <option value="confirmed">Confirmed</option>
                <option value="scheduled">Scheduled</option>
                <option value="cancelled">Cancelled</option>
              </select>
            </div>
            <div>
              <label class="block text-gray-700 font-medium mb-2">Installation Date</label>
              <input type="date" class="form-input border border-gray-300 rounded-lg px-4 py-2 w-full">
            </div>
          </div>
          
          <div class="mb-4">
            <label class="block text-gray-700 font-medium mb-2">Message</label>
            <textarea class="form-input border border-gray-300 rounded-lg px-4 py-2 w-full" rows="4" placeholder="Additional notes or requirements"></textarea>
          </div>
        </form>
      </div>
      <div class="modal-footer">
        <button type="button" class="px-4 py-2 bg-gray-200 text-gray-700 rounded-lg hover:bg-gray-300 transition-all" onclick="closeModal('bookingModal')">
          Cancel
        </button>
        <button type="button" class="px-4 py-2 btn-gradient text-white rounded-lg" onclick="submitBooking()">
          <i class="fas fa-plus mr-2"></i> Add Booking
        </button>
      </div>
    </div>
  </div>

  <!-- Expense Modal -->
  <div id="expenseModal" class="modal">
    <div class="modal-content">
      <div class="modal-header">
        <h2 class="text-xl font-bold">Add New Expense</h2>
        <button class="text-white hover:text-gray-200" onclick="closeModal('expenseModal')">
          <i class="fas fa-times text-xl"></i>
        </button>
      </div>
      <div class="modal-body">
        <form id="expenseForm">
          <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4">
            <div>
              <label class="block text-gray-700 font-medium mb-2">Expense Type <span class="text-red-500">*</span></label>
              <select id="expenseType" class="form-input border border-gray-300 rounded-lg px-4 py-2 w-full" required>
                <option value="">Select expense type</option>
                <option value="Travel">Travel</option>
                <option value="Meals">Meals</option>
                <option value="Supplies">Supplies</option>
                <option value="Equipment">Equipment</option>
                <option value="Transportation">Transportation</option>
                <option value="Repair and Maintenance">Repair and Maintenance</option>
                <option value="Other">Other</option>
              </select>
            </div>
            <div>
              <label class="block text-gray-700 font-medium mb-2">Amount (Ksh) <span class="text-red-500">*</span></label>
              <input type="number" id="expenseAmount" step="0.01" min="0" class="form-input border border-gray-300 rounded-lg px-4 py-2 w-full" placeholder="Enter amount" required>
            </div>
          </div>
          
          <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4">
            <div>
              <label class="block text-gray-700 font-medium mb-2">Vendor</label>
              <input type="text" id="expenseVendor" class="form-input border border-gray-300 rounded-lg px-4 py-2 w-full" placeholder="Enter vendor name">
            </div>
            <div>
              <label class="block text-gray-700 font-medium mb-2">Payee</label>
              <input type="text" id="expensePayee" class="form-input border border-gray-300 rounded-lg px-4 py-2 w-full" placeholder="Enter payee name">
            </div>
          </div>
          
          <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4">
            <div>
              <label class="block text-gray-700 font-medium mb-2">Date <span class="text-red-500">*</span></label>
              <input type="date" id="expenseDate" class="form-input border border-gray-300 rounded-lg px-4 py-2 w-full" required>
            </div>
            <div>
              <label class="block text-gray-700 font-medium mb-2">Status</label>
              <select id="expenseStatus" class="form-input border border-gray-300 rounded-lg px-4 py-2 w-full">
                <option value="pending">Pending</option>
                <option value="approved">Approved</option>
                <option value="rejected">Rejected</option>
              </select>
            </div>
          </div>
          
          <div class="mb-4">
            <label class="block text-gray-700 font-medium mb-2">Description <span class="text-red-500">*</span></label>
            <textarea id="expenseDescription" class="form-input border border-gray-300 rounded-lg px-4 py-2 w-full" rows="3" placeholder="Describe the expense" required></textarea>
          </div>
        </form>
      </div>
      <div class="modal-footer">
        <button type="button" class="px-4 py-2 bg-gray-200 text-gray-700 rounded-lg hover:bg-gray-300 transition-all" onclick="closeModal('expenseModal')">
          Cancel
        </button>
        <button type="button" class="px-4 py-2 btn-gradient text-white rounded-lg" onclick="submitExpense()">
          <i class="fas fa-save mr-2"></i> Save Expense
        </button>
      </div>
    </div>
  </div>

  <!-- Sales Modal -->
  <div id="salesModal" class="modal">
    <div class="modal-content">
      <div class="modal-header">
        <h2 class="text-xl font-bold">Add New Sale</h2>
        <button class="text-white hover:text-gray-200" onclick="closeModal('salesModal')">
          <i class="fas fa-times text-xl"></i>
        </button>
      </div>
      <div class="modal-body">
        <form id="saleForm">
          <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4">
            <div>
              <label class="block text-gray-700 font-medium mb-2">Client Name <span class="text-red-500">*</span></label>
              <input type="text" id="saleClientName" class="form-input border border-gray-300 rounded-lg px-4 py-2 w-full" placeholder="Enter client name" required>
            </div>
            <div>
              <label class="block text-gray-700 font-medium mb-2">Service Type <span class="text-red-500">*</span></label>
              <select id="saleServiceType" class="form-input border border-gray-300 rounded-lg px-4 py-2 w-full" required>
                <option value="">Select service type</option>
                <option value="Cyber Services">Cyber Services</option>
                <option value="Equipment and Accessories">Equipment and Accessories</option>
                <option value="Technical Support">Technical Support</option>
                <option value="Other">Other</option>
              </select>
            </div>
          </div>
          
          <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4">
            <div>
              <label class="block text-gray-700 font-medium mb-2">Sale Amount (Ksh) <span class="text-red-500">*</span></label>
              <input type="number" id="saleAmount" step="0.01" min="0" class="form-input border border-gray-300 rounded-lg px-4 py-2 w-full" placeholder="Enter sale amount" required>
            </div>
            <div>
              <label class="block text-gray-700 font-medium mb-2">Date <span class="text-red-500">*</span></label>
              <input type="date" id="saleDate" class="form-input border border-gray-300 rounded-lg px-4 py-2 w-full" required>
            </div>
          </div>
          
          <div class="mb-4">
            <label class="block text-gray-700 font-medium mb-2">Description</label>
            <textarea id="saleDescription" class="form-input border border-gray-300 rounded-lg px-4 py-2 w-full" rows="3" placeholder="Describe the sale/service"></textarea>
          </div>
          
          <div class="mb-4">
            <label class="block text-gray-700 font-medium mb-2">Payment Status</label>
            <select id="salePaymentStatus" class="form-input border border-gray-300 rounded-lg px-4 py-2 w-full">
              <option value="Paid">Paid</option>
              <option value="Pending">Pending</option>
              <option value="Partial">Partial</option>
              <option value="Overdue">Overdue</option>
            </select>
          </div>
        </form>
      </div>
      <div class="modal-footer">
        <button type="button" class="px-4 py-2 bg-gray-200 text-gray-700 rounded-lg hover:bg-gray-300 transition-all" onclick="closeModal('salesModal')">
          Cancel
        </button>
        <button type="button" class="px-4 py-2 btn-gradient text-white rounded-lg" onclick="submitSale()">
          <i class="fas fa-save mr-2"></i> Save Sale
        </button>
      </div>
    </div>
  </div>

  <!-- Equipment Modal -->
  <div id="equipmentModal" class="modal">
    <div class="modal-content">
      <div class="modal-header">
        <h2 class="text-xl font-bold">Add New Equipment</h2>
        <button class="text-white hover:text-gray-200" onclick="closeModal('equipmentModal')">
          <i class="fas fa-times text-xl"></i>
        </button>
      </div>
      <div class="modal-body">
        <form>
          <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4">
            <div>
              <label class="block text-gray-700 font-medium mb-2">Equipment Name</label>
              <input type="text" class="form-input border border-gray-300 rounded-lg px-4 py-2 w-full" placeholder="Enter equipment name">
            </div>
            <div>
              <label class="block text-gray-700 font-medium mb-2">Category</label>
              <select class="form-input border border-gray-300 rounded-lg px-4 py-2 w-full">
                <option>Tools</option>
                <option>Testing Equipment</option>
                <option>Safety Gear</option>
                <option>Installation Materials</option>
                <option>Other</option>
              </select>
            </div>
          </div>
          
          <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4">
            <div>
              <label class="block text-gray-700 font-medium mb-2">Quantity</label>
              <input type="number" class="form-input border border-gray-300 rounded-lg px-4 py-2 w-full" placeholder="Enter quantity">
            </div>
            <div>
              <label class="block text-gray-700 font-medium mb-2">Status</label>
              <select class="form-input border border-gray-300 rounded-lg px-4 py-2 w-full">
                <option>In Stock</option>
                <option>Out of Stock</option>
                <option>Low Stock</option>
              </select>
            </div>
          </div>
          
          <div class="mb-4">
            <label class="block text-gray-700 font-medium mb-2">Description</label>
            <textarea class="form-input border border-gray-300 rounded-lg px-4 py-2 w-full" rows="3" placeholder="Describe the equipment"></textarea>
          </div>
        </form>
      </div>
      <div class="modal-footer">
        <button type="button" class="px-4 py-2 bg-gray-200 text-gray-700 rounded-lg hover:bg-gray-300 transition-all" onclick="closeModal('equipmentModal')">
          Cancel
        </button>
        <button type="button" class="px-4 py-2 btn-gradient text-white rounded-lg" onclick="submitEquipment()">
          <i class="fas fa-save mr-2"></i> Save Equipment
        </button>
      </div>
    </div>
  </div>

  <!-- Report Modal -->
  <div id="reportModal" class="modal">
    <div class="modal-content">
      <div class="modal-header">
        <h2 class="text-xl font-bold">Create New Report</h2>
        <button class="text-white hover:text-gray-200" onclick="closeModal('reportModal')">
          <i class="fas fa-times text-xl"></i>
        </button>
      </div>
      <div class="modal-body">
        <form>
          <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4">
            <div>
              <label class="block text-gray-700 font-medium mb-2">Report Date</label>
              <input type="date" class="form-input border border-gray-300 rounded-lg px-4 py-2 w-full">
            </div>
            <div>
              <label class="block text-gray-700 font-medium mb-2">Report Type</label>
              <select class="form-input border border-gray-300 rounded-lg px-4 py-2 w-full">
                <option>Daily Report</option>
                <option>Weekly Report</option>
                <option>Incident Report</option>
                <option>Service Report</option>
              </select>
            </div>
          </div>
          
          <div class="mb-4">
            <label class="block text-gray-700 font-medium mb-2">Summary</label>
            <textarea class="form-input border border-gray-300 rounded-lg px-4 py-2 w-full" rows="4" placeholder="Provide a summary of today's activities"></textarea>
          </div>
          
          <div class="mb-4">
            <label class="block text-gray-700 font-medium mb-2">Completed Tasks</label>
            <textarea class="form-input border border-gray-300 rounded-lg px-4 py-2 w-full" rows="3" placeholder="List all completed tasks"></textarea>
          </div>
          
          <div class="mb-4">
            <label class="block text-gray-700 font-medium mb-2">Issues/Challenges</label>
            <textarea class="form-input border border-gray-300 rounded-lg px-4 py-2 w-full" rows="3" placeholder="Describe any issues or challenges faced"></textarea>
          </div>
          
          <div class="mb-4">
            <label class="block text-gray-700 font-medium mb-2">Tomorrow's Plan</label>
            <textarea class="form-input border border-gray-300 rounded-lg px-4 py-2 w-full" rows="3" placeholder="Outline plans for tomorrow"></textarea>
          </div>
        </form>
      </div>
      <div class="modal-footer">
        <button type="button" class="px-4 py-2 bg-gray-200 text-gray-700 rounded-lg hover:bg-gray-300 transition-all" onclick="closeModal('reportModal')">
          Cancel
        </button>
        <button type="button" class="px-4 py-2 btn-gradient text-white rounded-lg" onclick="submitReport()">
          <i class="fas fa-paper-plane mr-2"></i> Send Report
        </button>
      </div>
    </div>
  </div>

  <!-- Update Ticket Modal -->
  <div id="updateTicketModal" class="modal">
    <div class="modal-content">
      <div class="modal-header">
        <h2 class="text-xl font-bold">Update Ticket</h2>
        <button class="text-white hover:text-gray-200" onclick="closeModal('updateTicketModal')">
          <i class="fas fa-times text-xl"></i>
        </button>
      </div>
      <div class="modal-body">
        <form>
          <input type="hidden" id="updateTicketId">
          
          <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4">
            <div>
              <label class="block text-gray-700 font-medium mb-2">Status</label>
              <select class="form-input border border-gray-300 rounded-lg px-4 py-2 w-full" id="updateTicketStatus">
                <option value="open">Open</option>
                <option value="in-progress">In Progress</option>
                <option value="resolved">Resolved</option>
              </select>
            </div>
            <div>
              <label class="block text-gray-700 font-medium mb-2">Priority</label>
              <select class="form-input border border-gray-300 rounded-lg px-4 py-2 w-full" id="updateTicketPriority">
                <option value="low">Low</option>
                <option value="medium">Medium</option>
                <option value="high">High</option>
                <option value="urgent">Urgent</option>
              </select>
            </div>
          </div>
          
          <div class="mb-4">
            <label class="block text-gray-700 font-medium mb-2">Update Notes</label>
            <textarea class="form-input border border-gray-300 rounded-lg px-4 py-2 w-full" rows="4" placeholder="Add notes about this update"></textarea>
          </div>
        </form>
      </div>
      <div class="modal-footer">
        <button type="button" class="px-4 py-2 bg-gray-200 text-gray-700 rounded-lg hover:bg-gray-300 transition-all" onclick="closeModal('updateTicketModal')">
          Cancel
        </button>
        <button type="button" class="px-4 py-2 btn-gradient text-white rounded-lg" onclick="saveTicketUpdate()">
          <i class="fas fa-save mr-2"></i> Save Update
        </button>
      </div>
    </div>
  </div>

  <!-- Update Equipment Modal -->
  <div id="updateEquipmentModal" class="modal">
    <div class="modal-content">
      <div class="modal-header">
        <h2 class="text-xl font-bold">Update Equipment</h2>
        <button class="text-white hover:text-gray-200" onclick="closeModal('updateEquipmentModal')">
          <i class="fas fa-times text-xl"></i>
        </button>
      </div>
      <div class="modal-body">
        <form>
          <input type="hidden" id="updateEquipmentName">
          
          <div class="mb-4">
            <label class="block text-gray-700 font-medium mb-2">Equipment Name</label>
            <input type="text" class="form-input border border-gray-300 rounded-lg px-4 py-2 w-full" id="updateEquipmentNameDisplay" readonly>
          </div>
          
          <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4">
            <div>
              <label class="block text-gray-700 font-medium mb-2">Current Quantity</label>
              <input type="number" class="form-input border border-gray-300 rounded-lg px-4 py-2 w-full" id="updateEquipmentQuantity" readonly>
            </div>
            <div>
              <label class="block text-gray-700 font-medium mb-2">New Quantity</label>
              <input type="number" class="form-input border border-gray-300 rounded-lg px-4 py-2 w-full" id="updateEquipmentNewQuantity">
            </div>
          </div>
          
          <div class="mb-4">
            <label class="block text-gray-700 font-medium mb-2">Status</label>
            <select class="form-input border border-gray-300 rounded-lg px-4 py-2 w-full" id="updateEquipmentStatus">
              <option value="in-stock">In Stock</option>
              <option value="low-stock">Low Stock</option>
              <option value="out-of-stock">Out of Stock</option>
            </select>
          </div>
          
          <div class="mb-4">
            <label class="block text-gray-700 font-medium mb-2">Update Notes</label>
            <textarea class="form-input border border-gray-300 rounded-lg px-4 py-2 w-full" rows="3" placeholder="Add notes about this update"></textarea>
          </div>
        </form>
      </div>
      <div class="modal-footer">
        <button type="button" class="px-4 py-2 bg-gray-200 text-gray-700 rounded-lg hover:bg-gray-300 transition-all" onclick="closeModal('updateEquipmentModal')">
          Cancel
        </button>
        <button type="button" class="px-4 py-2 btn-gradient text-white rounded-lg" onclick="saveEquipmentUpdate()">
          <i class="fas fa-save mr-2"></i> Save Update
        </button>
      </div>
    </div>
  </div>

  <!-- Logout Script -->
  <script>
    document.addEventListener('DOMContentLoaded', function() {
      const logoutButton = document.querySelector('.sidebar-gradient button');

      if (logoutButton) {
        logoutButton.addEventListener('click', function() {
          console.log('Logout button clicked'); // Debugging log
          window.location.href = '/unified-login.html'; // Redirect to unified login page
        });
      } else {
        console.error('Logout button not found'); // Debugging log
      }
      
      // Load supervisor payslips
      loadSupervisorPayslips();
    });
  </script>

  <script>
    // Attendance date selection functionality
    document.addEventListener('DOMContentLoaded', function() {
      const datePicker = document.getElementById('attendanceDatePicker');
      
      // Set default date to today
      if (datePicker) {
        const today = new Date().toISOString().split('T')[0];
        datePicker.value = today;
        
        // Add event listener for date changes
        datePicker.addEventListener('change', function() {
          const selectedDate = this.value;
          console.log('Selected date:', selectedDate);
          
          // Update the heading to show selected date
          const heading = document.querySelector('#attendance h2');
          if (heading) {
            const formattedDate = new Date(selectedDate).toLocaleDateString('en-US', {
              weekday: 'long',
              year: 'numeric',
              month: 'long',
              day: 'numeric'
            });
            heading.textContent = `Attendance for ${formattedDate}`;
          }
          
          // Load attendance data for the selected date
          loadAttendanceForDate(selectedDate);
        });
        
        // Load initial attendance data
        loadAttendanceForDate(today);
      }
    });
    
    // Enhanced staff data with more details
    const staffData = [
      { 
        id: 'EMP001', 
        name: 'John Smith', 
        position: 'Lead Technician', 
        department: 'Technical',
        phone: '+254 712 345 678',
        email: 'john.smith@drnet.co.ke'
      },
      { 
        id: 'EMP002', 
        name: 'Sarah Johnson', 
        position: 'Installation Specialist', 
        department: 'Installation',
        phone: '+254 723 456 789',
        email: 'sarah.johnson@drnet.co.ke'
      },
      { 
        id: 'EMP003', 
        name: 'Mike Wilson', 
        position: 'Customer Service Rep', 
        department: 'Customer Service',
        phone: '+254 734 567 890',
        email: 'mike.wilson@drnet.co.ke'
      },
      { 
        id: 'EMP004', 
        name: 'Lisa Brown', 
        position: 'Maintenance Tech', 
        department: 'Maintenance',
        phone: '+254 745 678 901',
        email: 'lisa.brown@drnet.co.ke'
      },
      { 
        id: 'EMP005', 
        name: 'David Lee', 
        position: 'Field Engineer', 
        department: 'Technical',
        phone: '+254 756 789 012',
        email: 'david.lee@drnet.co.ke'
      },
      { 
        id: 'EMP006', 
        name: 'Grace Mwangi', 
        position: 'Network Administrator', 
        department: 'Technical',
        phone: '+254 767 890 123',
        email: 'grace.mwangi@drnet.co.ke'
      },
      { 
        id: 'EMP007', 
        name: 'Peter Ochieng', 
        position: 'Support Technician', 
        department: 'Customer Service',
        phone: '+254 778 901 234',
        email: 'peter.ochieng@drnet.co.ke'
      },
      { 
        id: 'EMP008', 
        name: 'Mary Wanjiku', 
        position: 'Quality Assurance', 
        department: 'Technical',
        phone: '+254 789 012 345',
        email: 'mary.wanjiku@drnet.co.ke'
      }
    ];

    // Function to load staff selection interface
    function loadStaffSelection() {
      const staffGrid = document.getElementById('staffSelectionGrid');
      if (staffGrid) {
        staffGrid.innerHTML = '';
        
        staffData.forEach(staff => {
          const staffCard = document.createElement('div');
          staffCard.className = 'bg-gradient-to-br from-blue-50 to-indigo-50 rounded-lg p-4 border border-blue-200 hover:border-blue-300 transition-all cursor-pointer staff-selection-card';
          staffCard.setAttribute('data-staff-id', staff.id);
          staffCard.innerHTML = `
            <div class="flex items-center space-x-3">
              <div class="w-12 h-12 bg-gradient-to-br from-blue-500 to-indigo-600 rounded-full flex items-center justify-center text-white font-bold text-lg">
                ${staff.name.split(' ').map(n => n[0]).join('')}
              </div>
              <div class="flex-1">
                <h3 class="font-semibold text-gray-800">${staff.name}</h3>
                <p class="text-sm text-gray-600">${staff.position}</p>
                <p class="text-xs text-gray-500">${staff.department}  ${staff.id}</p>
              </div>
              <div class="w-6 h-6 border-2 border-gray-300 rounded-full flex items-center justify-center selection-indicator">
                <i class="fas fa-check text-white text-xs hidden"></i>
              </div>
            </div>
          `;
          
          staffCard.addEventListener('click', () => selectStaff(staff.id));
          staffGrid.appendChild(staffCard);
        });
      }
    }

    // Function to select/deselect staff
    function selectStaff(staffId) {
      const card = document.querySelector(`[data-staff-id="${staffId}"]`);
      const indicator = card.querySelector('.selection-indicator');
      const checkIcon = indicator.querySelector('i');
      
      if (card.classList.contains('selected')) {
        card.classList.remove('selected', 'bg-gradient-to-br', 'from-green-50', 'to-emerald-50', 'border-green-300');
        card.classList.add('bg-gradient-to-br', 'from-blue-50', 'to-indigo-50', 'border-blue-200');
        indicator.classList.remove('bg-green-500', 'border-green-500');
        indicator.classList.add('border-gray-300');
        checkIcon.classList.add('hidden');
      } else {
        card.classList.add('selected', 'bg-gradient-to-br', 'from-green-50', 'to-emerald-50', 'border-green-300');
        card.classList.remove('bg-gradient-to-br', 'from-blue-50', 'to-indigo-50', 'border-blue-200');
        indicator.classList.add('bg-green-500', 'border-green-500');
        indicator.classList.remove('border-gray-300');
        checkIcon.classList.remove('hidden');
      }
    }

    // Function to load attendance data for a specific date
    function loadAttendanceForDate(date) {
      console.log('Loading attendance for date:', date);
      loadStaffSelection();
      loadAttendanceRecords(date);
    }

    // Function to load attendance records in the data table
    function loadAttendanceRecords(date) {
      const attendanceHistory = JSON.parse(localStorage.getItem('attendanceHistory') || '[]');
      const ctioAttendance = JSON.parse(localStorage.getItem('ctioAttendance') || '[]');
      
      // Merge records from both sources, ctioAttendance takes priority
      const allRecords = [...ctioAttendance, ...attendanceHistory];
      
      // Filter by date
      const filteredRecords = allRecords.filter(record => {
        const recordDate = record.date || new Date(record.timestamp).toISOString().split('T')[0];
        return recordDate === date;
      });
      
      const tableBody = document.getElementById('attendanceTableBody');
      const noRecords = document.getElementById('noAttendanceRecords');
      
      if (!tableBody) return;
      
      if (filteredRecords.length === 0) {
        tableBody.innerHTML = '';
        if (noRecords) noRecords.classList.remove('hidden');
        return;
      }
      
      if (noRecords) noRecords.classList.add('hidden');
      tableBody.innerHTML = '';
      
      filteredRecords.forEach(record => {
        const row = document.createElement('tr');
        row.className = 'hover:bg-gray-50';
        row.innerHTML = `
          <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900">${record.employeeId}</td>
          <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">${record.employeeName}</td>
          <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">${record.department}</td>
          <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">${record.role}</td>
          <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">${record.phone || 'N/A'}</td>
          <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">${record.email || 'N/A'}</td>
          <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-700 font-medium">${record.timeIn || 'N/A'}</td>
          <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-700 font-medium">${record.timeOut || 'N/A'}</td>
          <td class="px-6 py-4 whitespace-nowrap">
            <span class="inline-flex px-2 py-1 text-xs font-semibold rounded-full ${getStatusColor(record.status)}">
              ${record.status}
            </span>
          </td>
          <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">${record.date || new Date(record.timestamp).toLocaleDateString()}</td>
          <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">${record.markedBy}</td>
          <td class="px-6 py-4 whitespace-nowrap text-sm font-medium">
            <button onclick="editAttendanceRecord('${record.id}')" class="text-indigo-600 hover:text-indigo-900 mr-3 px-2 py-1 rounded hover:bg-indigo-50 transition-colors" title="Edit Attendance">
              <i class="fas fa-edit"></i>
            </button>
            <button onclick="deleteAttendanceRecord('${record.id}')" class="text-red-600 hover:text-red-900 px-2 py-1 rounded hover:bg-red-50 transition-colors" title="Delete Attendance">
              <i class="fas fa-trash"></i>
            </button>
          </td>
        `;
        tableBody.appendChild(row);
      });
    }

    // Function to get status color class
    function getStatusColor(status) {
      switch(status) {
        case 'Present': return 'bg-green-100 text-green-800';
        case 'Absent': return 'bg-red-100 text-red-800';
        case 'Off Duty': return 'bg-yellow-100 text-yellow-800';
        case 'On Leave': return 'bg-blue-100 text-blue-800';
        default: return 'bg-gray-100 text-gray-800';
      }
    }
    
    // Load supervisor payslips
    function loadSupervisorPayslips() {
      const payslipsList = document.getElementById('supervisorPayslipsList');
      const noPayslipsMessage = document.getElementById('noPayslipsMessage');
      
      // Get supervisor payslips from localStorage
      const supervisorPayslips = JSON.parse(localStorage.getItem('supervisorPayslips') || '[]');
      
      if (supervisorPayslips.length === 0) {
        noPayslipsMessage.style.display = 'block';
        return;
      }
      
      noPayslipsMessage.style.display = 'none';
      
      // Clear existing content
      payslipsList.innerHTML = '';
      
      // Display payslips
      supervisorPayslips.forEach(payslip => {
        const payslipCard = document.createElement('div');
        payslipCard.className = 'bg-white rounded-lg p-4 border border-gray-200 shadow-sm';
        payslipCard.innerHTML = `
          <div class="flex items-center justify-between">
            <div class="flex items-center space-x-4">
              <div class="w-12 h-12 bg-green-100 rounded-full flex items-center justify-center">
                <i class="fas fa-file-invoice-dollar text-green-600 text-xl"></i>
              </div>
              <div>
                <h3 class="font-semibold text-gray-800">${payslip.payPeriod}</h3>
                <p class="text-sm text-gray-600">Payslip for ${payslip.staffName}</p>
                <p class="text-xs text-gray-500">Activated: ${new Date(payslip.activatedDate).toLocaleDateString()}</p>
              </div>
            </div>
            <button onclick="downloadSupervisorPayslip('${payslip.payPeriod}', '${payslip.staffId}')" 
                    class="px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-all">
              <i class="fas fa-download mr-2"></i> Download
            </button>
          </div>
        `;
        payslipsList.appendChild(payslipCard);
      });
    }
    
    // Download supervisor payslip
    function downloadSupervisorPayslip(period, staffId) {
      const supervisorPayslips = JSON.parse(localStorage.getItem('supervisorPayslips') || '[]');
      const payslip = supervisorPayslips.find(p => p.payPeriod === period && p.staffId === staffId);
      
      if (!payslip) {
        showNotification('Payslip not found', 'error');
        return;
      }
      
      // Create simplified payslip HTML (no deductions/allowances)
      const payslipHTML = `
        <!DOCTYPE html>
        <html>
        <head>
          <title>Payslip - ${payslip.payPeriod}</title>
          <style>
            body { font-family: Arial, sans-serif; margin: 20px; }
            .header { text-align: center; margin-bottom: 30px; }
            .company { font-size: 24px; font-weight: bold; color: #1f2937; }
            .payslip-title { font-size: 18px; margin: 10px 0; color: #059669; }
            .details { margin: 20px 0; }
            .row { display: flex; justify-content: space-between; margin: 8px 0; padding: 5px 0; }
            .total { border-top: 2px solid #059669; font-weight: bold; margin-top: 10px; }
            .footer { margin-top: 30px; text-align: center; font-size: 12px; color: #6b7280; }
          </style>
        </head>
        <body>
          <div class="header">
            <div class="company">DR.NET TECHNOLOGY LABS</div>
            <div class="payslip-title">PAYSLIP - ${payslip.payPeriod}</div>
          </div>
          
          <div class="details">
            <div class="row">
              <span>Employee:</span>
              <span>${payslip.staffName}</span>
            </div>
            <div class="row">
              <span>Position:</span>
              <span>${payslip.staffRole}</span>
            </div>
            <div class="row">
              <span>Period:</span>
              <span>${payslip.payPeriod}</span>
            </div>
            <div class="row">
              <span>Basic Salary:</span>
              <span>Ksh ${payslip.basicSalary.toLocaleString()}</span>
            </div>
            <div class="row total">
              <span>Net Salary:</span>
              <span>Ksh ${payslip.netSalary.toLocaleString()}</span>
            </div>
          </div>
          
          <div class="footer">
            <p>This is a computer generated payslip and does not require a signature.</p>
            <p>Generated on: ${new Date().toLocaleDateString()}</p>
          </div>
        </body>
        </html>
      `;
      
      // Create and download PDF
      const blob = new Blob([payslipHTML], { type: 'text/html' });
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url;
      a.download = `DR-NET-Payslip-${payslip.staffName.replace(/\s+/g, '-')}-${payslip.payPeriod}.html`;
      document.body.appendChild(a);
      a.click();
      document.body.removeChild(a);
      URL.revokeObjectURL(url);
      
      showNotification('Payslip downloaded successfully', 'success');
    }
  </script>

  <script>
    // ===================== SUPERVISOR CHAT FUNCTIONS =====================

    let currentUser = { name: "Supervisor", role: "supervisor" };

    // Initialize chat on page load
    document.addEventListener("DOMContentLoaded", function () {
      loadChatMessages();
      updateOnlineCount();
      // Auto-refresh messages every 5 seconds
      setInterval(loadChatMessages, 5000);
    });

    // Load and display chat messages
    function loadChatMessages() {
      const messagesContainer = document.getElementById("messagesContainer");
      if (!messagesContainer) return;

      // Use common.js getActiveChatMessages for compatibility with CTO dashboard
      let messages;
      if (typeof getActiveChatMessages === 'function') {
        messages = getActiveChatMessages();
      } else {
        messages = getStoredMessages();
      }

      if (messages.length === 0) {
        messagesContainer.innerHTML = `
                    <div class="flex flex-col items-center justify-center h-full text-center">
                        <div class="w-16 h-16 bg-gray-100 rounded-full flex items-center justify-center mb-4">
                            <i class="fas fa-comments text-2xl text-gray-400"></i>
                        </div>
                        <h3 class="text-lg font-medium text-gray-900 mb-2">No messages yet</h3>
                        <p class="text-gray-500">Start the conversation with your team!</p>
                    </div>
                `;
        return;
      }

      messagesContainer.innerHTML = messages
        .map((msg) => {
          const isSent = msg.sender === currentUser.name;
          const timeAgo = formatTimeAgo(msg.timestamp);
          const fullTime = new Date(msg.timestamp).toLocaleString();
          const avatarInitials = msg.sender
            .split(" ")
            .map((n) => n[0])
            .join("")
            .toUpperCase()
            .substring(0, 2);

          return `
                    <div class="flex ${
                      isSent ? "justify-end" : "justify-start"
                    } mb-4">
                        <div class="flex ${
                          isSent ? "flex-row-reverse" : "flex-row"
                        } items-end space-x-2 max-w-xs lg:max-w-md">
                            <div class="w-8 h-8 rounded-full flex items-center justify-center text-xs font-bold text-white ${getRoleColor(
                              msg.role
                            )}">
                                ${avatarInitials}
                            </div>
                            <div class="message-bubble ${
                              isSent ? "sent" : "received"
                            } px-4 py-3 rounded-2xl">
                                <div class="flex items-center justify-between mb-1">
                                    <span class="text-xs font-medium ${
                                      isSent ? "text-blue-100" : "text-gray-600"
                                    }">${msg.sender}</span>
                                </div>
                                <p class="${
                                  isSent ? "text-white" : "text-gray-800"
                                }">${msg.text}</p>
                                <div class="text-xs ${
                                  isSent ? "text-blue-100" : "text-gray-500"
                                } mt-1" title="${fullTime}">
                                    ${timeAgo}
                                </div>
                            </div>
                        </div>
                    </div>
                `;
        })
        .join("");

      // Scroll to bottom
      messagesContainer.scrollTop = messagesContainer.scrollHeight;
    }

    // Get role-based color (handles both uppercase and lowercase roles)
    function getRoleColor(role) {
      const roleLower = role ? role.toLowerCase() : '';
      switch (roleLower) {
        case "ctio":
          return "bg-blue-600";
        case "supervisor":
          return "bg-green-600";
        case "staff":
          return "bg-gray-600";
        default:
          return "bg-gray-500";
      }
    }

    // Format time ago
    function formatTimeAgo(timestamp) {
      const now = new Date();
      const messageTime = new Date(timestamp);
      const diffInMinutes = Math.floor((now - messageTime) / (1000 * 60));
      
      if (diffInMinutes < 1) return "Just now";
      if (diffInMinutes < 60) return `${diffInMinutes}m ago`;
      if (diffInMinutes < 1440) return `${Math.floor(diffInMinutes / 60)}h ago`;
      return `${Math.floor(diffInMinutes / 1440)}d ago`;
    }

    // Get stored messages (using common.js for compatibility)
    function getStoredMessages() {
      try {
        // Use common.js getActiveChatMessages for compatibility
        if (typeof getActiveChatMessages === 'function') {
          return getActiveChatMessages();
        }
        // Fallback to direct localStorage access
        return JSON.parse(localStorage.getItem("teamChatMessages") || "[]");
      } catch (e) {
        console.error("Error loading messages:", e);
        return [];
      }
    }

    // Save message to storage
    function saveMessage(message) {
      try {
        const messages = getStoredMessages();
        messages.push(message);
        localStorage.setItem("teamChatMessages", JSON.stringify(messages));
        return true;
      } catch (e) {
        console.error("Error saving message:", e);
        return false;
      }
    }

    // Send message - Team Communication
    function sendMessage() {
      const messageInput = document.getElementById("messageInput");
      if (!messageInput) {
        console.error("Message input not found");
        return;
      }
      
      const messageText = messageInput.value.trim();

      if (!messageText) {
        Swal.fire({
          title: "Empty Message",
          text: "Please enter a message before sending.",
          icon: "warning",
          confirmButtonColor: "#3b82f6",
        });
        return;
      }

      // Use common.js sendChatMessage function for compatibility
      const message = sendChatMessage(currentUser.name, currentUser.role, messageText);

      if (message) {
        messageInput.value = "";
        loadChatMessages();

        // Show success feedback
        const sendButton = document.querySelector(
          'button[onclick="sendMessage()"]'
        );
        if (sendButton) {
          const originalText = sendButton.innerHTML;
          sendButton.innerHTML = '<i class="fas fa-check"></i> Sent';
          sendButton.disabled = true;

          setTimeout(() => {
            sendButton.innerHTML = originalText;
            sendButton.disabled = false;
          }, 1000);
        }
      } else {
        Swal.fire({
          title: "Error",
          text: "Failed to send message. Please try again.",
          icon: "error",
          confirmButtonColor: "#3b82f6",
        });
      }
    }

    // Handle Enter key press
    function handleKeyPress(event) {
      if (event.key === "Enter") {
        sendMessage();
      }
    }

    // Refresh chat
    function refreshChat() {
      loadChatMessages();

      // Show feedback
      const refreshButton = document.querySelector(
        'button[onclick="refreshChat()"]'
      );
      const originalIcon = refreshButton.innerHTML;
      refreshButton.innerHTML = '<i class="fas fa-check text-sm"></i>';

      setTimeout(() => {
        refreshButton.innerHTML = originalIcon;
      }, 1000);
    }

    // Update online count
    function updateOnlineCount() {
      const onlineCountElement = document.getElementById("onlineCount");
      if (onlineCountElement) {
        // Simulate online count
        const onlineCount = Math.floor(Math.random() * 8) + 5; // 5-12 people
        onlineCountElement.textContent = `${onlineCount} people online`;
      }
    }
    
    // Navigation functionality - wrapped in DOMContentLoaded
    document.addEventListener('DOMContentLoaded', function() {
      console.log('Navigation DOMContentLoaded triggered');
      
      // Debug: Check if navigation elements exist
      const navItems = document.querySelectorAll('.nav-item');
      console.log('Found', navItems.length, 'navigation items');
      navItems.forEach((item, index) => {
        console.log(`Nav item ${index}:`, item.getAttribute('data-page'));
      });
      
      // Debug: Check if page sections exist
      const pageSections = document.querySelectorAll('.page-section');
      console.log('Found', pageSections.length, 'page sections');
      pageSections.forEach((section, index) => {
        console.log(`Page section ${index}:`, section.id, 'Active:', section.classList.contains('active'));
      });
      

      
      // Use event delegation for more reliable navigation
      document.body.addEventListener('click', function(e) {
        const navItem = e.target.closest('.nav-item');
        if (!navItem) return;
        
        e.preventDefault();
        console.log('Navigation item clicked:', navItem);
        
        const pageId = navItem.getAttribute('data-page');
        if (!pageId) {
          console.log('No data-page attribute found');
          return;
        }
        
        console.log('Navigating to page:', pageId);
        
        // Remove active class from all nav items
        document.querySelectorAll('.nav-item').forEach(navItem => {
          navItem.classList.remove('active');
        });
        
        // Add active class to clicked nav item
        navItem.classList.add('active');
        
        // Hide all page sections
        document.querySelectorAll('.page-section').forEach(section => {
          section.classList.remove('active');
        });
        
        // Show the selected page section
        const targetSection = document.getElementById(pageId);
        if (targetSection) {
          targetSection.classList.add('active');
          // Scroll to top when specific sections are activated
          if (pageId === 'equipment' || pageId === 'reports' || pageId === 'communication' || pageId === 'settings') {
            // Use requestAnimationFrame to ensure DOM is updated
            requestAnimationFrame(() => {
              const sectionDiv = targetSection.querySelector('div');
              if (sectionDiv) {
                sectionDiv.scrollTop = 0;
              }
              window.scrollTo({ top: 0, behavior: 'instant' });
            });
          }
          console.log('Successfully navigated to:', pageId);
          console.log('Target section classes:', targetSection.className);
          console.log('Target section display style:', window.getComputedStyle(targetSection).display);
        } else {
          console.error('Could not find page section with id:', pageId);
        }
        
        // Load section-specific data
        if (pageId === 'tickets') {
          if (typeof loadTickets === 'function') {
            loadTickets();
          }
        }
        if (pageId === 'equipment') {
          if (typeof loadEquipmentTable === 'function') {
            initializeEquipmentData();
            loadEquipmentTable();
            updateEquipmentStats();
          }
        }
        if (pageId === 'reports') {
          if (typeof loadReportsTable === 'function') {
            loadReportsTable();
          }
        }
        if (pageId === 'communication') {
          if (typeof loadChatMessages === 'function') {
            loadChatMessages();
            loadTeamMembers();
          }
        }
        if (pageId === 'attendance') {
          if (typeof loadStaffDropdown === 'function') {
            loadStaffDropdown();
          }
          if (typeof loadRecentAttendance === 'function') {
            loadRecentAttendance();
          }
          const datePicker = document.getElementById('attendanceDatePicker');
          if (datePicker) {
            const today = new Date().toISOString().split('T')[0];
            datePicker.value = today;
            if (typeof loadAttendanceRecords === 'function') {
              loadAttendanceRecords(today);
            }
            // Add event listener for date change
            datePicker.addEventListener('change', function() {
              if (typeof loadAttendanceRecords === 'function') {
                loadAttendanceRecords(this.value || today);
              }
            });
          }
        }
      });
    });
    
    // Modal functions
    function openModal(modalId) {
      document.getElementById(modalId).classList.add('active');
    }
    
    function closeModal(modalId) {
      document.getElementById(modalId).classList.remove('active');
    }
    
    // Chat functionality
    function openChat(userId) {
      currentUser = userId;
      
      // Update chat header
      const userInfo = {
        michael: { name: 'Michael Johnson', avatar: 'staff1', status: 'Online' },
        sarah: { name: 'Sarah Williams', avatar: 'staff2', status: 'Online' },
        david: { name: 'David Brown', avatar: 'staff3', status: 'Offline' },
        emily: { name: 'Emily Davis', avatar: 'staff4', status: 'Online' },
        ctio: { name: 'CTIO', avatar: 'ctio', status: 'Online' },
        alex: { name: 'Alex Thompson', avatar: 'staff5', status: 'Online' },
        lisa: { name: 'Lisa Chen', avatar: 'staff6', status: 'Away' },
        james: { name: 'James Wilson', avatar: 'staff7', status: 'Offline' },
        maria: { name: 'Maria Rodriguez', avatar: 'staff8', status: 'Online' }
      };
      
      const user = userInfo[userId];
      document.getElementById('chatUserName').textContent = user.name;
      document.getElementById('chatUserAvatar').src = `https://picsum.photos/seed/${user.avatar}/40/40.jpg`;
      document.getElementById('chatUserStatus').textContent = user.status;
      document.getElementById('chatUserStatus').className = user.status === 'Online' ? 'text-xs text-green-500' : 'text-xs text-gray-500';
      
      // Load chat history
      loadChatHistory(userId);
      
      // Clear notification badge
      const notificationBadge = event.currentTarget.querySelector('.notification-badge');
      if (notificationBadge) {
        notificationBadge.remove();
      }
    }
    
    function loadChatHistory(userId) {
      const messageContainer = document.getElementById('messageContainer');
      messageContainer.innerHTML = '';
      
      const history = chatHistory[userId] || [];
      history.forEach(msg => {
        addMessageToChat(msg.message, msg.type, msg.time);
      });
      
      // Scroll to bottom
      const chatMessages = document.getElementById('chatMessages');
      chatMessages.scrollTop = chatMessages.scrollHeight;
    }
    
    function addMessageToChat(message, type, time) {
      const messageContainer = document.getElementById('messageContainer');
      const messageDiv = document.createElement('div');
      messageDiv.className = `flex ${type === 'sent' ? 'justify-end' : 'justify-start'}`;
      
      const bubble = document.createElement('div');
      bubble.className = `message-bubble ${type === 'sent' ? 'message-sent' : 'message-received'}`;
      bubble.innerHTML = `
        <p>${message}</p>
        <span class="text-xs ${type === 'sent' ? 'text-gray-300' : 'text-gray-500'} mt-1 block ${type === 'sent' ? 'text-right' : ''}">${time}</span>
      `;
      
      messageDiv.appendChild(bubble);
      messageContainer.appendChild(messageDiv);
    }
    
    // Send message for staff management chat (renamed to avoid conflicts with team communication)
    function sendStaffManagementMessage() {
      const input = document.getElementById('messageInput');
      if (!input) {
        console.error("Staff management message input not found");
        return;
      }
      
      const message = input.value.trim();
      
      if (message === '') return;
      
      // Add message to chat
      const now = new Date();
      const time = now.toLocaleTimeString('en-US', { hour: '2-digit', minute: '2-digit' });
      
      addMessageToChat(message, 'sent', time);
      
      // Store in chat history
      if (!chatHistory[currentUser]) {
        chatHistory[currentUser] = [];
      }
      chatHistory[currentUser].push({ type: 'sent', message, time });
      
      // Clear input
      input.value = '';
      
      // Scroll to bottom
      const chatMessages = document.getElementById('chatMessages');
      if (chatMessages) {
        chatMessages.scrollTop = chatMessages.scrollHeight;
      }
      
      // Simulate response after a delay
      simulateResponse();
      
      // Update last message in staff list
      updateLastMessage(userId, message, time);
    }
    
    // Filter staff function
    function filterStaff() {
      const searchTerm = document.getElementById('staffSearch').value.toLowerCase();
      const staffItems = document.querySelectorAll('.staff-item');
      
      staffItems.forEach(item => {
        const name = item.querySelector('h3').textContent.toLowerCase();
        if (name.includes(searchTerm)) {
          item.style.display = 'block';
        } else {
          item.style.display = 'none';
        }
      });
    }
    
    // Group chat function
    function openGroupChat() {
      Swal.fire({
        title: 'Group Chat',
        html: `
          <div class="text-left">
            <p class="text-gray-600 mb-4">Send a message to all team members</p>
            <textarea id="groupMessage" class="w-full p-3 border border-gray-300 rounded-lg" rows="4" placeholder="Type your group message here..."></textarea>
          </div>
        `,
        showCancelButton: true,
        confirmButtonText: 'Send to All',
        cancelButtonText: 'Cancel',
        preConfirm: () => {
          const message = document.getElementById('groupMessage').value;
          if (!message.trim()) {
            Swal.showValidationMessage('Please enter a message');
            return false;
          }
          sendGroupMessage(message);
        }
      });
    }
    
    // Send group message function
    function sendGroupMessage(message) {
      const now = new Date();
      const time = now.toLocaleTimeString('en-US', { hour: '2-digit', minute: '2-digit' });
      
      // Send to all staff members
      const staffMembers = ['michael', 'sarah', 'david', 'emily', 'alex', 'lisa', 'james', 'maria'];
      
      staffMembers.forEach(staffId => {
        if (!chatHistory[staffId]) {
          chatHistory[staffId] = [];
        }
        chatHistory[staffId].push({ 
          type: 'received', 
          message: `[Group Message] ${message}`, 
          time: time 
        });
        
        // Update last message in staff list
        updateLastMessage(staffId, `[Group] ${message}`, time);
        
        // Show notification badge
        showNotificationBadge(staffId);
      });
      
      Swal.fire({
        title: 'Message Sent!',
        text: 'Group message sent to all team members',
        icon: 'success',
        timer: 2000,
        showConfirmButton: false
      });
    }
    
    // Update last message in staff list
    function updateLastMessage(userId, message, time) {
      const lastMessageElement = document.getElementById(`${userId}LastMessage`);
      const lastSeenElement = document.getElementById(`${userId}LastSeen`);
      
      if (lastMessageElement) {
        lastMessageElement.textContent = message;
      }
      if (lastSeenElement) {
        lastSeenElement.textContent = time;
      }
    }
    
    // Show notification badge
    function showNotificationBadge(userId) {
      const badge = document.getElementById(`${userId}Badge`);
      if (badge) {
        const currentCount = parseInt(badge.textContent) || 0;
        badge.textContent = currentCount + 1;
        badge.style.display = 'inline-block';
      }
    }
    
    // Real-time message simulation
    function simulateRealTimeMessages() {
      const messages = [
        { userId: 'michael', message: 'Equipment list sent!', time: '10:35 AM' },
        { userId: 'sarah', message: 'Installation report uploaded', time: '11:00 AM' },
        { userId: 'alex', message: 'Network configuration completed', time: '11:15 AM' },
        { userId: 'lisa', message: 'Customer tickets resolved', time: '11:30 AM' },
        { userId: 'ctio', message: 'New project assigned to your team', time: '12:00 PM' }
      ];
      
      // Simulate random messages every 30-60 seconds
      setInterval(() => {
        const randomMessage = messages[Math.floor(Math.random() * messages.length)];
        const now = new Date();
        const time = now.toLocaleTimeString('en-US', { hour: '2-digit', minute: '2-digit' });
        
        // Add to chat history
        if (!chatHistory[randomMessage.userId]) {
          chatHistory[randomMessage.userId] = [];
        }
        chatHistory[randomMessage.userId].push({
          type: 'received',
          message: randomMessage.message,
          time: time
        });
        
        // Update last message
        updateLastMessage(randomMessage.userId, randomMessage.message, time);
        
        // Show notification badge
        showNotificationBadge(randomMessage.userId);
        
        // If current chat is open, add message to chat
        if (currentUser === randomMessage.userId) {
          addMessageToChat(randomMessage.message, 'received', time);
        }
      }, Math.random() * 30000 + 30000); // 30-60 seconds
    }
    
    function simulateResponse() {
      const responses = {
        michael: [
          "Thanks! I'll check on that right away.",
          "Got it. I'll update you shortly.",
          "Perfect, let me handle that.",
                   "Understood. I'll get back to you."
        ],
        sarah: [
          "Will do. Thanks for letting me know.",
          "No problem, I'm on it.",
          "Got it. I'll take care of it.",
          "Sure thing. I'll follow up."
        ],
        david: [
          "Thanks for the information.",
          "I appreciate the update.",
          "Sounds good to me.",
          "I'll look into that."
        ],
        emily: [
          "Great! I'll be there on time.",
          "Thanks for the heads up.",
          "Perfect, I'm ready to go.",
          "No worries, I've got it covered."
        ],
        ctio: [
          "Thank you for the update.",
          "I'll review it right away.",
          "Good work, keep it up.",
          "Noted. I'll take care of it."
        ]
      };
      
      const userResponses = responses[currentUser] || responses.michael;
      const randomResponse = userResponses[Math.floor(Math.random() * userResponses.length)];
      
      // Show typing indicator
      showTypingIndicator();
      
      // Add response after delay
      setTimeout(() => {
        hideTypingIndicator();
        const now = new Date();
        const time = now.toLocaleTimeString('en-US', { hour: '2-digit', minute: '2-digit' });
        
        addMessageToChat(randomResponse, 'received', time);
        
        // Store in chat history
        if (!chatHistory[currentUser]) {
          chatHistory[currentUser] = [];
        }
        chatHistory[currentUser].push({ type: 'received', message: randomResponse, time });
        
        // Scroll to bottom
        const chatMessages = document.getElementById('chatMessages');
        chatMessages.scrollTop = chatMessages.scrollHeight;
      }, 2000);
    }
    
    function showTypingIndicator() {
      const messageContainer = document.getElementById('messageContainer');
      const typingDiv = document.createElement('div');
      typingDiv.className = 'typing-indicator';
      typingDiv.id = 'typingIndicator';
      typingDiv.innerHTML = `
        <span></span>
        <span></span>
        <span></span>
      `;
      messageContainer.appendChild(typingDiv);
      
      // Scroll to bottom
      const chatMessages = document.getElementById('chatMessages');
      chatMessages.scrollTop = chatMessages.scrollHeight;
    }
    
    function hideTypingIndicator() {
      const typingIndicator = document.getElementById('typingIndicator');
      if (typingIndicator) {
        typingIndicator.remove();
      }
    }
    
    function handleKeyPress(event) {
      if (event.key === 'Enter') {
        event.preventDefault();
        sendMessage();
      }
    }
    
    // Submit functions
    function submitTicket() {
      // Collect form data
      const title = document.querySelector('#ticketModal input[placeholder="Enter ticket title"]').value;
      const priority = document.querySelector('#ticketModal select').value;
      const description = document.querySelector('#ticketModal textarea').value;
      const clientName = document.querySelector('#ticketModal input[placeholder="Enter client name"]').value;
      const clientLocation = document.querySelector('#ticketModal input[placeholder="Enter client location"]').value;
      const contact = document.querySelector('#ticketModal input[placeholder="Phone or email"]').value;
      
      // Generate unique ticket ID
      const timestamp = Date.now().toString().slice(-6);
      const random = Math.random().toString(36).substring(2, 6).toUpperCase();
      const ticketId = `ST${timestamp}${random}`;
      
      // Create ticket object matching the format used in supportTickets localStorage
      const ticket = {
        id: ticketId,
        title: title || `Support Ticket for ${clientName}`,
        subject: title || `Support Ticket for ${clientName}`,
        clientName: clientName,
        client: clientName,
        clientLocation: clientLocation,
        contact: contact,
        description: description,
        priority: priority || 'Medium',
        status: 'open',
        source: 'supervisor',
        createdBy: 'Supervisor',
        assignedTo: 'Support Team',
        issueType: title || 'General Support',
        createdAt: new Date().toISOString(),
        updatedAt: new Date().toISOString()
      };
      
      // Save to centralized support tickets storage
      let allSupportTickets = JSON.parse(localStorage.getItem('supportTickets') || '[]');
      allSupportTickets.unshift(ticket);
      localStorage.setItem('supportTickets', JSON.stringify(allSupportTickets));
      
      // Send to CTIO (simulated)
      sendToCTIO('ticket', ticket);
      
      // Create notification for CTIO
      let ctioNotifications = JSON.parse(localStorage.getItem('ctioNotifications') || '[]');
      const ctioNotification = {
        id: `CTIO${Date.now()}${Math.random().toString(36).substr(2, 5)}`,
        type: "support_ticket_created",
        title: `New Support Ticket from Supervisor`,
        message: `${ticket.issueType} for ${ticket.clientName}: ${ticket.description.substring(0, 80)}...`,
        ticketId: ticket.id,
        priority: ticket.priority,
        clientName: ticket.clientName,
        timestamp: Date.now(),
        isRead: false,
        createdBy: 'Supervisor',
        ticketType: 'staff',
        createdAt: new Date().toISOString(),
      };
      ctioNotifications.unshift(ctioNotification);
      if (ctioNotifications.length > 100) {
        ctioNotifications = ctioNotifications.slice(0, 100);
      }
      localStorage.setItem('ctioNotifications', JSON.stringify(ctioNotifications));
      
      // Reload tickets display
      loadTickets();
      
      // Close modal
      closeModal('ticketModal');
      
      // Reset form
      document.querySelector('#ticketModal input[placeholder="Enter ticket title"]').value = '';
      document.querySelector('#ticketModal select').value = '';
      document.querySelector('#ticketModal textarea').value = '';
      document.querySelector('#ticketModal input[placeholder="Enter client name"]').value = '';
      document.querySelector('#ticketModal input[placeholder="Enter client location"]').value = '';
      document.querySelector('#ticketModal input[placeholder="Phone or email"]').value = '';
      
      // Show success message
      showNotification('Ticket created successfully and sent to CTIO', 'success');
    }
    
    function submitAssignment() {
      // Collect form data using IDs
      const type = document.getElementById('assignmentType').value;
      const clientName = document.getElementById('assignmentClientName').value.trim();
      const location = document.getElementById('assignmentLocation').value.trim();
      const technician = document.getElementById('assignmentTechnician').value;
      const equipment = document.getElementById('assignmentEquipment').value.trim();
      const date = document.getElementById('assignmentDate').value;
      const priority = document.getElementById('assignmentPriority').value;
      const notes = document.getElementById('assignmentNotes').value.trim();
      
      // Validate required fields
      if (!clientName || !location || !technician || !date) {
        showNotification('Please fill in all required fields', 'error');
        return;
      }
      
      // Generate assignment ID
      const assignmentId = 'SA-' + Date.now().toString().substr(-6) + Math.random().toString(36).substr(2, 3).toUpperCase();
      
      // Create assignment object matching CTIO format
      const assignment = {
        id: assignmentId,
        serviceType: type,
        clientName: clientName,
        client: clientName,
        clientId: `client_${Date.now()}`,
        serviceAddress: location,
        location: location,
        technicianName: technician,
        assignedTechnician: technician,
        technicianId: technician.toLowerCase().replace(/\s+/g, '_'),
        requiredEquipment: equipment,
        equipment: equipment,
        scheduledDate: date,
        date: date,
        priority: priority,
        description: notes,
        notes: notes,
        status: 'assigned',
        createdBy: 'Supervisor',
        createdAt: new Date().toISOString(),
        createdDate: new Date().toISOString()
      };
      
      // Save to centralized service assignments storage (same as CTIO)
      let allAssignments = JSON.parse(localStorage.getItem('serviceAssignments') || '[]');
      allAssignments.unshift(assignment);
      localStorage.setItem('serviceAssignments', JSON.stringify(allAssignments));
      
      // Also send to CTIO data for notifications
      sendToCTIO('assignment', assignment);
      
      // Create notification for CTIO
      let ctioNotifications = JSON.parse(localStorage.getItem('ctioNotifications') || '[]');
      const ctioNotification = {
        id: `CTIO${Date.now()}${Math.random().toString(36).substr(2, 5)}`,
        type: 'service_assignment_created',
        title: `New Service Assignment from Supervisor`,
        message: `${assignment.serviceType} assignment for ${assignment.clientName} assigned to ${assignment.technicianName}`,
        assignmentId: assignment.id,
        priority: assignment.priority,
        clientName: assignment.clientName,
        timestamp: Date.now(),
        isRead: false,
        createdBy: 'Supervisor',
        assignmentType: 'service',
        createdAt: new Date().toISOString(),
      };
      ctioNotifications.unshift(ctioNotification);
      if (ctioNotifications.length > 100) {
        ctioNotifications = ctioNotifications.slice(0, 100);
      }
      localStorage.setItem('ctioNotifications', JSON.stringify(ctioNotifications));
      
      // Reset form
      document.getElementById('assignmentType').value = 'Installation';
      document.getElementById('assignmentClientName').value = '';
      document.getElementById('assignmentLocation').value = '';
      document.getElementById('assignmentTechnician').value = 'Michael Johnson';
      document.getElementById('assignmentEquipment').value = '';
      document.getElementById('assignmentDate').value = '';
      document.getElementById('assignmentPriority').value = 'Medium';
      document.getElementById('assignmentNotes').value = '';
      
      // Close modal
      closeModal('assignmentModal');
      
      // Reload assignments display
      loadAssignments();
      
      // Show success message
      showNotification('Assignment created successfully and sent to CTIO', 'success');
      
      console.log(' Supervisor created service assignment:', assignment);
    }
    
    // Load and display assignments
    function loadAssignments() {
      const assignmentsList = document.getElementById('assignmentsList');
      if (!assignmentsList) return;
      
      // Get assignments from localStorage
      const assignments = JSON.parse(localStorage.getItem('serviceAssignments') || '[]');
      
      // Filter assignments created by supervisor or all assignments for display
      const supervisorAssignments = assignments.filter(a => 
        a.createdBy === 'Supervisor' || a.createdBy === 'supervisor'
      );
      
      if (supervisorAssignments.length === 0) {
        assignmentsList.innerHTML = `
          <div class="text-center py-12 bg-white rounded-lg border border-gray-200">
            <div class="w-16 h-16 bg-blue-100 rounded-full flex items-center justify-center mx-auto mb-4">
              <i class="fas fa-tasks text-2xl text-blue-600"></i>
            </div>
            <h3 class="text-lg font-medium text-gray-800 mb-2">No Assignments</h3>
            <p class="text-gray-600 mb-6">Create your first service assignment to get started</p>
            <button onclick="openModal('assignmentModal')" class="px-6 py-3 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-all">
              <i class="fas fa-plus mr-2"></i> Create Assignment
            </button>
          </div>
        `;
        return;
      }
      
      // Sort by creation date (newest first)
      supervisorAssignments.sort((a, b) => {
        const dateA = new Date(a.createdAt || a.createdDate || 0);
        const dateB = new Date(b.createdAt || b.createdDate || 0);
        return dateB - dateA;
      });
      
      // Generate HTML for assignments
      assignmentsList.innerHTML = supervisorAssignments.map(assignment => {
        const statusColors = {
          'assigned': 'bg-blue-100 text-blue-800',
          'scheduled': 'bg-purple-100 text-purple-800',
          'in-progress': 'bg-yellow-100 text-yellow-800',
          'completed': 'bg-green-100 text-green-800',
          'cancelled': 'bg-red-100 text-red-800'
        };
        
        const priorityColors = {
          'Low': 'bg-gray-100 text-gray-800',
          'Medium': 'bg-yellow-100 text-yellow-800',
          'High': 'bg-orange-100 text-orange-800',
          'Urgent': 'bg-red-100 text-red-800'
        };
        
        const status = assignment.status || 'assigned';
        const priority = assignment.priority || 'Medium';
        const serviceType = assignment.serviceType || assignment.type || 'N/A';
        const clientName = assignment.clientName || assignment.client || 'N/A';
        const location = assignment.serviceAddress || assignment.location || 'N/A';
        const technician = assignment.technicianName || assignment.assignedTechnician || assignment.technician || 'N/A';
        const date = assignment.scheduledDate || assignment.date || 'Not scheduled';
        const createdAt = assignment.createdAt || assignment.createdDate || '';
        const formattedDate = createdAt ? new Date(createdAt).toLocaleDateString() : 'N/A';
        
        return `
          <div class="bg-white rounded-lg border border-gray-200 p-6 hover:shadow-lg transition-all duration-300">
            <div class="flex items-start justify-between mb-4">
              <div class="flex-1">
                <div class="flex items-center space-x-3 mb-2">
                  <span class="px-3 py-1 rounded-full text-xs font-medium ${statusColors[status] || 'bg-gray-100 text-gray-800'}">
                    ${status.charAt(0).toUpperCase() + status.slice(1)}
                  </span>
                  <span class="px-3 py-1 rounded-full text-xs font-medium ${priorityColors[priority] || 'bg-gray-100 text-gray-800'}">
                    ${priority} Priority
                  </span>
                  <span class="px-3 py-1 rounded-full text-xs font-medium bg-blue-100 text-blue-800">
                    ${serviceType}
                  </span>
                </div>
                <h3 class="text-lg font-semibold text-gray-800 mb-1">${clientName}</h3>
                <p class="text-sm text-gray-600 mb-2">ID: ${assignment.id}</p>
              </div>
            </div>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4">
              <div>
                <p class="text-xs text-gray-500 mb-1">Location</p>
                <p class="text-sm font-medium text-gray-800">${location}</p>
              </div>
              <div>
                <p class="text-xs text-gray-500 mb-1">Assigned Technician</p>
                <p class="text-sm font-medium text-gray-800">${technician}</p>
              </div>
              <div>
                <p class="text-xs text-gray-500 mb-1">Scheduled Date</p>
                <p class="text-sm font-medium text-gray-800">${date}</p>
              </div>
              <div>
                <p class="text-xs text-gray-500 mb-1">Created</p>
                <p class="text-sm font-medium text-gray-800">${formattedDate}</p>
              </div>
            </div>
            ${assignment.requiredEquipment || assignment.equipment ? `
              <div class="mb-4">
                <p class="text-xs text-gray-500 mb-1">Equipment</p>
                <p class="text-sm text-gray-800">${assignment.requiredEquipment || assignment.equipment}</p>
              </div>
            ` : ''}
            ${assignment.notes || assignment.description ? `
              <div class="mb-4">
                <p class="text-xs text-gray-500 mb-1">Notes</p>
                <p class="text-sm text-gray-800">${assignment.notes || assignment.description}</p>
              </div>
            ` : ''}
          </div>
        `;
      }).join('');
    }
    
    // Filter assignments by service type
    function filterAssignments(serviceType) {
      const assignments = JSON.parse(localStorage.getItem('serviceAssignments') || '[]');
      const supervisorAssignments = assignments.filter(a => 
        (a.createdBy === 'Supervisor' || a.createdBy === 'supervisor')
      );
      
      let filteredAssignments = supervisorAssignments;
      if (serviceType !== 'all') {
        filteredAssignments = supervisorAssignments.filter(a => {
          const type = a.serviceType || a.type || '';
          return type === serviceType;
        });
      }
      
      // Update button styles
      document.querySelectorAll('[onclick^="filterAssignments"]').forEach(btn => {
        btn.classList.remove('bg-blue-600', 'text-white');
        btn.classList.add('bg-gray-200', 'text-gray-700');
      });
      
      // Highlight active filter
      event.target.classList.remove('bg-gray-200', 'text-gray-700');
      event.target.classList.add('bg-blue-600', 'text-white');
      
      // Render filtered assignments
      const assignmentsList = document.getElementById('assignmentsList');
      if (!assignmentsList) return;
      
      if (filteredAssignments.length === 0) {
        assignmentsList.innerHTML = `
          <div class="text-center py-12 bg-white rounded-lg border border-gray-200">
            <div class="w-16 h-16 bg-blue-100 rounded-full flex items-center justify-center mx-auto mb-4">
              <i class="fas fa-tasks text-2xl text-blue-600"></i>
            </div>
            <h3 class="text-lg font-medium text-gray-800 mb-2">No ${serviceType === 'all' ? '' : serviceType} Assignments</h3>
            <p class="text-gray-600 mb-6">No assignments found for this filter</p>
            <button onclick="openModal('assignmentModal')" class="px-6 py-3 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-all">
              <i class="fas fa-plus mr-2"></i> Create Assignment
            </button>
          </div>
        `;
        return;
      }
      
      // Sort by creation date (newest first)
      filteredAssignments.sort((a, b) => {
        const dateA = new Date(a.createdAt || a.createdDate || 0);
        const dateB = new Date(b.createdAt || b.createdDate || 0);
        return dateB - dateA;
      });
      
      // Generate HTML (same as loadAssignments)
      assignmentsList.innerHTML = filteredAssignments.map(assignment => {
        const statusColors = {
          'assigned': 'bg-blue-100 text-blue-800',
          'scheduled': 'bg-purple-100 text-purple-800',
          'in-progress': 'bg-yellow-100 text-yellow-800',
          'completed': 'bg-green-100 text-green-800',
          'cancelled': 'bg-red-100 text-red-800'
        };
        
        const priorityColors = {
          'Low': 'bg-gray-100 text-gray-800',
          'Medium': 'bg-yellow-100 text-yellow-800',
          'High': 'bg-orange-100 text-orange-800',
          'Urgent': 'bg-red-100 text-red-800'
        };
        
        const status = assignment.status || 'assigned';
        const priority = assignment.priority || 'Medium';
        const serviceType = assignment.serviceType || assignment.type || 'N/A';
        const clientName = assignment.clientName || assignment.client || 'N/A';
        const location = assignment.serviceAddress || assignment.location || 'N/A';
        const technician = assignment.technicianName || assignment.assignedTechnician || assignment.technician || 'N/A';
        const date = assignment.scheduledDate || assignment.date || 'Not scheduled';
        const createdAt = assignment.createdAt || assignment.createdDate || '';
        const formattedDate = createdAt ? new Date(createdAt).toLocaleDateString() : 'N/A';
        
        return `
          <div class="bg-white rounded-lg border border-gray-200 p-6 hover:shadow-lg transition-all duration-300">
            <div class="flex items-start justify-between mb-4">
              <div class="flex-1">
                <div class="flex items-center space-x-3 mb-2">
                  <span class="px-3 py-1 rounded-full text-xs font-medium ${statusColors[status] || 'bg-gray-100 text-gray-800'}">
                    ${status.charAt(0).toUpperCase() + status.slice(1)}
                  </span>
                  <span class="px-3 py-1 rounded-full text-xs font-medium ${priorityColors[priority] || 'bg-gray-100 text-gray-800'}">
                    ${priority} Priority
                  </span>
                  <span class="px-3 py-1 rounded-full text-xs font-medium bg-blue-100 text-blue-800">
                    ${serviceType}
                  </span>
                </div>
                <h3 class="text-lg font-semibold text-gray-800 mb-1">${clientName}</h3>
                <p class="text-sm text-gray-600 mb-2">ID: ${assignment.id}</p>
              </div>
            </div>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4">
              <div>
                <p class="text-xs text-gray-500 mb-1">Location</p>
                <p class="text-sm font-medium text-gray-800">${location}</p>
              </div>
              <div>
                <p class="text-xs text-gray-500 mb-1">Assigned Technician</p>
                <p class="text-sm font-medium text-gray-800">${technician}</p>
              </div>
              <div>
                <p class="text-xs text-gray-500 mb-1">Scheduled Date</p>
                <p class="text-sm font-medium text-gray-800">${date}</p>
              </div>
              <div>
                <p class="text-xs text-gray-500 mb-1">Created</p>
                <p class="text-sm font-medium text-gray-800">${formattedDate}</p>
              </div>
            </div>
            ${assignment.requiredEquipment || assignment.equipment ? `
              <div class="mb-4">
                <p class="text-xs text-gray-500 mb-1">Equipment</p>
                <p class="text-sm text-gray-800">${assignment.requiredEquipment || assignment.equipment}</p>
              </div>
            ` : ''}
            ${assignment.notes || assignment.description ? `
              <div class="mb-4">
                <p class="text-xs text-gray-500 mb-1">Notes</p>
                <p class="text-sm text-gray-800">${assignment.notes || assignment.description}</p>
              </div>
            ` : ''}
          </div>
        `;
      }).join('');
    }
    
    function submitBooking() {
      // Collect form data
      const fullName = document.querySelector('#bookingModal input[placeholder="Enter full name"]').value;
      const phoneNumber = document.querySelector('#bookingModal input[placeholder="xxx xxx xxx"]').value;
      const email = document.querySelector('#bookingModal input[placeholder="email@example.com"]').value;
      const location = document.querySelector('#bookingModal input[placeholder="Enter location"]').value;
      const exactLocation = document.querySelector('#bookingModal input[placeholder="Enter location"]:nth-of-type(2)').value;
      const packageType = document.querySelector('#bookingModal select').value;
      const status = document.querySelector('#bookingModal select:nth-of-type(2)').value;
      const installationDate = document.querySelector('#bookingModal input[type="date"]').value;
      const message = document.querySelector('#bookingModal textarea').value;
      
      // Create booking object
      const booking = {
        id: '#B' + Math.floor(Math.random() * 10000),
        fullName,
        phoneNumber,
        email,
        location,
        exactLocation,
        packageType,
        status,
        installationDate,
        message,
        createdBy: 'supervisor',
        createdAt: new Date().toISOString()
      };
      
      // Send to CTIO (simulated)
      sendToCTIO('booking', booking);
      
      // Close modal
      closeModal('bookingModal');
      
      // Show success message
      showNotification('Booking created successfully and sent to CTIO', 'success');
    }
    
    function submitExpense() {
      // Collect form data using IDs
      const type = document.getElementById('expenseType').value;
      const amount = document.getElementById('expenseAmount').value;
      const description = document.getElementById('expenseDescription').value;
      const date = document.getElementById('expenseDate').value;
      const vendor = document.getElementById('expenseVendor').value.trim();
      const payee = document.getElementById('expensePayee').value.trim();
      const status = document.getElementById('expenseStatus').value;
      
      // Validate required fields
      if (!type || !amount || !description || !date) {
        showNotification('Please fill in all required fields', 'error');
        return;
      }
      
      // Create expense object
      const expense = {
        id: 'EXP-' + Date.now().toString().substr(-6) + Math.random().toString(36).substr(2, 3).toUpperCase(),
        type,
        amount: parseFloat(amount),
        description,
        date,
        vendor: vendor || 'N/A',
        payee: payee || 'N/A',
        status: status || 'pending',
        createdBy: 'supervisor',
        createdAt: new Date().toISOString()
      };
      
      // Save to localStorage
      let expenses = JSON.parse(localStorage.getItem('supervisorExpenses') || '[]');
      expenses.unshift(expense);
      localStorage.setItem('supervisorExpenses', JSON.stringify(expenses));
      
      // Send to CTIO (simulated)
      sendToCTIO('expense', expense);
      
      // Reset form
      document.getElementById('expenseForm').reset();
      
      // Close modal
      closeModal('expenseModal');
      
      // Reload expenses display
      loadExpenses();
      
      // Show success message
      showNotification('Expense added successfully', 'success');
      
      console.log(' Expense saved:', expense);
    }
    
    function submitSale() {
      // Collect form data using IDs
      const clientName = document.getElementById('saleClientName')?.value || document.querySelector('#salesModal input[placeholder="Enter client name"]')?.value;
      const serviceType = document.getElementById('saleServiceType')?.value || document.querySelector('#salesModal select')?.value;
      const amount = document.getElementById('saleAmount')?.value || document.querySelector('#salesModal input[type="number"]')?.value;
      const date = document.getElementById('saleDate')?.value || document.querySelector('#salesModal input[type="date"]')?.value;
      const description = document.getElementById('saleDescription')?.value || document.querySelector('#salesModal textarea')?.value;
      const paymentStatus = document.getElementById('salePaymentStatus')?.value || document.querySelector('#salesModal select:nth-of-type(2)')?.value;
      
      // Validate required fields
      if (!clientName || !serviceType || !amount || !date) {
        showNotification('Please fill in all required fields', 'error');
        return;
      }
      
      // Create sale object
      const sale = {
        id: 'SAL-' + Date.now().toString().substr(-6) + Math.random().toString(36).substr(2, 3).toUpperCase(),
        clientName,
        serviceType,
        amount: parseFloat(amount),
        date,
        description: description || 'N/A',
        paymentStatus: paymentStatus || 'Pending',
        createdBy: 'supervisor',
        createdAt: new Date().toISOString()
      };
      
      // Save to localStorage
      let sales = JSON.parse(localStorage.getItem('supervisorSales') || '[]');
      sales.unshift(sale);
      localStorage.setItem('supervisorSales', JSON.stringify(sales));
      
      // Send to CTIO (simulated)
      sendToCTIO('sale', sale);
      
      // Reset form if IDs exist
      const saleForm = document.getElementById('saleForm');
      if (saleForm) saleForm.reset();
      
      // Close modal
      closeModal('salesModal');
      
      // Reload sales display
      loadSales();
      
      // Show success message
      showNotification('Sale added successfully', 'success');
      
      console.log(' Sale saved:', sale);
    }
    
    function submitEquipment() {
      // Collect form data
      const name = document.querySelector('#equipmentModal input[placeholder="Enter equipment name"]').value;
      const category = document.querySelector('#equipmentModal select').value;
      const quantity = document.querySelector('#equipmentModal input[type="number"]').value;
      const status = document.querySelector('#equipmentModal select:nth-of-type(2)').value;
      const description = document.querySelector('#equipmentModal textarea').value;
      
      // Create equipment object
      const equipment = {
        id: '#EQ' + Math.floor(Math.random() * 10000),
        name,
        category,
        quantity,
        status,
        description,
        createdBy: 'supervisor',
        createdAt: new Date().toISOString()
      };
      
      // Send to CTIO (simulated)
      sendToCTIO('equipment', equipment);
      
      // Close modal
      closeModal('equipmentModal');
      
      // Show success message
      showNotification('Equipment added successfully and sent to CTIO', 'success');
    }
    
    function submitReport() {
      // Collect form data
      const date = document.querySelector('#reportModal input[type="date"]').value;
      const type = document.querySelector('#reportModal select').value;
      const summary = document.querySelector('#reportModal textarea').value;
      const completedTasks = document.querySelector('#reportModal textarea:nth-of-type(2)').value;
      const issues = document.querySelector('#reportModal textarea:nth-of-type(3)').value;
      const tomorrowPlan = document.querySelector('#reportModal textarea:nth-of-type(4)').value;
      
      // Validation
      if (!date || !type || !summary) {
        showNotification('Please fill in all required fields', 'error');
        return;
      }
      
      // Create report object
      const report = {
        id: '#R' + Math.floor(Math.random() * 10000),
        date,
        type,
        summary,
        completedTasks,
        issues,
        tomorrowPlan,
        status: 'pending',
        createdBy: 'supervisor',
        createdAt: new Date().toISOString(),
        approvedBy: null,
        approvedAt: null,
        comments: null
      };
      
      // Store report locally
      let reports = JSON.parse(localStorage.getItem('supervisorReports') || '[]');
      reports.push(report);
      localStorage.setItem('supervisorReports', JSON.stringify(reports));
      
      // Send to CTIO (simulated)
      sendReportToCTIO(report);
      
      // Close modal and reset form
      closeModal('reportModal');
      document.querySelector('#reportModal form').reset();
      
      // Show success message
      showNotification('Report sent successfully to CTIO for approval', 'success');
      
      // Refresh reports list
      loadReports();
      
      // Show status notification
      showReportStatusNotification(report.id, 'pending');
    }
    
    function sendReportToCTIO(report) {
      // Simulate sending to CTIO
      let ctioReports = JSON.parse(localStorage.getItem('ctioReports') || '[]');
      ctioReports.push(report);
      localStorage.setItem('ctioReports', JSON.stringify(ctioReports));
      
      // Simulate CTIO notification
      setTimeout(() => {
        showNotification(' New report received from Supervisor', 'info');
      }, 1000);
    }
    
    function loadReports() {
      const reports = JSON.parse(localStorage.getItem('supervisorReports') || '[]');
      const reportsList = document.getElementById('reportsList');
      
      if (reports.length === 0) {
        reportsList.innerHTML = `
          <div class="text-center py-8 text-gray-500">
            <i class="fas fa-file-alt text-4xl mb-4"></i>
            <p>No reports created yet</p>
          </div>
        `;
        return;
      }
      
      reportsList.innerHTML = reports.map(report => `
        <div class="bg-white border border-gray-200 rounded-lg p-4 hover:shadow-md transition-shadow">
          <div class="flex justify-between items-start mb-3">
            <div>
              <h3 class="font-semibold text-gray-800">${report.type}</h3>
              <p class="text-sm text-gray-600">${report.date}</p>
            </div>
            <div class="flex items-center space-x-2">
              <span class="px-3 py-1 rounded-full text-xs font-medium ${getStatusColor(report.status)}">
                ${getStatusText(report.status)}
              </span>
              <button onclick="viewReport('${report.id}')" class="text-blue-600 hover:text-blue-800">
                <i class="fas fa-eye"></i>
              </button>
            </div>
          </div>
          <p class="text-gray-700 text-sm mb-2">${report.summary.substring(0, 100)}${report.summary.length > 100 ? '...' : ''}</p>
          <div class="flex justify-between items-center text-xs text-gray-500">
            <span>Created: ${new Date(report.createdAt).toLocaleString()}</span>
            ${report.approvedAt ? `<span>Approved: ${new Date(report.approvedAt).toLocaleString()}</span>` : ''}
          </div>
        </div>
      `).join('');
    }
    
    function getStatusColor(status) {
      switch(status) {
        case 'pending': return 'bg-yellow-100 text-yellow-800';
        case 'approved': return 'bg-green-100 text-green-800';
        case 'rejected': return 'bg-red-100 text-red-800';
        default: return 'bg-gray-100 text-gray-800';
      }
    }
    
    function getStatusText(status) {
      switch(status) {
        case 'pending': return 'Pending Approval';
        case 'approved': return 'Approved';
        case 'rejected': return 'Rejected';
        default: return 'Unknown';
      }
    }
    
    function viewReport(reportId) {
      const reports = JSON.parse(localStorage.getItem('supervisorReports') || '[]');
      const report = reports.find(r => r.id === reportId);
      
      if (!report) return;
      
      Swal.fire({
        title: `${report.type} - ${report.date}`,
        html: `
          <div class="text-left space-y-4">
            <div>
              <h4 class="font-semibold text-gray-800 mb-2">Summary</h4>
              <p class="text-gray-700">${report.summary}</p>
            </div>
            <div>
              <h4 class="font-semibold text-gray-800 mb-2">Completed Tasks</h4>
              <p class="text-gray-700">${report.completedTasks || 'None specified'}</p>
            </div>
            <div>
              <h4 class="font-semibold text-gray-800 mb-2">Issues/Challenges</h4>
              <p class="text-gray-700">${report.issues || 'None reported'}</p>
            </div>
            <div>
              <h4 class="font-semibold text-gray-800 mb-2">Tomorrow's Plan</h4>
              <p class="text-gray-700">${report.tomorrowPlan || 'None specified'}</p>
            </div>
            <div class="flex items-center space-x-2">
              <span class="px-3 py-1 rounded-full text-xs font-medium ${getStatusColor(report.status)}">
                ${getStatusText(report.status)}
              </span>
              ${report.comments ? `<p class="text-sm text-gray-600">CTIO Comments: ${report.comments}</p>` : ''}
            </div>
          </div>
        `,
        showCancelButton: false,
        confirmButtonText: 'Close',
        background: 'linear-gradient(135deg, #667eea 0%, #764ba2 100%)',
        color: 'white'
      });
    }
    
    function showReportStatusNotification(reportId, status) {
      const statusText = getStatusText(status);
      const statusColor = status === 'approved' ? 'green' : status === 'rejected' ? 'red' : 'yellow';
      
      // Create notification element
      const notification = document.createElement('div');
      notification.className = `fixed top-4 right-4 z-50 p-4 rounded-lg shadow-lg text-white max-w-sm transform transition-all duration-300 translate-x-full`;
      notification.style.backgroundColor = status === 'approved' ? '#10B981' : status === 'rejected' ? '#EF4444' : '#F59E0B';
      
      notification.innerHTML = `
        <div class="flex items-center space-x-3">
          <i class="fas fa-${status === 'approved' ? 'check-circle' : status === 'rejected' ? 'times-circle' : 'clock'} text-xl"></i>
          <div>
            <p class="font-semibold">Report ${statusText}</p>
            <p class="text-sm opacity-90">Report ${reportId} is ${statusText.toLowerCase()}</p>
          </div>
          <button onclick="this.parentElement.parentElement.remove()" class="text-white hover:text-gray-200">
            <i class="fas fa-times"></i>
          </button>
        </div>
      `;
      
      document.body.appendChild(notification);
      
      // Animate in
      setTimeout(() => {
        notification.classList.remove('translate-x-full');
      }, 100);
      
      // Auto remove after 5 seconds
      setTimeout(() => {
        notification.classList.add('translate-x-full');
        setTimeout(() => notification.remove(), 300);
      }, 5000);
    }
    
    // Listen for report status updates
    function checkReportStatusUpdates() {
      const reports = JSON.parse(localStorage.getItem('supervisorReports') || '[]');
      const ctioReports = JSON.parse(localStorage.getItem('ctioReports') || '[]');
      
      reports.forEach(supervisorReport => {
        const ctioReport = ctioReports.find(r => r.id === supervisorReport.id);
        if (ctioReport && ctioReport.status !== supervisorReport.status) {
          // Update local report
          supervisorReport.status = ctioReport.status;
          supervisorReport.approvedBy = ctioReport.approvedBy;
          supervisorReport.approvedAt = ctioReport.approvedAt;
          supervisorReport.comments = ctioReport.comments;
          
          // Show notification
          showReportStatusNotification(supervisorReport.id, ctioReport.status);
        }
      });
      
      // Update localStorage
      localStorage.setItem('supervisorReports', JSON.stringify(reports));
      
      // Refresh reports list
      loadReports();
    }
    
    // Check for updates every 10 seconds
    setInterval(checkReportStatusUpdates, 10000);
    
    // Update functions
    function viewTicket(ticketId) {
      // View ticket details (simulated)
      showNotification(`Viewing ticket ${ticketId}`, 'info');
    }
    
    function updateTicket(ticketId) {
      // Set ticket ID in modal
      document.getElementById('updateTicketId').value = ticketId;
      
      // Open modal
      openModal('updateTicketModal');
    }
    
    function saveTicketUpdate() {
      // Get form data
      const ticketId = document.getElementById('updateTicketId').value;
      const status = document.getElementById('updateTicketStatus').value;
      const priority = document.getElementById('updateTicketPriority').value;
      const notes = document.querySelector('#updateTicketModal textarea').value;
      
      // Create update object
      const update = {
        ticketId,
        status,
        priority,
        notes,
        updatedBy: 'supervisor',
        updatedAt: new Date().toISOString()
      };
      
      // Send to CTIO (simulated)
      sendToCTIO('ticketUpdate', update);
      
      // Close modal
      closeModal('updateTicketModal');
      
      // Show success message
      showNotification('Ticket updated successfully', 'success');
    }
    
    function updateEquipment(equipmentName) {
      // Set equipment name in modal
      document.getElementById('updateEquipmentName').value = equipmentName;
      document.getElementById('updateEquipmentNameDisplay').value = equipmentName;
      
      // Get current quantity (simulated)
      const currentQuantity = 5; // This would be fetched from the database
      document.getElementById('updateEquipmentQuantity').value = currentQuantity;
      document.getElementById('updateEquipmentNewQuantity').value = currentQuantity;
      
      // Open modal
      openModal('updateEquipmentModal');
    }
    
    function saveEquipmentUpdate() {
      // Get form data
      const equipmentName = document.getElementById('updateEquipmentName').value;
      const newQuantity = document.getElementById('updateEquipmentNewQuantity').value;
      const status = document.getElementById('updateEquipmentStatus').value;
      const notes = document.querySelector('#updateEquipmentModal textarea').value;
      
      // Create update object
      const update = {
        equipmentName,
        newQuantity,
        status,
        notes,
        updatedBy: 'supervisor',
        updatedAt: new Date().toISOString()
      };
      
      // Send to CTIO (simulated)
      sendToCTIO('equipmentUpdate', update);
      
      // Close modal
      closeModal('updateEquipmentModal');
      
      // Show success message
      showNotification('Equipment updated successfully', 'success');
    }
    
    // Function to load staff into dropdown
    function loadStaffDropdown() {
      const staffSelect = document.getElementById('staffSelect');
      if (!staffSelect || !staffData) return;
      
      staffSelect.innerHTML = '<option value="">Select a staff member</option>';
      
      staffData.forEach(staff => {
        const option = document.createElement('option');
        option.value = staff.id;
        option.textContent = `${staff.name} - ${staff.position}`;
        option.setAttribute('data-staff-name', staff.name);
        option.setAttribute('data-staff-position', staff.position);
        option.setAttribute('data-staff-department', staff.department || '');
        option.setAttribute('data-staff-phone', staff.phone || '');
        option.setAttribute('data-staff-email', staff.email || '');
        staffSelect.appendChild(option);
      });
    }
    
    // Function to mark attendance for individual staff
    function markIndividualAttendance(event) {
      event.preventDefault();
      
      const staffSelect = document.getElementById('staffSelect');
      const timeIn = document.getElementById('timeIn');
      const timeOut = document.getElementById('timeOut');
      const status = document.getElementById('attendanceStatus');
      const notes = document.getElementById('attendanceNotes');
      const datePicker = document.getElementById('attendanceDatePicker');
      
      if (!staffSelect.value || !timeIn.value || !timeOut.value || !status.value) {
        Swal.fire('Validation Error', 'Please fill in all required fields', 'warning');
        return;
      }
      
      const selectedOption = staffSelect.options[staffSelect.selectedIndex];
      const selectedDate = datePicker.value || new Date().toISOString().split('T')[0];
      
      const attendanceRecord = {
        id: `ATT${Date.now()}${Math.random().toString(36).substr(2, 5)}`,
        employeeId: staffSelect.value,
        employeeName: selectedOption.getAttribute('data-staff-name'),
        department: selectedOption.getAttribute('data-staff-department'),
        role: selectedOption.getAttribute('data-staff-position'),
        phone: selectedOption.getAttribute('data-staff-phone'),
        email: selectedOption.getAttribute('data-staff-email'),
        timeIn: timeIn.value,
        timeOut: timeOut.value,
        status: status.value,
        notes: notes.value.trim(),
        timestamp: new Date().toISOString(),
        markedBy: 'Supervisor',
        date: selectedDate
      };
      
      // Save to attendance history
      let attendanceHistory = JSON.parse(localStorage.getItem('attendanceHistory') || '[]');
      
      // Check for duplicate (same employee, same date)
      const existingIndex = attendanceHistory.findIndex(r => 
        r.employeeId === attendanceRecord.employeeId && r.date === attendanceRecord.date
      );
      
      if (existingIndex >= 0) {
        // Update existing record
        attendanceHistory[existingIndex] = attendanceRecord;
        Swal.fire('Updated!', `Attendance updated for ${attendanceRecord.employeeName}`, 'success');
      } else {
        // Add new record
        attendanceHistory.push(attendanceRecord);
        Swal.fire('Success!', `Attendance marked for ${attendanceRecord.employeeName}`, 'success');
      }
      
      // Keep only last 1000 records
      if (attendanceHistory.length > 1000) {
        attendanceHistory = attendanceHistory.slice(-1000);
      }
      
      localStorage.setItem('attendanceHistory', JSON.stringify(attendanceHistory));
      
      // Clear form
      clearAttendanceForm();
      
      // Refresh recent attendance list
      loadRecentAttendance();
      
      // Refresh attendance records table
      loadAttendanceRecords(selectedDate);
    }
    
    // Function to clear attendance form
    function clearAttendanceForm() {
      const form = document.getElementById('attendanceForm');
      if (form) {
        form.reset();
      }
      
      const staffSelect = document.getElementById('staffSelect');
      const timeIn = document.getElementById('timeIn');
      const timeOut = document.getElementById('timeOut');
      const status = document.getElementById('attendanceStatus');
      const notes = document.getElementById('attendanceNotes');
      const datePicker = document.getElementById('attendanceDatePicker');
      
      if (staffSelect) staffSelect.value = '';
      if (timeIn) timeIn.value = '';
      if (timeOut) timeOut.value = '';
      if (status) status.value = '';
      if (notes) notes.value = '';
      
      // Keep date picker value or set to today
      if (datePicker && !datePicker.value) {
        datePicker.value = new Date().toISOString().split('T')[0];
      }
    }
    
    // Function to clear saved attendance records for the selected date
    function clearSavedAttendance() {
      const datePicker = document.getElementById('attendanceDatePicker');
      const selectedDate = datePicker ? datePicker.value : new Date().toISOString().split('T')[0];
      
      if (!selectedDate) {
        Swal.fire('Error', 'Please select a date first', 'error');
        return;
      }
      
      Swal.fire({
        title: 'Clear Saved Attendance?',
        html: `
          <div class="text-left">
            <p class="mb-2">This will remove all saved attendance records for <strong>${selectedDate}</strong></p>
            <p class="text-red-600 font-medium">This action cannot be undone!</p>
          </div>
        `,
        icon: 'warning',
        showCancelButton: true,
        confirmButtonColor: '#dc2626',
        cancelButtonColor: '#6b7280',
        confirmButtonText: 'Yes, Clear All',
        cancelButtonText: 'Cancel'
      }).then((result) => {
        if (result.isConfirmed) {
          // Clear from attendanceHistory
          let attendanceHistory = JSON.parse(localStorage.getItem('attendanceHistory') || '[]');
          const originalCount = attendanceHistory.length;
          attendanceHistory = attendanceHistory.filter(record => {
            const recordDate = record.date || new Date(record.timestamp).toISOString().split('T')[0];
            return recordDate !== selectedDate;
          });
          
          // Clear from ctioAttendance if exists
          let ctioAttendance = JSON.parse(localStorage.getItem('ctioAttendance') || '[]');
          const ctioOriginalCount = ctioAttendance.length;
          ctioAttendance = ctioAttendance.filter(record => {
            const recordDate = record.date || new Date(record.timestamp).toISOString().split('T')[0];
            return recordDate !== selectedDate;
          });
          
          // Save updated arrays
          localStorage.setItem('attendanceHistory', JSON.stringify(attendanceHistory));
          localStorage.setItem('ctioAttendance', JSON.stringify(ctioAttendance));
          
          const deletedCount = (originalCount - attendanceHistory.length) + (ctioOriginalCount - ctioAttendance.length);
          
          // Refresh displays
          loadAttendanceRecords(selectedDate);
          loadRecentAttendance();
          
          Swal.fire(
            'Cleared!',
            `Removed ${deletedCount} attendance record(s) for ${selectedDate}`,
            'success'
          );
        }
      });
    }
    
    // Function to load recent attendance (last 5)
    function loadRecentAttendance() {
      const recentList = document.getElementById('recentAttendanceList');
      if (!recentList) return;
      
      let attendanceHistory = JSON.parse(localStorage.getItem('attendanceHistory') || '[]');
      let ctioAttendance = JSON.parse(localStorage.getItem('ctioAttendance') || '[]');
      
      // Merge records from both sources
      const allRecords = [...ctioAttendance, ...attendanceHistory];
      
      // Sort by timestamp (newest first) and get last 5
      allRecords.sort((a, b) => new Date(b.timestamp) - new Date(a.timestamp));
      const recent = allRecords.slice(0, 5);
      
      if (recent.length === 0) {
        recentList.innerHTML = '<p class="text-gray-500 text-sm">No attendance records yet</p>';
        return;
      }
      
      recentList.innerHTML = recent.map(record => {
        const statusColors = {
          'Present': 'bg-green-100 text-green-800',
          'Absent': 'bg-red-100 text-red-800',
          'Off Duty': 'bg-gray-100 text-gray-800',
          'On Leave': 'bg-yellow-100 text-yellow-800'
        };
        
        return `
          <div class="bg-white p-3 rounded-lg border border-gray-200 flex items-center justify-between">
            <div class="flex items-center space-x-3 flex-1">
              <div class="w-10 h-10 bg-blue-500 rounded-full flex items-center justify-center text-white text-xs font-bold">
                ${record.employeeName.split(' ').map(n => n[0]).join('')}
              </div>
              <div class="flex-1">
                <p class="font-medium text-sm">${record.employeeName}</p>
                <p class="text-sm text-gray-600">${record.status}  ${record.date || new Date(record.timestamp).toLocaleDateString()}</p>
                ${record.timeIn || record.timeOut ? `<p class="text-xs text-gray-400">${record.timeIn || 'N/A'} - ${record.timeOut || 'N/A'}</p>` : ''}
              </div>
            </div>
            <div class="flex items-center space-x-2">
              <span class="px-3 py-1 rounded-full text-xs font-medium ${statusColors[record.status] || 'bg-gray-100 text-gray-800'}">
                ${record.status}
              </span>
              <button onclick="editAttendanceRecord('${record.id}')" class="text-indigo-600 hover:text-indigo-900 px-2 py-1 rounded hover:bg-indigo-50 transition-colors" title="Edit">
                <i class="fas fa-edit text-sm"></i>
              </button>
            </div>
          </div>
        `;
      }).join('');
    }
    
    // Function to submit all attendance to CTIO
    function submitAttendanceToCTIO() {
      let attendanceHistory = JSON.parse(localStorage.getItem('attendanceHistory') || '[]');
      
      if (attendanceHistory.length === 0) {
        Swal.fire('No Data', 'There are no attendance records to send to CTIO', 'info');
        return;
      }
      
      // Get today's date
      const today = new Date().toISOString().split('T')[0];
      const datePicker = document.getElementById('attendanceDatePicker');
      const selectedDate = datePicker.value || today;
      
      // Filter attendance for selected date
      const todayAttendance = attendanceHistory.filter(r => r.date === selectedDate);
      
      if (todayAttendance.length === 0) {
        Swal.fire('No Data', `No attendance records found for ${selectedDate}`, 'info');
        return;
      }
      
      // Save to CTIO data
      let ctioAttendance = JSON.parse(localStorage.getItem('ctioAttendance') || '[]');
      
      // Add all attendance records
      todayAttendance.forEach(record => {
        // Check if already sent
        const exists = ctioAttendance.find(r => r.id === record.id);
        if (!exists) {
          ctioAttendance.push({
            ...record,
            sentAt: new Date().toISOString(),
            sentBy: 'Supervisor'
          });
        }
      });
      
      localStorage.setItem('ctioAttendance', JSON.stringify(ctioAttendance));
      
      // Create notification for CTIO
      const notification = {
        id: Date.now().toString(),
        type: 'attendance_update',
        title: 'Staff Attendance Update',
        message: `Supervisor submitted ${todayAttendance.length} attendance record(s) for ${selectedDate}`,
        timestamp: new Date().toISOString(),
        read: false,
        source: 'supervisor_dashboard',
        data: todayAttendance
      };
      
      let ctioNotifications = JSON.parse(localStorage.getItem('ctioNotifications') || '[]');
      ctioNotifications.unshift(notification);
      localStorage.setItem('ctioNotifications', JSON.stringify(ctioNotifications));
      
      Swal.fire({
        title: 'Success!',
        text: `${todayAttendance.length} attendance record(s) sent to CTIO for ${selectedDate}`,
        icon: 'success',
        confirmButtonColor: '#3b82f6'
      });
    }

    // Function to save all attendance (legacy function for compatibility)
    function saveAttendance() {
      const datePicker = document.getElementById('attendanceDatePicker');
      const selectedDate = datePicker.value;
      
      // This function is kept for compatibility but now just refreshes the display
      loadAttendanceRecords(selectedDate);
      showNotification(`Attendance records refreshed for ${selectedDate}`, 'success');
    }

    // Function to filter attendance records
    function filterAttendanceRecords() {
      const searchTerm = document.getElementById('attendanceSearch').value.toLowerCase();
      const statusFilter = document.getElementById('attendanceStatusFilter').value;
      const tableBody = document.getElementById('attendanceTableBody');
      const rows = tableBody.querySelectorAll('tr');
      
      rows.forEach(row => {
        const name = row.cells[1].textContent.toLowerCase();
        const status = row.cells[6].textContent.trim();
        
        const matchesSearch = name.includes(searchTerm);
        const matchesStatus = !statusFilter || status === statusFilter;
        
        if (matchesSearch && matchesStatus) {
          row.style.display = '';
        } else {
          row.style.display = 'none';
        }
      });
    }

    // Function to refresh attendance records
    function refreshAttendanceRecords() {
      const datePicker = document.getElementById('attendanceDatePicker');
      const selectedDate = datePicker.value;
      loadAttendanceRecords(selectedDate);
      showNotification('Attendance records refreshed', 'success');
    }

    // Function to edit attendance record
    function editAttendanceRecord(recordId) {
      // Check both attendanceHistory and ctioAttendance
      const attendanceHistory = JSON.parse(localStorage.getItem('attendanceHistory') || '[]');
      const ctioAttendance = JSON.parse(localStorage.getItem('ctioAttendance') || '[]');
      
      let record = attendanceHistory.find(r => r.id === recordId);
      let isInCtioAttendance = false;
      
      if (!record) {
        record = ctioAttendance.find(r => r.id === recordId);
        isInCtioAttendance = true;
      }
      
      if (!record) {
        Swal.fire('Error!', 'Attendance record not found', 'error');
        return;
      }
      
      Swal.fire({
        title: 'Edit Attendance Record',
        html: `
          <div class="text-left space-y-4">
            <div class="bg-gray-50 p-3 rounded-lg">
              <label class="block text-sm font-medium mb-1"><strong>Employee:</strong> ${record.employeeName}</label>
              <label class="block text-sm font-medium mb-1"><strong>ID:</strong> ${record.employeeId}</label>
            </div>
            <div>
              <label class="block text-sm font-medium mb-1">Date: <span class="text-red-500">*</span></label>
              <input type="date" id="editAttendanceDate" class="w-full p-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500" value="${record.date || new Date(record.timestamp).toISOString().split('T')[0]}" required>
            </div>
            <div>
              <label class="block text-sm font-medium mb-1">Time In:</label>
              <input type="time" id="editTimeIn" class="w-full p-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500" value="${record.timeIn || ''}">
            </div>
            <div>
              <label class="block text-sm font-medium mb-1">Time Out:</label>
              <input type="time" id="editTimeOut" class="w-full p-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500" value="${record.timeOut || ''}">
            </div>
            <div>
              <label class="block text-sm font-medium mb-1">Attendance Status: <span class="text-red-500">*</span></label>
              <select id="editAttendanceStatus" class="w-full p-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500" required>
                <option value="Present" ${record.status === 'Present' ? 'selected' : ''}>Present</option>
                <option value="Absent" ${record.status === 'Absent' ? 'selected' : ''}>Absent</option>
                <option value="Off Duty" ${record.status === 'Off Duty' ? 'selected' : ''}>Off Duty</option>
                <option value="On Leave" ${record.status === 'On Leave' ? 'selected' : ''}>On Leave</option>
              </select>
            </div>
            <div>
              <label class="block text-sm font-medium mb-1">Notes:</label>
              <textarea id="editAttendanceNotes" class="w-full p-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500" rows="3" placeholder="Add any notes...">${record.notes || ''}</textarea>
            </div>
          </div>
        `,
        showCancelButton: true,
        confirmButtonText: 'Update',
        cancelButtonText: 'Cancel',
        confirmButtonColor: '#3b82f6',
        cancelButtonColor: '#6b7280',
        width: '600px',
        preConfirm: () => {
          const date = document.getElementById('editAttendanceDate').value;
          const timeIn = document.getElementById('editTimeIn').value;
          const timeOut = document.getElementById('editTimeOut').value;
          const status = document.getElementById('editAttendanceStatus').value;
          const notes = document.getElementById('editAttendanceNotes').value.trim();
          
          if (!date) {
            Swal.showValidationMessage('Please select a date');
            return false;
          }
          
          if (!status) {
            Swal.showValidationMessage('Please select an attendance status');
            return false;
          }
          
          return { date, timeIn, timeOut, status, notes };
        }
      }).then((result) => {
        if (result.isConfirmed) {
          const { date, timeIn, timeOut, status, notes } = result.value;
          
          // Update the record in the appropriate storage
          if (isInCtioAttendance) {
            const recordIndex = ctioAttendance.findIndex(r => r.id === recordId);
            if (recordIndex >= 0) {
              ctioAttendance[recordIndex].date = date;
              ctioAttendance[recordIndex].timeIn = timeIn || null;
              ctioAttendance[recordIndex].timeOut = timeOut || null;
              ctioAttendance[recordIndex].status = status;
              ctioAttendance[recordIndex].notes = notes;
              ctioAttendance[recordIndex].timestamp = new Date().toISOString();
              ctioAttendance[recordIndex].markedBy = 'Supervisor (Edited)';
              
              localStorage.setItem('ctioAttendance', JSON.stringify(ctioAttendance));
            }
          } else {
            const recordIndex = attendanceHistory.findIndex(r => r.id === recordId);
            if (recordIndex >= 0) {
              attendanceHistory[recordIndex].date = date;
              attendanceHistory[recordIndex].timeIn = timeIn || null;
              attendanceHistory[recordIndex].timeOut = timeOut || null;
              attendanceHistory[recordIndex].status = status;
              attendanceHistory[recordIndex].notes = notes;
              attendanceHistory[recordIndex].timestamp = new Date().toISOString();
              attendanceHistory[recordIndex].markedBy = 'Supervisor (Edited)';
              
              localStorage.setItem('attendanceHistory', JSON.stringify(attendanceHistory));
            }
          }
          
          // Refresh display
          const datePicker = document.getElementById('attendanceDatePicker');
          if (datePicker && datePicker.value) {
            loadAttendanceRecords(datePicker.value);
          }
          loadRecentAttendance();
          
          Swal.fire('Success!', 'Attendance record updated successfully', 'success');
        }
      });
    }

    // Function to delete attendance record
    function deleteAttendanceRecord(recordId) {
      const attendanceHistory = JSON.parse(localStorage.getItem('attendanceHistory') || '[]');
      const record = attendanceHistory.find(r => r.id === recordId);
      
      if (!record) {
        Swal.fire('Error!', 'Attendance record not found', 'error');
        return;
      }
      
      Swal.fire({
        title: 'Delete Attendance Record?',
        html: `
          <div class="text-left">
            <p class="mb-2"><strong>Employee:</strong> ${record.employeeName}</p>
            <p class="mb-2"><strong>ID:</strong> ${record.employeeId}</p>
            <p class="mb-2"><strong>Status:</strong> ${record.status}</p>
            <p class="mb-2"><strong>Date:</strong> ${new Date(record.timestamp).toLocaleDateString()}</p>
            <p class="text-red-600 font-medium">This action cannot be undone!</p>
          </div>
        `,
        icon: 'warning',
        showCancelButton: true,
        confirmButtonColor: '#dc2626',
        cancelButtonColor: '#6b7280',
        confirmButtonText: 'Yes, Delete',
        cancelButtonText: 'Cancel'
      }).then((result) => {
        if (result.isConfirmed) {
          // Remove the record
          const updatedHistory = attendanceHistory.filter(r => r.id !== recordId);
          localStorage.setItem('attendanceHistory', JSON.stringify(updatedHistory));
          
          // Refresh display
          const datePicker = document.getElementById('attendanceDatePicker');
          loadAttendanceRecords(datePicker.value);
          
          Swal.fire('Deleted!', 'Attendance record has been deleted', 'success');
        }
      });
    }
    
    // Load and display tickets
    function loadTickets() {
      const ticketsList = document.getElementById('ticketsList');
      if (!ticketsList) return;
      
      // Get all tickets from localStorage
      const allTickets = JSON.parse(localStorage.getItem('supportTickets') || '[]');
      
      // Filter to show tickets created by supervisor or all tickets (depending on need)
      // For supervisor dashboard, show all tickets including supervisor-created ones
      const supervisorTickets = allTickets.filter(ticket => 
        ticket.createdBy === 'Supervisor' || 
        ticket.createdBy === 'supervisor' || 
        ticket.source === 'supervisor' ||
        ticket.source === 'client' // Also show client tickets
      );
      
      if (supervisorTickets.length === 0) {
        ticketsList.innerHTML = `
          <div class="text-center py-12 bg-white rounded-lg border border-gray-200">
            <div class="w-16 h-16 bg-blue-100 rounded-full flex items-center justify-center mx-auto mb-4">
              <i class="fas fa-ticket-alt text-2xl text-blue-600"></i>
            </div>
            <h3 class="text-lg font-medium text-gray-800 mb-2">No Tickets Found</h3>
            <p class="text-gray-600 mb-6">Create your first support ticket to get started</p>
            <button onclick="openModal('ticketModal')" class="px-6 py-3 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-all">
              <i class="fas fa-plus mr-2"></i> Create Ticket
            </button>
          </div>
        `;
        return;
      }
      
      // Sort by creation date (newest first)
      supervisorTickets.sort((a, b) => {
        const dateA = new Date(a.createdAt || 0);
        const dateB = new Date(b.createdAt || 0);
        return dateB - dateA;
      });
      
      // Generate HTML for tickets
      ticketsList.innerHTML = supervisorTickets.map(ticket => {
        const priorityColors = {
          'Low': 'bg-green-100 text-green-800',
          'Medium': 'bg-yellow-100 text-yellow-800',
          'High': 'bg-orange-100 text-orange-800',
          'Critical': 'bg-red-100 text-red-800'
        };
        
        const statusColors = {
          'open': 'bg-blue-100 text-blue-800',
          'Open': 'bg-blue-100 text-blue-800',
          'in-progress': 'bg-purple-100 text-purple-800',
          'In Progress': 'bg-purple-100 text-purple-800',
          'resolved': 'bg-green-100 text-green-800',
          'Resolved': 'bg-green-100 text-green-800',
          'closed': 'bg-gray-100 text-gray-800',
          'Closed': 'bg-gray-100 text-gray-800'
        };
        
        const priority = ticket.priority || 'Medium';
        const status = ticket.status || 'open';
        const createdAt = ticket.createdAt ? new Date(ticket.createdAt).toLocaleString() : 'Unknown';
        const createdBy = ticket.createdBy || 'Unknown';
        
        return `
          <div class="bg-white rounded-lg border border-gray-200 p-6 hover:shadow-lg transition-all duration-300">
            <div class="flex items-start justify-between mb-4">
              <div class="flex-1">
                <div class="flex items-center space-x-3 mb-2">
                  <span class="px-3 py-1 rounded-full text-xs font-medium ${statusColors[status] || 'bg-gray-100 text-gray-800'}">
                    ${status.charAt(0).toUpperCase() + status.slice(1)}
                  </span>
                  <span class="px-3 py-1 rounded-full text-xs font-medium ${priorityColors[priority] || 'bg-gray-100 text-gray-800'}">
                    ${priority} Priority
                  </span>
                  ${ticket.source === 'supervisor' || ticket.createdBy === 'Supervisor' ? `
                    <span class="px-3 py-1 rounded-full text-xs font-medium bg-blue-100 text-blue-800">
                      <i class="fas fa-user-tie mr-1"></i> Supervisor
                    </span>
                  ` : ''}
                </div>
                <h3 class="text-lg font-semibold text-gray-800 mb-1">${ticket.title || ticket.subject || 'Support Ticket'}</h3>
                <p class="text-sm text-gray-600 mb-2">ID: ${ticket.id}</p>
                ${ticket.description ? `<p class="text-sm text-gray-700 mb-2">${ticket.description.substring(0, 150)}${ticket.description.length > 150 ? '...' : ''}</p>` : ''}
              </div>
            </div>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4">
              ${ticket.clientName ? `
              <div>
                <p class="text-xs text-gray-500 mb-1">Client</p>
                <p class="text-sm font-medium text-gray-800">${ticket.clientName}</p>
              </div>
              ` : ''}
              ${ticket.clientLocation ? `
              <div>
                <p class="text-xs text-gray-500 mb-1">Location</p>
                <p class="text-sm font-medium text-gray-800">${ticket.clientLocation}</p>
              </div>
              ` : ''}
              <div>
                <p class="text-xs text-gray-500 mb-1">Created By</p>
                <p class="text-sm font-medium text-gray-800">${createdBy}</p>
              </div>
              <div>
                <p class="text-xs text-gray-500 mb-1">Created</p>
                <p class="text-sm font-medium text-gray-800">${createdAt}</p>
              </div>
            </div>
            <div class="flex space-x-2">
              <button onclick="viewTicketDetails('${ticket.id}')" class="px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded-lg text-sm transition-colors">
                <i class="fas fa-eye mr-2"></i> View Details
              </button>
              ${status === 'open' || status === 'Open' ? `
                <button onclick="updateTicketStatus('${ticket.id}', 'in-progress')" class="px-4 py-2 bg-purple-600 hover:bg-purple-700 text-white rounded-lg text-sm transition-colors">
                  <i class="fas fa-play mr-2"></i> Start Progress
                </button>
              ` : ''}
              ${(status === 'in-progress' || status === 'In Progress') ? `
                <button onclick="updateTicketStatus('${ticket.id}', 'resolved')" class="px-4 py-2 bg-green-600 hover:bg-green-700 text-white rounded-lg text-sm transition-colors">
                  <i class="fas fa-check mr-2"></i> Mark Resolved
                </button>
              ` : ''}
            </div>
          </div>
        `;
      }).join('');
    }
    
    // View ticket details
    function viewTicketDetails(ticketId) {
      const allTickets = JSON.parse(localStorage.getItem('supportTickets') || '[]');
      const ticket = allTickets.find(t => t.id === ticketId);
      
      if (!ticket) {
        showNotification('Ticket not found', 'error');
        return;
      }
      
      Swal.fire({
        title: `Ticket #${ticket.id}`,
        html: `
          <div class="text-left">
            <p><strong>Title:</strong> ${ticket.title || ticket.subject || 'N/A'}</p>
            <p><strong>Client:</strong> ${ticket.clientName || ticket.client || 'N/A'}</p>
            <p><strong>Location:</strong> ${ticket.clientLocation || 'N/A'}</p>
            <p><strong>Priority:</strong> ${ticket.priority || 'N/A'}</p>
            <p><strong>Status:</strong> ${ticket.status || 'N/A'}</p>
            <p><strong>Created By:</strong> ${ticket.createdBy || 'N/A'}</p>
            <p><strong>Description:</strong></p>
            <p class="mt-2">${ticket.description || 'No description provided'}</p>
            <p class="mt-4"><strong>Created:</strong> ${ticket.createdAt ? new Date(ticket.createdAt).toLocaleString() : 'N/A'}</p>
          </div>
        `,
        icon: 'info',
        confirmButtonText: 'Close'
      });
    }
    
    // Update ticket status
    function updateTicketStatus(ticketId, newStatus) {
      const allTickets = JSON.parse(localStorage.getItem('supportTickets') || '[]');
      const ticketIndex = allTickets.findIndex(t => t.id === ticketId);
      
      if (ticketIndex === -1) {
        showNotification('Ticket not found', 'error');
        return;
      }
      
      allTickets[ticketIndex].status = newStatus;
      allTickets[ticketIndex].updatedAt = new Date().toISOString();
      localStorage.setItem('supportTickets', JSON.stringify(allTickets));
      
      loadTickets();
      showNotification('Ticket status updated successfully', 'success');
    }
    
    // Filter tickets function
    function filterTickets(status) {
      // Update button styles
      const buttons = event.target.parentElement.querySelectorAll('button');
      buttons.forEach(button => {
        button.classList.remove('bg-blue-600', 'text-white');
        button.classList.add('bg-gray-200', 'text-gray-700');
      });
      
      event.target.classList.remove('bg-gray-200', 'text-gray-700');
      event.target.classList.add('bg-blue-600', 'text-white');
      
      // Filter and reload tickets
      const ticketsList = document.getElementById('ticketsList');
      if (!ticketsList) return;
      
      const allTickets = JSON.parse(localStorage.getItem('supportTickets') || '[]');
      let filteredTickets = allTickets.filter(ticket => 
        ticket.createdBy === 'Supervisor' || 
        ticket.createdBy === 'supervisor' || 
        ticket.source === 'supervisor' ||
        ticket.source === 'client'
      );
      
      if (status !== 'all') {
        filteredTickets = filteredTickets.filter(ticket => {
          const ticketStatus = (ticket.status || '').toLowerCase();
          if (status === 'open') return ticketStatus === 'open';
          if (status === 'in-progress') return ticketStatus === 'in-progress' || ticketStatus === 'in progress';
          if (status === 'resolved') return ticketStatus === 'resolved';
          return true;
        });
      }
      
      // Sort by creation date (newest first)
      filteredTickets.sort((a, b) => {
        const dateA = new Date(a.createdAt || 0);
        const dateB = new Date(b.createdAt || 0);
        return dateB - dateA;
      });
      
      // Re-render with filtered tickets (similar to loadTickets but with filtered data)
      // For simplicity, we'll just reload all and apply filter visually
      loadTickets();
      
      showNotification(`Showing ${status} tickets`, 'info');
    }
    
    // Show user tab function
    function showUserTab(tab) {
      // Hide all tabs
      document.querySelectorAll('.user-tab').forEach(userTab => {
        userTab.classList.add('hidden');
      });
      
      // Show selected tab
      document.getElementById(tab + 'Tab').classList.remove('hidden');
      
      // Update button styles
      const buttons = event.target.parentElement.querySelectorAll('button');
      buttons.forEach(button => {
        button.classList.remove('bg-blue-600', 'text-white');
        button.classList.add('bg-gray-200', 'text-gray-700');
      });
      
      event.target.classList.remove('bg-gray-200', 'text-gray-700');
      event.target.classList.add('bg-blue-600', 'text-white');
    }
    
    // Show finance tab function
    function showFinanceTab(tab) {
      // Hide all tabs
      document.querySelectorAll('.finance-tab').forEach(financeTab => {
        financeTab.classList.add('hidden');
      });
      
      // Show selected tab
      document.getElementById(tab + 'Tab').classList.remove('hidden');
      
      // Update button styles
      const buttons = event.target.parentElement.querySelectorAll('button');
      buttons.forEach(button => {
        button.classList.remove('bg-blue-600', 'text-white');
        button.classList.add('bg-gray-200', 'text-gray-700');
      });
      
      event.target.classList.remove('bg-gray-200', 'text-gray-700');
      event.target.classList.add('bg-blue-600', 'text-white');
    }
    
    // Profile functions
    document.querySelector('.profile-upload').addEventListener('click', function() {
      document.getElementById('profileInput').click();
    });
    
    document.getElementById('profileInput').addEventListener('change', function(e) {
      const file = e.target.files[0];
      if (file) {
        const reader = new FileReader();
        reader.onload = function(e) {
          const imageUrl = e.target.result;
          document.getElementById('profileImage').src = imageUrl;
          
          // Save using centralized profile image manager
          if (window.ProfileImageManager) {
            window.ProfileImageManager.save(imageUrl);
          }
          
          // Update all profile images on the page
          if (window.ProfileImageManager) {
            window.ProfileImageManager.update(imageUrl);
          }
        };
        reader.readAsDataURL(file);
      }
    });
    
    // Load profile image on page load
    function loadSupervisorProfileImage() {
      const profileImageElement = document.getElementById('profileImage');
      const headerProfileImageElement = document.getElementById('supervisorHeaderProfileImage');
      const headerProfilePlaceholder = document.getElementById('supervisorHeaderProfilePlaceholder');
      const supervisorNameElement = document.getElementById('supervisorHeaderName');
      
      let imageUrl = null;
      if (window.ProfileImageManager) {
        imageUrl = window.ProfileImageManager.get();
      }
      
      // Update settings profile image
      if (profileImageElement && imageUrl) {
        profileImageElement.src = imageUrl;
      }
      
      // Update header profile image
      if (headerProfileImageElement && imageUrl) {
        headerProfileImageElement.src = imageUrl;
        headerProfileImageElement.classList.remove('hidden');
        if (headerProfilePlaceholder) {
          headerProfilePlaceholder.style.display = 'none';
        }
      } else if (headerProfileImageElement) {
        headerProfileImageElement.classList.add('hidden');
        if (headerProfilePlaceholder) {
          headerProfilePlaceholder.style.display = 'flex';
        }
      }
      
      // Update supervisor name in header if available
      if (supervisorNameElement) {
        // Try to get name from localStorage or profile data
        const adminProfile = JSON.parse(localStorage.getItem('adminProfile') || '{}');
        const supervisorName = localStorage.getItem('supervisorName') || adminProfile.name || 'Supervisor';
        supervisorNameElement.textContent = supervisorName;
      }
    }
    
    // Load profile image when page loads
    if (document.readyState === 'loading') {
      document.addEventListener('DOMContentLoaded', loadSupervisorProfileImage);
    } else {
      loadSupervisorProfileImage();
    }
    
    // Listen for profile image updates
    window.addEventListener('profileImageUpdated', () => {
      loadSupervisorProfileImage();
    });
    
    function saveProfile() {
      const fullName = document.getElementById('fullName').value;
      const username = document.getElementById('username').value;
      
      // Update profile (simulated)
      document.querySelector('.sidebar .font-semibold').textContent = fullName;
      
      // Show success message
      showNotification('Profile updated successfully', 'success');
    }
    
    // SMS Integration Functions
    async function sendSMSToSupervisor(message, phoneNumber = '+254700000000') {
      try {
        // In a real implementation, this would call an SMS API like Twilio, Africa's Talking, etc.
        console.log(` Sending SMS to Supervisor (${phoneNumber}): ${message}`);
        
        // Simulate SMS sending with a realistic API call structure
        const smsData = {
          to: phoneNumber,
          message: `[DR.NET CTIO] ${message}`,
          from: 'DR.NET',
          timestamp: new Date().toISOString()
        };
        
        // Store SMS in localStorage for simulation
        let smsHistory = JSON.parse(localStorage.getItem('supervisorSMS') || '[]');
        smsHistory.push(smsData);
        localStorage.setItem('supervisorSMS', JSON.stringify(smsHistory));
        
        // Show notification in supervisor dashboard
        showSMSNotification(message);
        
        // Add to chat history
        if (!chatHistory['ctio']) {
          chatHistory['ctio'] = [];
        }
        chatHistory['ctio'].push({
          type: 'received',
          message: ` SMS: ${message}`,
          time: new Date().toLocaleTimeString('en-US', { hour: '2-digit', minute: '2-digit' })
        });
        
        // Update last message
        updateLastMessage('ctio', ` SMS: ${message}`, new Date().toLocaleTimeString('en-US', { hour: '2-digit', minute: '2-digit' }));
        
        // Show notification badge
        showNotificationBadge('ctio');
        
        return { success: true, messageId: Date.now() };
      } catch (error) {
        console.error('SMS sending failed:', error);
        return { success: false, error: error.message };
      }
    }
    
    // Show SMS notification
    function showSMSNotification(message) {
      const notification = document.createElement('div');
      notification.className = 'fixed top-4 right-4 px-6 py-4 rounded-lg shadow-2xl z-50 bg-gradient-to-r from-blue-500 to-purple-600 text-white max-w-sm';
      notification.innerHTML = `
        <div class="flex items-start">
          <div class="flex-shrink-0">
            <i class="fas fa-sms text-2xl"></i>
          </div>
          <div class="ml-3">
            <h3 class="text-lg font-semibold">New SMS from CTIO</h3>
            <p class="text-sm mt-1">${message}</p>
            <div class="mt-2 flex space-x-2">
              <button onclick="this.parentElement.parentElement.parentElement.parentElement.remove()" 
                      class="px-3 py-1 bg-white/20 rounded text-sm hover:bg-white/30 transition-colors">
                Dismiss
              </button>
              <button onclick="openChat('ctio'); this.parentElement.parentElement.parentElement.parentElement.remove()" 
                      class="px-3 py-1 bg-white/20 rounded text-sm hover:bg-white/30 transition-colors">
                View Chat
              </button>
            </div>
          </div>
        </div>
      `;
      
      document.body.appendChild(notification);
      
      // Auto-remove after 10 seconds
      setTimeout(() => {
        if (notification.parentElement) {
          notification.remove();
        }
      }, 10000);
    }
    
    // Send to CTIO function (enhanced with SMS)
    function sendToCTIO(type, data) {
      // In a real application, this would send data to the CTIO's dashboard
      console.log(`Sending ${type} to CTIO:`, data);
      
      // Store in localStorage for simulation
      let ctioData = JSON.parse(localStorage.getItem('ctioData') || '{}');
      if (!ctioData[type]) ctioData[type] = [];
      ctioData[type].push(data);
      localStorage.setItem('ctioData', JSON.stringify(ctioData));
      
      // Send SMS notification to CTIO if it's urgent
      if (type === 'attendance' || type === 'urgent') {
        const message = `Supervisor submitted: ${type} - ${JSON.stringify(data).substring(0, 50)}...`;
        sendSMSToCTIO(message);
      }
    }
    
    // Send SMS to CTIO (for urgent notifications)
    async function sendSMSToCTIO(message, phoneNumber = '+254700000001') {
      try {
        console.log(` Sending SMS to CTIO (${phoneNumber}): ${message}`);
        
        const smsData = {
          to: phoneNumber,
          message: `[DR.NET SUPERVISOR] ${message}`,
          from: 'DR.NET',
          timestamp: new Date().toISOString()
        };
        
        // Store SMS in localStorage for simulation
        let smsHistory = JSON.parse(localStorage.getItem('ctioSMS') || '[]');
        smsHistory.push(smsData);
        localStorage.setItem('ctioSMS', JSON.stringify(smsHistory));
        
        return { success: true, messageId: Date.now() };
      } catch (error) {
        console.error('SMS sending to CTIO failed:', error);
        return { success: false, error: error.message };
      }
    }
    
    // Load SMS history
    function loadSMSHistory() {
      const smsHistory = JSON.parse(localStorage.getItem('supervisorSMS') || '[]');
      return smsHistory;
    }
    
    // Simulate incoming SMS from CTIO
    function simulateIncomingSMS() {
      const messages = [
        "Please review the new project assignments for this week.",
        "Urgent: Equipment maintenance required at client site ABC.",
        "Team meeting scheduled for tomorrow at 9 AM.",
        "Budget approval needed for new equipment purchase.",
        "Client feedback received - please follow up on installation issues.",
        "New staff member onboarding - prepare training materials.",
        "Monthly report due by end of week - please submit attendance data.",
        "Emergency contact: Client experiencing network outage - immediate response needed."
      ];
      
      // Simulate SMS every 2-5 minutes
      setInterval(() => {
        const randomMessage = messages[Math.floor(Math.random() * messages.length)];
        const now = new Date();
        const time = now.toLocaleTimeString('en-US', { hour: '2-digit', minute: '2-digit' });
        
        // Send SMS to supervisor
        sendSMSToSupervisor(randomMessage);
        
        // Add to CTIO chat
        if (!chatHistory['ctio']) {
          chatHistory['ctio'] = [];
        }
        chatHistory['ctio'].push({
          type: 'received',
          message: ` SMS: ${randomMessage}`,
          time: time
        });
        
        // Update last message
        updateLastMessage('ctio', ` SMS: ${randomMessage}`, time);
        
        // Show notification badge
        showNotificationBadge('ctio');
        
        // If CTIO chat is open, add message to chat
        if (currentUser === 'ctio') {
          addMessageToChat(` SMS: ${randomMessage}`, 'received', time);
        }
      }, Math.random() * 180000 + 120000); // 2-5 minutes
    }
    
    // Open SMS History Modal
    function openSMSHistory() {
      const smsHistory = loadSMSHistory();
      
      let smsHTML = `
        <div class="text-left max-h-96 overflow-y-auto">
          <div class="mb-4">
            <h3 class="text-xl font-bold text-gray-800 mb-2">SMS History</h3>
            <p class="text-gray-600">Messages received from CTIO via SMS</p>
          </div>
      `;
      
      if (smsHistory.length === 0) {
        smsHTML += `
          <div class="text-center py-8">
            <i class="fas fa-sms text-4xl text-gray-300 mb-4"></i>
            <p class="text-gray-500">No SMS messages yet</p>
            <p class="text-sm text-gray-400">SMS messages from CTIO will appear here</p>
          </div>
        `;
      } else {
        smsHTML += `
          <div class="space-y-3">
        `;
        
        smsHistory.reverse().forEach(sms => {
          const date = new Date(sms.timestamp).toLocaleDateString();
          const time = new Date(sms.timestamp).toLocaleTimeString('en-US', { hour: '2-digit', minute: '2-digit' });
          
          smsHTML += `
            <div class="flex items-start p-4 bg-blue-50 rounded-lg border border-blue-200">
              <div class="flex-shrink-0">
                <div class="w-10 h-10 bg-blue-100 rounded-full flex items-center justify-center">
                  <i class="fas fa-sms text-blue-600"></i>
                </div>
              </div>
              <div class="ml-3 flex-1">
                <div class="flex items-center justify-between">
                  <h4 class="font-medium text-gray-800">CTIO</h4>
                  <span class="text-xs text-gray-500">${date} ${time}</span>
                </div>
                <p class="text-sm text-gray-600 mt-1">${sms.message}</p>
                <div class="mt-2 flex items-center text-xs text-gray-500">
                  <i class="fas fa-phone mr-1"></i>
                  <span>From: ${sms.from}</span>
                  <span class="mx-2"></span>
                  <span>To: ${sms.to}</span>
                </div>
              </div>
            </div>
          `;
        });
        
        smsHTML += `</div>`;
      }
      
      smsHTML += `</div>`;
      
      Swal.fire({
        title: 'SMS History',
        html: smsHTML,
        width: '700px',
        showCancelButton: true,
        cancelButtonText: 'Close',
        confirmButtonText: 'Send Reply',
        confirmButtonColor: '#3b82f6',
        preConfirm: () => {
          openChat('ctio');
        }
      });
    }
    
    // Show notification function
    function showNotification(message, type) {
      // Create notification element
      const notification = document.createElement('div');
      notification.className = `fixed top-4 right-4 px-6 py-3 rounded-lg shadow-lg z-50 flex items-center ${
        type === 'success' ? 'bg-green-500 text-white' : 
        type === 'error' ? 'bg-red-500 text-white' : 
        'bg-blue-500 text-white'
      }`;
      
      // Add icon based on type
      const icon = type === 'success' ? 'fa-check-circle' : 
                   type === 'error' ? 'fa-exclamation-circle' : 
                   'fa-info-circle';
      
      notification.innerHTML = `
        <i class="fas ${icon} mr-2"></i>
        <span>${message}</span>
      `;
      
      // Add to DOM
      document.body.appendChild(notification);
      
      // Remove after 3 seconds
      setTimeout(() => {
        notification.remove();
      }, 3000);
    }
    
    // Initialize other functions on page load
    document.addEventListener('DOMContentLoaded', function() {
      // Load assignments
      loadAssignments();
      
      // Load supervisor payslips
      loadSupervisorPayslips();
      
      // Load initial attendance data
      loadAttendanceForDate(new Date().toISOString().split('T')[0]);
      
      // Initialize user management
      initializeUserManagement();
    });
    
    // Finance Card Modal Functions
    function openPayslipsModal() {
      const payslips = JSON.parse(localStorage.getItem('supervisorPayslips') || '[]');
      
      let payslipsHTML = `
        <div class="text-left max-h-96 overflow-y-auto">
          <div class="mb-4">
            <h3 class="text-xl font-bold text-gray-800 mb-2">Payslips Overview</h3>
            <p class="text-gray-600">Manage and view all payslips</p>
          </div>
      `;
      
      if (payslips.length === 0) {
        payslipsHTML += `
          <div class="text-center py-8">
            <i class="fas fa-file-invoice-dollar text-4xl text-gray-300 mb-4"></i>
            <p class="text-gray-500">No payslips available yet</p>
            <p class="text-sm text-gray-400">Payslips will appear here when activated by CTIO</p>
          </div>
        `;
      } else {
        payslipsHTML += `
          <div class="space-y-3">
        `;
        
        payslips.forEach(payslip => {
          payslipsHTML += `
            <div class="flex items-center justify-between p-3 bg-blue-50 rounded-lg border border-blue-200">
              <div class="flex items-center space-x-3">
                <div class="w-10 h-10 bg-blue-100 rounded-full flex items-center justify-center">
                  <i class="fas fa-file-invoice-dollar text-blue-600"></i>
                </div>
                <div>
                  <p class="font-medium text-gray-800">${payslip.payPeriod}</p>
                  <p class="text-sm text-gray-600">${payslip.staffName}</p>
                </div>
              </div>
              <div class="flex items-center space-x-2">
                <span class="text-sm text-gray-600">Ksh ${payslip.netSalary.toLocaleString()}</span>
                <button onclick="downloadSupervisorPayslip('${payslip.payPeriod}', '${payslip.staffId}')" 
                        class="px-3 py-1 bg-blue-600 text-white text-sm rounded hover:bg-blue-700 transition-colors">
                  <i class="fas fa-download mr-1"></i>Download
                </button>
              </div>
            </div>
          `;
        });
        
        payslipsHTML += `</div>`;
      }
      
      payslipsHTML += `</div>`;
      
      Swal.fire({
        title: 'Payslips Management',
        html: payslipsHTML,
        width: '700px',
        showCancelButton: true,
        cancelButtonText: 'Close',
        confirmButtonText: 'View All Payslips',
        confirmButtonColor: '#3b82f6',
        preConfirm: () => {
          showFinanceTab('payslips');
        }
      });
    }
    
    function openExpensesModal() {
      // Mock expenses data
      const expenses = [
        { id: 1, description: 'Office Supplies', amount: 250, date: '2024-12-15', category: 'Office' },
        { id: 2, description: 'Internet Bill', amount: 500, date: '2024-12-10', category: 'Utilities' },
        { id: 3, description: 'Equipment Maintenance', amount: 300, date: '2024-12-08', category: 'Maintenance' },
        { id: 4, description: 'Transportation', amount: 200, date: '2024-12-05', category: 'Travel' }
      ];
      
      const totalExpenses = expenses.reduce((sum, expense) => sum + expense.amount, 0);
      
      let expensesHTML = `
        <div class="text-left max-h-96 overflow-y-auto">
          <div class="mb-4">
            <h3 class="text-xl font-bold text-gray-800 mb-2">Expenses Overview</h3>
            <p class="text-gray-600">Total expenses this month: <span class="font-bold text-red-600">Ksh ${totalExpenses.toLocaleString()}</span></p>
          </div>
          <div class="space-y-3">
      `;
      
      expenses.forEach(expense => {
        expensesHTML += `
          <div class="flex items-center justify-between p-3 bg-orange-50 rounded-lg border border-orange-200">
            <div class="flex items-center space-x-3">
              <div class="w-10 h-10 bg-orange-100 rounded-full flex items-center justify-center">
                <i class="fas fa-receipt text-orange-600"></i>
              </div>
              <div>
                <p class="font-medium text-gray-800">${expense.description}</p>
                <p class="text-sm text-gray-600">${expense.category}  ${new Date(expense.date).toLocaleDateString()}</p>
              </div>
            </div>
            <span class="font-bold text-red-600">Ksh ${expense.amount}</span>
          </div>
        `;
      });
      
      expensesHTML += `
          </div>
        </div>
      `;
      
      Swal.fire({
        title: 'Expenses Management',
        html: expensesHTML,
        width: '700px',
        showCancelButton: true,
        cancelButtonText: 'Close',
        confirmButtonText: 'View All Expenses',
        confirmButtonColor: '#f97316',
        preConfirm: () => {
          showFinanceTab('expenses');
        }
      });
    }
    
    function openSalesModal() {
      // Mock sales data
      const sales = [
        { id: 1, client: 'ABC Company', amount: 2500, date: '2024-12-15', status: 'Completed' },
        { id: 2, client: 'XYZ Corp', amount: 1800, date: '2024-12-12', status: 'Completed' },
        { id: 3, client: 'Tech Solutions', amount: 3200, date: '2024-12-10', status: 'Pending' },
        { id: 4, client: 'Global Systems', amount: 1500, date: '2024-12-08', status: 'Completed' }
      ];
      
      const totalSales = sales.reduce((sum, sale) => sum + sale.amount, 0);
      const completedSales = sales.filter(sale => sale.status === 'Completed').reduce((sum, sale) => sum + sale.amount, 0);
      
      let salesHTML = `
        <div class="text-left max-h-96 overflow-y-auto">
          <div class="mb-4">
            <h3 class="text-xl font-bold text-gray-800 mb-2">Sales Overview</h3>
            <p class="text-gray-600">Total sales this month: <span class="font-bold text-green-600">Ksh ${totalSales.toLocaleString()}</span></p>
            <p class="text-gray-600">Completed sales: <span class="font-bold text-green-600">Ksh ${completedSales.toLocaleString()}</span></p>
          </div>
          <div class="space-y-3">
      `;
      
      sales.forEach(sale => {
        const statusColor = sale.status === 'Completed' ? 'text-green-600 bg-green-100' : 'text-yellow-600 bg-yellow-100';
        salesHTML += `
          <div class="flex items-center justify-between p-3 bg-green-50 rounded-lg border border-green-200">
            <div class="flex items-center space-x-3">
              <div class="w-10 h-10 bg-green-100 rounded-full flex items-center justify-center">
                <i class="fas fa-chart-line text-green-600"></i>
              </div>
              <div>
                <p class="font-medium text-gray-800">${sale.client}</p>
                <p class="text-sm text-gray-600">${new Date(sale.date).toLocaleDateString()}</p>
              </div>
            </div>
            <div class="flex items-center space-x-2">
              <span class="px-2 py-1 text-xs rounded-full ${statusColor}">${sale.status}</span>
              <span class="font-bold text-green-600">Ksh ${sale.amount}</span>
            </div>
          </div>
        `;
      });
      
      salesHTML += `
          </div>
        </div>
      `;
      
      Swal.fire({
        title: 'Sales Management',
        html: salesHTML,
        width: '700px',
        showCancelButton: true,
        cancelButtonText: 'Close',
        confirmButtonText: 'View All Sales',
        confirmButtonColor: '#10b981',
        preConfirm: () => {
          showFinanceTab('sales');
        }
      });
    }
  </script>

  <!-- CTIO User Management Scripts (Read-Only for Supervisor) -->
  <script>
    // ===================== USER MANAGEMENT FUNCTIONS (READ-ONLY) =====================
    
    let users = [];
    let staff = [];
    let currentTab = 'clients';

    // Initialize user management
    async function initializeUserManagement() {
      try {
        await fetchData();
        switchUserTab('clients');
        
        // Add event listeners
        document.getElementById('clientSearchInput').addEventListener('input', renderManageUsers);
        document.getElementById('subscriptionFilter').addEventListener('change', renderManageUsers);
        document.getElementById('statusFilter').addEventListener('change', renderManageUsers);
        
        document.getElementById('staffSearchInput').addEventListener('input', renderManageStaff);
        document.getElementById('departmentFilter').addEventListener('change', renderManageStaff);
        document.getElementById('staffStatusFilter').addEventListener('change', renderManageStaff);
        
        
      } catch (error) {
        console.error('Error initializing user management:', error);
      }
    }

    // Fetch data from CTIO dashboard
    async function fetchData() {
      try {
        // Simulate fetching from CTIO's data
        // In a real implementation, this would fetch from the CTIO's API
        users = JSON.parse(localStorage.getItem('ctioUsers') || '[]');
        staff = JSON.parse(localStorage.getItem('ctioStaff') || '[]');
        
        // If no data exists, create sample data
        if (users.length === 0) {
          users = [
            {
              id: 1,
              name: "John Doe",
              phone: "+254700000001",
              location: "Nairobi",
              paid_subscription: true,
              payment_date: "2024-01-15",
              is_deleted: 0
            },
            {
              id: 2,
              name: "Jane Smith",
              phone: "+254700000002",
              location: "Mombasa",
              paid_subscription: false,
              payment_date: "2023-12-01",
              is_deleted: 0
            }
          ];
          localStorage.setItem('ctioUsers', JSON.stringify(users));
        }
        
        if (staff.length === 0) {
          staff = [
            {
              id: 1,
              name: "Michael Johnson",
              employee_id: "EMP001",
              email: "michael@drnet.com",
              role: "Lead Technician",
              department: "Technical",
              status: "active",
              hire_date: "2023-01-15",
              salary: "80000"
            },
            {
              id: 2,
              name: "Sarah Williams",
              employee_id: "EMP002",
              email: "sarah@drnet.com",
              role: "Customer Service Rep",
              department: "Customer Service",
              status: "active",
              hire_date: "2023-03-20",
              salary: "60000"
            }
          ];
          localStorage.setItem('ctioStaff', JSON.stringify(staff));
        }
        
      } catch (error) {
        console.error('Error fetching data:', error);
      }
    }

    // Tab switching functionality
    function switchUserTab(tab) {
      const clientsSection = document.getElementById('clientsSection');
      const staffSection = document.getElementById('staffSection');
      const clientsTab = document.getElementById('clientsTab');
      const staffTab = document.getElementById('staffTab');
      const exportButton = document.getElementById('exportButton');

      currentTab = tab;

      // Hide all sections first
      clientsSection.classList.add('hidden');
      staffSection.classList.add('hidden');

      // Remove active state from all tabs
      [clientsTab, staffTab].forEach(tabElement => {
        tabElement.classList.remove('bg-white', 'text-blue-600', 'shadow-sm', 'active');
        tabElement.classList.add('text-gray-600', 'hover:text-blue-600');
      });

      if (tab === 'clients') {
        clientsSection.classList.remove('hidden');
        clientsTab.classList.add('bg-white', 'text-blue-600', 'shadow-sm', 'active');
        clientsTab.classList.remove('text-gray-600', 'hover:text-blue-600');
        exportButton.innerHTML = '<i class="fas fa-download mr-2"></i> Export Clients to CSV';
        renderManageUsers();
      } else if (tab === 'staff') {
        staffSection.classList.remove('hidden');
        staffTab.classList.add('bg-white', 'text-blue-600', 'shadow-sm', 'active');
        staffTab.classList.remove('text-gray-600', 'hover:text-blue-600');
        exportButton.innerHTML = '<i class="fas fa-download mr-2"></i> Export Staff to CSV';
        renderManageStaff();
      }
    }

    // Render clients (read-only)
    async function renderManageUsers() {
      const container = document.getElementById('clientListContent');
      const searchInput = document.getElementById('clientSearchInput').value.toLowerCase();
      const subscriptionFilter = document.getElementById('subscriptionFilter').value;
      const statusFilter = document.getElementById('statusFilter').value;

      container.innerHTML = '<div class="text-center text-gray-500 py-8"> Loading clients...</div>';

      try {
        await fetchData();
        let filteredUsers = users.filter(u => u.is_deleted !== 1);

        // Apply search filter
        if (searchInput) {
          filteredUsers = filteredUsers.filter(u =>
            u.name.toLowerCase().includes(searchInput) ||
            u.phone.toLowerCase().includes(searchInput) ||
            u.location.toLowerCase().includes(searchInput)
          );
        }

        // Apply subscription filter
        if (subscriptionFilter !== 'all') {
          filteredUsers = filteredUsers.filter(u =>
            subscriptionFilter === 'paid' ? u.paid_subscription : !u.paid_subscription
          );
        }

        // Apply status filter
        if (statusFilter !== 'all') {
          filteredUsers = filteredUsers.filter(u => {
            const paymentDate = dayjs(u.payment_date);
            const expiryDate = paymentDate.add(30, 'day');
            const daysRemaining = expiryDate.diff(dayjs(), 'day');
            const isActive = daysRemaining >= 0;
            return statusFilter === 'active' ? isActive : !isActive;
          });
        }

        if (filteredUsers.length === 0) {
          container.innerHTML = `<p class="text-gray-500 text-center py-8">No clients found.</p>`;
          return;
        }

        container.innerHTML = filteredUsers.map(user => {
          const paymentDate = dayjs(user.payment_date);
          const expiryDate = paymentDate.add(30, 'day');
          const daysRemaining = expiryDate.diff(dayjs(), 'day');
          const isActive = daysRemaining >= 0;
          const statusColor = isActive ? 'bg-green-100 text-green-800' : 'bg-red-100 text-red-800';
          const subscriptionColor = user.paid_subscription ? 'bg-blue-100 text-blue-800' : 'bg-yellow-100 text-yellow-800';

          return `
            <div class="bg-white border border-gray-200 rounded-lg p-6 shadow-sm hover:shadow-md transition-shadow">
              <div class="flex justify-between items-start">
                <div class="flex-1">
                  <div class="flex items-center space-x-3 mb-2">
                    <h3 class="text-lg font-semibold text-gray-900">${user.name}</h3>
                    <span class="px-2 py-1 text-xs rounded-full ${statusColor}">
                      ${isActive ? 'Active' : 'Expired'}
                    </span>
                    <span class="px-2 py-1 text-xs rounded-full ${subscriptionColor}">
                      ${user.paid_subscription ? 'Paid' : 'Unpaid'}
                    </span>
                  </div>
                  <div class="grid grid-cols-1 md:grid-cols-3 gap-4 text-sm text-gray-600">
                    <div>
                      <span class="font-medium">Phone:</span> ${user.phone}
                    </div>
                    <div>
                      <span class="font-medium">Location:</span> ${user.location}
                    </div>
                    <div>
                      <span class="font-medium">Days Remaining:</span> ${daysRemaining} days
                    </div>
                  </div>
                </div>
                <div class="flex space-x-2">
                  <button onclick="viewClient('${user.id}')" class="px-3 py-1 bg-blue-100 text-blue-700 rounded hover:bg-blue-200 transition-colors text-sm">
                    <i class="fas fa-eye mr-1"></i> View
                  </button>
                </div>
              </div>
            </div>
          `;
        }).join('');
      } catch (error) {
        console.error('Error rendering users:', error);
        container.innerHTML = '<p class="text-red-500 text-center py-8">Error loading clients. Please try again.</p>';
      }
    }

    // Render staff (read-only)
    async function renderManageStaff() {
      const container = document.getElementById('staffListContent');
      const searchInput = document.getElementById('staffSearchInput').value.toLowerCase();
      const departmentFilter = document.getElementById('departmentFilter').value;
      const statusFilter = document.getElementById('staffStatusFilter').value;

      container.innerHTML = '<div class="text-center text-gray-500 py-8"> Loading staff...</div>';

      try {
        await fetchData();
        let filteredStaff = staff;

        // Apply search filter
        if (searchInput) {
          filteredStaff = filteredStaff.filter(s =>
            s.name.toLowerCase().includes(searchInput) ||
            s.employee_id.toLowerCase().includes(searchInput) ||
            s.role.toLowerCase().includes(searchInput) ||
            s.department.toLowerCase().includes(searchInput)
          );
        }

        // Apply department filter
        if (departmentFilter !== 'all') {
          filteredStaff = filteredStaff.filter(s => s.department === departmentFilter);
        }

        // Apply status filter
        if (statusFilter !== 'all') {
          filteredStaff = filteredStaff.filter(s => s.status === statusFilter);
        }

        if (filteredStaff.length === 0) {
          container.innerHTML = `<p class="text-gray-500 text-center py-8">No staff found.</p>`;
          return;
        }

        container.innerHTML = filteredStaff.map(staffMember => {
          const hireDate = dayjs(staffMember.hire_date);
          const statusColor = staffMember.status === 'active'
            ? 'bg-gradient-to-r from-green-100 to-emerald-100 text-green-700' 
            : 'bg-gradient-to-r from-red-100 to-pink-100 text-red-700';

          return `
            <div class="bg-white border border-gray-200 rounded-lg p-6 shadow-sm hover:shadow-md transition-shadow">
              <div class="flex justify-between items-start">
                <div class="flex-1">
                  <div class="flex items-center space-x-3 mb-2">
                    <h3 class="text-lg font-semibold text-gray-900">${staffMember.name}</h3>
                    <span class="px-2 py-1 text-xs rounded-full ${statusColor}">
                      ${staffMember.status === 'active' ? 'Active' : 'Inactive'}
                    </span>
                  </div>
                  <div class="grid grid-cols-1 md:grid-cols-2 gap-4 text-sm text-gray-600">
                    <div>
                      <span class="font-medium">Employee ID:</span> ${staffMember.employee_id}
                    </div>
                    <div>
                      <span class="font-medium">Email:</span> ${staffMember.email}
                    </div>
                    <div>
                      <span class="font-medium">Role:</span> ${staffMember.role}
                    </div>
                    <div>
                      <span class="font-medium">Department:</span> ${staffMember.department}
                    </div>
                    <div>
                      <span class="font-medium">Hired:</span> ${hireDate.format('MMM D, YYYY')}
                    </div>
                  </div>
                </div>
                <div class="flex space-x-2">
                  <button onclick="viewStaff('${staffMember.id}')" class="px-3 py-1 bg-blue-100 text-blue-700 rounded hover:bg-blue-200 transition-colors text-sm">
                    <i class="fas fa-eye mr-1"></i> View
                  </button>
                </div>
              </div>
            </div>
          `;
        }).join('');
      } catch (error) {
        console.error('Error rendering staff:', error);
        container.innerHTML = '<p class="text-red-500 text-center py-8">Error loading staff. Please try again.</p>';
      }
    }


    // View client details (read-only)
    function viewClient(clientId) {
      const client = users.find(u => u.id == clientId);
      if (!client) return;
      
      const paymentDate = dayjs(client.payment_date);
      const expiryDate = paymentDate.add(30, 'day');
      const daysRemaining = expiryDate.diff(dayjs(), 'day');
      const isActive = daysRemaining >= 0;
      
      Swal.fire({
        title: 'Client Details',
        html: `
          <div class="text-left">
            <h3 class="text-lg font-semibold mb-4">${client.name}</h3>
            <div class="space-y-2">
              <p><strong>Phone:</strong> ${client.phone}</p>
              <p><strong>Location:</strong> ${client.location}</p>
              <p><strong>Subscription:</strong> ${client.paid_subscription ? 'Paid' : 'Unpaid'}</p>
              <p><strong>Payment Date:</strong> ${paymentDate.format('MMM D, YYYY')}</p>
              <p><strong>Expiry Date:</strong> ${expiryDate.format('MMM D, YYYY')}</p>
              <p><strong>Status:</strong> <span class="${isActive ? 'text-green-600' : 'text-red-600'}">${isActive ? 'Active' : 'Expired'}</span></p>
              <p><strong>Days Remaining:</strong> ${daysRemaining} days</p>
            </div>
          </div>
        `,
        showCancelButton: false,
        confirmButtonText: 'Close',
        confirmButtonColor: '#3b82f6'
      });
    }

    // View staff details (read-only)
    function viewStaff(staffId) {
      const member = staff.find(s => s.id == staffId);
      if (!member) return;
      
      const hireDate = dayjs(member.hire_date);
      
      Swal.fire({
        title: 'Staff Details',
        html: `
          <div class="text-left">
            <h3 class="text-lg font-semibold mb-4">${member.name}</h3>
            <div class="space-y-2">
              <p><strong>Employee ID:</strong> ${member.employee_id}</p>
              <p><strong>Email:</strong> ${member.email}</p>
              <p><strong>Role:</strong> ${member.role}</p>
              <p><strong>Department:</strong> ${member.department}</p>
              <p><strong>Status:</strong> <span class="${member.status === 'active' ? 'text-green-600' : 'text-red-600'}">${member.status}</span></p>
              <p><strong>Hire Date:</strong> ${hireDate.format('MMM D, YYYY')}</p>
            </div>
          </div>
        `,
        showCancelButton: false,
        confirmButtonText: 'Close',
        confirmButtonColor: '#3b82f6'
      });
    }

    // Export to CSV
    function exportToCSV() {
      let csvContent = '';
      let filename = '';
      
      if (currentTab === 'clients') {
        csvContent = 'Name,Phone,Location,Subscription,Payment Date,Status\n';
        users.forEach(user => {
          const paymentDate = dayjs(user.payment_date);
          const expiryDate = paymentDate.add(30, 'day');
          const daysRemaining = expiryDate.diff(dayjs(), 'day');
          const isActive = daysRemaining >= 0;
          csvContent += `${user.name},${user.phone},${user.location},${user.paid_subscription ? 'Paid' : 'Unpaid'},${paymentDate.format('YYYY-MM-DD')},${isActive ? 'Active' : 'Expired'}\n`;
        });
        filename = 'clients.csv';
      } else if (currentTab === 'staff') {
        csvContent = 'Name,Employee ID,Email,Role,Department,Status,Hire Date\n';
        staff.forEach(member => {
          const hireDate = dayjs(member.hire_date);
          csvContent += `${member.name},${member.employee_id},${member.email},${member.role},${member.department},${member.status},${hireDate.format('YYYY-MM-DD')}\n`;
        });
        filename = 'staff.csv';
      }
      
      const blob = new Blob([csvContent], { type: 'text/csv' });
      const url = window.URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url;
      a.download = filename;
      a.click();
      window.URL.revokeObjectURL(url);
      
      Swal.fire({
        title: 'Export Successful',
        text: `${filename} has been downloaded.`,
        icon: 'success',
        timer: 2000,
        showConfirmButton: false
      });
    }

    // ===== EQUIPMENT MANAGEMENT FUNCTIONS =====
    function getStoredEquipment() {
      return JSON.parse(localStorage.getItem('equipmentData') || '[]');
    }

    function saveEquipmentData(data) {
      try {
        localStorage.setItem('equipmentData', JSON.stringify(data));
        return true;
      } catch (error) {
        console.error('Error saving equipment data:', error);
        return false;
      }
    }

    // Initialize with sample data if none exists
    function initializeEquipmentData() {
      if (getStoredEquipment().length === 0) {
        const sampleData = [
          {
            id: '1', name: 'Network Cable Tester', serialNumber: 'NCT-001', category: 'network',
            totalQuantity: 10, availableQuantity: 7, minimumStock: 2,
            brand: 'Fluke', location: 'Main Warehouse',
            description: 'Professional cable testing equipment',
            status: 'in-stock', assignedTo: [], addedBy: 'Supervisor',
            dateAdded: new Date().toISOString(), lastModified: new Date().toISOString()
          },
          {
            id: '2', name: 'Safety Helmets', serialNumber: 'SH-002', category: 'safety',
            totalQuantity: 25, availableQuantity: 18, minimumStock: 5,
            brand: 'ProSafe', location: 'Equipment Room',
            description: 'Hard hats for field technicians',
            status: 'in-stock', assignedTo: ['Mike Johnson', 'Sarah Wilson'], addedBy: 'Supervisor',
            dateAdded: new Date().toISOString(), lastModified: new Date().toISOString()
          },
          {
            id: '3', name: 'Fiber Optic Splicer', serialNumber: 'FOS-003', category: 'tools',
            totalQuantity: 3, availableQuantity: 1, minimumStock: 1,
            brand: 'Fujikura', location: 'Tech Room',
            description: 'Advanced fiber splicing equipment',
            status: 'low-stock', assignedTo: ['Alex Chen', 'David Miller'], addedBy: 'Supervisor',
            dateAdded: new Date().toISOString(), lastModified: new Date().toISOString()
          },
          {
            id: '4', name: 'Ethernet Cables (Cat6)', serialNumber: 'EC6-004', category: 'cables',
            totalQuantity: 100, availableQuantity: 0, minimumStock: 20,
            brand: 'CommScope', location: 'Storage A',
            description: '50-meter Cat6 ethernet cables',
            status: 'out-of-stock', assignedTo: [], addedBy: 'Supervisor',
            dateAdded: new Date().toISOString(), lastModified: new Date().toISOString()
          }
        ];
        saveEquipmentData(sampleData);
      }
    }

    function loadEquipmentTable() {
      const equipmentData = getStoredEquipment();
      const tableBody = document.getElementById('equipmentTableBody');
      
      if (!tableBody) return;

      if (equipmentData.length === 0) {
        tableBody.innerHTML = `
          <tr>
            <td colspan="6" class="px-6 py-8 text-center text-gray-500">
              <div class="flex flex-col items-center">
                <i class="fas fa-boxes text-4xl text-gray-300 mb-3"></i>
                <p class="text-lg font-medium">No equipment registered yet</p>
                <p class="text-sm">Click "Add Equipment" to start managing your inventory</p>
              </div>
            </td>
          </tr>
        `;
        return;
      }

      tableBody.innerHTML = equipmentData.map(equipment => {
        const statusBadge = getStatusBadge(equipment);
        const assignedCount = Array.isArray(equipment.assignedTo) ? equipment.assignedTo.length : 0;
        const assignedText = assignedCount > 0 ? `${assignedCount} tech${assignedCount > 1 ? 's' : ''}` : 'None';

        return `
          <tr class="hover:bg-gray-50">
            <td class="px-6 py-4 whitespace-nowrap">
              <div>
                <div class="text-sm font-medium text-gray-900">${equipment.name}</div>
                <div class="text-sm text-gray-500">${equipment.serialNumber}</div>
              </div>
            </td>
            <td class="px-6 py-4 whitespace-nowrap">
              <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ${getCategoryColor(equipment.category)}">
                ${getCategoryIcon(equipment.category)} ${formatCategory(equipment.category)}
              </span>
            </td>
            <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">
              ${equipment.availableQuantity}/${equipment.totalQuantity}
            </td>
            <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">
              ${assignedText}
            </td>
            <td class="px-6 py-4 whitespace-nowrap">${statusBadge}</td>
            <td class="px-6 py-4 whitespace-nowrap text-sm font-medium space-x-2">
              <button onclick="viewEquipmentDetails('${equipment.id}')" class="text-blue-600 hover:text-blue-900" title="View Details">
                <i class="fas fa-eye"></i>
              </button>
              <button onclick="editEquipment('${equipment.id}')" class="text-green-600 hover:text-green-900" title="Edit">
                <i class="fas fa-edit"></i>
              </button>
              <button onclick="assignEquipment('${equipment.id}')" class="text-purple-600 hover:text-purple-900" title="Assign to Tech">
                <i class="fas fa-user-plus"></i>
              </button>
              <button onclick="deleteEquipment('${equipment.id}')" class="text-red-600 hover:text-red-900" title="Delete">
                <i class="fas fa-trash"></i>
              </button>
            </td>
          </tr>
        `;
      }).join('');
    }

    function updateEquipmentStats() {
      const equipmentData = getStoredEquipment();
      
      const totalItems = equipmentData.length;
      const inStock = equipmentData.filter(item => item.status === 'in-stock').length;
      const lowStock = equipmentData.filter(item => item.status === 'low-stock').length;
      const outOfStock = equipmentData.filter(item => item.status === 'out-of-stock').length;
      const assignedItems = equipmentData.filter(item => 
        Array.isArray(item.assignedTo) && item.assignedTo.length > 0
      ).length;

      document.getElementById('totalItems').textContent = totalItems;
      document.getElementById('inStock').textContent = inStock;
      document.getElementById('lowStock').textContent = lowStock;
      document.getElementById('outOfStock').textContent = outOfStock;
      document.getElementById('assignedItems').textContent = assignedItems;
    }

    function getStatusBadge(equipment) {
      const statusConfig = {
        'in-stock': { class: 'bg-green-100 text-green-800', text: 'In Stock' },
        'low-stock': { class: 'bg-yellow-100 text-yellow-800', text: 'Low Stock' },
        'out-of-stock': { class: 'bg-red-100 text-red-800', text: 'Out of Stock' }
      };
      
      const config = statusConfig[equipment.status] || { class: 'bg-gray-100 text-gray-800', text: 'Unknown' };
      return `<span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ${config.class}">
        ${config.text}
      </span>`;
    }

    function getCategoryColor(category) {
      const colors = {
        'network': 'bg-blue-100 text-blue-800',
        'tools': 'bg-green-100 text-green-800',
        'cables': 'bg-purple-100 text-purple-800',
        'hardware': 'bg-orange-100 text-orange-800',
        'safety': 'bg-red-100 text-red-800'
      };
      return colors[category] || 'bg-gray-100 text-gray-800';
    }

    function getCategoryIcon(category) {
      const icons = {
        'network': '<i class="fas fa-network-wired mr-1"></i>',
        'tools': '<i class="fas fa-tools mr-1"></i>',
        'cables': '<i class="fas fa-ethernet mr-1"></i>',
        'hardware': '<i class="fas fa-microchip mr-1"></i>',
        'safety': '<i class="fas fa-shield-alt mr-1"></i>'
      };
      return icons[category] || '<i class="fas fa-box mr-1"></i>';
    }

    function formatCategory(category) {
      const names = {
        'network': 'Network Equipment',
        'tools': 'Tools',
        'cables': 'Cables & Accessories',
        'hardware': 'Hardware',
        'safety': 'Safety Equipment'
      };
      return names[category] || category.charAt(0).toUpperCase() + category.slice(1);
    }

    function filterEquipment() {
      const searchTerm = document.getElementById('equipmentSearch').value.toLowerCase();
      const categoryFilter = document.getElementById('categoryFilter').value;
      const statusFilter = document.getElementById('statusFilter').value;
      
      let equipmentData = getStoredEquipment();
      
      // Apply filters
      if (categoryFilter) {
        equipmentData = equipmentData.filter(item => item.category === categoryFilter);
      }
      
      if (statusFilter) {
        equipmentData = equipmentData.filter(item => item.status === statusFilter);
      }
      
      if (searchTerm) {
        equipmentData = equipmentData.filter(item => 
          item.name.toLowerCase().includes(searchTerm) ||
          item.serialNumber.toLowerCase().includes(searchTerm) ||
          item.brand.toLowerCase().includes(searchTerm)
        );
      }
      
      // Update table with filtered data
      updateTableWithData(equipmentData);
    }

    function updateTableWithData(equipmentData) {
      const tableBody = document.getElementById('equipmentTableBody');
      
      if (equipmentData.length === 0) {
        tableBody.innerHTML = `
          <tr>
            <td colspan="6" class="px-6 py-8 text-center text-gray-500">
              <div class="flex flex-col items-center">
                <i class="fas fa-search text-4xl text-gray-300 mb-3"></i>
                <p class="text-lg font-medium">No equipment found</p>
                <p class="text-sm">Try adjusting your search criteria</p>
              </div>
            </td>
          </tr>
        `;
        return;
      }

      tableBody.innerHTML = equipmentData.map(equipment => {
        const statusBadge = getStatusBadge(equipment);
        const assignedCount = Array.isArray(equipment.assignedTo) ? equipment.assignedTo.length : 0;
        const assignedText = assignedCount > 0 ? `${assignedCount} tech${assignedCount > 1 ? 's' : ''}` : 'None';

        return `
          <tr class="hover:bg-gray-50">
            <td class="px-6 py-4 whitespace-nowrap">
              <div>
                <div class="text-sm font-medium text-gray-900">${equipment.name}</div>
                <div class="text-sm text-gray-500">${equipment.serialNumber}</div>
              </div>
            </td>
            <td class="px-6 py-4 whitespace-nowrap">
              <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ${getCategoryColor(equipment.category)}">
                ${getCategoryIcon(equipment.category)} ${formatCategory(equipment.category)}
              </span>
            </td>
            <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">
              ${equipment.availableQuantity}/${equipment.totalQuantity}
            </td>
            <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">
              ${assignedText}
            </td>
            <td class="px-6 py-4 whitespace-nowrap">${statusBadge}</td>
            <td class="px-6 py-4 whitespace-nowrap text-sm font-medium space-x-2">
              <button onclick="viewEquipmentDetails('${equipment.id}')" class="text-blue-600 hover:text-blue-900" title="View Details">
                <i class="fas fa-eye"></i>
              </button>
              <button onclick="editEquipment('${equipment.id}')" class="text-green-600 hover:text-green-900" title="Edit">
                <i class="fas fa-edit"></i>
              </button>
              <button onclick="assignEquipment('${equipment.id}')" class="text-purple-600 hover:text-purple-900" title="Assign to Tech">
                <i class="fas fa-user-plus"></i>
              </button>
              <button onclick="deleteEquipment('${equipment.id}')" class="text-red-600 hover:text-red-900" title="Delete">
                <i class="fas fa-trash"></i>
              </button>
            </td>
          </tr>
        `;
      }).join('');
    }

    function openAddEquipmentModal() {
      Swal.fire({
        title: 'Add New Equipment',
        html: `
          <div class="text-left space-y-4">
            <div>
              <label class="block text-gray-700 font-medium mb-2">Equipment Name</label>
              <input type="text" id="equipName" class="w-full px-4 py-2 border border-gray-300 rounded-lg" placeholder="e.g., Network Cable Tester">
            </div>
            <div>
              <label class="block text-gray-700 font-medium mb-2">Serial Number</label>
              <input type="text" id="equipSerial" class="w-full px-4 py-2 border border-gray-300 rounded-lg" placeholder="e.g., NCT-001">
            </div>
            <div>
              <label class="block text-gray-700 font-medium mb-2">Category</label>
              <select id="equipCategory" class="w-full px-4 py-2 border border-gray-300 rounded-lg">
                <option value="network">Network Equipment</option>
                <option value="tools">Tools</option>
                <option value="cables">Cables & Accessories</option>
                <option value="hardware">Hardware</option>
                <option value="safety">Safety Equipment</option>
              </select>
            </div>
            <div>
              <label class="block text-gray-700 font-medium mb-2">Brand</label>
              <input type="text" id="equipBrand" class="w-full px-4 py-2 border border-gray-300 rounded-lg" placeholder="e.g., Fluke">
            </div>
            <div>
              <label class="block text-gray-700 font-medium mb-2">Total Quantity</label>
              <input type="number" id="equipQuantity" class="w-full px-4 py-2 border border-gray-300 rounded-lg" min="1" value="1">
            </div>
            <div>
              <label class="block text-gray-700 font-medium mb-2">Minimum Stock Level</label>
              <input type="number" id="equipMinStock" class="w-full px-4 py-2 border border-gray-300 rounded-lg" min="0" value="1">
            </div>
            <div>
              <label class="block text-gray-700 font-medium mb-2">Location</label>
              <input type="text" id="equipLocation" class="w-full px-4 py-2 border border-gray-300 rounded-lg" placeholder="e.g., Main Warehouse">
            </div>
            <div>
              <label class="block text-gray-700 font-medium mb-2">Description</label>
              <textarea id="equipDescription" class="w-full px-4 py-2 border border-gray-300 rounded-lg" rows="3" placeholder="Equipment description..."></textarea>
            </div>
          </div>
        `,
        showCancelButton: true,
        confirmButtonText: 'Add Equipment',
        confirmButtonColor: '#3b82f6',
        cancelButtonColor: '#6b7280',
        width: '600px',
        preConfirm: () => {
          const name = document.getElementById('equipName').value.trim();
          const serial = document.getElementById('equipSerial').value.trim();
          const category = document.getElementById('equipCategory').value;
          const brand = document.getElementById('equipBrand').value.trim();
          const quantity = parseInt(document.getElementById('equipQuantity').value) || 1;
          const minStock = parseInt(document.getElementById('equipMinStock').value) || 0;
          const location = document.getElementById('equipLocation').value.trim();
          const description = document.getElementById('equipDescription').value.trim();
          
          if (!name || !serial) {
            Swal.showValidationMessage('Please fill in equipment name and serial number');
            return false;
          }
          
          return { name, serial, category, brand, quantity, minStock, location, description };
        }
      }).then((result) => {
        if (result.isConfirmed) {
          const equipmentData = getStoredEquipment();
          const newEquipment = {
            id: Date.now().toString(),
            name: result.value.name,
            serialNumber: result.value.serial,
            category: result.value.category,
            brand: result.value.brand,
            totalQuantity: result.value.quantity,
            availableQuantity: result.value.quantity,
            minimumStock: result.value.minStock,
            location: result.value.location,
            description: result.value.description,
            status: result.value.quantity > result.value.minStock ? 'in-stock' : 
                   result.value.quantity === 0 ? 'out-of-stock' : 'low-stock',
            assignedTo: [],
            addedBy: 'Supervisor',
            dateAdded: new Date().toISOString(),
            lastModified: new Date().toISOString()
          };
          
          equipmentData.push(newEquipment);
          saveEquipmentData(equipmentData);
          loadEquipmentTable();
          updateEquipmentStats();
          
          Swal.fire('Success!', 'Equipment added successfully.', 'success');
        }
      });
    }

    function editEquipment(id) {
      const equipment = equipmentData.find(e => e.id === id);
      if (!equipment) return;
      
      Swal.fire({
        title: 'Edit Equipment Status',
        html: `
          <div class="text-left">
            <div class="mb-4">
              <label class="block text-gray-700 font-medium mb-2">Status</label>
              <select id="equipStatus" class="w-full px-4 py-2 border border-gray-300 rounded-lg">
                <option value="available" ${equipment.status === 'available' ? 'selected' : ''}>Available</option>
                <option value="in-use" ${equipment.status === 'in-use' ? 'selected' : ''}>In Use</option>
                <option value="maintenance" ${equipment.status === 'maintenance' ? 'selected' : ''}>Maintenance</option>
              </select>
            </div>
            <div class="mb-4">
              <label class="block text-gray-700 font-medium mb-2">Assigned To</label>
              <input type="text" id="equipAssigned" value="${equipment.assignedTo}" class="w-full px-4 py-2 border border-gray-300 rounded-lg">
            </div>
          </div>
        `,
        showCancelButton: true,
        confirmButtonText: 'Update',
        confirmButtonColor: '#3b82f6',
        preConfirm: () => {
          const status = document.getElementById('equipStatus').value;
          const assignedTo = document.getElementById('equipAssigned').value;
          return { status, assignedTo };
        }
      }).then((result) => {
        if (result.isConfirmed) {
          equipment.status = result.value.status;
          equipment.assignedTo = result.value.assignedTo;
          equipment.lastUpdated = new Date().toISOString().split('T')[0];
          
          loadEquipmentTable();
          updateEquipmentStats();
          
          Swal.fire('Success!', 'Equipment updated successfully.', 'success');
        }
      });
    }

    function deleteEquipment(id) {
      Swal.fire({
        title: 'Delete Equipment?',
        text: 'This action cannot be undone.',
        icon: 'warning',
        showCancelButton: true,
        confirmButtonColor: '#ef4444',
        confirmButtonText: 'Delete'
      }).then((result) => {
        if (result.isConfirmed) {
          equipmentData = equipmentData.filter(e => e.id !== id);
          loadEquipmentTable();
          updateEquipmentStats();
          Swal.fire('Deleted!', 'Equipment has been deleted.', 'success');
        }
      });
    }

    // Additional equipment management functions
    function viewEquipmentDetails(equipmentId) {
      const equipmentData = getStoredEquipment();
      const equipment = equipmentData.find(item => item.id === equipmentId);
      if (!equipment) return;

      const assignedList = Array.isArray(equipment.assignedTo) && equipment.assignedTo.length > 0 ? 
        equipment.assignedTo.join(', ') : 'None assigned';

      Swal.fire({
        title: 'Equipment Details',
        html: `
          <div class="text-left space-y-4">
            <div class="grid grid-cols-2 gap-4">
              <div>
                <label class="block text-sm font-medium text-gray-700">Equipment Name</label>
                <p class="text-sm text-gray-900">${equipment.name}</p>
              </div>
              <div>
                <label class="block text-sm font-medium text-gray-700">Serial Number</label>
                <p class="text-sm text-gray-900">${equipment.serialNumber}</p>
              </div>
              <div>
                <label class="block text-sm font-medium text-gray-700">Category</label>
                <p class="text-sm text-gray-900">${formatCategory(equipment.category)}</p>
              </div>
              <div>
                <label class="block text-sm font-medium text-gray-700">Brand</label>
                <p class="text-sm text-gray-900">${equipment.brand || 'N/A'}</p>
              </div>
              <div>
                <label class="block text-sm font-medium text-gray-700">Total Quantity</label>
                <p class="text-sm text-gray-900">${equipment.totalQuantity}</p>
              </div>
              <div>
                <label class="block text-sm font-medium text-gray-700">Available</label>
                <p class="text-sm text-gray-900">${equipment.availableQuantity}</p>
              </div>
            </div>
            <div>
              <label class="block text-sm font-medium text-gray-700">Assigned To</label>
              <p class="text-sm text-gray-900">${assignedList}</p>
            </div>
            <div>
              <label class="block text-sm font-medium text-gray-700">Description</label>
              <p class="text-sm text-gray-900">${equipment.description || 'No description available'}</p>
            </div>
          </div>
        `,
        confirmButtonText: 'Close',
        confirmButtonColor: '#3b82f6',
        width: '600px'
      });
    }

    function assignEquipment(equipmentId) {
      const equipmentData = getStoredEquipment();
      const equipment = equipmentData.find(item => item.id === equipmentId);
      if (!equipment) return;

      Swal.fire({
        title: 'Assign Equipment',
        html: `
          <div class="text-left space-y-4">
            <div>
              <label class="block text-gray-700 font-medium mb-2">Equipment: ${equipment.name}</label>
              <p class="text-sm text-gray-600">Available: ${equipment.availableQuantity}/${equipment.totalQuantity}</p>
            </div>
            <div>
              <label class="block text-gray-700 font-medium mb-2">Assign to Technician</label>
              <input type="text" id="techName" class="w-full px-4 py-2 border border-gray-300 rounded-lg" placeholder="Technician name">
            </div>
          </div>
        `,
        showCancelButton: true,
        confirmButtonText: 'Assign Equipment',
        confirmButtonColor: '#3b82f6',
        preConfirm: () => {
          const techName = document.getElementById('techName').value.trim();
          if (!techName) {
            Swal.showValidationMessage('Please enter technician name');
            return false;
          }
          return { techName };
        }
      }).then((result) => {
        if (result.isConfirmed) {
          if (!Array.isArray(equipment.assignedTo)) {
            equipment.assignedTo = [];
          }
          equipment.assignedTo.push(result.value.techName);
          if (equipment.availableQuantity > 0) {
            equipment.availableQuantity -= 1;
          }
          equipment.lastModified = new Date().toISOString();
          
          saveEquipmentData(equipmentData);
          loadEquipmentTable();
          updateEquipmentStats();
          
          Swal.fire('Success!', `Equipment assigned to ${result.value.techName}`, 'success');
        }
      });
    }

    function downloadInventoryReport() {
      const equipmentData = getStoredEquipment();
      
      if (equipmentData.length === 0) {
        Swal.fire({
          title: 'No Data',
          text: 'No equipment data available to export.',
          icon: 'info',
          confirmButtonColor: '#3b82f6'
        });
        return;
      }

      // Create CSV content
      const headers = ['Name', 'Serial Number', 'Category', 'Total Qty', 'Available Qty', 'Status', 'Location'];
      const csvContent = [
        headers.join(','),
        ...equipmentData.map(item => [
          `"${item.name}"`,
          `"${item.serialNumber}"`,
          `"${formatCategory(item.category)}"`,
          item.totalQuantity,
          item.availableQuantity,
          `"${item.status}"`,
          `"${item.location || 'N/A'}"`
        ].join(','))
      ].join('\n');

      // Download CSV
      const blob = new Blob([csvContent], { type: 'text/csv' });
      const url = window.URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url;
      a.download = `equipment-inventory-${new Date().toISOString().split('T')[0]}.csv`;
      document.body.appendChild(a);
      a.click();
      document.body.removeChild(a);
      window.URL.revokeObjectURL(url);

      Swal.fire('Success!', 'Equipment inventory report downloaded successfully.', 'success');
    }

    function exportEquipmentData() {
      const csvContent = "data:text/csv;charset=utf-8," 
        + "Name,Serial,Category,Status,Assigned To,Last Updated\\n"
        + equipmentData.map(e => `"${e.name}","${e.serial}","${e.category}","${e.status}","${e.assignedTo}","${e.lastUpdated}"`).join("\\n");
      
      const encodedUri = encodeURI(csvContent);
      const link = document.createElement("a");
      link.setAttribute("href", encodedUri);
      link.setAttribute("download", "equipment_inventory.csv");
      document.body.appendChild(link);
      link.click();
      document.body.removeChild(link);
      
      Swal.fire('Success!', 'Equipment data exported successfully.', 'success');
    }

    // ===== REPORTS MANAGEMENT FUNCTIONS =====
    let reportsData = [
      {id: 1, name: 'Daily Activity Report', type: 'daily', generatedBy: 'John Supervisor', date: '2025-11-02', status: 'approved'},
      {id: 2, name: 'Equipment Status Report', type: 'equipment', generatedBy: 'John Supervisor', date: '2025-11-01', status: 'pending'},
      {id: 3, name: 'Staff Performance Report', type: 'staff', generatedBy: 'System', date: '2025-11-01', status: 'approved'},
      {id: 4, name: 'Incident Report #001', type: 'incident', generatedBy: 'Mike Johnson', date: '2025-10-31', status: 'approved'}
    ];

    function loadReportsTable() {
      const tbody = document.getElementById('reportsTableBody');
      if (!tbody) return;
      
      tbody.innerHTML = reportsData.map(report => `
        <tr class="border-b border-gray-100 hover:bg-gray-50">
          <td class="py-3 px-4">${report.name}</td>
          <td class="py-3 px-4">
            <span class="px-2 py-1 bg-blue-100 text-blue-800 rounded text-xs">${report.type}</span>
          </td>
          <td class="py-3 px-4">${report.generatedBy}</td>
          <td class="py-3 px-4">${report.date}</td>
          <td class="py-3 px-4">
            <span class="px-3 py-1 rounded-full text-xs font-medium ${report.status === 'approved' ? 'bg-green-100 text-green-800' : 'bg-yellow-100 text-yellow-800'}">
              ${report.status.toUpperCase()}
            </span>
          </td>
          <td class="py-3 px-4">
            <button onclick="viewReport(${report.id})" class="text-blue-600 hover:text-blue-800 mr-2">
              <i class="fas fa-eye"></i>
            </button>
            <button onclick="downloadReport(${report.id})" class="text-green-600 hover:text-green-800 mr-2">
              <i class="fas fa-download"></i>
            </button>
            <button onclick="deleteReport(${report.id})" class="text-red-600 hover:text-red-800">
              <i class="fas fa-trash"></i>
            </button>
          </td>
        </tr>
      `).join('');
    }

    function generateDailyReport() {
      Swal.fire({
        title: 'Generating Daily Report...',
        text: 'Please wait while we compile your daily activity report.',
        allowOutsideClick: false,
        didOpen: () => {
          Swal.showLoading();
        }
      });
      
      setTimeout(() => {
        const newReport = {
          id: Date.now(),
          name: `Daily Activity Report - ${new Date().toISOString().split('T')[0]}`,
          type: 'daily',
          generatedBy: 'John Supervisor',
          date: new Date().toISOString().split('T')[0],
          status: 'pending'
        };
        
        reportsData.unshift(newReport);
        loadReportsTable();
        
        Swal.fire('Success!', 'Daily report generated successfully.', 'success');
      }, 2000);
    }

    function viewReport(id) {
      const report = reportsData.find(r => r.id === id);
      if (!report) return;
      
      Swal.fire({
        title: report.name,
        html: `
          <div class="text-left">
            <p><strong>Type:</strong> ${report.type}</p>
            <p><strong>Generated By:</strong> ${report.generatedBy}</p>
            <p><strong>Date:</strong> ${report.date}</p>
            <p><strong>Status:</strong> ${report.status}</p>
            <hr class="my-4">
            <p class="text-gray-600">Report content would be displayed here...</p>
          </div>
        `,
        width: 600,
        confirmButtonText: 'Close'
      });
    }

    function downloadReport(id) {
      const report = reportsData.find(r => r.id === id);
      if (!report) return;
      
      Swal.fire('Download Started!', `Downloading ${report.name}...`, 'success');
    }

    function deleteReport(id) {
      Swal.fire({
        title: 'Delete Report?',
        text: 'This action cannot be undone.',
        icon: 'warning',
        showCancelButton: true,
        confirmButtonColor: '#ef4444',
        confirmButtonText: 'Delete'
      }).then((result) => {
        if (result.isConfirmed) {
          reportsData = reportsData.filter(r => r.id !== id);
          loadReportsTable();
          Swal.fire('Deleted!', 'Report has been deleted.', 'success');
        }
      });
    }

    // ===== TEAM COMMUNICATION FUNCTIONS =====
    let chatMessages = [
      {id: 1, sender: 'Mike Johnson', message: 'Installation at Site A completed successfully.', time: '10:30 AM', type: 'received'},
      {id: 2, sender: 'John Supervisor', message: 'Great work! Please move to Site B for the next assignment.', time: '10:35 AM', type: 'sent'},
      {id: 3, sender: 'Sarah Wilson', message: 'Equipment delivered to warehouse.', time: '11:00 AM', type: 'received'}
    ];

    let teamMembers = [
      {id: 1, name: 'Mike Johnson', status: 'online', role: 'Technician'},
      {id: 2, name: 'Sarah Wilson', status: 'online', role: 'Technician'},
      {id: 3, name: 'David Brown', status: 'away', role: 'Technician'},
      {id: 4, name: 'Emily Davis', status: 'offline', role: 'Assistant'}
    ];

    function loadChatMessages() {
      const container = document.getElementById('chatMessages');
      if (!container) return;
      
      container.innerHTML = chatMessages.map(msg => `
        <div class="flex ${msg.type === 'sent' ? 'justify-end' : 'justify-start'}">
          <div class="message-${msg.type} px-4 py-2 max-w-xs">
            ${msg.type === 'received' ? `<div class="text-xs opacity-75 mb-1">${msg.sender}</div>` : ''}
            <div>${msg.message}</div>
            <div class="text-xs opacity-75 mt-1">${msg.time}</div>
          </div>
        </div>
      `).join('');
      
      container.scrollTop = container.scrollHeight;
    }

    function loadTeamMembers() {
      const container = document.getElementById('teamMembers');
      if (!container) return;
      
      container.innerHTML = teamMembers.map(member => `
        <div class="flex items-center justify-between">
          <div class="flex items-center">
            <div class="w-8 h-8 bg-gray-300 rounded-full flex items-center justify-center mr-3">
              <i class="fas fa-user text-sm"></i>
            </div>
            <div>
              <p class="font-medium text-sm">${member.name}</p>
              <p class="text-xs text-gray-500">${member.role}</p>
            </div>
          </div>
          <div class="w-2 h-2 rounded-full ${member.status === 'online' ? 'bg-green-500' : member.status === 'away' ? 'bg-yellow-500' : 'bg-gray-400'}"></div>
        </div>
      `).join('');
    }

    function sendMessage() {
      const input = document.getElementById('messageInput');
      if (!input || !input.value.trim()) return;
      
      const newMessage = {
        id: Date.now(),
        sender: 'John Supervisor',
        message: input.value.trim(),
        time: new Date().toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'}),
        type: 'sent'
      };
      
      chatMessages.push(newMessage);
      loadChatMessages();
      input.value = '';
    }

    function clearChat() {
      Swal.fire({
        title: 'Clear Chat?',
        text: 'This will remove all messages from the chat.',
        icon: 'warning',
        showCancelButton: true,
        confirmButtonColor: '#ef4444',
        confirmButtonText: 'Clear'
      }).then((result) => {
        if (result.isConfirmed) {
          chatMessages = [];
          loadChatMessages();
          Swal.fire('Cleared!', 'Chat has been cleared.', 'success');
        }
      });
    }

    function refreshChat() {
      loadChatMessages();
      Swal.fire({
        text: 'Chat refreshed',
        icon: 'success',
        timer: 1000,
        showConfirmButton: false
      });
    }

    // ===== SETTINGS FUNCTIONS =====
    function showSettingsTab(tabName) {
      // Hide all tab contents
      document.querySelectorAll('.settings-tab-content').forEach(tab => {
        tab.style.display = 'none';
      });
      
      // Remove active class from all buttons
      document.querySelectorAll('.settings-tab-btn').forEach(btn => {
        btn.classList.remove('active');
      });
      
      // Show selected tab
      const targetTab = document.getElementById(tabName + 'Settings');
      if (targetTab) {
        targetTab.style.display = 'block';
      }
      
      // Add active class to clicked button
      event.target.classList.add('active');
    }

    // Initialize new sections when they are loaded
    document.addEventListener('DOMContentLoaded', function() {
      // Initialize equipment section
      if (document.getElementById('equipmentTableBody')) {
        loadEquipmentTable();
        updateEquipmentStats();
      }
      
      // Initialize reports section
      if (document.getElementById('reportsTableBody')) {
        loadReportsTable();
      }
      
      // Initialize communication section
      if (document.getElementById('chatMessages')) {
        loadChatMessages();
        loadTeamMembers();
        
        // Add enter key listener for chat
        const messageInput = document.getElementById('messageInput');
        if (messageInput) {
          messageInput.addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
              sendMessage();
            }
          });
        }
      }
    });
  </script>
</body>
</html>
</html>